%!PS-Adobe-2.0
%%Creator: dvipsk 5.58e Copyright 1986, 1994 Radical Eye Software
%%Pages: 44
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%EndComments
%DVIPSCommandLine: dvips -f
%DVIPSParameters: dpi=300, comments removed
%DVIPSSource:  TeX output 1995.03.28:1643
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
TeXDict begin 39158280 55380996 1000 300 300 () @start
/Fa 60 126 df<E038F078F078F078F078F078F078F078E038E03860300D0B7C9816>34
D<00C00001C00001C00001C00007F0001FFC003FFE007DCF0071C780E1C380E1C780E1C7
80F1C30079C0003FC0001FF00007FC0001FE0001CF0001C70061C380F1C380F1C380E1C3
8071C70079DF003FFE001FF80007E00001C00001C00000C00011207E9C16>36
D<30787C3C1C1C1C1C3878F0E040060D789816>39 D<00E001E0038007000E001C001C00
38003800700070007000E000E000E000E000E000E000E000E000E0007000700070003800
38001C001C000E000700038001E000E00B217A9C16>I<C000E000700038001C000E000E
000700070003800380038001C001C001C001C001C001C001C001C001C003800380038007
0007000E000E001C0038007000E000C0000A217B9C16>I<00E00000E00000E00000E000
00E00000E00000E00000E000FFFFE0FFFFE0FFFFE000E00000E00000E00000E00000E000
00E00000E00000E00013137F9516>43 D<387C7E7E3E0E1E1C78F060070B798416>I<FF
FF80FFFF80FFFF8011037E8D16>I<70F8F8F8700505788416>I<03E0000FF8001FFC001E
3C00380E00780F00700700700700E00380E00380E00380E00380E00380E00380E00380E0
0380F00780700700700700780F003C1E001E3C001FFC000FF80003E00011197E9816>48
D<0300070007000F001F00FF00FF00E70007000700070007000700070007000700070007
000700070007000700FFF8FFF8FFF80D197B9816>I<70F8F8F870000000000000000070
F8F8F8700512789116>58 D<000180000780001F80003E0000F80001F00007C0000F8000
3E0000FC0000F00000FC00003E00000F800007C00001F00000F800003E00001F80000780
00018011157E9616>60 D<7FFFC0FFFFE0FFFFE0000000000000000000000000000000FF
FFE0FFFFE07FFFC0130B7F9116>I<C00000F00000FC00003E00000F800007C00001F000
00F800003E00001F80000780001F80003E0000F80001F00007C0000F80003E0000FC0000
F00000C0000011157E9616>I<00E00001F00001F00001B00001B00003B80003B80003B8
00031800071C00071C00071C00071C00071C000E0E000E0E000FFE000FFE001FFF001C07
001C07001C07007E0FC0FF1FE07E0FC013197F9816>65 D<7FF800FFFE007FFF001C0700
1C07801C03801C03801C03801C03801C07001FFF001FFE001FFE001C1F001C03801C03C0
1C01C01C01C01C01C01C01C01C03C01C07807FFF80FFFF007FFC0012197F9816>I<7FF8
00FFFE007FFF001C0F001C07801C03C01C01C01C01C01C01E01C00E01C00E01C00E01C00
E01C00E01C00E01C00E01C00E01C01C01C01C01C03C01C07801C0F807FFF00FFFE007FF8
001319809816>68 D<7FFFC0FFFFC07FFFC01C01C01C01C01C01C01C01C01C00001C0000
1C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C00E01C00E01C00E01C00E0
1C00E07FFFE0FFFFE07FFFE013197F9816>I<7FFFE0FFFFE07FFFE01C00E01C00E01C00
E01C00E01C00001C00001C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C00
001C00001C00001C00001C00007F8000FFC0007F800013197F9816>I<7FFCFFFE7FFC03
800380038003800380038003800380038003800380038003800380038003800380038003
807FFCFFFE7FFC0F197D9816>73 D<7E07F0FF0FF87F07F01D81C01D81C01D81C01DC1C0
1CC1C01CE1C01CE1C01C61C01C71C01C71C01C71C01C31C01C39C01C39C01C19C01C1DC0
1C0DC01C0DC01C0DC07F07C0FF87C07F03C01519809816>78 D<7FF800FFFE007FFF001C
0F801C03801C03C01C01C01C01C01C01C01C03C01C03801C0F801FFF001FFE001FF8001C
00001C00001C00001C00001C00001C00001C00007F0000FF80007F000012197F9816>80
D<07E3001FFF003FFF00781F00F00700E00700E00700E00000F000007800003F80001FF0
0007FC0000FE00000F00000700000380000380600380E00380E00700F80F00FFFE00FFFC
00C7F00011197E9816>83 D<7FFFE0FFFFE0FFFFE0E0E0E0E0E0E0E0E0E0E0E0E000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E00000E00007FC000FFE0007FC0013197F9816>I<7F07F0FF8FF87F07F01C01C01C01
C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01
C01C01C01C01C00E03800E038007070007FF0003FE0000F8001519809816>I<FFF0FFF0
FFF0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000FFF0FFF0FFF00C20789C16>91
D<C00000E00000E000007000007000003800003800001C00001C00000E00000E00000700
0007000003800003800001C00001C00000E00000E000007000007000003800003800001C
00001C00000E00000E0000070000070000038000038000018011207E9C16>I<FFF0FFF0
FFF000700070007000700070007000700070007000700070007000700070007000700070
007000700070007000700070007000700070FFF0FFF0FFF00C207F9C16>I<FFFF80FFFF
80FFFF8011037E7E16>95 D<081C3C7870E0E0E0E0F0F87830060D789B16>I<1FE0003F
F0007FF800783C00300E00000E00000E0003FE001FFE003E0E00700E00E00E00E00E00E0
0E00783E007FFFE03FE7E00F83E013127E9116>I<FC0000FC0000FC00001C00001C0000
1C00001C00001C7C001DFE001FFF001F07801E03C01C01C01C00E01C00E01C00E01C00E0
1C00E01C00E01C01C01E03C01F07801FFF001DFE000C780013197F9816>I<03F80FFC1F
FE3C1E780C7000E000E000E000E000E000F000700778073E0E1FFC0FF803F010127D9116
>I<003F00003F00003F0000070000070000070000070003C7000FF7001FFF003C1F0078
0F00700700E00700E00700E00700E00700E00700E00700700F00780F003C1F001FFFE00F
F7E007C7E013197F9816>I<03F0000FFC001FFE003C0F00780700700380E00380FFFF80
FFFF80FFFF80E00000E000007003807803803E07801FFF0007FE0001F80011127E9116>
I<001E00007F0001FF8001C7800383000380000380007FFF00FFFF00FFFF000380000380
000380000380000380000380000380000380000380000380000380000380007FFC00FFFE
007FFC0011197F9816>I<03E3C007F7E00FFFE01C1CC0380E00380E00380E00380E0038
0E001C1C000FF8001FF0001BE0003800001800001FFC001FFF003FFF807003C0E000E0E0
00E0E000E0E000E07001C07C07C03FFF800FFE0003F800131C7F9116>I<FC0000FC0000
FC00001C00001C00001C00001C00001C78001DFC001FFE001F0F001E07001C07001C0700
1C07001C07001C07001C07001C07001C07001C07001C0700FF8FE0FF9FE0FF8FE013197F
9816>I<03000780078003000000000000000000FF80FF80FF8003800380038003800380
0380038003800380038003800380FFFCFFFEFFFC0F1A7C9916>I<003000780078003000
000000000000000FF81FF80FF80038003800380038003800380038003800380038003800
3800380038003800380038003800386070F0F0FFE07FC03F800D237E9916>I<7E0000FE
00007E00000E00000E00000E00000E00000E7FE00E7FE00E7FE00E0F000E1E000E3C000E
78000EF0000FF0000FF8000FBC000F1E000E0E000E07000E07807F87F0FFCFF07F87F014
19809816>I<7FC000FFC0007FC00001C00001C00001C00001C00001C00001C00001C000
01C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C000
7FFF00FFFF807FFF0011197E9816>I<F9C380FFEFC0FFFFE03C78E03C78E03870E03870
E03870E03870E03870E03870E03870E03870E03870E03870E0FE7CF8FE7CF8FE7CF81512
809116>I<FC7800FDFC00FFFE001F0F001E07001C07001C07001C07001C07001C07001C
07001C07001C07001C07001C0700FF8FE0FF9FE0FF8FE013127F9116>I<03E0000FF800
1FFC003C1E00780F00700700E00380E00380E00380E00380E00380F00780700700780F00
3C1E001FFC000FF80003E00011127E9116>I<FC7C00FDFE00FFFF001F07801E03C01C01
C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01E03C01F07801FFF001DFE001C78
001C00001C00001C00001C00001C00001C0000FF8000FF8000FF8000131B7F9116>I<03
E3800FF3801FFB803E0F80780780700780E00380E00380E00380E00380E00380E0038070
07807807803C1F801FFB800FF38003E38000038000038000038000038000038000038000
1FF0003FF8001FF0151B7F9116>I<7F0FC0FF3FE07F7FE007F04007C000078000078000
0700000700000700000700000700000700000700000700007FFC00FFFC007FFC0013127F
9116>I<0FEC3FFC7FFCF03CE01CE01C70007F801FF007F8003C600EE00EF00EF81EFFFC
FFF8C7E00F127D9116>I<0300000700000700000700000700007FFF00FFFF00FFFF0007
000007000007000007000007000007000007000007010007038007038007038007870003
FE0001FC0000F80011177F9616>I<FC3F00FC3F00FC3F001C07001C07001C07001C0700
1C07001C07001C07001C07001C07001C07001C07001C1F001FFFE00FF7E007C7E013127F
9116>I<7F1FC0FF9FE07F1FC01C07001C07000E0E000E0E000E0E00071C00071C00071C
00071C0003B80003B80003B80001F00001F00000E00013127F9116>I<FF1FE0FF1FE0FF
1FE038038038038038038038038039F38039F38019F30019B30019B30019B3001DB7001D
17001F1F000F1E000E0E0013127F9116>I<7F1FC07F3FC07F1FC00F1E00073C0003B800
03F00001F00000E00001E00001F00003B800073C00071C000E0E007F1FC0FF3FE07F1FC0
13127F9116>I<7F1FC0FF9FE07F1FC01C07000E07000E0E000E0E00070E00071C00071C
00039C00039C0003980001B80001B80000F00000F00000F00000E00000E00000E00001C0
0079C0007BC0007F80007F00003C0000131B7F9116>I<3FFFC07FFFC07FFFC070078070
0F00701E00003C0000780001F00003E0000780000F00001E01C03C01C07801C0FFFFC0FF
FFC0FFFFC012127F9116>I<001F80007F8000FF8001E00001C00001C00001C00001C000
01C00001C00001C00001C00001C00003C0007F8000FF0000FF00007F800003C00001C000
01C00001C00001C00001C00001C00001C00001C00001C00001E00000FF80007F80001F80
11207E9C16>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0
E0E0E00320779C16>I<7C0000FF0000FF800003C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001E00000FF00007F80007F8000FF0001E00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00003C000FF8000FF00007C00001120
7E9C16>I E /Fb 3 120 df<3C000C000C00180018001800187031903230340038007F00
618061906190C1A0C0C00C117E9010>107 D<73C05C2098609800180030003000300030
00600060000B0B7E8A0E>114 D<3810C04830C08C304098304018304030608030608030
608030610010A2000F1C00120B7E8A16>119 D E /Fc 1 4 df<E0000000F8000000DE00
0000C7800000C1E00000C0780000C01E0000C0078000C001E000C0007800C0001E00C000
0780C0000780C0001E00C0007800C001E000C0078000C01E0000C0780000C1E00000C780
0000DE000000F8000000E000000019187D9520>3 D E /Fd 17 66
df<FFFFC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0FFFF0831798111>2 D<FFFF0303030303030303030303
03030303030303030303030303030303030303030303030303030303030303030303FFFF
08317F8111>I<0000300000600000C0000180000300000700000E00000C000018000038
0000300000700000E00000C00001C0000180000380000380000300000700000600000E00
000E00000C00001C00001C00001C00001800003800003800003800003800007000007000
00700000700000700000700000700000E00000E00000E00000E00000E00000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E00000E000007000007000007000007000007000007000007000003800003800003800
003800001800001C00001C00001C00000C00000E00000E00000600000700000300000380
0003800001800001C00000C00000E000007000003000003800001800000C00000E000007
000003000001800000C0000060000030146377811F>18 D<C00000600000300000180000
0C00000E000007000003000001800001C00000C00000E000007000003000003800001800
001C00001C00000C00000E00000600000700000700000300000380000380000380000180
0001C00001C00001C00001C00000E00000E00000E00000E00000E00000E00000E0000070
000070000070000070000070000070000070000070000070000070000070000070000070
0000700000700000700000700000700000700000700000700000E00000E00000E00000E0
0000E00000E00000E00001C00001C00001C00001C0000180000380000380000380000300
000700000700000600000E00000C00001C00001C0000180000380000300000700000E000
00C00001C0000180000300000700000E00000C0000180000300000600000C0000014637F
811F>I<0000700001F00003C0000780000E00001C0000380000700000700000F00000E0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00001C00001C00001C0000380000700000600000E00
00380000700000C000007000003800000E000006000007000003800001C00001C00001C0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00000E00000F000007000007000003800001C00000E
000007800003C00001F000007014637B811F>26 D<E00000F000007C00001E00000F0000
07000003800001C00001C00000E00000E00000E00000E00000E00000E00000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000007000
007000003800003800001C00000E000007000003C00000F00000700000E00003C0000700
000E00001C0000380000380000700000700000E00000E00000E00000E00000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E00001C00001C0000380000700000F00001E00007C0000F00000E0000014637B811F>
I<00000C0000180000380000300000600000E00000C00001C00003800003800007000007
00000E00000E00001C00001C0000380000380000780000700000F00000F00000E00001E0
0001E00003C00003C00003C00003C0000780000780000780000F80000F00000F00000F00
001F00001F00001E00001E00001E00003E00003E00003E00003E00003C00003C00003C00
007C00007C00007C00007C00007C00007C00007C00007C0000780000780000F80000F800
00F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F800
00F80000F80000F80000164B748024>48 D<C000006000007000003000001800001C0000
0C00000E000007000007000003800003800001C00001C00000E00000E000007000007000
007800003800003C00003C00001C00001E00001E00000F00000F00000F00000F00000780
0007800007800007C00003C00003C00003C00003E00003E00001E00001E00001E00001F0
0001F00001F00001F00000F00000F00000F00000F80000F80000F80000F80000F80000F8
0000F80000F800007800007800007C00007C00007C00007C00007C00007C00007C00007C
00007C00007C00007C00007C00007C00007C00007C00007C00007C164B7F8024>I<0018
007800F001E003C007800F001F001E003E003C007C007C007800F800F800F800F800F800
F800F800F800F800F800F800F800F800F800F800F800F800F800F800F800F800F800F800
0D25707E25>56 D<C000F0007C001E000F00078007C003C001E001F000F000F800F800F8
007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C
007C007C007C007C007C0E25797E25>I<F800F800F800F800F800F800F800F800F800F8
00F800F800F800F800F800F800F800F800F800F800F800F800F80078007C007C003C003E
001E001F000F00078003C001E000F0007800180D25708025>I<007C007C007C007C007C
007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C
00F800F800F800F001F001E003C007C007800F001E007C00F000C0000E25798025>I<00
7C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C00
7C007C007C007C007C007C00F800F800F800F001F001E003E003C0078007000E001C0038
00F000C000F00038001C000E000700078003C003E001E001F000F000F800F800F8007C00
7C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C00
7C007C007C007C007C0E4D798025>I<F800F800F800F800F800F800F800F800F800F800
F800F800F800F800F800F800F800F800F800F800F800F800F800F80078007C007C003C00
3C003E001E000F000F00078003C001C000E000780018007800E001C003C007800F000F00
1E003E003C003C007C007C007800F800F800F800F800F800F800F800F800F800F800F800
F800F800F800F800F800F800F800F800F800F800F800F800F8000D4D708025>I<F8F8F8
F8F8F8F8F8F8F8F8F8F8F8050E708025>I<F80000F80000F80000F80000F80000F80000
F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000780000
7800007C00007C00007C00007C00007C00007C00007C00007C00003C00003C00003C0000
3E00003E00003E00003E00001E00001E00001E00001F00001F00000F00000F00000F0000
0F800007800007800007800003C00003C00003C00003C00001E00001E00000E00000F000
00F000007000007800003800003800001C00001C00000E00000E00000700000700000380
0003800001C00000C00000E000006000003000003800001800000C164B748224>64
D<00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C0000
7C00007C00007C00007C00007C00007C0000780000780000F80000F80000F80000F80000
F80000F80000F80000F80000F00000F00000F00001F00001F00001F00001F00001E00001
E00001E00003E00003E00003C00003C00003C00007C0000780000780000780000F00000F
00000F00000F00001E00001E00001C00003C00003C0000380000780000700000700000E0
0000E00001C00001C0000380000380000700000700000E00000C00001C00001800003000
00700000600000C00000164B7F8224>I E /Fe 2 93 df<E1C0E1C0E1C060C040804080
4080C1800A087F9913>34 D<60C0408040804080C180E1C0E1C0E1C00A08799913>92
D E /Ff 2 49 df<FFFFC0FFFFC012027D8618>0 D<081C1C3838383070706060C0C006
0D7E8D09>48 D E /Fg 19 120 df<70F8F8F8700505798414>46
D<0006000E000E001C001C003800380070007000E000E001C001C0038003800380070007
000E000E001C001C003800380070007000E000E000C0000F1D7E9914>I<07C00FE01C70
38383018701C701CE00EE00EE00EE00EE00EE00EE00EE00EE00E701C701C383838381C70
0FE007C00F177E9614>I<0FE03FF8783C701CE00EE00EE00EE00E701C1EF003801FF038
38701CE00EE00EE00EE00EF01E701C38381FF007C00F177E9614>56
D<70F8F8F87000000000000070F8F8F8700510798F14>58 D<1FC0007FF0007078002018
00001C00001C0007FC001FFC003C1C00701C00E01C00E01C00E01C00707C003FFF800F8F
8011107E8F14>97 D<FC0000FC00001C00001C00001C00001C00001C00001CF8001DFE00
1F07001E03001C03801C01C01C01C01C01C01C01C01C01C01C01C01C03801E03001F0E00
1DFC000CF8001217809614>I<03F80FFE1C0E380470006000E000E000E000E000600070
00380E1C1E0FFC03F00F107E8F14>I<07E00FF01C38301C700CE00EE00EFFFEFFFEE000
60007000380E1C1E0FFC03F00F107E8F14>101 D<FC0000FC00001C00001C00001C0000
1C00001C00001C78001DFE001F86001E07001C07001C07001C07001C07001C07001C0700
1C07001C07001C07001C0700FF8FE0FF8FE01317809614>104 D<FC0000FC00001C0000
1C00001C00001C00001C00001CFF801CFF801C1C001C38001C70001CE0001DC0001FE000
1FE0001E70001C38001C3C001C1C001C0E00FF1F80FF1F801117809614>107
D<FF80FF8003800380038003800380038003800380038003800380038003800380038003
80038003800380FFFEFFFE0F177E9614>I<FB8E00FFDF003CF3803CF38038E38038E380
38E38038E38038E38038E38038E38038E38038E38038E380FEFBE0FE79E01310808F14>
I<FCF800FDFE001F07001E03001C03801C01C01C01C01C01C01C01C01C01C01C01C01C03
801E03001F0E001DFC001CF8001C00001C00001C00001C00001C00001C0000FF8000FF80
001218808F14>112 D<FE1F00FE7F800EE3800F81000F00000F00000E00000E00000E00
000E00000E00000E00000E00000E0000FFF000FFF00011107F8F14>114
D<0FD83FF86038C038C038F0007F803FF007F8001C6006E006F006F81CFFF8CFE00F107E
8F14>I<06000E000E000E000E007FFCFFFC0E000E000E000E000E000E000E000E000E0E
0E0E0E0E0E1C07F801F00F157F9414>I<FC3F00FC3F001C07001C07001C07001C07001C
07001C07001C07001C07001C07001C07001C07001C1F000FFFE003E7E01310808F14>I<
FE3F80FE3F80700700380E00380E00380E0039CE0039CE0039CE001B6C001A6C001A6C00
1A6C001E7C001E7C000E380011107F8F14>119 D E /Fh 2 49 df<FFFFC0FFFFC01202
7D871A>0 D<040E0E1C1C1C38383070706060C0C0070F7F8F0A>48
D E /Fi 9 115 df<FFFFFEFFFFFE17027D891E>0 D<C00000F000003C00000F000003C0
0000F000003C00000F000003C00000F000003C00000E00003C0000F00003C0000F00003C
0000F00003C0000F00003C0000700000C000000000000000000000000000000000000000
007FFFFCFFFFFE171F7D971E>21 D<00000180000000018000000000C000000000C00000
000060000000006000000000300000000018000000000C00FFFFFFFF80FFFFFFFF800000
000C000000001800000000300000000060000000006000000000C000000000C000000001
8000000001800021147E9226>33 D<07C001F0001FF0078C00307C0C0200601E18010040
0F30010080076000808003C000808003C000808001E000808001E0008080037000804006
780100400C3C030020181F060018F007FC0007C001F00021107E8F26>49
D<0008001807F80C301838303C706E60666066E067E0C7E0C7E0C7E187E187E187E187E3
07E307E307E60766066606760E3C0C1C180C301FE018001800101E7F9B13>59
D<400008C00018C00018C00018C00018C00018C00018C00018C00018C00018C00018C000
18C00018C00018C00018C00018C000186000303000601E03C00FFF8001FC0015167E951A
>91 D<C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C002257C9B0B>106 D<C000C0006000600060003000300030001800180018000C
000C000C0006000600060003000300030001800180018000C000C000C000600060006000
3000300030001800180018000C00040E257E9B13>110 D<FFFFFFE0FFFFFFE07FFFFFC0
78000040380000803C0001801C0001001E0003000E0002000F0006000700040007800C00
0380080001C0100001C0100000E0200000E0200000704000007040000038800000388000
001D0000001F0000000E0000000E0000000400001B1A7E9920>114
D E /Fj 30 122 df<78FCFCFCFC7806067D850C>46 D<07F0001E3C003C1E00380E0078
0F00780F00780F00F80F80F80F80F80F80F80F80F80F80F80F80F80F80F80F80F80F80F8
0F80F80F80780F00780F00380E003C1E001E3C0007F00011187E9716>48
D<01800780FF80FF80078007800780078007800780078007800780078007800780078007
800780078007800780FFFCFFFC0E187C9716>I<0FF0003FFC00787E00FC1F00FC1F80FC
0F80FC0F80780F80001F80001F00001E00003C0000780000700000E00001800003018006
01800C01801003803FFF007FFF00FFFF00FFFF0011187E9716>I<07F0001FFC00383E00
7C3E007C1F007C1F007C1F00383F00003E00003C0000780007F000003C00003E00001F00
001F80781F80FC1F80FC1F80FC1F00F81F00703E003FFC000FF00011187E9716>I<0006
00000E00001E00003E00007E0000DE00019E00011E00031E00061E000C1E00181E00301E
00601E00C01E00FFFFE0FFFFE0001E00001E00001E00001E00001E0001FFE001FFE01318
7F9716>I<3006003FFC003FF8003FF0003FE0003F800030000030000030000037F00038
1C00201E00000F00000F00000F80700F80F80F80F80F80F80F80F80F00601F00383E001F
F80007E00011187E9716>I<01F80007FE000F06001E0F003C1F003C1F00780E00780000
F80000F9F000FA1C00FC0E00FC0F00F80F80F80F80F80F80F80F80780F80780F80780F00
3C0F001E1E000FFC0003F00011187E9716>I<6000007FFFC07FFFC07FFF807FFF00E006
00C00600C00C00C0180000300000600000E00000E00001E00001C00003C00003C00003C0
0007C00007C00007C00007C00007C00007C00003800012197E9816>I<07F0001FFC0038
1E003007007007007007007807007E06003F8C003FF8001FF0000FFC001FFE0038FF0070
3F00E01F80E00780E00380E00380E003007007003C0E001FFC0007F00011187E9716>I<
07E0001FF8003C1C00781E00780F00F80F00F80F00F80F80F80F80F80F80F80F80781F80
381F801C2F8007CF80000F80000F00380F007C1F007C1E00783C003078001FF0000FC000
11187E9716>I<FFFFFCFFFFFC0F803C0F801C0F800C0F800E0F80060F80060F81860F81
800F81800F83800FFF800FFF800F83800F81800F81800F81800F80000F80000F80000F80
000F80000F8000FFFC00FFFC00171A7E991C>70 D<1FF000383C007C1E007C0F007C0F00
380F00000F0000FF000FCF003E0F007C0F00F80F00F80F00F80F00F817007C27E01FC3E0
13117F9015>97 D<03FC000F0E001C1F003C1F00781F00780E00F80000F80000F80000F8
0000F800007800007800003C01801C03000F060003FC0011117F9014>99
D<0007E00007E00001E00001E00001E00001E00001E00001E00001E003F9E00F07E01C03
E03C01E07801E07801E0F801E0F801E0F801E0F801E0F801E07801E07801E03C01E01C03
E00F0DF803F9F8151A7F9919>I<03F0000E1C001C0E003C0700780700780780F80780F8
0780FFFF80F80000F800007800007800003C01801C03000E060003FC0011117F9014>I<
00FE0003C700078F800F0F800F0F800F07000F00000F00000F0000FFF000FFF0000F0000
0F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F0000
3FE0003FE000111A80990E>I<07F1C01C1EE0380EE0780FC0780F00780F00780F00780F
00380E001C1C0037F0002000003000003000003FFE001FFF801FFFC07003C0E000E0E000
E0E000E0E000E07001C03C078007FC0013197F9016>I<FC0000FC00003C00003C00003C
00003C00003C00003C00003C00003C3E003CC7803D03803E03C03E03C03C03C03C03C03C
03C03C03C03C03C03C03C03C03C03C03C03C03C03C03C0FF0FF0FF0FF0141A7E9919>I<
3C7E7E7E7E3C00000000FCFC3C3C3C3C3C3C3C3C3C3C3C3C3CFFFF081B7E9A0D>I<FCFC
3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3C3CFFFF081A7E990D>108
D<FC3E00FCC7803D03803E03C03E03C03C03C03C03C03C03C03C03C03C03C03C03C03C03
C03C03C03C03C03C03C0FF0FF0FF0FF014117E9019>110 D<03F8000E0E003C07803803
807803C07803C0F803E0F803E0F803E0F803E0F803E0F803E07803C07C07C03C07800E0E
0003F80013117F9016>I<FCFE00FF87803E03C03C01E03C01F03C00F03C00F83C00F83C
00F83C00F83C00F83C00F03C01F03C01E03E03C03F07803CFE003C00003C00003C00003C
00003C0000FF0000FF000015187E9019>I<F8F0F9383A7C3A7C3C7C3C383C003C003C00
3C003C003C003C003C003C00FF80FF800E117E9012>114 D<1FD820784018C018C018F0
00FF807FE03FF007F8003CC00CC00CE00CE008F830CFE00E117F9011>I<060006000600
06000E000E001E003FF0FFF01E001E001E001E001E001E001E001E001E181E181E181E18
1E180F3003E00D187F9711>I<FC0FC0FC0FC03C03C03C03C03C03C03C03C03C03C03C03
C03C03C03C03C03C03C03C03C03C03C03C07C03C07C01E0BF007F3F014117E9019>I<FF
1FE1F8FF1FE1F83C0780601E0780C01E07C0C01E0DC1C00F0DC1800F1DE1800798E30007
98F30007B0730003F0760003F07E0003E03E0001E03C0001E03C0000C018001D117F9020
>119 D<FF03F0FF03F03E01C01E01801F03800F03000F030007860007860003CC0003CC
0003FC0001F80001F80000F00000F00000600000600070C000F8C000F9C000F980007700
003C000014187F9017>121 D E /Fk 43 123 df<0003FE000E03001C07001806003800
00380000380000700000700000700007FFFC00701C00E03800E03800E03800E03800E070
01C07001C07001C07001C0E401C0E40380E40380E4038068038030030000070000070000
660000E60000CC00007800001821819916>12 D<183C3C1C08080810204080060B78990C
>39 D<FF80FF80FF0009037D880E>45 D<3078F06005047C830C>I<0008001800300070
01F00E7000E000E000E000E001C001C001C001C003800380038003800700070007000700
0F00FFE00D187C9714>49 D<0000200000600000E00000E00001E00001F0000270000270
00047000087000087000107000107000207000407000407000803800FFF8010038020038
020038040038040038080038180038FE01FF181A7E991D>65 D<03FFF800700E00700600
700700E00700E00700E00700E00701C00E01C01C01C03801C07003FFE003807803803803
801C07001C07001C07001C07001C0E00380E00380E00700E00E01C03C0FFFF00181A7D99
1B>I<000F8200706200C01603801E07000C0E000C1C000C18000C380008300008700000
700000E00000E00000E00000E00000E00020E00020E00020E00040600040600080300100
1006000C180003E000171A7A991B>I<03FFFF00700700700300700100E00100E00100E0
0100E00101C08001C08001C08001C18003FF000381000381000381000702000700040700
040700080E00080E00180E00100E00301C00E0FFFFE0181A7D991A>69
D<03FF1FF800700380007003800070038000E0070000E0070000E0070000E0070001C00E
0001C00E0001C00E0001C00E0003FFFC0003801C0003801C0003801C0007003800070038
0007003800070038000E0070000E0070000E0070000E0070001C00E000FF87FC001D1A7D
991D>72 D<03FF0000700000700000700000E00000E00000E00000E00001C00001C00001
C00001C0000380000380000380000380000700000700100700100700200E00200E00600E
00400E00C01C0380FFFF80141A7D9918>76 D<03F8001FC00078003C000078003C000078
005C0000B800B80000B800B800009C013800009C013800011C027000011C027000011C04
7000011C087000021C08E000021C10E000021C10E000021C20E000041C41C000041C41C0
00041C81C000041C81C000080F038000080F038000080E038000180C038000180C070000
FE083FE000221A7D9922>I<03F007F8007800C00078008000780080009C0100009C0100
009C0100008E0100010E0200010602000107020001070200020384000203840002038400
0201C4000401C8000401C8000400E8000400E8000800F000080070000800700018007000
18002000FE0020001D1A7D991D>I<03FFF800701C00700600700700E00700E00700E007
00E00701C00E01C00E01C01C01C03803806003FF80038000038000070000070000070000
0700000E00000E00000E00000E00001C0000FF8000181A7D991A>80
D<003F1000609001807001007003002006002006002006002006000007000007C00003F8
0001FE00007F00000F80000380000180000180200180200180600300600300600600700C
00C8180087E000141A7D9916>83 D<3FFFFC381C0C201C04401C04403804803804803804
80380400700000700000700000700000E00000E00000E00000E00001C00001C00001C000
01C000038000038000038000038000078000FFF800161A79991B>I<7FE0FF0E00180E00
100E00101C00201C00201C00201C00203800403800403800403800407000807000807000
80700080E00100E00100E00100E00200E00200E004006008006010003860000F8000181A
78991D>I<FF803F801C000C001C0008001E0010000E0020000E0060000F004000070080
0007010000078200000386000003C4000001C8000001D0000001E0000000E0000001C000
0001C0000001C0000001C0000003800000038000000380000003800000070000003FE000
00191A78991D>89 D<0408102020404070F0F060060B78990C>96
D<03CC0E2E181C381C301C701CE038E038E038E038C072C072C07260F261341E180F107C
8F14>I<7E000E000E000E001C001C001C001C00380038003BC03C307830701870187018
E038E038E038E038C070C060C0E060C063801E000D1A7C9912>I<01E006180C18183830
1070006000E000E000E000E000E008E010602030C01F000D107C8F12>I<001F80000380
000380000380000700000700000700000700000E00000E0003CE000E2E00181C00381C00
301C00701C00E03800E03800E03800E03800C07200C07200C0720060F2006134001E1800
111A7C9914>I<01E00E181C08380870087010FFE0E000E000E000E000E0086010602030
C01F000D107C8F12>I<000700000980001B80003B000038000030000070000070000070
0000700007FF0000E00000E00000E00000E00000E00001C00001C00001C00001C00001C0
00038000038000038000038000030000070000070000060000660000E40000CC00007000
00112181990C>I<00F300038B800607000E07000C07001C0700380E00380E00380E0038
0E00301C00301C00301C00183C0018780007B800003800003800007000607000E0E000C1
C0007F000011177E8F12>I<1F8000038000038000038000070000070000070000070000
0E00000E00000E7C000F86001E07001E07001C07001C0700380E00380E00380E00381C00
701C80701C80703880703900E01900600E00111A7E9914>I<030706000000000000384C
4E8E9C9C1C3838707272E2E4643808197C980C>I<1F8003800380038007000700070007
000E000E000E0E0E131C271C431C801F003C003F8039C038E070E270E270E270E4E06460
38101A7E9912>107 D<1F0707070E0E0E0E1C1C1C1C3838383870707070E4E4E4E4E830
081A7D990A>I<307C1E00598663009E0783809E0703809C0703809C070380380E070038
0E0700380E0700380E0E00701C0E40701C0E40701C1C40701C1C80E0380C80601807001A
107C8F1F>I<307C005986009E07009E07009C07009C0700380E00380E00380E00381C00
701C80701C80703880703900E01900600E0011107C8F16>I<01F006180C0C180E300E70
0E600EE00EE00EE00CE01CE018E030606030C01F000F107C8F14>I<030F000590C009E0
C009C06009C06009C0600380E00380E00380E00380E00701C00701800703800703000E8E
000E78000E00000E00001C00001C00001C00001C0000FF00001317808F14>I<03C20E2E
181C381C301C701CE038E038E038E038C070C070C07060F061E01EE000E000E001C001C0
01C001C01FF00F177C8F12>I<30F05D189E389C189C009C003800380038003800700070
0070007000E00060000D107C8F10>I<03E004300830187018601C001F801FC00FE000E0
0060E060E06080C041803E000C107D8F10>I<06000E000E000E000E001C001C00FFC01C
0038003800380038007000700070007000E100E100E100E200E40038000A177C960D>I<
38064C074E0E8E0E9C0E9C0E1C1C381C381C381C7039703970393079389A0F0C10107C8F
15>I<38184C1C4E1C8E0C9C0C9C0C1C08380838083810701070107020304018C00F000E
107C8F12>I<078F0008D18010F38020E18020E00020E00001C00001C00001C00001C000
038200038200C38200E78400C5880078F00011107E8F12>120 D<38064C074E0E8E0E9C
0E9C0E1C1C381C381C381C703870387038307838F00F700070006060E0E1C0C18047003C
0010177C8F13>I<038207C40FFC10081010002000400180030004000808100820187FF0
43E081C00F107E8F10>I E /Fl 17 123 df<0F000003800003C00001C00001C00001E0
0000E00000E00000F000007000007000007800003800003800003C00007C0000DE00018E
00030E00060F000C07001C0700380780700380E00380C001C0121A7E9916>21
D<00000E00003C0000F00003C0000F00003C0000F00003C0000F00003C0000F00000F000
003C00000F000003C00000F000003C00000F000003C00000F000003C00000E17167D931E
>60 D<E000007800001E000007800001E000007800001E000007800001E000007800001E
00001E0000780001E0000780001E0000780001E0000780001E0000780000E0000017167D
931E>62 D<03E606171C0E380E300E700E601CE01CE01CE01CE039C039E0396079219A1E
0E10107F8F14>97 D<7E000E000E000E001C001C001C001C003800380039E03E10781870
1C700C701CE01CE01CE01CE018E038C030E07060E021801F000E1A7F9910>I<01F0070C
0C0C181C300870006000E000E000E000E000E004E008601030600F800E107F8F11>I<00
07C0000C60001CE00018C000380000380000380000380000700000700007FF0000700000
700000E00000E00000E00000E00000E00001C00001C00001C00001C00001C00001C00003
8000038000038000030000030000670000E60000CC000078000013217E9913>102
D<1F80000380000380000380000700000700000700000700000E00000E00000E07000E19
801C23801C41801C80001D00003E00003FC00038E0003870007071007071007071007072
00E03200601C00111A7F9914>107 D<383E0F804CC330C08F03C0E08F03C0E08E0380E0
8E0380E01C0701C01C0701C01C0701C01C070380380E0388380E0388380E0708380E0710
701C0320300C01C01D107E8F22>109 D<703E0058C7009D03809E03809C03809C038038
0700380700380700380E00700E40700E40701C40701C80E00C8060070012107E8F17>I<
30F059189E389C189C009C0038003800380038007000700070007000E00060000D107E8F
11>114 D<03E006180818183818301C001FC00FE007F000700030E030E030806040C03F
000D107E8F12>I<06000E000E000E000E001C001C00FFE01C0038003800380038007000
700070007000E080E080E100E100660038000B177E960E>I<1C03062603874707078707
038E07038E07030E0E021C0E021C0E021C0E02381C04381C04181C081C1C100C263007C3
C018107E8F1C>119 D<07878008C8C010F1C020E0C020E00020E00001C00001C00001C0
0001C000038100038100C38100E58200C5840078780012107F8F16>I<3803004C03804E
07008E07009C07009C07001C0E00380E00380E00380E00701C00701C00701C00303C0018
78000FB800003800007000607000E0E000C0C0004380003E000011177E8F13>I<038107
C20FFC10041008003000400080010002000C041004200C3FF841F080E010107F8F12>I
E /Fm 7 120 df<06070600000000384C4C8C98181830323264643808147F930C>105
D<1E0006000C000C000C000C0018001838185C189C3118360038003F8061C060C860C860
C8C0D0C0600E147F9312>107 D<30F87C00590C86004E0D06009C0E0600980C0600180C
0600180C060030180C0030180C8030181880301818806030190060300E00190D7F8C1D>
109 D<30F8590C4E0C9C0C980C180C180C30183019303130316032601C100D7F8C15>I<
0C78168C130426062606060606060C0C0C0C0C080C101A2019C018001800300030003000
FC000F13818C11>112 D<31E05A704C709C609800180018003000300030003000600060
000C0D7F8C0F>114 D<3818204C18704C18208C30209830201830201830203060403060
4030604030608018B1000F1E00140D7F8C18>119 D E /Fn 35 123
df<07800001C00001E00000E00000E00000F00000700000700000780000380000380000
3C00001C00001C00001E00000E00001E00003F0000670000C7000187800303800603800E
03C01C01C03801C07001E0E000E0C000F0141D7E9C18>21 D<60F0F06004047C830C>58
D<60F0F0701010101020204080040C7C830C>I<0000038000000F0000003C000000F000
0003C000000F0000003C000000F0000003C000000F0000003C000000F0000000F0000000
3C0000000F00000003C0000000F00000003C0000000F00000003C0000000F00000003C00
00000F000000038019187D9520>I<00010003000600060006000C000C000C0018001800
180030003000300060006000C000C000C0018001800180030003000300060006000C000C
000C00180018001800300030003000600060006000C000C00010297E9E15>I<E0000000
780000001E0000000780000001E0000000780000001E0000000780000001E00000007800
00001E00000007800000078000001E00000078000001E00000078000001E000000780000
01E00000078000001E00000078000000E000000019187D9520>I<0001F808000E061800
380138006000F001C0007003800070070000300F0000200E0000201C0000203C0000203C
000000780000007800000078000000F0000000F0000000F0000000F0000000F0000100F0
000100F0000100700002007000020030000400380008001C0010000E0060000701800000
FE00001D1E7E9C1E>67 D<01FFFFF8003C00780038001800380010003800100038001000
70001000700010007008100070080000E0100000E0100000E0300000FFF00001C0200001
C0200001C0200001C0200003804040038000400380008003800080070001000700010007
000300070006000E003E00FFFFFC001D1C7E9B1F>69 D<01FE0000FF003E0000F0002E00
01E0002E0002E0002E0002E0002E0004E0004E0009C0004E0009C000470011C000470011
C00087002380008700438000870043800087008380010701070001070107000103820700
01038207000203840E000203880E000203880E000203900E000403A01C000403A01C0004
01C01C000C01C01C001C01803C00FF8103FF80281C7E9B28>77 D<01FC00FF80001C001C
00002E001800002E001000002E0010000027001000004700200000430020000043802000
00438020000081C040000081C040000081C040000080E040000100E08000010070800001
00708000010070800002003900000200390000020039000002001D000004001E00000400
0E000004000E00000C000E00001C00040000FF80040000211C7E9B21>I<0003F800000E
0E000038038000E001C001C001C0038000E0070000E00F0000F01E0000F01C0000F03C00
00F03C0000F0780000F0780000F0780000F0F00001E0F00001E0F00001E0F00003C0F000
03C0F0000780F0000780F0000F0070000E0070001C00380038003C0070001C01C0000707
800001FC00001C1E7E9C20>I<01FFFF00003C03C0003800E0003800F000380070003800
70007000F0007000F0007000F0007000E000E001E000E003C000E0070000E01E0001FFF0
0001C0000001C0000001C000000380000003800000038000000380000007000000070000
0007000000070000000F000000FFE000001C1C7E9B1B>I<0003F800000E0E0000380380
00E001C001C001C0038000E0070000E00F0000F01E0000F01C0000F03C0000F03C0000F0
780000F0780000F0780000F0F00001E0F00001E0F00001E0F00003C0F00003C0F0000380
F0000780F0000F00703C0E0070421C0038823800388270001C83C0000787810001FF0100
000303000003020000038E000003FC000003F8000001F8000001E0001C257E9C21>I<00
0FC100303300400F00800601800603000603000606000406000407000007000007800003
F00001FF0000FFC0003FE00003E00000F000007000003000003020003020003060006060
00606000C0600080F00300CC060083F800181E7E9C19>83 D<7FF03FE00F0007000E0006
000E0004000E0004000E0004001C0008001C0008001C0008001C00080038001000380010
00380010003800100070002000700020007000200070002000E0004000E0004000E00040
00E0008000E0008000E00100006002000060040000300800001830000007C000001B1D7D
9B1C>85 D<00800080208020802080208020802080208020E027E03FE0FF80FC80E08020
802080208020802080208020802080208020802080208020E027E03FE0FF80FC80E08020
80208020802080200020000B277E9D10>93 D<01E3000717000C0F00180F00380E00300E
00700E00700E00E01C00E01C00E01C00E01C00E03880E03880E038806078803199001E0E
0011127E9116>97 D<3F00070007000E000E000E000E001C001C001C001C0039E03A303C
1838187018701C701C701CE038E038E038E030E070E060E0C061C023001E000E1D7E9C12
>I<0007E00000E00000E00001C00001C00001C00001C000038000038000038000038001
E7000717000C0F00180F00380E00300E00700E00700E00E01C00E01C00E01C00E01C00E0
3880E03880E038806078803199001E0E00131D7E9C16>100 D<01F007080C0818043808
300870307FC0E000E000E000E000E000E0046008601030600F800E127E9113>I<0001E0
000630000E78000EF0001C60001C00001C00001C00001C0000380000380003FFC0003800
00380000700000700000700000700000700000E00000E00000E00000E00000E00001C000
01C00001C00001C00001C000018000038000038000630000F30000F60000E40000780000
15257E9C14>I<0038C000C5C00183C00303C00703800603800E03800E03801C07001C07
001C07001C07001C0E001C0E001C0E000C1E00047C00039C00001C00001C000038006038
00F03000F07000E0C0007F0000121A809114>I<01C003C003C001800000000000000000
000000001C00270047004700870087000E000E001C001C001C0038003880388070807100
32001C000A1C7E9B0E>105 D<0007000F000F0006000000000000000000000000007800
9C010C020C021C041C001C001C0038003800380038007000700070007000E000E000E000
E001C061C0F180F300E6007C001024809B11>I<0FC00001C00001C00003800003800003
80000380000700000700000700000700000E07000E08800E11C00E23C01C47801C83001D
00001E00003FC00038E000387000387000707100707100707100707200E03200601C0012
1D7E9C16>I<1F800380038007000700070007000E000E000E000E001C001C001C001C00
38003800380038007000700070007000E200E200E200E40064003800091D7F9C0C>I<38
1F81F04E20C6184640E81C4680F01C8F00F01C8E00E01C0E00E01C0E00E01C1C01C0381C
01C0381C01C0381C01C0703803807138038071380380E1380380E2700700643003003820
127E9124>I<3C1F004E61804681C04701C08F01C08E01C00E01C00E01C01C03801C0380
1C03801C0700380710380710380E10380E2070064030038014127E9119>I<3C3C4E4246
87470F8E1E8E0C0E000E001C001C001C001C0038003800380038007000300010127E9113
>114 D<01F0060C0C040C0E180C1C001F000FE00FF003F80038201C7018F018F0108030
60601F800F127E9113>I<00C001C001C001C00380038003800380FFF00700070007000E
000E000E000E001C001C001C001C00382038203840384018800F000C1A80990F>I<1C00
C0802701C1C04701C1C04701C0C087038040870380400E0380400E0380401C0700801C07
00801C0700801C07010018060100180601001C0E02001C0F04000E13080003E1F0001A12
7E911E>119 D<07878008C84010F0C020F1E020E3C040E18000E00000E00001C00001C0
0001C00001C000638080F38080F38100E5810084C60078780013127E9118>I<1C00C027
01C04701C04701C08703808703800E03800E03801C07001C07001C07001C0700180E0018
0E00180E001C1E000C3C0007DC00001C00001800603800F03000F06000E0C0004180003E
0000121A7E9114>I<038107C10FF6081C10080010002000400080010002000400080410
043C1867F843F081E010127E9113>I E /Fo 9 66 df<18789818181818181818181818
1818FF08107D8F0F>49 D<1F00618040C08060C0600060006000C00180030006000C0010
2020207FC0FFC00B107F8F0F>I<1F00218060C060C000C0008001001F00008000400060
C060C060804060801F000B107F8F0F>I<01800180038005800D801980118021804180C1
80FFE001800180018001800FE00B107F8F0F>I<20C03F802E002000200020002F003080
2040006000600060C06080C061801F000B107F8F0F>I<0780184030C060C06000C000CF
00F080E040C060C060C060406060C030801F000B107F8F0F>I<40007FF07FE080408040
00800100020002000600040004000C000C000C000C000C000C117F900F>I<1F00318060
C060C060C031803F000E00338061C0C060C060C060C04060C01F000B107F8F0F>I<00C0
0000C00001E000016000016000023000023000023000041800041800080C000FFC00080C
00100600100600300700FC1FC012117F9016>65 D E /Fp 39 123
df<E0E0E0E0E0E06060404040404040C0C00B087F9C15>34 D<01C0038007000E000E00
1C001C003800380038007000700070007000E000E000E000E000E000E000E000E000E000
E000E000E000E000E00070007000700070003800380038001C001C000E000E0007000380
01C00A2A7D9E10>40 D<E000700038001C001C000E000E00070007000700038003800380
038001C001C001C001C001C001C001C001C001C001C001C001C001C001C0038003800380
03800700070007000E000E001C001C0038007000E0000A2A7E9E10>I<E0E0E060404040
C003087C820C>44 D<FFE0FFE00B0280890E>I<E0E0E003037C820C>I<03C00FF01FF83C
3C381C700E700E700EE007E007E007E007E007E007E007E007E007E007E007E007E00770
0E700E700E381C3C3C1FF80FF007E0101D7E9B15>48 D<010007003F00FF00C700070007
000700070007000700070007000700070007000700070007000700070007000700070007
000700FFF8FFF80D1C7C9B15>I<07C01FF03878701C601EE00EC00F400F400700070007
000F000E001E001C003C007800F001E001C0038007000E001C0038007000FFFFFFFF101C
7E9B15>I<07E01FF03838701CE01E401E401E001E001E001C003C007807F007E007F000
3C001C001E000F000F000F000F800F800FC01E601C383C1FF007C0101D7E9B15>I<03C0
0FF01C38381C700C700EE00EE006E007E007E007E007E007E00F700F781F3C3F3FF71FE7
0F86000E000E000C001C0018203870F03FC00F80101D7E9B15>57
D<E0E0E0000000000000000000000000E0E0E003127C910C>I<E0E0E000000000000000
0000000000E0E0E060404040C003177C910C>I<7FFFFFC0FFFFFFE00000000000000000
000000000000000000000000000000000000000000000000FFFFFFE07FFFFFC01B0C7E8F
20>61 D<F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000
F000F000F000F000F000F000F000F000F000F000F000FFFFFFFF101D7D9C16>76
D<FC0070FC0070FE0070EE0070EF0070E70070E70070E78070E38070E3C070E3C070E1E0
70E1E070E0E070E0F070E07070E07870E07870E03C70E03C70E01C70E01E70E00E70E00E
70E00F70E00770E007F0E003F0E003F0141D7C9C1D>78 D<FFFFFFE0E0E0E0E0E0E0E0E0
E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0FFFFFF08297D9E0C>91
D<6060404040404040C0C0E0E0E0E0E0E00B08789C15>I<FFFFFF070707070707070707
0707070707070707070707070707070707070707070707070707FFFFFF0829809E0C>I<
0FC03FF07FF87038401C001C001C00FC0FFC3FFC781CE01CE01CE01CF07C7FFC7FDC3F1C
0E127E9114>97 D<E000E000E000E000E000E000E000E000E000E000E000E3E0EFF8FFFC
F83EE01EE00EE007E007E007E007E007E007E00EF01EF83CFFF8EFF0E3E0101D7D9C15>
I<03F00FFC1FFE3C0E78027000E000E000E000E000E000E000700078023C0E1FFE0FFC03
F00F127F9112>I<0007000700070007000700070007000700070007000707C71FF73FFF
3C1F78077007E007E007E007E007E007E0077007780F3C1F3FFF1FF707C7101D7F9C15>
I<07E00FF03FF83C3C700C700EFFFEFFFEFFFEE000E000E000700078023C0E1FFE0FFC03
F00F127F9112>I<00FC01FC03FC07000E000E000E000E000E000E000E00FFE0FFE00E00
0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E1D809C0D>
I<E000E000E000E000E000E000E000E000E000E000E000E3E0EFF0FFF8F83CF01CE01CE0
1CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01C0E1D7D9C15>104
D<F0F0F0F000000000000000707070707070707070707070707070707070041D7E9C0A>
I<03C003C003C003C0000000000000000000000000000001C001C001C001C001C001C001
C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C0C3C0FF80FF
003E000A25839C0B>I<E000E000E000E000E000E000E000E000E000E000E000E03CE078
E0F0E1E0E3C0E780EF00FF00FF80FB80F9C0F1E0E0E0E0F0E078E038E03CE01E0F1D7D9C
14>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0031D7D9C
0A>I<E3E0EFF0FFF8F83CF01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE01CE0
1CE01C0E127D9115>110 D<03F0000FFC001FFE003C0F00780780700380E001C0E001C0
E001C0E001C0E001C0F003C07003807807803C0F001FFE000FFC0003F00012127F9115>
I<E380E780EF80FC00F800F000F000E000E000E000E000E000E000E000E000E000E000E0
0009127D910E>114 D<1FC03FF07FF0F030E000E000F0007F003FC01FE001F000380038
8038F078FFF07FE01FC00D127F9110>I<1C001C001C001C001C001C00FFE0FFE01C001C
001C001C001C001C001C001C001C001C001C001C001C201FF00FF007C00C187F970F>I<
E03E0380E03E0380E03E03807037030070770700707707007073070038E38E0038E38E00
38E38E0018E18C001CC1CC001DC1DC001DC1DC000D80D8000F80F8000F80F80007807000
19127F911C>119 D<7003807807003C0E001C1C000E1C0007380003F00001E00001C000
01E00003F0000738000618000E1C001C0E00380700700380F003C01212809113>I<E007
E007700E700E780E381C381C1C1C1C380C380E300E7006700760036003C001C001C00180
0180030003000700FE00FC00F800101A7F9113>I<7FFC7FFC7FFC007800F000E001E003
C0038007000F001E001C003C007800FFFCFFFCFFFC0E127F9112>I
E /Fq 24 115 df<FFFFFF80FFFFFF8019027D8A20>0 D<003F800000C4600003041800
040404000804020010040100200400802004008040040040400400408004002080040020
80040020FFFFFFE080040020800400208004002080040020400400404004004020040080
200400801004010008040200040404000304180000C46000003F80001B1C7E9720>8
D<03C00FF01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFF7FFE7FFE3FFC1FF80FF003C010107E
9115>15 D<000001800000078000001E00000078000001E00000078000001E0000007800
0001E00000078000001E00000078000000E0000000780000001E0000000780000001E000
0000780000001E0000000780000001E0000000780000001E000000078000000180000000
000000000000000000000000000000000000000000000000007FFFFF00FFFFFF8019227D
9920>20 D<C0000000F00000003C0000000F00000003C0000000F00000003C0000000F00
000003C0000000F00000003C0000000F000000038000000F0000003C000000F0000003C0
00000F0000003C000000F0000003C000000F0000003C00000070000000C0000000000000
000000000000000000000000000000000000000000000000007FFFFF00FFFFFF8019227D
9920>I<00C0000000018000000001800000000180000000030000000003000000000600
0000000C000000001C000000003000000000FFFFFFFFF0FFFFFFFFF030000000001C0000
00000C000000000600000000030000000003000000000180000000018000000001800000
0000C000000024167D942A>32 D<00000030000000001800000000180000000018000000
000C000000000C0000000006000000000300000000038000000000C0FFFFFFFFF8FFFFFF
FFF800000000C00000000380000000030000000006000000000C000000000C0000000018
0000000018000000001800000000300025167E942A>I<00060000000006000000000C00
0000001C00000000180000000030000000007FFFFFF000FFFFFFF8038000000007000000
003C00000000F0000000003C000000000E000000000300000000018000000000FFFFFFF8
007FFFFFF000300000000018000000000C000000000C0000000006000000000600000025
187E952A>40 D<000003000000000300000000018000000001C000000000C00000000060
007FFFFFF000FFFFFFF8000000000E00000000070000000001E0000000007800000001E0
000000038000000006000000000C00FFFFFFF8007FFFFFF0000000006000000000C00000
0001800000000180000000030000000003000025187E952A>I<07E0003F000FF800F180
183E018040200F03002040078400104003CC00108001D800088000F000088000F0000880
0078000880007800088000DC000840019E001040010F00102006078020100C03E0C00C78
00FF8007E0003F0025127E912A>49 D<007FF801FFF80780000E00001800003000003000
00600000600000C00000C00000C00000FFFFF8FFFFF8C00000C00000C000006000006000
003000003000001800000E000007800001FFF8007FF8151A7D961C>I<00006000006000
00C00000C0000180000180000180000300000300000600000600000C00000C0000180000
180000180000300000300000600000600000C00000C00001800001800003000003000003
00000600000600000C00000C0000180000180000300000300000300000600000600000C0
000040000013287A9D00>54 D<400004C0000C6000186000186000183000303000303000
301800601800601FFFE00FFFC00C00C00C00C00601800601800303000303000303000186
0001860001860000CC0000CC0000CC00007800007800007800003000003000161E809C17
>56 D<FFFFC0FFFFC00000C00000C00000C00000C00000C00000C00000C00000C00000C0
0000C00000C03FFFC07FFFC00000C00000C00000C00000C00000C00000C00000C00000C0
0000C00000C00000C00000C0FFFFC0FFFFC0121D7E9C17>I<FFFFFEFFFFFE0000060000
06000006000006000006000006000006000006000006170B7E8E1C>I<0004000C03CC0C
381818301C303C703E603660666066E067E067E0C7E0C7E0C7E187E187E187E307E307E3
07E607E607E60766066C067C0E3C0C380C18181C3033C03000300010237E9F15>I<003F
FF0001FFFFC0071E0FE0081C03F0381C01F8703C00F8603C0078C03C0078003C00780038
007000380070007800E0007800E0007801C0007001800070020000F00C0000E0300000E7
C00001EF000001E0000001C0000001C00000038000000380000007800000070000000700
00000E0000000C0000001D1E809B1D>80 D<400002C00006C00006C00006C00006C00006
C00006C00006C00006C00006C00006C00006C00006C00006C00006C00006C00006C00006
C0000660000C60000C3000181C00700F01E003FF8000FE00171A7E981C>91
D<001000003800003800006C00006C00006C0000C60000C6000183000183000301800301
800600C00600C00600C00C00600C006018003018003030001830001830001860000C6000
0CC00006C00002171A7E981C>94 D<C00002C0000660000C60000C300018300018300018
1800301800300C00600C00600600C00600C00600C003018003018001830001830000C600
00C600006C00006C00006C00003800003800001000171A7E981C>I<003C00E001C00180
0380038003800380038003800380038003800380038003800380030007001C00F0001C00
070003000380038003800380038003800380038003800380038003800380018001C000E0
003C0E297D9E15>102 D<F0001C00070003000380038003800380038003800380038003
800380038003800380018001C000E0003C00E001C0018003800380038003800380038003
80038003800380038003800380030007001C00F0000E297D9E15>I<C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C002297B
9E0C>106 D<FFFFFFFCFFFFFFFC7FFFFFF878000018380000103C0000301C0000200E00
00400E0000400700008007000080038001000380010001C0020001C0020000E0040000E0
040000700800007008000038100000381000001C2000001E2000000E4000000F40000007
80000007800000030000000300001E1D7E9B23>114 D E /Fr 10
57 df<006000006000006000006000006000006000006000006000006000006000FFFFF0
FFFFF000600000600000600000600000600000600000600000600000600000600014167E
9119>43 D<0F0030C0606060604020C030C030C030C030C030C030C030C030C030402060
60606030C00F000C137E9211>48 D<0C001C00EC000C000C000C000C000C000C000C000C
000C000C000C000C000C000C000C00FFC00A137D9211>I<1F0060C06060F070F0306030
00700070006000C001C00180020004000810101020207FE0FFE00C137E9211>I<0FC030
707038703870380038003000E00FC0007000380018001C601CF01CF018E03860701FC00E
137F9211>I<006000E000E00160026006600C600860106020606060C060FFFC00600060
00600060006003FC0E137F9211>I<60607FC07F8044004000400040004F0070C040E000
6000700070E070E070E06040E021C01F000C137E9211>I<07C00C201070207060006000
C000CF00D0C0E060C020C030C030C03040306020206010C00F000C137E9211>I<40007F
FC7FF8401080308020004000800100010003000200060006000E000E000E000E000E0004
000E147E9311>I<0FC0107020186018601870183C303F600F800FE031F06078C01CC00C
C00CC00C601830300FC00E137F9211>I E /Fs 57 123 df<0001F03C00071C47000C1C
C7000C19C6001C0180001C0380001803800038038000380380003807000038070003FFFF
F000700700007007000070070000700E0000700E0000E00E0000E00E0000E00E0000E01C
0000E01C0001C01C0001C01C0001C01C0001C0380001C038000380380003803800038030
00030070000300700007006000C630E000E638C000CC318000781E00002025819C19>11
D<0000FE000003018000060180000C0380001C0180001C00000018000000380000003800
00003800000038000003FFFE0000700E0000700E0000700E0000701C0000701C0000E01C
0000E01C0000E0380000E0380000E0380001C0380001C0720001C0720001C0720001C072
00038034000380180003800000030000000300000007000000C6000000E6000000CC0000
00780000001925819C17>I<183C3C3C0404080810204080060C779C0D>39
D<FFC0FFC0FFC00A037D890F>45 D<3078F06005047C830D>I<0004000C001800380078
07B8007000700070007000E000E000E000E001C001C001C001C003800380038003800700
0700070007000F00FFF00E1C7B9B15>49 D<003E000041800080C00100C00200E00440E0
0440E00840E00840E00840E01081C01081C01103800E0300000600000C00001800006000
0080000300000400000800401000802000802001007F070043FE0081FC00807800131D7D
9B15>I<001F000060C00080C00100600200600240600440E00440E00440E00481C00301
C000038000070000FC00001C00000600000600000700000700000700000700700700E00E
00800E00801C0040180040300020E0001F8000131D7D9B15>I<0001800001C000038000
0380000380000300000700000700000600000E00000C00001C0000180000180000300000
300000600000400000C600018E00010E00020E00061C000C1C00181C003F1C0040F80080
3F8000380000380000700000700000700000700000E00000600012247E9B15>I<008060
01FFC001FF8001FE0001000002000002000002000002000004000004F800050C00060600
0C0600080600000600000700000600000E00000E00700E00700C00E01C00801800803800
40300040600021C0001F0000131D7C9B15>I<060F0F06000000000000000000003078F0
6008127C910D>58 D<0000180000001800000038000000380000007800000078000000B8
00000138000001380000023C0000021C0000041C00000C1C0000081C0000101C0000101C
0000201C0000201C00007FFC0000C01C0000801C0001001C0001001E0002000E0002000E
0004000E000C000E001C001E00FF00FFC01A1D7E9C1F>65 D<01FFFF00003C0380003801
C0003800E0003800E0003800E0007000E0007001E0007001E0007003C000E0038000E00F
0000E01E0000FFFC0001C00E0001C0070001C0078001C007800380078003800780038007
800380078007000F0007000E0007001E0007003C000E00F000FFFFC0001B1C7E9B1D>I<
0003F020001E0C60003002E000E003C001C001C0038001C0070000C00E0000801E000080
1C0000803C0000803C000000780000007800000078000000F0000000F0000000F0000000
F0000000F0000400F0000400F0000400F000080070000800700010003800200018004000
0C0180000706000001F800001B1E7A9C1E>I<01FFFF00003C03C0003800E0003800E000
380070003800700070007800700038007000380070007800E0007800E0007800E0007800
E0007801C000F001C000F001C000F001C000E0038001E0038001C0038003C00380038007
00070007000E0007001C00070038000E00E000FFFF80001D1C7E9B1F>I<01FFFFF0003C
00F0003800300038002000380020003800200070002000700020007008200070080000E0
100000E0100000E0300000FFF00001C0200001C0200001C0200001C02000038040800380
00800380008003800100070001000700030007000200070006000E003C00FFFFFC001C1C
7E9B1C>I<01FFFFF0003C00F00038003000380020003800200038002000700020007000
20007008200070080000E0100000E0100000E0300000FFF00001C0200001C0200001C020
0001C0200003804000038000000380000003800000070000000700000007000000070000
000F000000FFF000001C1C7E9B1B>I<03FF0078007000700070007000E000E000E000E0
01C001C001C001C0038003800380038007000700070007000E000E000E000E001E00FFC0
101C7D9B10>73 D<01FFC0003C0000380000380000380000380000700000700000700000
700000E00000E00000E00000E00001C00001C00001C00001C00003800203800203800203
800407000407000C0700180700380E00F0FFFFF0171C7E9B1A>76
D<01FE0001FE003E0001E0002E0003C0002E0005C0002E0005C0002E0009C0004E000B80
004E001380004E0023800047002380008700470000870047000087008700008701070001
07010E000107020E000107040E000107040E000207081C000203881C000203901C000203
A01C000403A038000403C038000403C038000C038038001C03007800FF8307FF00271C7E
9B25>I<01FC00FF80001C001C00002E001800002E001000002E00100000270010000047
0020000043002000004380200000438020000081C040000081C040000081C040000080E0
40000100E080000100708000010070800001007080000200390000020039000002003900
0002001D000004001E000004000E000004000E00000C000E00001C00040000FF80040000
211C7E9B1F>I<0007F000001C1C0000700E0000E0070001C0038003800380070003800E
0003C01E0003C01C0003C03C0003C03C0003C0780003C0780003C0780003C0F0000780F0
000780F0000780F0000F00F0000F00F0000E00F0001E00F0003C00700038007000700078
00E0003801C0001C0380000E0E000003F800001A1E7A9C20>I<01FFFE00003C03800038
01C0003800E0003800E0003800E0007001E0007001E0007001E0007001C000E003C000E0
038000E0070000E01C0001FFF00001C0000001C0000001C0000003800000038000000380
000003800000070000000700000007000000070000000F000000FFE000001B1C7E9B1C>
I<01FFFE00003C0780003801C0003801E0003800E0003800E0007001E0007001E0007001
E0007003C000E0038000E0070000E01C0000FFE00001C0300001C0180001C01C0001C01C
0003801C0003801C0003801C0003801C0007003C0007003C2007003C2007003C200F003C
40FFE01E8000000F001B1D7E9B1E>82 D<000F8400304C00403C00801801001803001803
001806001006001006000007000007000003E00003FC0001FF00007F800007C00001C000
01C00000C00000C02000C02000C0600180600180600300600200F00400CC180083E00016
1E7D9C17>I<1FFFFFC01C0701C0300E00C0200E0080600E0080400E0080401C0080801C
0080801C0080001C00000038000000380000003800000038000000700000007000000070
00000070000000E0000000E0000000E0000000E0000001C0000001C0000001C0000001C0
000003C000007FFE00001A1C799B1E>I<7FF03FE00F0007000E0006000E0004000E0004
000E0004001C0008001C0008001C0008001C000800380010003800100038001000380010
0070002000700020007000200070002000E0004000E0004000E0004000E0008000E00080
00E00100006002000060040000300800001830000007C000001B1D789B1F>I<FF801FC0
3C0007001C0004001C0004001C0008001C0010001C0010001C0020001C0020001C004000
1C0080001C0080000E0100000E0100000E0200000E0400000E0400000E0800000E080000
0E1000000E2000000F200000074000000740000007800000070000000700000006000000
060000001A1D779B1F>I<FF83FF07F03C007001C038007001803800F001003800F00100
380170020038017004003802700400380270080038047008003804701000380870100038
087020003810702000383070400038207040001C407080001C407080001C807100001C80
7100001D007200001D007200001E007400001E007400001C003800001C00380000180030
000018002000001000200000241D779B29>I<FFC00FE01E0003800E0002000E0004000F
000C000700080007801000038020000380400003C0C00001C0800001C1000001E2000000
E4000000EC000000F80000007000000070000000E0000000E0000000E0000000E0000001
C0000001C0000001C0000001C00000038000003FF800001B1C789B1F>89
D<020006001B0031006080C0800906759C15>94 D<0408102020404080E0F0F0E0060C77
9C0D>96 D<01E307170C0F180F380E300E700E700EE01CE01CE01CE01CE039E039E03960
79319A1E0C10127C9115>I<3F00070007000E000E000E000E001C001C001C001C0039E0
3A183C0C380C700C700E700E700EE01CE01CE01CE018E038E030E06060C031801E000F1D
7C9C13>I<00F803040E041C0E181C300070007000E000E000E000E000E000E004600860
1030600F800F127C9113>I<0007E00000E00000E00001C00001C00001C00001C0000380
00038000038000038001E7000717000C0F00180F00380E00300E00700E00700E00E01C00
E01C00E01C00E01C00E03900E03900E03900607900319A001E0C00131D7C9C15>I<00F8
07040C0418023804300470087FF0E000E000E000E000E00060046008301030600F800F12
7C9113>I<0003C0000670000C70001C60001C00001C0000380000380000380000380000
380003FF8000700000700000700000700000700000E00000E00000E00000E00000E00001
C00001C00001C00001C00001C000038000038000038000030000030000070000C60000E6
0000CC00007800001425819C0D>I<0078C001C5C00303C00603C00E03800C03801C0380
1C0380380700380700380700380700380E00380E00380E00181E000C7C00079C00001C00
001C00003800003800C03000E07000C1C0007F0000121A7E9113>I<0FC00001C00001C0
000380000380000380000380000700000700000700000700000E3E000EC3000F03800E03
801E03801C03801C03801C0380380700380700380700380E00700E40700E40701C40701C
80E00C80600700121D7E9C15>I<01800380010000000000000000000000000000001C00
2600470047008E008E000E001C001C001C0038003800710071007100720072003C00091C
7C9B0D>I<0FC00001C00001C00003800003800003800003800007000007000007000007
00000E07800E08800E11C00E21C01C41801C80001D00001E00003FC00038E00038700038
7000707100707100707100707200E03200601C00121D7E9C13>107
D<1F800380038007000700070007000E000E000E000E001C001C001C001C003800380038
0038007000700070007000E200E200E200E40064003800091D7D9C0B>I<1C1E07802663
18C04683A0E04703C0E08E0380E08E0380E00E0380E00E0380E01C0701C01C0701C01C07
01C01C070380380E0388380E0388380E0708380E0710701C0320300C01C01D127C9122>
I<383E004CC3004D03804E03809E03809C03801C03801C0380380700380700380700380E
00700E40700E40701C40701C80E00C8060070012127C9117>I<00F800030C000E06001C
0300180300300300700380700380E00700E00700E00700E00E00E00E00E01C0060180060
300030E0000F800011127C9115>I<03878004C86004D03004E03009C03009C03801C038
01C0380380700380700380700380600700E00700C00701800783000E86000E78000E0000
0E00001C00001C00001C00001C0000380000FF0000151A809115>I<01E107130C0F180F
380E300E700E700EE01CE01CE01CE01CE038E038E038607831F01E700070007000E000E0
00E000E001C00FF8101A7C9113>I<1C3C2642468747078E068E000E000E001C001C001C
001C0038003800380038007000300010127C9112>I<01F006080C080C1C18181C001F00
1FC00FF007F0007800386030E030C030806060C01F000E127D9111>I<03000700070007
000E000E000E000E00FFE01C001C001C0038003800380038007000700070007000E080E0
80E100E100660038000B1A7C990E>I<1C01802E03804E03804E03808E07008E07001C07
001C0700380E00380E00380E00380E00301C80301C80301C80383C80184D000F86001112
7C9116>I<1C062E0E4E064E068E028E021C021C02380438043804380830083008301038
2018400F800F127C9113>I<1E01832703874703874703838707018707010E07010E0701
1C0E021C0E021C0E021C0E04180C04181C04181C081C1E080C263007C3C018127C911C>
I<0387800CC8400870E01070E020E0C020E00000E00000E00001C00001C00001C00001C0
00038100638100E38200C5820085840078780013127E9113>I<1C01802E03804E03804E
03808E07008E07001C07001C0700380E00380E00380E00380E00301C00301C00301C0038
3C001878000FB800003800003000007000E06000E0C0008180004300003C0000111A7C91
14>I<01C107E10FF6081C10080010002000400080010002000400080410042C0C73F841
F080E010127E9111>I E /Ft 45 124 df<FFF8FFF8FFF8FFF80D04808A10>45
D<78FCFCFCFC7806067D850D>I<00600001E0000FE000FFE000F3E00003E00003E00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00003E00003E0007FFF807FFF80111B7D9A18>49
D<07F8001FFE00383F80780FC0FC07C0FC07E0FC03E0FC03E07803E00007E00007C00007
C0000F80001F00001E0000380000700000E0000180600300600600600800E01FFFC03FFF
C07FFFC0FFFFC0FFFFC0131B7E9A18>I<07F8001FFE003C1F003C0F807C07C07E07C07C
07C03807C0000F80000F80001E00003C0003F800001E00000F800007C00007C00007E030
07E07807E0FC07E0FC07E0FC07C0780F80781F001FFE0007F800131B7E9A18>I<000180
000380000780000F80001F80003F80006F8000CF80008F80018F80030F80060F800C0F80
180F80300F80600F80C00F80FFFFF8FFFFF8000F80000F80000F80000F80000F80000F80
00FFF800FFF8151B7F9A18>I<3801803FFF003FFE003FFC003FF8003FC0003000003000
0030000030000031F800361E00380F803007800007C00007E00007E00007E07807E0F807
E0F807E0F807C0F007C0600F80381F001FFE0007F000131B7E9A18>I<007E0003FF0007
81800F03C01E07C03C07C07C0380780000780000F80000F8F800FB0E00FA0780FC0380FC
03C0F803E0F803E0F803E0F803E07803E07803E07803C03C03C03C07801E0F0007FE0003
F800131B7E9A18>I<6000007FFFE07FFFE07FFFC07FFF807FFF80E00300C00600C00C00
C0180000300000300000600000E00000E00001E00001C00003C00003C00003C00003C000
07C00007C00007C00007C00007C00007C000038000131C7D9B18>I<0FF0303C601EF01F
F81FF81F701F003E003C007000E001C00180018003000300030003000300000000000000
000007800FC00FC00FC00FC00780101D7D9C17>63 D<00038000000380000007C0000007
C0000007C000000FE000000FE000001FF000001BF000003BF8000031F8000031F8000060
FC000060FC0000E0FE0000C07E0000C07E0001803F0001FFFF0003FFFF8003001F800700
1FC006000FC006000FC00C0007E00C0007E0FF803FFEFF803FFE1F1C7E9B24>65
D<FFFFF800FFFFFF000FC01F800FC00FC00FC007C00FC007E00FC007E00FC007E00FC007
E00FC007E00FC007C00FC00F800FC03F000FFFFE000FC00F800FC007C00FC003E00FC003
E00FC003F00FC003F00FC003F00FC003F00FC003F00FC007E00FC007E00FC01FC0FFFFFF
00FFFFFC001C1C7E9B22>I<001FE02000FFF8E003F80FE007C003E00F8001E01F0000E0
3E0000E03E0000607E0000607C000060FC000000FC000000FC000000FC000000FC000000
FC000000FC000000FC0000007C0000607E0000603E0000603E0000C01F0000C00F800180
07C0030003F80E0000FFFC00001FE0001B1C7D9B22>I<FFFFF800FFFFFF000FC01FC00F
C007E00FC001F00FC001F80FC000F80FC000FC0FC0007C0FC0007C0FC0007E0FC0007E0F
C0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007C0FC0007C0FC0007C0F
C000F80FC000F80FC001F00FC007E00FC01FC0FFFFFF00FFFFF8001F1C7E9B25>I<FFFC
FFFC0FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC0
0FC00FC00FC00FC00FC00FC00FC0FFFCFFFC0E1C7E9B12>73 D<FFFE00FFFE000FC0000F
C0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000F
C0000FC0000FC0030FC0030FC0030FC0070FC0070FC0060FC00E0FC01E0FC07EFFFFFEFF
FFFE181C7E9B1D>76 D<FFC00003FFFFE00007FF0FE00007F00DF0000DF00DF0000DF00D
F0000DF00CF80019F00CF80019F00C7C0031F00C7C0031F00C3E0061F00C3E0061F00C1F
00C1F00C1F00C1F00C1F00C1F00C0F8181F00C0F8181F00C07C301F00C07C301F00C03E6
01F00C03E601F00C01FC01F00C01FC01F00C01FC01F00C00F801F00C00F801F0FFC0701F
FFFFC0701FFF281C7E9B2D>I<FFFFF800FFFFFE000FC03F800FC00F800FC007C00FC007
E00FC007E00FC007E00FC007E00FC007E00FC007C00FC007C00FC00F800FC03F000FFFFC
000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000
000FC000000FC00000FFFC0000FFFC00001B1C7E9B21>80 D<FFFFF00000FFFFFE00000F
C03F00000FC00F80000FC007C0000FC007E0000FC007E0000FC007E0000FC007E0000FC0
07E0000FC007C0000FC00F80000FC03E00000FFFF000000FC07C00000FC03E00000FC03F
00000FC01F80000FC01F80000FC01F80000FC01F80000FC01F80000FC01F80000FC01F81
800FC01F81800FC00FC180FFFC07C300FFFC01FE00211C7E9B24>82
D<07F8201FFEE03C07E07801E07000E0F000E0F00060F00060F80000FE0000FFE0007FFE
003FFF003FFF800FFFC007FFE0007FE00003F00001F00000F0C000F0C000F0C000E0E000
E0F001C0FC03C0EFFF0083FC00141C7D9B1B>I<7FFFFFE07FFFFFE0781F81E0701F80E0
601F8060E01F8070C01F8030C01F8030C01F8030C01F8030001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F800007FFFE0007FFFE001C1C7E9B21>I<FFF87FFE0F
FCFFF87FFE0FFC0FC007E000C00FC007F000C00FE003F001C007E003F0018007E007F801
8007F007F8038003F00FFC030003F00CFC030001F80CFC060001F81CFE060001FC187E0E
0000FC187E0C0000FC303F0C0000FE303F1C00007E703F9800007E601F9800003F601FB0
00003FE01FF000003FC00FF000001FC00FE000001F8007E000001F8007E000000F8007C0
00000F0003C0000007000380000007000380002E1C7F9B31>87 D<0FF8001C1E003E0F80
3E07803E07C01C07C00007C0007FC007E7C01F07C03C07C07C07C0F807C0F807C0F807C0
780BC03E13F80FE1F815127F9117>97 D<FF0000FF00001F00001F00001F00001F00001F
00001F00001F00001F00001F00001F3F801FE1E01F80701F00781F003C1F003C1F003E1F
003E1F003E1F003E1F003E1F003E1F003C1F003C1F00781F80701EC1E01C3F00171D7F9C
1B>I<03FC000E0E001C1F003C1F00781F00780E00F80000F80000F80000F80000F80000
F800007800007801803C01801C03000E0E0003F80011127E9115>I<000FF0000FF00001
F00001F00001F00001F00001F00001F00001F00001F00001F001F9F00F07F01C03F03C01
F07801F07801F0F801F0F801F0F801F0F801F0F801F0F801F07801F07801F03C01F01C03
F00F0FFE03F9FE171D7E9C1B>I<03FC000F07001C03803C01C07801C07801E0F801E0F8
01E0FFFFE0F80000F80000F800007800007800603C00601E00C00F038001FC0013127F91
16>I<007F0001E38003C7C00787C00F87C00F83800F80000F80000F80000F80000F8000
FFF800FFF8000F80000F80000F80000F80000F80000F80000F80000F80000F80000F8000
0F80000F80000F80000F80007FF0007FF000121D809C0F>I<03F0F00E1F383C0F383807
307807807807807807807807803807003C0F001E1C0033F0003000003000003000003FFF
003FFFC01FFFE01FFFF07801F8F00078F00078F000787000707800F01E03C007FF00151B
7F9118>I<FF0000FF00001F00001F00001F00001F00001F00001F00001F00001F00001F
00001F0FC01F31E01F40F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F
00F81F00F81F00F81F00F81F00F8FFE7FFFFE7FF181D7F9C1B>I<1E003F003F003F003F
001E000000000000000000000000007F007F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F00FFC0FFC00A1E7F9D0E>I<FF0000FF00001F00001F00001F00
001F00001F00001F00001F00001F00001F00001F03FC1F03FC1F01C01F03001F0E001F1C
001F38001F78001FFC001FBE001F1F001F0F001F0F801F07C01F03E01F01E0FFE7FEFFE7
FE171D7F9C19>107 D<FF00FF001F001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F00FFE0FFE00B1D7F9C
0E>I<FF0FC07E00FF31E18F001F40F207801F80FC07C01F80FC07C01F00F807C01F00F8
07C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807
C01F00F807C01F00F807C0FFE7FF3FF8FFE7FF3FF825127F9128>I<FF0FC0FF31E01F40
F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00
F81F00F8FFE7FFFFE7FF18127F911B>I<01FC000F07801C01C03C01E07800F07800F0F8
00F8F800F8F800F8F800F8F800F8F800F87800F07800F03C01E01E03C00F078001FC0015
127F9118>I<FF3F80FFE1E01F80F01F00781F007C1F003C1F003E1F003E1F003E1F003E
1F003E1F003E1F003C1F007C1F00781F80F01FC1E01F3F001F00001F00001F00001F0000
1F00001F0000FFE000FFE000171A7F911B>I<FE3E00FE47001E8F801E8F801E8F801F07
001F00001F00001F00001F00001F00001F00001F00001F00001F00001F0000FFE000FFE0
0011127F9114>114 D<1FD830786018E018E018F000FF807FE07FF01FF807FC007CC01C
C01CE01CE018F830CFC00E127E9113>I<0300030003000300070007000F000F003FFCFF
FC1F001F001F001F001F001F001F001F001F001F0C1F0C1F0C1F0C0F08079803F00E1A7F
9913>I<FF07F8FF07F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00
F81F00F81F00F81F00F81F01F80F01F80786FF01F8FF18127F911B>I<FF8FF8FEFF8FF8
FE1F03E0301F03E0301F03E0300F87F0600F86F0600FC6F8E007CC78C007CC78C003FC7D
8003F83D8003F83F8001F01F0001F01F0000F01E0000E00E0000E00E001F127F9122>
119 D<FFC7FCFFC7FC1F81C00F838007C70003EE0001FC0001F80000F800007C0000FE00
01DF00039F80070F800607C00C03E0FF07FCFF07FC16127F9119>I<FFC1FCFFC1FC1F00
601F80600F80C00F80C007C18007C18003E30003E30003F70001F60001FE0000FC0000FC
00007800007800003000003000006000706000F8E000F8C000F980007300003E0000161A
7F9119>I<FFFFFE1701808B18>123 D E /Fu 51 122 df<000FF000007FFC0001F80E00
03E01F0007C03F000F803F000F803F000F801E000F800C000F8000000F8000000F800000
0F800000FFFFFF00FFFFFF000F801F000F801F000F801F000F801F000F801F000F801F00
0F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F00
0F801F000F801F000F801F007FF0FFE07FF0FFE01B237FA21F>12
D<387CFEFFFF7F3B03030306060C1C18702008117CA210>39 D<FFFCFFFCFFFCFFFC0E04
7F8C13>45 D<00FE0007FFC00F83E01F01F03E00F83E00F87C007C7C007C7C007CFC007C
FC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007E
FC007E7C007C7C007C7C007C3E00F83E00F81F01F00F83E007FFC000FE0017207E9F1C>
48 D<00180000780001F800FFF800FFF80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F8007FFFE07FFFE013207C9F1C>I<03FC
000FFF003C1FC07007E07C07F0FE03F0FE03F8FE03F8FE01F87C01F83803F80003F80003
F00003F00007E00007C0000F80001F00003E0000380000700000E01801C0180380180700
180E00380FFFF01FFFF03FFFF07FFFF0FFFFF0FFFFF015207D9F1C>I<00FE0007FFC00F
07E01E03F03F03F03F81F83F81F83F81F81F03F81F03F00003F00003E00007C0001F8001
FE0001FF000007C00001F00001F80000FC0000FC3C00FE7E00FEFF00FEFF00FEFF00FEFF
00FC7E01FC7801F81E07F00FFFC001FE0017207E9F1C>I<0000E00001E00003E00003E0
0007E0000FE0001FE0001FE00037E00077E000E7E001C7E00187E00307E00707E00E07E0
0C07E01807E03807E07007E0E007E0FFFFFFFFFFFF0007E00007E00007E00007E00007E0
0007E00007E000FFFF00FFFF18207E9F1C>I<3000203E01E03FFFC03FFF803FFF003FFE
003FF80033C00030000030000030000030000031FC0037FF003E0FC03807E03003E00003
F00003F00003F80003F83803F87C03F8FE03F8FE03F8FC03F0FC03F07007E03007C03C1F
800FFF0003F80015207D9F1C>I<001F8000FFE003E07007C0F00F01F81F01F83E01F83E
01F87E00F07C00007C0000FC0800FC7FC0FCFFE0FD80F0FF00F8FE007CFE007CFC007EFC
007EFC007EFC007E7C007E7C007E7C007E3C007C3E007C1E00F80F00F00783E003FFC000
FF0017207E9F1C>I<6000007800007FFFFE7FFFFE7FFFFC7FFFF87FFFF87FFFF0E00060
E000C0C00180C00300C00300000600000C00001C0000180000380000780000780000F000
00F00000F00001F00001F00001F00003F00003F00003F00003F00003F00003F00003F000
01E00017227DA11C>I<00FE0003FFC00703E00E00F01C00F01C00783C00783E00783F00
783F80783FE0F01FF9E01FFFC00FFF8007FFC003FFE007FFF01E7FF83C1FFC7807FC7801
FEF000FEF0003EF0001EF0001EF0001EF8001C7800383C00381F00F00FFFC001FF001720
7E9F1C>I<01FE0007FF800F83E01E01F03E00F07C00F87C0078FC007CFC007CFC007CFC
007EFC007EFC007EFC007E7C00FE7C00FE3E01FE1E037E0FFE7E07FC7E00207E00007C00
007C1E007C3F00F83F00F83F00F03F01E01E03C01C0F800FFE0003F80017207E9F1C>I<
387CFEFEFE7C380000000000000000387CFEFEFE7C3807167C9510>I<00007000000000
7000000000F800000000F800000000F800000001FC00000001FC00000003FE00000003FE
00000003FE000000067F000000067F0000000C7F8000000C3F8000000C3F800000181FC0
0000181FC00000301FE00000300FE00000700FF000006007F000006007F00000C007F800
00FFFFF80001FFFFFC00018001FC00018001FC00030001FE00030000FE00070000FF0006
00007F000600007F00FFE007FFF8FFE007FFF825227EA12A>65 D<FFFFFF8000FFFFFFF0
0007F001F80007F000FC0007F0007E0007F0007E0007F0007F0007F0007F0007F0007F00
07F0007F0007F0007F0007F0007E0007F000FE0007F000FC0007F003F80007FFFFF00007
FFFFF00007F001FC0007F0007E0007F0003F0007F0003F8007F0001F8007F0001FC007F0
001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0003F8007F0003F8007F000
7F0007F001FE00FFFFFFF800FFFFFFC00022227EA128>I<0003FE0080001FFF818000FF
01E38001F8003F8003E0001F8007C0000F800F800007801F800007803F000003803F0000
03807F000001807E000001807E00000180FE00000000FE00000000FE00000000FE000000
00FE00000000FE00000000FE00000000FE000000007E000000007E000001807F00000180
3F000001803F000003801F800003000F8000030007C000060003F0000C0001F800380000
FF00F000001FFFC0000003FE000021227DA128>I<FFFFFF8000FFFFFFF00007F003FC00
07F0007E0007F0003F0007F0001F8007F0000FC007F00007E007F00007E007F00007F007
F00003F007F00003F007F00003F007F00003F807F00003F807F00003F807F00003F807F0
0003F807F00003F807F00003F807F00003F807F00003F807F00003F007F00003F007F000
03F007F00007E007F00007E007F0000FC007F0001F8007F0003F0007F0007E0007F003FC
00FFFFFFF000FFFFFF800025227EA12B>I<FFFFFFF8FFFFFFF807F001F807F0007807F0
003807F0001807F0001C07F0001C07F0000C07F0000C07F0180C07F0180C07F0180007F0
180007F0380007F0780007FFF80007FFF80007F0780007F0380007F0180007F0180007F0
180007F0180007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0
0000FFFFC000FFFFC0001E227EA123>70 D<FFFF80FFFF8007F00007F00007F00007F000
07F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F000
07F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F000
07F00007F000FFFF80FFFF8011227EA115>73 D<FFFFC000FFFFC00007F0000007F00000
07F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00000
07F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00018
07F0001807F0001807F0001807F0003807F0003807F0007007F0007007F000F007F001F0
07F007F0FFFFFFF0FFFFFFF01D227EA122>76 D<FFF000000FFFFFF800001FFF07F80000
1FE006FC000037E006FC000037E006FC000037E0067E000067E0067E000067E0063F0000
C7E0063F0000C7E0061F800187E0061F800187E0060FC00307E0060FC00307E0060FC003
07E00607E00607E00607E00607E00603F00C07E00603F00C07E00601F81807E00601F818
07E00601F81807E00600FC3007E00600FC3007E006007E6007E006007E6007E006003FC0
07E006003FC007E006001F8007E006001F8007E006001F8007E006000F0007E0FFF00F00
FFFFFFF00600FFFF30227EA135>I<0007FC0000003FFF800000FC07E00003F001F80007
E000FC000FC0007E001F80003F001F80003F003F00001F803F00001F807F00001FC07E00
000FC07E00000FC0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE0000
0FE0FE00000FE0FE00000FE0FE00000FE07E00000FC07F00001FC07F00001FC03F00001F
803F80003F801F80003F000FC0007E0007E000FC0003F001F80000FC07E000003FFF8000
0007FC000023227DA12A>79 D<FFFFFF00FFFFFFE007F007F007F001FC07F000FC07F000
7E07F0007E07F0007F07F0007F07F0007F07F0007F07F0007F07F0007E07F0007E07F000
FC07F001FC07F007F007FFFFE007FFFF0007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00000FFFF80
00FFFF800020227EA126>I<FFFFFE0000FFFFFFC00007F007F00007F001F80007F000FC
0007F0007E0007F0007F0007F0007F0007F0007F0007F0007F0007F0007F0007F0007F00
07F0007E0007F000FC0007F001F80007F007F00007FFFFC00007FFFF800007F00FE00007
F007F00007F003F80007F001FC0007F001FC0007F001FC0007F001FC0007F001FC0007F0
01FC0007F001FC0007F001FC0007F001FC0607F000FE0607F000FF0CFFFF803FF8FFFF80
0FF027227EA12A>82 D<01FE0207FF861F01FE3C007E7C001E78000E78000EF80006F800
06FC0006FC0000FF0000FFE0007FFF007FFFC03FFFF01FFFF80FFFFC03FFFE003FFE0003
FE00007F00003F00003FC0001FC0001FC0001FE0001EE0001EF0003CFC003CFF00F8C7FF
E080FF8018227DA11F>I<7FFFFFFF807FFFFFFF807E03F80F807803F807807003F80380
6003F80180E003F801C0E003F801C0C003F800C0C003F800C0C003F800C0C003F800C000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003
F800000003F800000003F800000003F800000003F800000003F800000003F800000003F8
00000003F800000003F800000003F800000003F800000003F8000001FFFFF00001FFFFF0
0022227EA127>I<0FFC003FFF807E07C07E03E07E01E07E01F03C01F00001F00001F000
3FF003FDF01FC1F03F01F07E01F0FC01F0FC01F0FC01F0FC01F07E02F07E0CF81FF87F07
E03F18167E951B>97 D<FF000000FF0000001F0000001F0000001F0000001F0000001F00
00001F0000001F0000001F0000001F0000001F0000001F0000001F0FE0001F3FF8001FE0
7C001F803E001F001F001F000F801F000F801F000FC01F000FC01F000FC01F000FC01F00
0FC01F000FC01F000FC01F000FC01F000F801F001F801F801F001FC03E001EE07C001C3F
F800180FC0001A237EA21F>I<00FF8007FFE00F83F01F03F03E03F07E03F07C01E07C00
00FC0000FC0000FC0000FC0000FC0000FC00007C00007E00007E00003E00181F00300FC0
6007FFC000FF0015167E9519>I<0001FE000001FE0000003E0000003E0000003E000000
3E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0001FC3E0007FF
BE000F81FE001F007E003E003E007E003E007C003E00FC003E00FC003E00FC003E00FC00
3E00FC003E00FC003E00FC003E00FC003E007C003E007C003E003E007E001F00FE000F83
BE0007FF3FC001FC3FC01A237EA21F>I<00FE0007FF800F87C01E01E03E01F07C00F07C
00F8FC00F8FC00F8FFFFF8FFFFF8FC0000FC0000FC00007C00007C00007E00003E00181F
00300FC07003FFC000FF0015167E951A>I<001FC0007FE000F1F001E3F003E3F007C3F0
07C1E007C00007C00007C00007C00007C00007C000FFFE00FFFE0007C00007C00007C000
07C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C000
07C00007C00007C0003FFC003FFC00142380A211>I<01FE0F0007FFBF800F87C7801F03
E7801E01E0003E01F0003E01F0003E01F0003E01F0003E01F0001E01E0001F03E0000F87
C0000FFF800009FE000018000000180000001C0000001FFFE0000FFFF80007FFFE001FFF
FF003C003F0078000F80F0000780F0000780F0000780F000078078000F003C001E001F00
7C000FFFF80001FFC00019217F951C>I<FF000000FF0000001F0000001F0000001F0000
001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F07E0
001F1FF8001F307C001F403C001F803E001F803E001F003E001F003E001F003E001F003E
001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E
001F003E00FFE1FFC0FFE1FFC01A237EA21F>I<1C003E007F007F007F003E001C000000
000000000000000000000000FF00FF001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F00FFE0FFE00B247EA310>I<FF000000FF0000001F
0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F
0000001F0000001F00FF801F00FF801F0038001F0060001F01C0001F0380001F0700001F
0E00001F1C00001F7E00001FFF00001FCF00001F0F80001F07C0001F03E0001F01E0001F
01F0001F00F8001F007C001F003C00FFE0FFC0FFE0FFC01A237EA21E>107
D<FF00FF001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00FFE0FFE00B
237EA210>I<FF07F007F000FF1FFC1FFC001F303E303E001F403E403E001F801F801F00
1F801F801F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F00FFE0FFE0FFE0FFE0FFE0FFE02B167E9530>
I<FF07E000FF1FF8001F307C001F403C001F803E001F803E001F003E001F003E001F003E
001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E
001F003E001F003E00FFE1FFC0FFE1FFC01A167E951F>I<00FE0007FFC00F83E01E00F0
3E00F87C007C7C007C7C007CFC007EFC007EFC007EFC007EFC007EFC007EFC007E7C007C
7C007C3E00F81F01F00F83E007FFC000FE0017167E951C>I<FF0FE000FF3FF8001FE07C
001F803E001F001F001F001F801F001F801F000FC01F000FC01F000FC01F000FC01F000F
C01F000FC01F000FC01F000FC01F001F801F001F801F803F001FC03E001FE0FC001F3FF8
001F0FC0001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000
00FFE00000FFE000001A207E951F>I<00FE030007FF87000FC1C7001F006F003F003F00
7E003F007E001F007C001F00FC001F00FC001F00FC001F00FC001F00FC001F00FC001F00
FC001F007E001F007E001F003E003F001F007F000FC1DF0007FF9F0001FC1F0000001F00
00001F0000001F0000001F0000001F0000001F0000001F0000001F000000FFE00000FFE0
1B207E951E>I<FE1F00FE3FC01E67E01EC7E01E87E01E87E01F83C01F00001F00001F00
001F00001F00001F00001F00001F00001F00001F00001F00001F00001F0000FFF000FFF0
0013167E9517>I<0FF3003FFF00781F00600700E00300E00300F00300FC00007FE0007F
F8003FFE000FFF0001FF00000F80C00780C00380E00380E00380F00700FC0E00EFFC00C7
F00011167E9516>I<0180000180000180000180000380000380000780000780000F8000
3F8000FFFF00FFFF000F80000F80000F80000F80000F80000F80000F80000F80000F8000
0F80000F80000F81800F81800F81800F81800F81800F830007C30003FE0000F80011207F
9F16>I<FF01FE00FF01FE001F003E001F003E001F003E001F003E001F003E001F003E00
1F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E00
1F007E001F00FE000F81BE0007FF3FC001FC3FC01A167E951F>I<FFE01FE0FFE01FE01F
8007000F8006000FC00E0007C00C0007E00C0003E0180003E0180001F0300001F0300000
F8600000F86000007CC000007CC000007FC000003F8000003F8000001F0000001F000000
0E0000000E00001B167F951E>I<FFE3FF07F8FFE3FF07F81F007800C01F807C01C00F80
7C01800F807C018007C07E030007C0DE030007C0DE070003E1DF060003E18F060001F18F
8C0001F3078C0001F3078C0000FF07D80000FE03D80000FE03F800007C01F000007C01F0
00003C01E000003800E000003800E00025167F9528>I<FFE07FC0FFE07FC00F801C0007
C0380003E0700003F0600001F8C00000F98000007F8000003F0000001F0000001F800000
3FC0000037C0000063E00000C1F00001C0F8000380FC0007007E000E003E00FF80FFE0FF
80FFE01B167F951E>I<FFE01FE0FFE01FE01F8007000F8006000FC00E0007C00C0007E0
0C0003E0180003E0180001F0300001F0300000F8600000F86000007CC000007CC000007F
C000003F8000003F8000001F0000001F0000000E0000000E0000000C0000000C00000018
000078180000FC380000FC300000FC60000069C000007F8000001F0000001B207F951E>
I E /Fv 70 128 df<00FE7C0381C60603CE0E03841C03801C03801C03801C03801C0380
1C0380FFFFF01C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380
1C03801C03801C03801C0380FF8FF0171A809916>11 D<00FE000381000601800E03801C
01001C00001C00001C00001C00001C0000FFFF801C03801C03801C03801C03801C03801C
03801C03801C03801C03801C03801C03801C03801C03801C0380FF8FF0141A809915>I<
60C0F1E0F9F068D008100810081010201020204040800C0B7F9913>34
D<010001000FC0193021086108C104C10CC11CC108E100610079003F801FE007F0017801
38011C410CE10CE10C810C81084118211011600F80010001000E1E7E9B13>36
D<60F0F86808080810102040050B7D990B>39 D<00800100020004000C00080018003000
300030006000600060006000E000E000E000E000E000E000E000E000E000E00060006000
60006000300030003000180008000C00040002000100008009267D9B0F>I<8000400020
001000180008000C00060006000600030003000300030003800380038003800380038003
8003800380038003000300030003000600060006000C0008001800100020004000800009
267E9B0F>I<000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C
0000000C0000000C0000000C0000000C0000FFFFFF80FFFFFF80000C0000000C0000000C
0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C
0000191A7E951E>43 D<60F0F07010101020204040040B7D830B>I<FFC0FFC00A028088
0D>I<60F0F06004047D830B>I<07E01C38381C300C700E60066006E007E007E007E007E0
07E007E007E007E007E00760066006700E300C381C1C3807E010187F9713>48
D<03000700FF000700070007000700070007000700070007000700070007000700070007
00070007000700070007007FF80D187D9713>I<0F80106020304038803CC01CE01C401C
003C003800380070006000C001800100020004040804100430083FF87FF8FFF80E187E97
13>I<07E01838201C601E700E201E001E001C001C0038007007E00038001C000E000F00
0FE00FE00FC00F400E601C183807E010187F9713>I<001800180038007800F800B80138
02380238043808381838103820384038C038FFFF00380038003800380038003803FF1018
7F9713>I<07E01818300C2006600660067006780C3E181F3007C003E00CF8307C601E60
0FC007C003C003C00360022004181807E010187F9713>56 D<07E01C303018700C600EE0
06E006E007E007E0076007700F3017182707C700070006000E000C700C7018603030600F
8010187F9713>I<60F0F060000000000000000060F0F06004107D8F0B>I<FFFFFF80FFFF
FF80000000000000000000000000000000000000000000000000FFFFFF80FFFFFF80190A
7E8D1E>61 D<000C0000000C0000000C0000001E0000001E0000002F0000002700000027
00000043800000438000004380000081C0000081C0000181E0000100E0000100E00003FF
F000020070000200700004003800040038000400380008001C0008001C003C001E00FF00
FFC01A1A7F991D>65 D<FFFF800E00E00E00700E00380E003C0E003C0E003C0E003C0E00
3C0E00780E00700E01E00FFFC00E00F00E00780E003C0E001C0E001E0E001E0E001E0E00
1E0E001C0E003C0E00780E00F0FFFFC0171A7F991B>I<003F0201C0C603002E0E001E1C
000E1C0006380006780002700002700002F00000F00000F00000F00000F00000F0000070
00027000027800023800041C00041C00080E000803003001C0C0003F00171A7E991C>I<
FFFF80000E00E0000E0070000E0038000E001C000E000E000E000E000E0007000E000700
0E0007800E0007800E0007800E0007800E0007800E0007800E0007800E0007800E000700
0E0007000E000F000E000E000E001C000E001C000E0078000E00E000FFFF8000191A7F99
1D>I<FFFFF80E00380E00180E00080E000C0E00040E00040E00040E01000E01000E0100
0E03000FFF000E03000E01000E01000E01000E00020E00020E00020E00060E00040E0004
0E000C0E003CFFFFFC171A7F991A>I<003F020001C0C60003002E000E001E001C000E00
1C00060038000600780002007000020070000200F0000000F0000000F0000000F0000000
F0000000F001FFC070000E0070000E0078000E0038000E001C000E001C000E000E000E00
0300160001C06600003F82001A1A7E991E>71 D<FFE1FFC00E001C000E001C000E001C00
0E001C000E001C000E001C000E001C000E001C000E001C000E001C000E001C000FFFFC00
0E001C000E001C000E001C000E001C000E001C000E001C000E001C000E001C000E001C00
0E001C000E001C000E001C00FFE1FFC01A1A7F991D>I<FF801C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
00FF80091A7E990E>I<FFE01FC00E000F000E000C000E0008000E0010000E0020000E00
40000E0180000E0200000E0400000E0C00000E1C00000E2E00000E4700000E8380000F03
80000E01C0000E00E0000E00E0000E0070000E0038000E0038000E001C000E001E000E00
1F00FFE07FC01A1A7F991E>75 D<FFE0000E00000E00000E00000E00000E00000E00000E
00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00080E00080E
00080E00180E00100E00300E00700E00F0FFFFF0151A7F9918>I<FF0000FF0F0000F00F
0000F00B8001700B80017009C0027009C0027009C0027008E0047008E004700870087008
70087008700870083810700838107008381070081C2070081C2070080E4070080E407008
0E40700807807008078070080300701C030070FF8307FF201A7F9923>I<FE007FC00F00
0E000F0004000B80040009C0040009C0040008E00400087004000870040008380400081C
0400081C0400080E04000807040008038400080384000801C4000800E4000800E4000800
740008003C0008003C0008001C0008000C001C000C00FF8004001A1A7F991D>I<007F00
0001C1C000070070000E0038001C001C003C001E0038000E0078000F0070000700F00007
80F0000780F0000780F0000780F0000780F0000780F0000780F000078078000F0078000F
0038000E003C001E001C001C000E0038000700700001C1C000007F0000191A7E991E>I<
FFFF800E01E00E00700E00780E00380E003C0E003C0E003C0E003C0E00380E00780E0070
0E01E00FFF800E00000E00000E00000E00000E00000E00000E00000E00000E00000E0000
0E0000FFE000161A7F991A>I<0FC21836200E6006C006C002C002C002E00070007E003F
E01FF803FC007E000E00070003800380038003C002C006E004D81887E0101A7E9915>83
D<7FFFFF00701C0700401C0100401C0100C01C0180801C0080801C0080801C0080001C00
00001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C00
00001C0000001C0000001C0000001C0000001C0000001C0000001C000003FFE000191A7F
991C>I<FF801FC01C0007001C0006000E0004000E0004000E0004000700080007000800
03801000038010000380100001C0200001C0200000E0400000E0400000E0400000708000
00708000007980000039000000390000001E0000001E0000001E0000000C0000000C0000
1A1A7F991D>86 D<FF81FF07F03C007801C01C007800801C007800801C007800800E009C
01000E009C01000E009C010007010E020007010E020007010E020003830F040003820704
0003820704000382070C0001C403880001C403880001C403880000E801D00000E801D000
00E801D000007000E000007000E000007000E000003000C0000020004000241A7F9927>
I<FFC0FF800F003C000F001000070020000380200003C0400001C0800000E1800000F100
00007A0000003E0000001C0000001E0000001E00000017000000278000004380000041C0
000081E0000100E0000300700002007800040038000C001C001E003E00FF007FC01A1A7F
991D>I<FEFEC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0FEFE07257D9B0B>91 D<2040204040804080810081008100E1C0F1E0F1E060C00B
0B7A9913>I<FEFE06060606060606060606060606060606060606060606060606060606
0606060606FEFE0725809B0B>I<0C001E0033006180C0C080400A067C9913>I<20204040
808080E0F0F060040B7D990B>96 D<1FC000387000383800101C00001C00001C0003FC00
1E1C00381C00701C00E01C00E01C80E01C80E03C80705F801F8F0011107F8F13>I<FC00
001C00001C00001C00001C00001C00001C00001C00001C00001C00001CFC001D07001E03
801C01C01C00C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01801E03001906
0010F800131A809915>I<07F81C1C381C70087000E000E000E000E000E000E000700070
0438081C1807E00E107F8F11>I<003F0000070000070000070000070000070000070000
070000070000070003E7000C1700180F00300700700700E00700E00700E00700E00700E0
0700E00700600700700700380F001C370007C7E0131A7F9915>I<07C01C303018701860
0CE00CFFFCE000E000E000E0006000700438081C1807E00E107F8F11>I<01F007180E38
1C101C001C001C001C001C001C00FFC01C001C001C001C001C001C001C001C001C001C00
1C001C001C001C00FF800D1A80990C>I<0FCF0018718030300070380070380070380070
38003030001860002FC0006000006000007000003FF0003FFC001FFE00600F00C00300C0
0300C00300C00300600600381C0007E00011187F8F13>I<FC00001C00001C00001C0000
1C00001C00001C00001C00001C00001C00001C7C001D87001E03801E03801C03801C0380
1C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF0141A809915>
I<183C3C18000000000000FC1C1C1C1C1C1C1C1C1C1C1C1C1C1CFF081A80990A>I<FC00
001C00001C00001C00001C00001C00001C00001C00001C00001C00001C1FC01C0F001C0C
001C18001C20001C40001CE0001DE0001E70001C78001C38001C1C001C1E001C0F001C0F
80FF9FE0131A809914>107 D<FC001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C00FF80091A80990A>I<
FC7C1F001D8E63801E0781C01E0781C01C0701C01C0701C01C0701C01C0701C01C0701C0
1C0701C01C0701C01C0701C01C0701C01C0701C01C0701C0FF9FE7F81D107F8F20>I<FC
7C001D87001E03801E03801C03801C03801C03801C03801C03801C03801C03801C03801C
03801C03801C0380FF9FF01410808F15>I<07E01C38300C700E6006E007E007E007E007
E007E0076006700E381C1C3807E010107F8F13>I<FCFC001D07001E03801C01C01C01C0
1C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01801E03001D06001CF8001C0000
1C00001C00001C00001C00001C0000FF80001317808F15>I<03E1000C1300180B00300F
00700700E00700E00700E00700E00700E00700E00700700700700700380F001C370007C7
00000700000700000700000700000700000700003FE013177F8F14>I<FC781D9C1E1C1E
081C001C001C001C001C001C001C001C001C001C001C00FF800E10808F0F>I<1F2060E0
4020C020C020F0007F003FC01FE000F080708030C030C020F0408F800C107F8F0F>I<08
00080008000800180018003800FFC0380038003800380038003800380038003820382038
20382018201C4007800B177F960F>I<FC1F801C03801C03801C03801C03801C03801C03
801C03801C03801C03801C03801C03801C07800C07800E0B8003F3F01410808F15>I<FF
0F803C07001C06001C04001C04000E08000E080007100007100007100003A00003A00001
C00001C00001C00000800011107F8F14>I<FE7F1F80381C07003C1C06001C0C04001C0E
04000E1608000E1708000E170800072310000723900007A3900003C1A00003C1E0000180
C0000180C0000180C00019107F8F1C>I<FE3F803C1E001C08000E10000F300007600003
C00001C00001E00003E000027000043800083800181C00381E00FC3FC012107F8F14>I<
FF0F803C07001C06001C04001C04000E08000E080007100007100007100003A00003A000
01C00001C00001C000008000008000010000010000E10000E20000E4000078000011177F
8F14>I<FFFFFFFFF82501808926>124 D<E1C0E1C0E1C0E1C00A047C9913>127
D E /Fw 83 125 df<007E1F0001C1B1800303E3C00703C3C00E03C1800E01C0000E01C0
000E01C0000E01C0000E01C0000E01C000FFFFFC000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0007F87FC001A1D809C18>11 D<007E0001C1800301800703
C00E03C00E01800E00000E00000E00000E00000E0000FFFFC00E01C00E01C00E01C00E01
C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01
C07F87F8151D809C17>I<007FC001C1C00303C00703C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C0FFFFC00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C07FCFF8151D809C17>I<003F07
E00001C09C18000380F018000701F03C000E01E03C000E00E018000E00E000000E00E000
000E00E000000E00E000000E00E00000FFFFFFFC000E00E01C000E00E01C000E00E01C00
0E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E
00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C007FC7FCFF80211D
809C23>I<60F0F0F0F0F0F0F060606060606060606060606060000000000060F0F06004
1E7C9D0C>33 D<0080008007E01898308460824081C087C08FC08FC086E08070807E803F
C01FF00FF803FC00BE008E00876087F083F083E0838082408240842088189007E0008000
8010217E9E15>36 D<60F0F8680808081010204080050C7C9C0C>39
D<00800100020006000C000C00180018003000300030006000600060006000E000E000E0
00E000E000E000E000E000E000E000E000E0006000600060006000300030003000180018
000C000C000600020001000080092A7C9E10>I<8000400020003000180018000C000C00
060006000600030003000300030003800380038003800380038003800380038003800380
038003000300030003000600060006000C000C00180018003000200040008000092A7E9E
10>I<000600000006000000060000000600000006000000060000000600000006000000
06000000060000000600000006000000060000FFFFFFE0FFFFFFE0000600000006000000
060000000600000006000000060000000600000006000000060000000600000006000000
060000000600001B1C7E9720>43 D<60F0F0701010101020204080040C7C830C>I<FFE0
FFE00B0280890E>I<60F0F06004047C830C>I<00010003000600060006000C000C000C00
18001800180030003000300060006000C000C000C0018001800180030003000300060006
000C000C000C00180018001800300030003000600060006000C000C00010297E9E15>I<
03C00C301818300C300C700E60066006E007E007E007E007E007E007E007E007E007E007
E007E007E00760066006700E300C300C18180C3007E0101D7E9B15>I<010007003F00C7
000700070007000700070007000700070007000700070007000700070007000700070007
0007000700070007000700FFF80D1C7C9B15>I<07C01830201C400C400EF00FF80FF807
F8077007000F000E000E001C001C00380070006000C00180030006010C01180110023FFE
7FFEFFFE101C7E9B15>I<07E01830201C201C781E780E781E381E001C001C0018003000
6007C00030001C001C000E000F000F700FF80FF80FF80FF00E401C201C183007C0101D7E
9B15>I<000C00000C00001C00003C00003C00005C0000DC00009C00011C00031C00021C
00041C000C1C00081C00101C00301C00201C00401C00C01C00FFFFC0001C00001C00001C
00001C00001C00001C00001C0001FFC0121C7F9B15>I<300C3FF83FF03FC02000200020
0020002000200023E02C303018301C200E000E000F000F000F600FF00FF00FF00F800E40
1E401C2038187007C0101D7E9B15>I<00F0030C04040C0E181E301E300C700070006000
E3E0E430E818F00CF00EE006E007E007E007E007E007600760077006300E300C18180C30
03E0101D7E9B15>I<4000007FFF807FFF007FFF00400200800400800400800800001000
00100000200000600000400000C00000C00001C000018000018000038000038000038000
038000078000078000078000078000078000078000030000111D7E9B15>I<03E00C3010
08200C200660066006700670067C0C3E183FB01FE007F007F818FC307E601E600FC007C0
03C003C003C00360026004300C1C1007E0101D7E9B15>I<03C00C301818300C700C600E
E006E006E007E007E007E007E0076007700F300F18170C2707C700060006000E300C780C
78187018203010C00F80101D7E9B15>I<60F0F0600000000000000000000060F0F06004
127C910C>I<60F0F0600000000000000000000060F0F0701010101020204080041A7C91
0C>I<7FFFFFC0FFFFFFE000000000000000000000000000000000000000000000000000
00000000000000FFFFFFE07FFFFFC01B0C7E8F20>61 D<0FE03038401CE00EF00EF00EF0
0E000C001C0030006000C000800180010001000100010001000100000000000000000000
0003000780078003000F1D7E9C14>63 D<000600000006000000060000000F0000000F00
00000F000000178000001780000037C0000023C0000023C0000043E0000041E0000041E0
000080F0000080F0000080F000010078000100780001FFF80002003C0002003C0002003C
0004001E0004001E000C001F000C000F001E001F00FF00FFF01C1D7F9C1F>65
D<FFFFC0000F0078000F003C000F001E000F000E000F000F000F000F000F000F000F000F
000F000E000F001E000F003C000F00F8000FFFF0000F003C000F001E000F000F000F0007
000F0007800F0007800F0007800F0007800F0007800F000F000F000F000F001E000F0078
00FFFFE000191C7F9B1D>I<001F808000E0618001801980070007800E0003801C000380
1C00018038000180780000807800008070000080F0000000F0000000F0000000F0000000
F0000000F0000000F0000000F0000000700000807800008078000080380000801C000100
1C0001000E000200070004000180080000E03000001FC000191E7E9C1E>I<FFFFC0000F
00F0000F003C000F000E000F0007000F0007000F0003800F0003C00F0001C00F0001C00F
0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001C00F
0001C00F0003C00F0003800F0007800F0007000F000E000F001C000F007000FFFFC0001B
1C7E9B20>I<FFFFFC0F003C0F000C0F00040F00040F00060F00020F00020F01020F0100
0F01000F01000F03000FFF000F03000F01000F01000F01000F01010F00010F00020F0002
0F00020F00060F00060F000C0F003CFFFFFC181C7E9B1C>I<FFFFF80F00780F00180F00
080F00080F000C0F00040F00040F01040F01000F01000F01000F03000FFF000F03000F01
000F01000F01000F01000F00000F00000F00000F00000F00000F00000F00000F0000FFF8
00161C7E9B1B>I<001F808000E0618001801980070007800E0003801C0003801C000180
38000180780000807800008070000080F0000000F0000000F0000000F0000000F0000000
F0000000F000FFF0F0000F80700007807800078078000780380007801C0007801C000780
0E00078007000B800180118000E06080001F80001C1E7E9C21>I<FFF0FFF00F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000FFFFF000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000F00FFF0FFF01C1C7F9B1F
>I<FFF00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F00
0F000F000F000F000F000F000F000F000F000F00FFF00C1C7F9B0F>I<07FF80007C0000
3C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0000
3C00003C00003C00003C00003C00003C00003C00703C00F83C00F83C00F8380070780040
700030E0000F8000111D7F9B15>I<FFF01FE00F0007800F0006000F0004000F0008000F
0010000F0020000F0040000F0080000F0100000F0200000F0600000F0F00000F1780000F
2780000F43C0000F81E0000F01E0000F00F0000F0078000F0078000F003C000F003E000F
001E000F000F000F000F800F000FC0FFF03FF01C1C7F9B20>I<FFF8000F80000F00000F
00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F
00000F00000F00000F00080F00080F00080F00180F00180F00100F00300F00700F01F0FF
FFF0151C7E9B1A>I<FF8000FF800F8000F8000F8000F8000BC00178000BC00178000BC0
01780009E002780009E002780008F004780008F004780008F00478000878087800087808
78000878087800083C107800083C107800083C107800081E207800081E207800081E2078
00080F407800080F40780008078078000807807800080780780008030078001C03007800
FF8307FF80211C7E9B26>I<FF001FF00F8003800FC001000BC0010009E0010008F00100
08F0010008780100083C0100083E0100081E0100080F0100080F8100080781000803C100
0801E1000801F1000800F1000800790008007D0008003D0008001F0008001F0008000F00
08000700080003001C000300FF8001001C1C7F9B1F>I<003F800000E0E0000380380007
001C000E000E001C0007003C00078038000380780003C0780003C0700001C0F00001E0F0
0001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0700001C0780003C078
0003C0380003803C0007801C0007000E000E0007001C000380380000E0E000003F80001B
1E7E9C20>I<FFFF800F00E00F00780F003C0F001C0F001E0F001E0F001E0F001E0F001E
0F001C0F003C0F00780F00E00FFF800F00000F00000F00000F00000F00000F00000F0000
0F00000F00000F00000F00000F0000FFF000171C7E9B1C>I<003F800000E0E000038038
0007001C000E000E001C0007003C00078038000380780003C0780003C0700001C0F00001
E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0700001C0780003
C0780003C0380003803C0E07801C1107000E208E0007205C0003A0780000F0E020003FE0
200000602000003060000038E000003FC000003FC000001F8000000F001B257E9C20>I<
FFFF00000F01E0000F0078000F003C000F001C000F001E000F001E000F001E000F001E00
0F001C000F003C000F0078000F01E0000FFF00000F01E0000F0070000F0078000F003C00
0F003C000F003C000F003C000F003C000F003C000F003C100F003C100F001C100F001C10
FFF00E20000003C01C1D7E9B1F>I<07E0801C1980300580300380600180E00180E00080
E00080E00080F00000F800007C00007FC0003FF8001FFE0007FF0000FF80000F800007C0
0003C00001C08001C08001C08001C0C00180C00180E00300D00200CC0C0083F800121E7E
9C17>I<7FFFFFC0700F01C0600F00C0400F0040400F0040C00F0020800F0020800F0020
800F0020000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
001F800003FFFC001B1C7F9B1E>I<FFF01FF00F0003800F0001000F0001000F0001000F
0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000F
0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000700020007
8002000380040001C0040000E0180000706000000F80001C1D7F9B1F>I<FFE1FFC0FF1F
003E003C1E003C00180F001E00100F001E00100F001E001007801F002007801F00200780
1F002003C027804003C027804003C027804001E043C08001E043C08001E043C08000F081
E10000F081E10000F081E10000F900F300007900F200007900F200007E007E00003E007C
00003E007C00003C003C00001C003800001C00380000180018000008001000281D7F9B2B
>87 D<FFF003FC0F8001E0078000C007C0008003C0010003E0030001E0020000F0040000
F8040000780800007C1800003C1000003E2000001F2000000F4000000FC0000007800000
078000000780000007800000078000000780000007800000078000000780000007800000
078000007FF8001E1C809B1F>89 D<FEFEC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0FEFE07297C9E0C>91
D<FEFE060606060606060606060606060606060606060606060606060606060606060606
06060606FEFE0729809E0C>93 D<0C0012002100408080400A057B9B15>I<0810204040
808080B0F87830050C7D9C0C>96 D<1FC000307000783800781C00301C00001C00001C00
01FC000F1C00381C00701C00601C00E01C40E01C40E01C40603C40304E801F870012127E
9115>I<FC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00
001C7C001D87001E01801C00C01C00E01C00601C00701C00701C00701C00701C00701C00
701C00601C00E01C00C01E018019070010FC00141D7F9C17>I<03F80C0C181E301E700C
6000E000E000E000E000E000E00060007002300218040C1803E00F127F9112>I<001F80
00038000038000038000038000038000038000038000038000038000038003F3800E0B80
180780300380700380600380E00380E00380E00380E00380E00380E00380600380700380
3003801807800E1B8003E3F0141D7F9C17>I<07E00C301818300C700E6006E006FFFEE0
00E000E000E00060007002300218040C1803E00F127F9112>I<00F8018C071E061E0E0C
0E000E000E000E000E000E00FFE00E000E000E000E000E000E000E000E000E000E000E00
0E000E000E000E000E007FE00F1D809C0D>I<00038007C4C01C78C0383880301800701C
00701C00701C00701C003018003838001C700027C0002000002000003000003FF8001FFF
001FFF802003806001C0C000C0C000C0C000C06001803003001C0E0007F800121C7F9215
>I<FC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C
7C001C87001D03001E03801C03801C03801C03801C03801C03801C03801C03801C03801C
03801C03801C03801C03801C0380FF9FF0141D7F9C17>I<18003C003C00180000000000
00000000000000000000FC001C001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C00FF80091D7F9C0C>I<00C001E001E000C00000000000000000000000
00000007E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E060E0F0C0F1C061803E000B25839C0D>I<FC00001C00001C00001C
00001C00001C00001C00001C00001C00001C00001C00001C0FE01C07801C06001C0C001C
10001C20001C40001CE0001DE0001E70001C78001C38001C3C001C1C001C0E001C0F001C
0F80FF9FE0131D7F9C16>I<FC001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C00FF80091D
7F9C0C>I<FC7E07E0001C838838001D019018001E01E01C001C01C01C001C01C01C001C
01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01
C01C001C01C01C001C01C01C001C01C01C00FF8FF8FF8021127F9124>I<FC7C001C8700
1D03001E03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380
1C03801C03801C0380FF9FF014127F9117>I<03F0000E1C001806003003007003806001
80E001C0E001C0E001C0E001C0E001C0E001C06001807003803003001806000E1C0003F0
0012127F9115>I<FC7C001D87001E01801C01C01C00E01C00E01C00701C00701C00701C
00701C00701C00701C00E01C00E01C01C01E01801D07001CFC001C00001C00001C00001C
00001C00001C00001C0000FF8000141A7F9117>I<03E0800E1980180580380780700380
700380E00380E00380E00380E00380E00380E003807003807003803807801807800E1B80
03E380000380000380000380000380000380000380000380001FF0141A7F9116>I<FCE0
1D381E781E781C301C001C001C001C001C001C001C001C001C001C001C001C00FFC00D12
7F9110>I<1F9020704030C010C010E010F8007F803FE00FF000F880388018C018C018E0
10D0608FC00D127F9110>I<04000400040004000C000C001C003C00FFE01C001C001C00
1C001C001C001C001C001C001C101C101C101C101C100C100E2003C00C1A7F9910>I<FC
1F801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C
03801C03801C07800C07800E1B8003E3F014127F9117>I<FF07E03C03801C01001C0100
0E02000E02000F060007040007040003880003880003C80001D00001D00000E00000E000
00E00000400013127F9116>I<FF3FC7E03C0703C01C0701801C0701001C0B01000E0B82
000E0B82000E1182000711C4000711C4000720C40003A0E80003A0E80003C0680001C070
0001C0700001803000008020001B127F911E>I<FF0FE01E07001C06000E040007080003
900003B00001E00000E00000F00001F000013800021C00041C000C0E001807003C0780FE
1FF014127F9116>I<FF07E03C03801C01001C01000E02000E02000F0600070400070400
03880003880003C80001D00001D00000E00000E00000E000004000004000008000008000
F08000F10000F30000660000380000131A7F9116>I<7FFC70386038407040F040E041C0
03C0038007000F040E041C043C0C380870087038FFF80E127F9112>I<FFFFF01401808B
15>I<FFFFFFFFFF802901808B2A>I E /Fx 19 122 df<FFFF80FFFF80FFFF80FFFF80FF
FF80FFFF8011067F9016>45 D<FFFFFFFC0000FFFFFFFF8000FFFFFFFFE00003FC001FF8
0003FC0003FC0003FC0000FE0003FC00007F0003FC00003F8003FC00001FC003FC00001F
C003FC00000FE003FC00000FE003FC000007F003FC000007F003FC000007F003FC000007
F003FC000007F803FC000007F803FC000007F803FC000007F803FC000007F803FC000007
F803FC000007F803FC000007F803FC000007F803FC000007F803FC000007F003FC000007
F003FC000007F003FC00000FE003FC00000FE003FC00000FC003FC00001FC003FC00003F
8003FC00007F0003FC0000FF0003FC0003FC0003FC001FF800FFFFFFFFF000FFFFFFFF80
00FFFFFFFC00002D297EA834>68 D<FFFFFC0000FFFFFC0000FFFFFC000003FC00000003
FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC
00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00
000003FC00000003FC00000003FC00000003FC00000003FC00000003FC0001C003FC0001
C003FC0001C003FC0001C003FC0003C003FC00038003FC00038003FC00078003FC000780
03FC000F8003FC000F8003FC001F8003FC007F8003FC01FF00FFFFFFFF00FFFFFFFF00FF
FFFFFF0022297EA828>76 D<FFFFFFF800FFFFFFFF00FFFFFFFFC003FC003FE003FC0007
F003FC0003F803FC0003FC03FC0001FC03FC0001FE03FC0001FE03FC0001FE03FC0001FE
03FC0001FE03FC0001FE03FC0001FE03FC0001FC03FC0003FC03FC0003F803FC0007F003
FC003FE003FFFFFF8003FFFFFE0003FC00000003FC00000003FC00000003FC00000003FC
00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00000003FC00
000003FC00000003FC00000003FC00000003FC000000FFFFF00000FFFFF00000FFFFF000
0027297EA82E>80 D<7FFFFFFFFF807FFFFFFFFF807FFFFFFFFF807F807F807F807C007F
800F8078007F80078078007F80078070007F800380F0007F8003C0F0007F8003C0E0007F
8001C0E0007F8001C0E0007F8001C0E0007F8001C0E0007F8001C000007F80000000007F
80000000007F80000000007F80000000007F80000000007F80000000007F80000000007F
80000000007F80000000007F80000000007F80000000007F80000000007F80000000007F
80000000007F80000000007F80000000007F80000000007F80000000007F80000000007F
80000000007F80000000007F80000000FFFFFFC00000FFFFFFC00000FFFFFFC0002A287E
A72F>84 D<03FF80000FFFF0001F01FC003F80FE003F807F003F803F003F803F801F003F
8000003F8000003F8000003F8000003F80003FFF8001FC3F800FE03F801F803F803F003F
807E003F80FC003F80FC003F80FC003F80FC003F80FC005F807E00DF803F839FFC1FFE0F
FC03FC03FC1E1B7E9A21>97 D<FFE00000FFE00000FFE000000FE000000FE000000FE000
000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000
000FE1FE000FEFFF800FFE07E00FF803F00FF001F80FE000FC0FE000FC0FE0007E0FE000
7E0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE000
7E0FE0007E0FE0007E0FE000FC0FE000FC0FF001F80FF803F00F9C0FE00F0FFF800E01FC
00202A7EA925>I<003FC00001FFF00003E07C000F803E001F801F001F001F003F000F80
7E000F807E000FC07E000FC0FE0007C0FE0007C0FFFFFFC0FFFFFFC0FE000000FE000000
FE0000007E0000007E0000007F0000003F0001C01F0001C00F80038007C0070003F01E00
00FFFC00003FE0001A1B7E9A1F>101 D<0007F8003FFC007E3E01FC7F03F87F03F07F07
F07F07F03E07F00007F00007F00007F00007F00007F00007F000FFFFC0FFFFC0FFFFC007
F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007
F00007F00007F00007F00007F00007F00007F00007F00007F0007FFF807FFF807FFF8018
2A7EA915>I<00FF80F003FFE3F80FC1FE1C1F007C7C3F007E7C3E003E107E003F007E00
3F007E003F007E003F007E003F007E003F003E003E003F007E001F007C000FC1F8000BFF
E00018FF80001800000038000000380000003C0000003FFFF8003FFFFF001FFFFFC00FFF
FFE007FFFFF01FFFFFF03C0007F07C0001F8F80000F8F80000F8F80000F8F80000F87C00
01F07C0001F03F0007E00FC01F8007FFFF00007FF0001E287E9A22>I<FFE00000FFE000
00FFE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000
000FE000000FE000000FE000000FE000000FE07E000FE1FF800FE30FC00FE40FE00FE807
E00FF807F00FF007F00FF007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007
F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007
F00FE007F0FFFE3FFFFFFE3FFFFFFE3FFF202A7DA925>I<07000F801FC03FE03FE03FE0
1FC00F8007000000000000000000000000000000FFE0FFE0FFE00FE00FE00FE00FE00FE0
0FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFE
FFFE0F2B7EAA12>I<FFC07E00FFC1FF80FFC30FC00FC40FE00FC807E00FD807F00FD007
F00FD007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007
F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F0FFFE3F
FFFFFE3FFFFFFE3FFF201B7D9A25>110 D<003FE00001FFFC0003F07E000FC01F801F80
0FC03F0007E03F0007E07E0003F07E0003F07E0003F0FE0003F8FE0003F8FE0003F8FE00
03F8FE0003F8FE0003F8FE0003F8FE0003F87E0003F07E0003F03F0007E03F0007E01F80
0FC00FC01F8007F07F0001FFFC00003FE0001D1B7E9A22>I<FFE1FE00FFEFFF80FFFE0F
E00FF803F00FF001F80FE001FC0FE000FC0FE000FE0FE000FE0FE0007F0FE0007F0FE000
7F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007E0FE000FE0FE000FE0FE000
FC0FE001FC0FF001F80FF807F00FFC0FE00FEFFF800FE1FC000FE000000FE000000FE000
000FE000000FE000000FE000000FE000000FE000000FE00000FFFE0000FFFE0000FFFE00
0020277E9A25>I<FFC1F0FFC7FCFFC63E0FCC7F0FD87F0FD07F0FD07F0FF03E0FE0000F
E0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000F
E0000FE0000FE000FFFF00FFFF00FFFF00181B7F9A1B>114 D<03FE300FFFF03E03F078
00F07000F0F00070F00070F80070FE0000FFE0007FFF007FFFC03FFFE01FFFF007FFF800
FFF80007FC0000FCE0007CE0003CF0003CF00038F80038FC0070FF01E0E7FFC0C1FF0016
1B7E9A1B>I<00E00000E00000E00000E00001E00001E00001E00003E00003E00007E000
0FE0001FFFE0FFFFE0FFFFE00FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE000
0FE0000FE0000FE0000FE0000FE0000FE0700FE0700FE0700FE0700FE0700FE0700FE070
07F0E003F0C001FF80007F0014267FA51A>I<FFFC03FFFFFC03FFFFFC03FF0FF000F007
F000E007F800E003F801C003F801C003FC03C001FC038001FE078000FE070000FF070000
7F0E00007F0E00007F9E00003F9C00003FFC00001FF800001FF800000FF000000FF00000
0FF0000007E0000007E0000003C0000003C000000380000003800000078000380700007C
0F0000FE0E0000FE1E0000FE1C0000FE38000074F000003FE000000F80000020277F9A23
>121 D E end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin
%%PaperSize: a4

%%EndSetup
%%Page: 1 1
1 0 bop 349 194 a Fx(The)22 b(Design)g(of)g(a)g(Prett)n(y-prin)n(ti)q
(ng)j(Library)821 339 y Fw(John)14 b(Hughes)528 426 y
Fv(Chalmers)g(T)m(eknisk)n(a)h(H\177)-19 b(ogsk)o(ola,)14
b(G\177)-19 b(oteb)q(org,)13 b(Sw)o(eden.)183 565 y Fu(1)56
b(In)n(tro)r(duction)183 670 y Fw(On)17 b(what)h(do)q(es)g(the)g(p)q(o)
o(w)o(er)g(of)f(functional)f(programming)e(dep)q(end?)19
b(Wh)o(y)e(are)g(functional)183 719 y(programs)c(so)i(often)f(a)g
(fraction)h(of)f(the)h(size)g(of)f(equiv)n(alen)o(t)g(programs)f(in)h
(other)h(languages?)183 769 y(Wh)o(y)f(are)g(they)h(so)g(easy)g(to)f
(write?)h(I)f(claim:)e(b)q(ecause)k(functional)d(languages)h(supp)q
(ort)i(soft-)183 819 y(w)o(are)e(reuse)h(extremely)f(w)o(ell.)245
870 y(Programs)h(are)j(constructed)g(b)o(y)f(putting)f(program)f(comp)q
(onen)o(ts)h(together.)h(When)g(w)o(e)183 920 y(discuss)e(reuse,)g(w)o
(e)f(should)f(ask)209 1006 y Ft({)20 b Fw(What)15 b(kind)f(of)h(comp)q
(onen)o(ts)g(can)g(b)q(e)g(giv)o(en)g(a)g(name)f(and)h(reused,)h
(rather)g(than)f(recon-)253 1056 y(structed)h(at)e(eac)o(h)g(use?)209
1107 y Ft({)20 b Fw(Ho)o(w)14 b(\015exibly)f(can)h(eac)o(h)h(comp)q
(onen)o(t)e(b)q(e)h(used?)183 1193 y(Ev)o(ery)f(programming)c(language)
j(w)o(orth)o(y)g(of)h(the)g(name)f(allo)o(ws)f(sections)j(of)e(a)h
(program)e(with)183 1243 y(iden)o(tical)k(con)o(trol)g(\015o)o(w)g(to)h
(b)q(e)g(shared,)g(b)o(y)f(de\014ning)h(and)f(reusing)h(a)g(pro)q
(cedure.)h(But)f(`pro-)183 1292 y(grammi)o(ng)11 b(idioms')h(|)i(for)g
(example)f(lo)q(oping)g(o)o(v)o(er)i(an)f(arra)o(y)g(|)g(often)h
(cannot)f(b)q(e)h(de\014ned)183 1342 y(as)c(pro)q(cedures)i(b)q(ecause)
g(the)f(rep)q(eated)h(part)f(\(the)g(lo)q(op)e(construct\))j(con)o
(tains)e(a)g(v)n(arying)f(part)183 1392 y(\(the)15 b(lo)q(op)f(b)q(o)q
(dy\))g(whic)o(h)g(is)h(di\013eren)o(t)g(at)g(ev)o(ery)g(instance.)g
(In)f(a)g(functional)g(language)f(there)183 1442 y(is)j(no)g(problem:)f
(w)o(e)h(can)h(de\014ne)g(a)f Fs(higher-or)n(der)g(function)p
Fw(,)h(in)f(whic)o(h)g(the)h(v)n(arying)e(part)i(is)183
1492 y(passed)12 b(as)g(a)g(function-v)n(alued)e(parameter.)h(This)h
(abilit)o(y)e(to)i(name)e(and)i(reuse)h(programming)183
1541 y(idioms)e(is)j(at)g(the)g(heart)h(of)e(functional)g(languages')g
(p)q(o)o(w)o(er.)245 1592 y(Other)h(features)h(con)o(tribute)e(to)h
(making)c(reused)15 b(comp)q(onen)o(ts)e(more)f(\015exible.)h
Fs(Polymor-)183 1642 y(phic)k(typing)g Fw(enables)g(us)g(to)f(use)i
(the)f Fs(same)f Fw(programming)d(idiom)h(to)i(manipulate)f(data)h(of)
183 1692 y Fs(di\013er)n(ent)d Fw(t)o(yp)q(es.)h Fs(L)n(azy)g
(evaluation)g Fw(abstracts)h(a)o(w)o(a)o(y)d(from)f(execution)j(time,)e
(and)h(enables)h(us)183 1742 y(to)f(reuse)j(the)e(same)f(function)h
(with)f(man)o(y)f(di\013eren)o(t)j(b)q(eha)o(viours.)e(F)m(or)h
(example,)e(a)h(lazy)h(list)183 1791 y(can)e(b)q(eha)o(v)o(e)h(lik)o(e)
e(an)h(arra)o(y)f(\(a)h(sequence)j(of)c(elemen)o(ts)h(stored)h(at)f
(the)h(same)e(time\),)f(or)i(lik)o(e)g(an)183 1841 y(imp)q(erativ)o(e)d
(v)n(ariable)h(\(a)h(sequence)i(of)e(v)n(alues)g(stored)h(at)f
(di\013eren)o(t)h(times\),)d(or)i(lik)o(e)g(something)183
1891 y(in)j(b)q(et)o(w)o(een)i(\(sa)o(y)f(a)f(bu\013er)i(in)e(whic)o(h)
h(a)f(b)q(ounded)i(n)o(um)o(b)q(er)e(of)g(elemen)o(ts)g(are)i(stored)f
(at)g(an)o(y)183 1941 y(one)h(time\).)f(Regardless)i(of)f(b)q(eha)o
(viour)h(the)g(same)e(functions)i(can)g(b)q(e)g(used)g(to)g(manipulate)
183 1991 y(the)d(list.)245 2041 y(Soft)o(w)o(are)f(reuse)h(is)f
(plainly)e(visible)h(in)h(functional)f(programs:)f(for)h(example,)f
(the)j(Hask)o(ell)183 2091 y(standard)d(prelude)g(con)o(tains)f(man)o
(y)f(higher-order)i(functions)f(suc)o(h)i(as)e Fs(map)p
Fw(,)g Fs(foldr)g Fw(etc.,)h(whic)o(h)183 2141 y(are)j(used)g(in)o
(tensiv)o(ely)f(in)h(man)o(y)d(programs.)h(These)j(standard)f
(functions)g(capture)g(v)o(ery)g(gen-)183 2191 y(eral)k(programmi)o(ng)
d(idioms)h(that)i(are)h(useful)f(in)g(almost)e(an)o(y)i(con)o(text.)g
(But)h(it)f(is)g(just)g(as)183 2241 y(imp)q(ortan)o(t)12
b(to)i(de\014ne)g(and)g(use)h Fs(applic)n(ation)g(sp)n(e)n(ci\014c)f
Fw(idioms.)245 2292 y(The)j(functional)e(programmer,)f(then,)i(should)g
(approac)o(h)h(a)f(new)g(application)f(b)o(y)h(seek-)183
2341 y(ing)g(to)i(iden)o(tify)e(the)j(programmi)o(ng)14
b(idioms)i(common)e(in)j(that)h(application)e(area,)h(and)h(to)183
2391 y(de\014ne)e(them)f(as)h(\(probably)g(higher)f(order\))i
(functions.)f(Eac)o(h)g(particular)f(application)g(pro-)183
2441 y(gram)g(should)h(then)i(b)q(e)f(built)f(b)o(y)h(so)f(far)h(as)g
(p)q(ossible)g(com)o(bining)d(these)k(functions,)f(rather)183
2491 y(than)g(writing)g(`new)h(co)q(de'.)f(\(P)o(erhaps)i(for)e(this)h
(reason,)g(suc)o(h)g(functions)g(are)g(often)g(called)p
eop
%%Page: 2 2
2 1 bop 340 194 a Fs(c)n(ombinators)p Fw(\).)16 b(The)g(b)q(ene\014ts)h
(of)e(suc)o(h)h(an)f(approac)o(h)h(are)g(v)o(ery)g(rapid)f(programming)
o(,)d(once)340 244 y(the)h(library)e(of)g(idioms)e(is)j(de\014ned,)g
(and)g(v)o(ery)g(often)g(that)f(application)g(programs)f(are)i(correct)
340 293 y(\014rst)j(time,)d(since)j(they)f(are)h(built)e(b)o(y)g(assem)
o(bling)g(correct)i(comp)q(onen)o(ts.)403 343 y(One)f(example)f(of)g
(an)h(application)e(area)i(whose)g(idioms)e(ha)o(v)o(e)i(b)q(een)g
(thoroughly)g(studied)340 393 y(is)k(parsing:)f(libraries)g(of)g
(parsing)g(com)o(binators)f(are)i(describ)q(ed)h(in)f(this)f(v)o
(olume.)e(Another)340 443 y(go)q(o)q(d)f(example)f(on)i(a)f(m)o(uc)o(h)
f(larger)h(scale)h(is)f(Carlsson)h(and)f(Hallgren's)g
Fs(fudget)g Fw(library)m(,)f(also)340 493 y(describ)q(ed)h(here,)f
(whic)o(h)f(enables)g(graphical)f(user)i(in)o(terfaces)g(to)f(b)q(e)g
(constructed)i(v)o(ery)f(easily)m(.)403 542 y(The)i(question)g(w)o(e)g
(address)i(in)d(this)h(c)o(hapter)h(is:)e(ho)o(w)h(should)g(libraries)f
(of)h(com)o(binators)340 592 y(b)q(e)f(designed?)e(Ho)o(w)h(do)f(w)o(e)
h(kno)o(w)f(whic)o(h)g(op)q(erations)h(to)f(pro)o(vide?)g(Monads,)g
(also)g(explained)340 642 y(in)j(this)h(v)o(olume,)d(are)i(certainly)h
(helpful)e(|)h(but)h(ho)o(w)e(do)i(w)o(e)f(kno)o(w)g(whic)o(h)g(monad)f
(to)h(use?)340 692 y(Must)g(w)o(e)f(rely)g(completely)f(on)g(in)o
(tuition?)403 742 y(Our)e(goal)e(is)i(to)g(sho)o(w)f(ho)o(w)h(w)o(e)f
(can)h(use)h(formal)c(sp)q(eci\014cation)k(of)e(the)h(com)o(binators,)e
(and)h(a)340 791 y(study)j(of)e(their)h(algebraic)g(prop)q(erties,)h
(to)e(guide)h(b)q(oth)g(the)g(design)h(and)e(the)i(implem)o(en)o
(tation)340 841 y(of)j(a)g(com)o(binator)f(library)m(.)g(Our)i(case)g
(study)g(is)f(a)g(library)g(for)g(prett)o(y-prin)o(ting,)g(whic)o(h)g
(has)340 891 y(gone)d(through)g(man)o(y)e(iterations)i(and)f(b)q(een)i
(m)o(uc)o(h)e(impro)o(v)o(ed)f(b)o(y)h(a)h(more)e(formal)g(approac)o
(h.)340 941 y(But)19 b(w)o(e)f(hop)q(e)h(the)f(metho)q(ds)g(w)o(e)g
(presen)o(t)i(are)e(of)g(wider)g(applicabilit)o(y)m(,)d(and)j(w)o(e)g
(will)f(also)340 991 y(presen)o(t)f(some)d(smaller)f(examples)h(to)h
(justify)f(this)h(claim.)340 1115 y Fu(2)56 b(A)19 b(Preview)f(of)h
(the)f(Prett)n(y-prin)n(ting)f(Library)340 1205 y Ft(2.1)48
b(Wh)o(y)16 b(Prett)o(y-pri)o(n)n(ti)o(ng?)340 1277 y
Fw(Almost)d(ev)o(ery)j(program)c(whic)o(h)j(manipulates)e(sym)o(b)q
(olic)f(data)i(needs)i(to)e(displa)o(y)g(this)g(data)340
1327 y(to)h(the)g(user)g(at)f(some)g(p)q(oin)o(t)g(|)g(whether)h(it)g
(is)f(a)g(compiler)f(displa)o(ying)g(in)o(ternal)h(structures)340
1377 y(for)e(debugging,)f(a)g(pro)q(of-editor)h(displa)o(ying)e(pro)q
(ofs,)i(or)g(a)f(program)g(transformer)g(writing)g(its)340
1427 y(output.)j(The)h(problem)e(of)h(displa)o(ying)e(sym)o(b)q(olic,)g
(and)i(esp)q(ecially)h(tree)g(structured)i(data,)c(is)340
1477 y(th)o(us)i(a)e(recurring)i(one.)403 1527 y(A)o(t)f(the)g(same)f
(time,)f(structured)k(data)e(is)g(hard)g(to)g(read)g(unless)h(la)o(y)o
(out)d(is)i(used)h(to)f(mak)o(e)340 1576 y(the)h(structure)h(visible.)d
(T)m(ak)o(e)g(a)h(simple)e(example:)g(a)i(binary)f(tree)i(of)e(t)o(yp)q
(e)1542 1561 y Fr(1)1562 1576 y Fw(.)724 1649 y Ft(data)j
Fs(T)m(r)n(e)n(e)10 b Fw(=)i Fs(No)n(de)j(String)f(T)m(r)n(e)n(e)f(T)m
(r)n(e)n(e)8 b Fq(j)g Fs(L)n(e)n(af)340 1722 y Fw(The)j(tree)g
Fs(No)n(de)k Fp(\\fo)q(o")9 b Fw(\()p Fs(No)n(de)16 b
Fp(\\baz")10 b Fs(L)n(e)n(af)g(L)n(e)n(af)p Fw(\))g(\()p
Fs(No)n(de)15 b Fp(\\fo)q(obaz")9 b Fs(L)n(e)n(af)h(L)n(e)n(af)p
Fw(\))g(is)g(m)o(uc)o(h)f(easier)340 1772 y(to)14 b(read)g(if)g(it)f
(is)h(presen)o(ted)i(as)747 1847 y Fs(No)n(de)f Fp(\\fo)q(o")k
Fw(\()p Fs(No)n(de)c Fp(\\baz")f Fs(L)n(e)n(af)f(L)n(e)n(af)p
Fw(\))969 1897 y(\()p Fs(No)n(de)i Fp(\\fo)q(obaz")e
Fs(L)n(e)n(af)h(L)n(e)n(af)p Fw(\))340 1970 y(A)g(prett)o(y-prin)o
(ter's)h(job)f(is)f(to)h(la)o(y)f(out)h(structured)i(data)e
(appropriately)m(.)403 2020 y(Prett)o(y-prin)o(ting)i(is)h(complicated)
e(b)q(ecause)k(the)e(la)o(y)o(out)e(of)h(a)h(no)q(de)g(cannot)g(just)g
(b)q(e)g(in-)340 2070 y(ferred)d(from)d(its)h(form.)e(In)j(the)g
(example)e(ab)q(o)o(v)o(e,)h Fs(No)n(de)p Fw(s)h(are)g(laid)e(out)i(in)
f(t)o(w)o(o)g(di\013eren)o(t)h(w)o(a)o(ys:)340 2120 y(some)g(horizon)o
(tally)f(and)h(some)g(v)o(ertically)m(.)f(Moreo)o(v)o(er)i(the)g
(correct)h(inden)o(tation)e(of)g(the)h(\014nal)340 2169
y Fs(No)n(de)g Fw(dep)q(ends)h(on)f(the)g(length)g(of)f(the)h(string)g
(in)f(the)h(paren)o(t)g(no)q(de.)g(A)f(prett)o(y-prin)o(ter)i(m)o(ust)
340 2219 y(k)o(eep)g(trac)o(k)f(of)f(m)o(uc)o(h)g(con)o(textual)h
(information.)403 2269 y(Because)19 b(of)e(this)h(prett)o(y-prin)o
(ters)h(are)f(hard)g(to)g(write,)f(and)h(there)h(is)e(plen)o(t)o(y)h
(of)f(scop)q(e)340 2319 y(for)f(mistak)o(es.)e(Man)o(y)h(programmers)f
(simply)f(do)j(not)f(b)q(other)i(|)e(they)h(put)g(up)g(with)f(badly)340
2369 y(formatted)d(output)g(instead.)h(There)g(is)g(m)o(uc)o(h)e(to)h
(b)q(e)i(gained)e(b)o(y)g(capturing)g(the)h(hard)g(part)g(of)340
2418 y(prett)o(y-prin)o(ting)h(in)g(a)f(library)m(.)p
340 2448 237 2 v 349 2475 a Fo(1)379 2491 y Fv(All)h(examples)g(in)g
(this)g(c)o(hapter)g(use)f(Hask)o(ell)i(syn)o(tax)p eop
%%Page: 3 3
3 2 bop 183 194 a Fs(R)n(emark)31 b Fw(Note)22 b(that)g(w)o(e)g(are)g
(considering)g(the)h(problem)d(of)h(displa)o(ying)g(in)o(ternal)g
(data-)183 244 y(structures)f(in)d(a)g(readable)g(form,)f(not)h(the)h
(harder)g(problem)e(of)h(impro)o(ving)e(the)j(la)o(y)o(out)e(of)183
293 y(an)g(existing)h(text,)g(suc)o(h)g(as)g(a)g(program.)e(In)i(the)g
(latter)g(case)h(w)o(e)f(w)o(ould)f(ha)o(v)o(e)h(to)g(consider)183
343 y(questions)g(suc)o(h)g(as:)f(should)g(w)o(e)h(try)f(to)h(preserv)o
(e)h(an)o(ything)e(of)f(the)i(original)e(la)o(y)o(out?)g(Ho)o(w)183
393 y(should)e(w)o(e)h(handle)g(commen)o(ts?)e(Suc)o(h)i(problems)f
(are)h(outside)h(the)f(scop)q(e)h(of)f(this)f(c)o(hapter.)183
526 y Ft(2.2)47 b(A)16 b(Sk)o(etc)o(h)f(of)g(the)g(Design)183
618 y Fw(What)j(kind)h(of)f(ob)r(jects)j(should)d(prett)o(y-prin)o
(ting)h(com)o(binators)f(manipulate?)f(I)i(c)o(hose)h(to)183
668 y(w)o(ork)d(with)h(`prett)o(y)h(do)q(cumen)o(ts',)e(of)g(t)o(yp)q
(e)i Fs(Do)n(c)q Fw(,)e(whic)o(h)h(w)o(e)h(can)f(think)g(of)f(as)i(do)q
(cumen)o(ts)183 718 y(whic)o(h)d(`kno)o(w)g(ho)o(w)h(to')f(la)o(y)g
(themselv)o(es)h(out)g(prettily)m(.)f(A)g(prett)o(y-prin)o(ter)j(for)d
(a)h(particular)183 768 y(datat)o(yp)q(e)g(is)f(a)h(function)f(mapping)
e(an)o(y)j(v)n(alue)f(to)g(a)h(suitable)f Fs(Do)n(c)q
Fw(.)g(The)h(library)f(pro)o(vides)183 817 y(op)q(erations)f(for)g
(constructing)h Fs(Do)n(c)q Fw(s)g(in)e(v)n(arious)h(w)o(a)o(ys,)g(and)
g(for)g(con)o(v)o(erting)g(a)g Fs(Do)n(c)h Fw(to)f(text)183
867 y(at)e(the)i(top)f(lev)o(el.)245 919 y(W)m(e)d(will)e(need)j(to)f
(con)o(v)o(ert)h(literal)e(strings)i(to)f Fs(Do)n(c)p
Fw(s,)g(and)g(it)g(seems)g(reasonable)h(to)f(pro)o(vide)183
969 y(op)q(erations)j(that)f(com)o(bine)g Fs(Do)n(c)p
Fw(s)h(horizon)o(tally)f(and)g(v)o(ertically)m(.)f(That)i(suggests)h(w)
o(e)f(pro)o(vide)183 1018 y(op)q(erations)464 1076 y
Fs(text)d Fw(::)g Fs(String)g Fq(!)g Fs(Do)n(c)464 1126
y Fw(\()-7 b Fn(<)g(>)g Fw(\))13 b(::)d Fs(Do)n(c)i Fq(!)f
Fs(Do)n(c)h Fq(!)f Fs(Do)n(c)54 b Fw([horizon)o(tal)13
b(comp)q(osition)n(])464 1176 y(\($$\))e(::)g Fs(Do)n(c)h
Fq(!)f Fs(Do)n(c)h Fq(!)f Fs(Do)n(c)56 b Fw([v)o(ertical)13
b(comp)q(osition)n(])183 1257 y(The)g(comp)q(osition)e(op)q(erators)i
(\()-7 b Fn(<)g(>)g Fw(\))14 b(and)e(\($$\))h(reliev)o(e)g(the)g(user)h
(of)e(the)h(need)h(to)e(think)h(ab)q(out)183 1306 y(the)e(correct)i
(inden)o(tation:)d(for)h(example,)e(the)j(prett)o(y)g(tree)g(la)o(y)o
(out)e(ab)q(o)o(v)o(e)h(can)h(b)q(e)f(constructed)183
1356 y(as)423 1417 y Fs(text)k Fp(\\)p Fs(No)n(de)g Fp(\\fo)q(o")e(")e
Fn(<)-7 b(>)12 b Fw(\()6 b Fs(text)15 b Fp(\\)p Fs(No)n(de)g
Fp(\\baz")e Fs(L)n(e)n(af)h(L)n(e)n(af)7 b Fp(")i Fw($$)864
1466 y Fs(text)15 b Fp(\\)p Fs(No)n(de)g Fp(\\fo)q(obaz")e
Fs(L)n(e)n(af)g(L)n(e)n(af)7 b Fp(")p Fw(\))183 1545
y(and)13 b(the)i(last)e Fs(No)n(de)i Fw(is)e(automatically)e(inden)o
(ted)k(the)f(righ)o(t)g(amoun)o(t.)245 1597 y(Ho)o(w)o(ev)o(er,)g
(these)i(op)q(erations)e(only)f(enable)i(us)f(to)g(construct)i
Fs(Do)n(c)p Fw(s)f(with)f(a)g(\014xed)g(la)o(y)o(out.)183
1646 y(W)m(e)g(also)g(need)i(to)f(construct)h Fs(Do)n(c)q
Fw(s)f(that)g(c)o(ho)q(ose)g(b)q(et)o(w)o(een)h(alternativ)o(e)f(la)o
(y)o(outs)f(dep)q(ending)183 1696 y(on)f(the)i(con)o(text.)f(W)m(e)f
(will)g(therefore)i(de\014ne)774 1786 y Fs(sep)c Fw(::)g([)p
Fs(Do)n(c)p Fw(])g Fq(!)g Fs(Do)n(c)183 1875 y Fw(whic)o(h)i(com)o
(bines)g(a)h(list)f(of)h Fs(Do)n(c)p Fw(s)g(horizon)o(tally)f(or)h(v)o
(ertically)m(,)e(dep)q(ending)i(on)g(the)h(con)o(text.)245
1926 y(With)e(these)i(op)q(erations)g(w)o(e)f(can)g(write)g(a)g(prett)o
(y-prin)o(ter)h(for)e(the)i(tree)g(t)o(yp)q(e)f(ab)q(o)o(v)o(e:)420
2014 y Fs(pp)e Fw(::)f Fs(T)m(r)n(e)n(e)f Fq(!)h Fs(Do)n(c)420
2063 y(pp)k(L)n(e)n(af)d Fw(=)f Fs(text)k Fp(\\Leaf)s(")420
2113 y Fs(pp)g Fw(\()p Fs(No)n(de)h Fn(s)e(l)h(r)q Fw(\))c(=)h
Fs(text)j Fw(\()p Fp(\\No)q(de)g(")9 b Fw(+)-12 b(+)p
Fn(s)p Fw(\))13 b Fn(<)-7 b(>)12 b Fs(sep)j Fw([)p Fs(pp')f
Fn(l)q(;)7 b Fs(pp')14 b Fn(r)q Fw(])420 2163 y Fs(pp')g(L)n(e)n(af)d
Fw(=)h Fs(pp)j(L)n(e)n(af)420 2213 y(pp')f Fn(t)e Fw(=)f
Fs(text)k Fp(\\\(")c Fn(<)-7 b(>)13 b Fs(pp)i Fn(t)c(<)-7
b(>)13 b Fp(\\\)")183 2299 y Fw(The)h(con)o(text-dep)q(enden)o(t)j(c)o
(hoice)e(of)e(la)o(y)o(out)h(is)g(en)o(tirely)g(hidden)h(in)e(the)i
(implemen)o(tation)c(of)183 2349 y(the)j Fs(Do)n(c)h
Fw(t)o(yp)q(e)f(|)f(the)i(only)e(complication)e(is)j(deciding)g(when)g
(to)g(insert)h(brac)o(k)o(ets.)245 2401 y(The)f(library)f(pro)o(vides)h
(one)h(further)f(op)q(eration,)718 2491 y Fs(nest)e Fw(::)f
Fs(Int)g Fq(!)g Fs(Do)n(c)h Fq(!)f Fs(Do)n(c)p eop
%%Page: 4 4
4 3 bop 340 194 a Fw(whic)o(h)14 b(inden)o(ts)h(a)e(do)q(cumen)o(t)h(a)
f(giv)o(en)h(n)o(um)o(b)q(er)f(of)g(spaces.)i(F)m(or)e(example,)679
279 y Fs(text)i Fp(\\while)g(x)p Fn(>)p Fp(0)f(do")9
b Fw($$)g Fs(nest)15 b Fw(2)e(\()p Fs(text)i Fp(\\x)f(:=)g(x-2")o
Fw(\))340 364 y(pro)q(duces)i(the)e(la)o(y)o(out)981
444 y Fp(while)h(x)p Fn(>)p Fp(0)f(do)1023 494 y(x)g(:=)f(x-2)340
575 y Fw(The)20 b(di\013erence)h(b)q(et)o(w)o(een)g(using)e
Fs(nest)h Fw(and)f(inserting)g(spaces)i(is)e(that)h Fs(nest)f
Fw(inden)o(ts)h(only)340 625 y(where)15 b(it)f(is)g(appropriate)g(|)f
(so)h(for)f(example,)652 710 y Fs(sep)j Fw([)p Fs(text)e
Fp(\\while)h(x)p Fn(>)p Fp(0)f(do")p Fn(;)7 b Fs(nest)14
b Fw(2)g(\()p Fs(text)h Fp(\\x)e(:=)h(x-2")o Fw(\)])340
796 y(will)f(app)q(ear)h(as)g(ab)q(o)o(v)o(e)g(laid)e(out)i(v)o
(ertically)m(,)e(but)j(without)e(inden)o(tation)g(as)902
879 y Fp(while)i(x)p Fn(>)p Fp(0)f(do)g(x)g(:=)g(x-2)340
962 y Fw(if)f(laid)g(out)h(horizon)o(tally)m(.)403 1011
y(This)i(c)o(hoice)g(of)g(com)o(binators)e(w)o(as)i(made)f(quite)h
(early)g(on)g(in)f(the)i(dev)o(elopmen)o(t)e(of)h(the)340
1061 y(library)m(,)10 b(and)i(the)g(\014rst)g(implemen)o(tation)c(w)o
(as)k(written)g(from)e(a)h(description)h(more)f(or)h(less)g(lik)o(e)340
1111 y(the)f(one)g(just)f(giv)o(en.)g(But)g(the)h(description)g(is)f
(far)g(from)f(satisfactory:)h(although)f(the)i(in)o(ten)o(tion)340
1161 y(of)g(the)h(design)g(is)f(fairly)f(clear,)i(the)g(precise)h(b)q
(eha)o(viour)e(of)g(the)h(com)o(binators)e(is)h(certainly)h(not.)340
1211 y(Not)i(surprisingly)m(,)f(this)h(led)g(to)f(a)h(n)o(um)o(b)q(er)f
(of)g(di\016culties)h(and)g(strange)g(b)q(eha)o(viours.)403
1260 y(Later)h(on)g(w)o(e)g(will)e(giv)o(e)i(a)f(precise)j(sp)q
(eci\014cation)e(of)g(the)g(com)o(binators')e(b)q(eha)o(viour,)h(and)
340 1310 y(use)h(this)g(to)f(deriv)o(e)g(sev)o(eral)h(alternativ)o(e)f
(implem)o(en)o(tations.)d(But)k(b)q(efore)g(w)o(e)f(con)o(tin)o(ue)g
(with)340 1360 y(this)f(larger)f(case)i(study)m(,)e(w)o(e'll)f(presen)o
(t)j(some)d(simpler)h(examples)f(to)h(illustrate)h(the)g(metho)q(ds)340
1410 y(w)o(e)i(will)d(b)q(e)i(using.)340 1544 y Fu(3)56
b(Deriving)17 b(F)-5 b(unctional)19 b(Programs)f(from)f(Sp)r
(eci\014cations)340 1644 y Fw(Ho)o(w)d(can)h(w)o(e)g(con)o(v)o(enien)o
(tly)f(use)h(a)f(sp)q(eci\014cation)h(to)g(help)f(dev)o(elop)h(a)f
(functional)f(program?)340 1694 y(Let)g(us)f(supp)q(ose)g(that)g(the)g
(sp)q(eci\014cation)h(consists)f(of)f(a)h Fs(signatur)n(e)p
Fw(,)f(con)o(taining)f(p)q(ossibly)i(new)340 1744 y(t)o(yp)q(es)19
b(suc)o(h)f(as)f Fs(Do)n(c)h Fw(and)f(the)h(names)f(and)g(t)o(yp)q(es)h
(of)f(the)h(functions)g(b)q(eing)f(sp)q(eci\014ed,)h(and)340
1793 y(prop)q(erties)c(that)f(the)g(new)g(functions)g(m)o(ust)f
(satisfy)m(.)f(Our)i(task)g(is)f(to)h(in)o(v)o(en)o(t)f(represen)o
(tations)340 1843 y(of)h(the)g(new)g(t)o(yp)q(es)h(and)e(de\014nitions)
h(of)f(the)i(functions)e(so)h(that)g(the)h(prop)q(erties)g(are)f
(satis\014ed.)340 1893 y(W)m(e)e(will)e(call)h(functions)h(from)e(the)j
(new)f(t)o(yp)q(es)h(to)f(old)f(t)o(yp)q(es)i Fs(observations)p
Fw(.)e(Observ)n(ations)i(are)340 1943 y(imp)q(ortan)o(t:)h(if)h(there)j
(are)e(none)h(then)f(w)o(e)h(cannot)f(distinguish)f(b)q(et)o(w)o(een)j
(v)n(alues)e(of)f(the)i(new)340 1993 y(t)o(yp)q(es,)e(and)f(so)g(w)o(e)
g(can)g(represen)o(t)i(them)d(all)g(b)o(y)h(\(\).)f(W)m(e)h(will)e
(assume)i(that)g(the)g(sp)q(eci\014cation)340 2042 y(determines)g(the)h
(v)n(alue)d(of)h(ev)o(ery)i(p)q(ossible)f(observ)n(ation)f(|)g(if)g
(not,)g(w)o(e)h(m)o(ust)e(strengthen)k(the)340 2092 y(sp)q
(eci\014cation)g(un)o(til)e(it)h(do)q(es.)403 2142 y(The)g(implemen)o
(tations)e(whic)o(h)i(w)o(e)g(are)h(trying)f(to)g(deriv)o(e)h(consist)g
(of)f(equations)g(of)g(a)g(re-)340 2192 y(stricted)f(form.)c(W)m(e)h
(will)g(deriv)o(e)i(implem)o(en)o(tations)d(b)o(y)h(pro)o(ving)h(their)
g(constituen)o(t)h(equations)340 2242 y(from)f(the)j(sp)q
(eci\014cation.)f(By)f(itself)h(this)g(is)f(no)h(guaran)o(tee)g(that)f
(the)i(implem)o(en)o(ted)d(functions)340 2292 y(satisfy)j(the)g(sp)q
(eci\014cation)g(\(b)q(ecause)i(w)o(e)e(migh)o(t)d(not)j(ha)o(v)o(e)g
(pro)o(v)o(ed)f Fs(enough)i Fw(equations\).)f(But)340
2341 y(if)j(w)o(e)h(also)f(c)o(hec)o(k)i(that)e(the)h(deriv)o(ed)h
(de\014nitions)e(are)h Fs(terminating)f Fw(and)h Fs(exhaustive)p
Fw(,)f(then)340 2391 y(this)d(prop)q(ert)o(y)h(is)f(guaran)o(teed.)403
2441 y(T)m(o)d(see)i(wh)o(y)m(,)d(consider)j(the)f(case)h(of)e(a)g
(single)h(function)f Fn(f)t Fw(.)h(W)m(e)g(start)g(from)e(a)h(sp)q
(eci\014cation)340 2491 y Fn(P)6 b Fw(\()p Fn(f)t Fw(\))12
b(and)e(deriv)o(e)h(implemen)o(tation)d(equations)i Fn(Q)p
Fw(\()p Fn(f)t Fw(\),)h(b)q(oth)g(considered)h(as)f(predicates)h(on)f
Fn(f)t Fw(.)p eop
%%Page: 5 5
5 4 bop 183 194 a Fw(By)15 b(construction)g Fn(P)6 b
Fw(\()p Fn(f)t Fw(\))14 b Fq(\))e Fn(Q)p Fw(\()p Fn(f)t
Fw(\).)j(But)h(in)e(general,)g(the)i(implem)o(en)o(tation)c(equations)j
Fn(Q)p Fw(\()p Fn(f)t Fw(\))183 244 y(migh)o(t)g(b)q(e)k(satis\014ed)f
(b)o(y)g(man)o(y)e(di\013eren)o(t)j(functions,)e(of)h(whic)o(h)f(the)i
Fs(le)n(ast)e Fw(is)h(the)g(one)g(that)183 293 y(the)g(equations)f
(de\014ne.)h(Call)e(this)h(least)g(function)g Fn(f)1043
299 y Fm(imp)1104 293 y Fw(.)g(No)o(w,)f(if)h(the)h(deriv)o(ed)f
(de\014nitions)183 343 y(are)d(exhaustiv)o(e)g(and)f(terminating,)f
(then)i(for)f(an)o(y)g(argumen)o(t)g Fn(x)p Fw(,)g Fn(f)1264
349 y Fm(imp)1324 343 y Fn(=x)h Fw(is)f(a)g(de\014ned)i(v)n(alue)183
393 y Fn(y)j Fw(and)e Fn(Q)p Fw(\()p Fn(f)t Fw(\))h Fq(\))e
Fn(f)21 b(x)15 b Fw(=)h Fn(y)q Fw(.)h(In)f(other)h(w)o(ords)g
Fn(Q)p Fw(\()p Fn(f)t Fw(\))f Fq(\))g Fn(f)k Fw(=)c Fn(f)1203
399 y Fm(imp)1280 393 y Fw(|)g(the)h(implemen)o(tatio)o(n)183
443 y(equations)f(ha)o(v)o(e)h(a)f(unique)h(solution.)e(No)o(w)h(if)g
(the)h(sp)q(eci\014cation)h(is)e(satis\014ed)i(b)o(y)e(an)o(y)g
Fn(f)22 b Fw(at)183 493 y(all,)12 b(w)o(e)i(kno)o(w)f(that)704
536 y Fn(P)6 b Fw(\()p Fn(f)t Fw(\))12 b Fq(\))f Fn(Q)p
Fw(\()p Fn(f)t Fw(\))h Fq(\))f Fn(f)17 b Fw(=)12 b Fn(f)1113
542 y Fm(imp)183 595 y Fw(and)h(therefore)j Fn(P)6 b
Fw(\()p Fn(f)507 601 y Fm(imp)567 595 y Fw(\))14 b(holds)g(|)f(the)h
(implemen)o(tation)d(satis\014es)k(the)f(sp)q(eci\014cation.)245
645 y(Since)f(w)o(e)g(will)e(use)i(the)g(sp)q(eci\014cation)g(to)g
(deriv)o(e)g(equations,)f(it)g(will)f(b)q(e)i(most)e(con)o(v)o(enien)o
(t)183 695 y(if)k(the)i(sp)q(eci\014cation)g(also)e(consists)i(of)f
(equations)g(|)g(or)g(la)o(ws)f(|)h(that)g(the)h(new)f(functions)183
745 y(are)e(to)g(satisfy)m(.)245 795 y(But)g(b)q(efore)f(w)o(e)h(can)f
(start)h(deriving)e(implemen)o(tations)e(of)i(functions)i(w)o(e)f(m)o
(ust)f(c)o(ho)q(ose)i(a)183 845 y(represen)o(tation)e(for)f(eac)o(h)g
(new)g(t)o(yp)q(e.)g(W)m(e)f(will)g(presen)o(t)i(t)o(w)o(o)f
(di\013eren)o(t)g(w)o(a)o(ys)g(of)f(c)o(ho)q(osing)h(suc)o(h)183
894 y(a)g(represen)o(tation.)h(The)g(\014rst)g(is)f(based)h(on)g
(represen)o(ting)h(v)n(alues)e(b)o(y)g Fs(terms)f Fw(in)h(the)h
(algebra)f(w)o(e)183 944 y(are)j(w)o(orking)e(with.)h(The)h(second)g
(is)f(based)i(on)e(represen)o(ting)i(v)n(alues)e(b)o(y)g
Fs(functions)h Fw(from)e(the)183 994 y(con)o(text)i(in)g(whic)o(h)f
(the)i(v)n(alue)e(is)h(placed)g(to)g(the)g(v)n(alue)g(of)f(the)h
(corresp)q(onding)h(observ)n(ation.)183 1115 y Fu(4)56
b(Designing)17 b(a)i(Sequence)f(T)n(yp)r(e)183 1201 y
Fw(W)m(e)13 b(b)q(egin)h(b)o(y)g(considering)h(a)f(v)o(ery)g(simple)f
(and)h(famili)o(ar)d(example:)i(the)h(design)h(of)e(a)h(repre-)183
1251 y(sen)o(tation)h(for)g(sequences.)j(Of)d(course)h(w)o(e)g(kno)o(w)
f(ho)o(w)g(to)g(represen)o(t)j(sequences)g(|)d(as)g(lists.)183
1301 y(The)j(p)q(oin)o(t)g(here)h(is)f(not)g(to)g(disco)o(v)o(er)g(a)g
(new)g(represen)o(tation,)h(but)g(to)e(see)j(ho)o(w)d(w)o(e)i(could)183
1350 y(ha)o(v)o(e)g(arriv)o(ed)g(at)h(the)g(w)o(ell-kno)o(wn)e
(represen)o(tation)j(of)d(lists)i(starting)f(from)f(an)h(algebraic)183
1400 y(sp)q(eci\014cation.)245 1450 y(W)m(e)13 b(tak)o(e)h(the)h(follo)
o(wing)c(signature)j(as)g(our)g(starting)g(p)q(oin)o(t,)681
1517 y Fs(nil)d Fw(::)f Fs(Se)n(q)16 b Fn(a)681 1567
y Fs(unit)11 b Fw(::)g Fn(a)g Fq(!)g Fs(Se)n(q)16 b Fn(a)681
1616 y Fs(c)n(at)11 b Fw(::)g Fs(Se)n(q)k Fn(a)c Fq(!)h
Fs(Se)n(q)j Fn(a)c Fq(!)g Fs(Se)n(q)16 b Fn(a)681 1666
y Fs(list)10 b Fw(::)h Fs(Se)n(q)k Fn(a)d Fq(!)f Fw([)p
Fn(a)p Fw(])183 1734 y(where)16 b Fs(nil)o Fw(,)f Fs(unit)p
Fw(,)f(and)h Fs(c)n(at)f Fw(giv)o(e)g(us)i(w)o(a)o(ys)e(to)h(build)f
(sequences,)j(and)d Fs(list)g Fw(is)h(an)f(observ)n(ation.)183
1784 y(The)g(corresp)q(ondence)j(with)c(the)i(usual)f(list)f(op)q
(erations)h(is)888 1855 y Fs(nil)e Fw(=)g([])824 1918
y Fs(unit)j Fn(x)d Fw(=)g([)p Fn(x)p Fw(])883 1980 y
Fs(c)n(at)g Fw(=)g(\()-7 b(+)-21 b(+)-7 b(\))183 2051
y(These)15 b(op)q(erations)f(are)g(to)g(satisfy)g(the)g(follo)o(wing)d
(la)o(ws)1079 2036 y Fr(2)1097 2051 y Fw(:)586 2123 y
Fs(xs)e(`c)n(at`)g Fw(\()p Fs(ys)g(`c)n(at`)g(zs)p Fw(\))j(=)g(\()p
Fs(xs)d(`c)n(at`)g(ys)p Fw(\))g Fs(`c)n(at`)g(zs)738
2185 y(nil)g(`c)n(at`)g(xs)j Fw(=)g Fs(xs)738 2248 y(xs)e(`c)n(at`)e
(nil)k Fw(=)g Fs(xs)802 2310 y(list)h(nil)f Fw(=)g([])573
2372 y Fs(list)i Fw(\()p Fs(unit)h Fn(x)9 b Fs(`c)n(at`)g(xs)p
Fw(\))j(=)g Fn(x)f Fw(:)g Fs(list)j(xs)p 183 2402 237
2 v 191 2429 a Fo(2)221 2445 y Fv(Hask)o(ell)h(allo)o(ws)h(a)d(binary)j
(function)f(to)f(b)q(e)g(used)g(as)g(an)g(in\014x)h(op)q(erator)g(if)f
(the)g(name)g(is)h(enclosed)221 2491 y(in)f(bac)o(kquotes.)g(Th)o(us)f
Fl(a)c Fk(`op`)e Fl(b)14 b Fv(is)f(the)g(same)h(as)f
Fk(op)f Fl(a)h(b)p eop
%%Page: 6 6
6 5 bop 340 194 a Ft(4.1)48 b(T)l(erm)16 b(Represen)o(tati)o(on)340
296 y Fw(The)j(most)e(direct)h(w)o(a)o(y)g(to)f(represen)o(t)k(v)n
(alues)c(of)h(sequence)i(t)o(yp)q(e)e(is)g(just)g(as)g(terms)g(of)g
(the)340 346 y(alb)q(egra,)13 b(for)h(example)f(using)700
444 y Ft(data)j Fs(Se)n(q)f Fn(a)d Fw(=)f Fs(Nil)e Fq(j)g
Fs(Unit)14 b Fn(a)9 b Fq(j)g Fs(Se)n(q)15 b Fn(a)10 b
Fs(`Cat`)e(Se)n(q)15 b Fn(a)340 539 y Fw(But)h(this)f(trivial)f
(represen)o(tation)i(do)q(es)g(not)f(exploit)f(the)i(algebraic)e(la)o
(ws)h(that)g(w)o(e)g(kno)o(w)f(to)340 589 y(hold,)i(and)g(moreo)o(v)o
(er)f(the)i Fs(list)e Fw(observ)n(ation)h(will)f(b)q(e)i(a)f(little)g
(tric)o(ky)g(to)g(de\014ne)i(\(ideally)d(w)o(e)340 638
y(w)o(ould)i(lik)o(e)f(to)h(implem)o(en)o(t)e(observ)n(ations)i(b)o(y)f
(v)o(ery)i(simple,)d(non-recursiv)o(e)j(functions:)f(the)340
688 y(real)e(w)o(ork)g(should)f(b)q(e)i(done)f(in)f(the)i(implemen)o
(tatio)o(ns)d(of)h(the)h Fs(Se)n(q)h Fw(op)q(erators)f(themselv)o
(es\).)340 738 y(Instead,)h(w)o(e)f(ma)o(y)f(c)o(ho)q(ose)i(a)f
(restricted)i(subset)f(of)f(terms)g(|)g(call)f(them)h(simpli\014ed)e
(forms)1835 723 y Fr(3)340 788 y Fw(|)f(in)o(to)e(whic)o(h)i(ev)o(ery)g
(term)f(can)h(b)q(e)h(put)e(using)h(the)g(algebraic)f(la)o(ws.)g(Then)h
(w)o(e)g(can)g(represen)o(t)340 838 y(sequences)17 b(using)c(a)h(datat)
o(yp)q(e)g(that)g(represen)o(ts)j(the)d(syn)o(tax)g(of)f(simpli\014ed)f
(forms.)403 891 y(In)g(this)g(case,)h(there)h(is)e(an)g(ob)o(vious)f
(candidate)i(for)f(simpli\014ed)e(forms:)g(terms)i(of)g(the)h(form)340
941 y Fs(nil)j Fw(and)h Fs(unit)e Fn(x)10 b Fs(`c)n(at`)g(xs)q
Fw(,)15 b(where)j Fs(xs)e Fw(is)h(also)e(in)h(simpli\014ed)f(form.)f
(Simpli\014ed)g(forms)h(can)i(b)q(e)340 991 y(represen)o(ted)g(using)d
(the)g(t)o(yp)q(e)771 1089 y Ft(data)h Fs(Se)n(q)h Fn(a)11
b Fw(=)h Fs(Nil)c Fq(j)h Fn(a)g Fs(`UnitCat`)f(Se)n(q)16
b Fn(a)340 1184 y Fw(with)e(the)g(in)o(terpretation)756
1169 y Fr(4)1021 1292 y Fs(Nil)d Fw(=)h Fs(nil)819 1354
y Fn(x)d Fs(`UnitCat`)f Fn(xs)k Fw(=)g Fs(unit)j Fn(x)9
b Fs(`c)n(at`)f(xs)340 1463 y Fw(W)m(e)i(c)o(ho)q(ose)h(this)g
(represen)o(tation)g(b)q(ecause)h(a)e(de\014nition)g(of)g
Fs(list)f Fw(is)h(no)o(w)g(v)o(ery)g(simple)f(to)h(deriv)o(e:)721
1559 y Fs(list)k(Nil)238 b Fw(=)12 b Fs(list)i(nil)1083
1608 y Fw(=)e([])721 1658 y Fs(list)i Fw(\()p Fn(x)9
b Fs(`UnitCat`)f(xs)q Fw(\))j(=)h Fs(list)i Fw(\()p Fs(unit)h
Fn(x)9 b Fs(`c)n(at`)g(xs)p Fw(\))1083 1708 y(=)j Fn(x)g
Fw(:)f Fs(list)j(xs)340 1801 y Fw(W)m(e)g(can)f(also)g(deriv)o(e)h
(implemen)o(tations)d(of)i(the)h(three)h(op)q(erators)g(of)e(the)h
(algebra)f(b)o(y)g(simply)340 1850 y(applying)g(the)h(algebraic)g(la)o
(ws:)902 1961 y Fs(nil)d Fw(=)h Fs(Nil)52 b Fw([defn.)13
b Fs(Nil)o Fw(])717 2071 y Fs(unit)i Fn(x)d Fw(=)g Fs(unit)j
Fn(x)9 b Fs(`c)n(at`)f(nil)840 2121 y Fw(=)k Fn(x)d Fs(`UnitCat`)f(Nil)
52 b Fw([defn.)13 b Fs(UnitCat)p Fw(])885 2232 y Fs(Nil)8
b(`c)n(at`)h(ys)j Fw(=)g Fs(nil)d(`c)n(at`)f(ys)1084
2282 y Fw(=)k Fs(ys)492 2393 y Fw(\()p Fn(x)d Fs(`UnitCat`)f(xs)p
Fw(\))i Fs(`c)n(at`)e(ys)k Fw(=)g(\()p Fs(unit)j Fn(x)9
b Fs(`c)n(at`)g(xs)p Fw(\))g Fs(`c)n(at`)g(ys)918 2443
y Fw(=)j Fs(unit)j Fn(x)9 b Fs(`c)n(at`)g Fw(\()p Fs(xs)g(`c)n(at`)g
(ys)p Fw(\))84 b([asso)q(ciativit)o(y)n(])918 2492 y(=)12
b Fn(x)d Fs(`UnitCat`)f Fw(\()p Fs(xs)i(`c)n(at`)e(ys)p
Fw(\))54 b([defn.)13 b Fs(UnitCat)o Fw(])p eop
%%Page: 7 7
7 6 bop 530 226 a Fj(data)16 b Fk(Se)n(q)c Fl(a)f Fv(=)g
Fk(Nil)c Fi(j)h Fl(a)h Fk(`UnitCat`)e(Se)n(q)12 b Fl(a)530
317 y Fk(nil)e Fv(=)g Fk(Nil)530 408 y(Nil)e(`c)n(at`)f(ys)j
Fv(=)g Fk(ys)530 454 y Fv(\()p Fl(x)e Fk(`UnitCat`)f(xs)o
Fv(\))i Fk(`c)n(at`)e(ys)j Fv(=)g Fl(x)e Fk(`UnitCat`)f
Fv(\()p Fk(xs)h(`c)n(at`)f(ys)o Fv(\))530 545 y Fk(list)13
b(Nil)d Fv(=)g([])530 591 y Fk(list)j Fv(\()p Fl(x)8
b Fk(`UnitCat`)e(xs)p Fv(\))k(=)h Fl(x)f Fv(:)h Fk(list)h(xs)183
718 y Fj(Fig.)6 b(1.)14 b Fv(T)m(erm)e(represen)o(tation)j(of)e
(sequences.)183 860 y Fw(Collecting)19 b(the)i(results)g(w)o(e)g
(obtain)e(the)i(de\014nitions)f(in)g(\014gure)h(1.)e(T)m(ermination)f
(of)i(eac)o(h)183 910 y(function)13 b(is)h(ob)o(vious.)245
960 y(Ho)o(w)e(do)g(w)o(e)g(kno)o(w)g(that)g(ev)o(ery)h
Fs(Se)n(q)g Fw(term)e(can)i(b)q(e)g(expressed)h(as)f(a)f(simpli\014ed)e
(form?)g(The)183 1010 y(de\014nitions)16 b(w)o(e)g(ha)o(v)o(e)g(deriv)o
(ed)h(are)f(a)g(pro)q(of)s(!)g(Since)g(eac)o(h)h(function)f(maps)f
(simpli\014ed)f(argu-)183 1059 y(men)o(ts)i(to)g(simpli\014ed)f
(results)j(\(and)e(alw)o(a)o(ys)g(terminates\),)g(w)o(e)h(can)g
(construct)h(a)e(simpli\014ed)183 1109 y(form)11 b(equal)i(to)g(an)o(y)
g(term)g(just)g(b)o(y)h(ev)n(aluating)e(it)g(with)h(these)i
(de\014nitions.)e(In)g(more)g(compli-)183 1159 y(cated)k(algebras)g
(this)g(observ)n(ation)f(is)h(v)n(aluable:)e(when)i(w)o(e're)g(c)o(ho)q
(osing)g(a)f(simpli\014ed)f(form)183 1209 y(w)o(e)g(need)h(not)f(w)o
(orry)g(whether)h(all)e(terms)g(can)i(b)q(e)f(put)g(in)o(to)g(it)f(|)h
(w)o(e)g(simply)e(try)i(to)g(deriv)o(e)183 1259 y(terminating)d
(de\014nitions)i(for)f(the)i(op)q(erations,)e(and)h(if)f(w)o(e)h
(succeed,)i(the)e(result)h(follo)o(ws.)245 1309 y(So)h(far)g(w)o(e'v)o
(e)g(just)g(deriv)o(ed)h(the)g(usual)f(implem)o(en)o(tation)d(of)j
(lists)g(|)g Fs(Nil)f Fw(and)h Fs(UnitCat)183 1358 y
Fw(corresp)q(ond)d(to)f([])f(and)g(\(:\).)h(But)g(notice)g(that)g(it)g
(isn't)f(without)h(its)f(problems:)g(the)h(implemen-)183
1408 y(tation)g(of)h Fs(c)n(at)h Fw(is)f(linear)g(in)g(its)g(\014rst)i
(argumen)o(t,)c(and)j(w)o(e)f(run)h(in)o(to)f(the)h(w)o(ell)f(kno)o(wn)
g(problem)183 1458 y(that)h(an)f(expression)i(suc)o(h)g(as)420
1540 y(\()p Fn(:)7 b(:)g(:)e Fw(\()p Fs(unit)15 b Fn(x)618
1546 y Fr(1)646 1540 y Fs(`c)n(at`)9 b(unit)15 b Fn(x)844
1546 y Fr(2)862 1540 y Fw(\))7 b Fn(:)g(:)g(:)15 b Fs(`c)n(at`)8
b(unit)15 b Fn(x)1147 1546 y Fm(n)p Fh(\000)p Fr(1)1212
1540 y Fw(\))9 b Fs(`c)n(at`)g(unit)15 b Fn(x)1435 1546
y Fm(n)183 1622 y Fw(tak)o(es)h(quadratic)g(time)f(to)h(ev)n(aluate.)f
(Using)h(the)g(asso)q(ciativ)o(e)g(la)o(w)g Fn(n)g Fw(times)f(w)o(e)h
(can)g(obtain)183 1672 y(the)e(equiv)n(alen)o(t)f(expression)447
1755 y Fs(unit)i Fn(x)558 1761 y Fr(1)586 1755 y Fs(`c)n(at`)9
b Fw(\()p Fs(unit)15 b Fn(x)800 1761 y Fr(2)827 1755
y Fs(`c)n(at`)h Fn(:)7 b(:)g(:)e Fw(\()p Fs(unit)15 b
Fn(x)1103 1761 y Fm(n)p Fh(\000)p Fr(1)1177 1755 y Fs(`c)n(at`)9
b(unit)15 b Fn(x)1375 1761 y Fm(n)1397 1755 y Fw(\)\))183
1837 y(whic)o(h)h(runs)g(in)g(linear)g(time.)e(W)m(e)h(migh)o(t)f(hop)q
(e)j(to)f(exploit)f(the)i(asso)q(ciativ)o(e)f(la)o(w)f(in)h(an)f(im-)
183 1887 y(pro)o(v)o(ed)j(implemen)o(tation)d(that)j(ac)o(hiev)o(es)h
(the)g(b)q(etter)i(complexit)o(y)16 b(in)i(the)h(\014rst)g(case)h
(also.)183 1936 y(W)m(e)c(could)g(try)h(to)g(deriv)o(e)g(an)f(implemen)
o(tation)d(of)j Fs(c)n(at)h Fw(that)g(recognises)h Fs(c)n(at)e
Fw(in)h(its)f(left)h(ar-)183 1986 y(gumen)o(t,)f(and)i(applies)g(the)h
(asso)q(ciativ)o(e)g(la)o(w)e(b)q(efore)i(con)o(tin)o(uing.)e(But)i
(alas,)e(if)g(w)o(e)i(are)g(to)183 2036 y(recognise)c(applications)f
(of)g Fs(c)n(at)g Fw(then)h(they)g(m)o(ust)f(b)q(e)h(simpli\014ed)e
(forms,)f(whic)o(h)j(means)e(that)183 2086 y(the)f Fs(c)n(at)h
Fw(op)q(eration)f(can)g(do)g(nothing;)f(w)o(e)h(are)h(forced)g(bac)o(k)
f(to)g(the)h(trivial)d(represen)o(tation)k(w)o(e)183
2136 y(started)i(with.)d(In)i(the)h(next)f(section)g(w)o(e)g(lo)q(ok)f
(at)h(a)f(di\013eren)o(t)i(approac)o(h)e(whic)o(h)h(can)g(exploit)183
2185 y(asso)q(ciativit)o(y)e(in)g(this)h(case.)p 183
2220 237 2 v 191 2247 a Fo(3)221 2262 y Fv(W)m(e)d(a)o(v)o(oid)h(the)g
(term)e(`canonical)j(form')e(b)q(ecause)h(in)g(general)g(there's)f(no)g
(reason)h(wh)o(y)f(a)g(term)g(need)221 2308 y(ha)o(v)o(e)j(a)f
Fk(unique)d Fv(simpli\014ed)16 b(form.)191 2338 y Fo(4)221
2354 y Fv(Here)11 b(w)o(e)f(really)j(mean)e(the)h Fk(semantics)c
Fv(of)j Fk(Nil)f Fv(and)h Fk(UnitCat)o Fv(,)f(and)i(b)o(y)f(equalit)o
(y)i(w)o(e)e(mean)g(equalit)o(y)221 2399 y(in)g(the)f(algebra)h(w)o(e)e
(are)h(implemen)o(ting)j(|)d(not)g(necessarily)j(Hask)o(ell's)e
(equalit)o(y)m(.)g(P)o(erhaps)g(it)f(w)o(ould)221 2445
y(b)q(e)i(more)g(con)o(v)o(en)o(tional)j(to)d(write)g([)-6
b([)p Fk(Nil)n Fv(])g(])11 b(and)i([)-6 b([)p Fk(UnitCat)m
Fv(])g(])11 b(here,)h(but)g(w)o(e)g(prefer)g(to)g(iden)o(tify)h(syn)o
(tax)221 2491 y(and)h(seman)o(tics)g(in)g(the)f(in)o(terests)h(of)f
(ligh)o(tening)j(the)d(notation.)p eop
%%Page: 8 8
8 7 bop 340 194 a Ft(4.2)48 b(Con)o(text)15 b(P)o(assing)f(Represen)o
(tat)o(ion)340 277 y Fw(If)g(w)o(e)g(can't)g(apply)g(the)h(asso)q
(ciativ)o(e)f(la)o(w)f(b)o(y)h(making)d(the)k(outer)g
Fs(c)n(at)f Fw(recognise)h(that)f(its)g(left)340 327
y(argumen)o(t)h(is)g(a)g Fs(c)n(at)p Fw(,)g(p)q(erhaps)h(w)o(e)g(can)g
(mak)o(e)d(the)j(inner)g Fs(c)n(at)f Fw(recognise)i(that)e(it)g(is)g
(called)h(in)340 377 y(a)g Fs(c)n(at)g Fw(con)o(text.)g(This)g(idea)g
(motiv)n(ates)e(a)i(represen)o(tation)i(of)d(sequences)k(as)d
(functions)g(from)340 426 y(their)f(con)o(text)f(to)g(the)g(observ)n
(ation)g(b)q(eing)g(made.)403 476 y(A)h Fs(c)n(ontext)g
Fw(is)f(just)h(an)g(expression)h(with)f(a)f(hole,)g(written)i([)p
Fq(\017)p Fw(].)d(F)m(or)h(example,)f([)p Fq(\017)p Fw(])c
Fs(`c)n(at`)g(ys)340 526 y Fw(is)14 b(a)g(con)o(text.)g(If)g
Fn(C)s Fw([)p Fq(\017)p Fw(])e(is)i(a)g(con)o(text)h(and)f
Fn(e)g Fw(is)g(an)g(expression,)g(w)o(e)h(write)f Fn(C)s
Fw([)p Fn(e)p Fw(])f(for)h(the)g(result)340 576 y(of)g(replacing)f(the)
i(hole)e(with)h Fn(e)p Fw(.)g(In)g(this)g(case)g(\([)p
Fq(\017)p Fw(])9 b Fs(`c)n(at`)f(ys)p Fw(\)[)p Fs(xs)p
Fw(])14 b(is)f Fs(xs)d(`c)n(at`)f(ys)p Fw(.)403 626 y(W)m(e)15
b(can)g(describ)q(e)j(the)e(con)o(texts)g(w)o(e)g(are)g(in)o(terested)h
(in)e(b)o(y)g(a)g(grammar.)d(F)m(or)j(example,)340 676
y(the)h(follo)o(wing)c(gramma)o(r)g(describ)q(es)17 b(all)c(p)q
(ossible)i(con)o(texts)h(of)e(t)o(yp)q(e)h(list)f(for)h(expressions)h
(of)340 725 y(t)o(yp)q(e)f Fs(Se)n(q)g Fw(.)905 811 y
Fn(C)s Fw([)p Fq(\017)p Fw(])10 b(::=)h Fs(list)j Fw([)p
Fq(\017)p Fw(])1015 873 y Fq(j)33 b Fn(C)s Fw([[)p Fq(\017)p
Fw(])7 b Fs(`c)n(at`)h Fn(E)r Fw(])1015 936 y Fq(j)33
b Fn(C)s Fw([)p Fn(E)10 b Fs(`c)n(at`)f Fw([)p Fq(\017)p
Fw(]])340 1021 y(where)20 b Fn(E)h Fw(is)d(an)h(expression)h(of)e
Fs(Se)n(q)h Fw(t)o(yp)q(e.)f(And)h(just)g(as)g(with)f(terms,)g(w)o(e)h
(can)g(represen)o(t)340 1071 y(con)o(texts)c(b)o(y)f(a)g(corresp)q
(onding)g(Hask)o(ell)g(datat)o(yp)q(e:)464 1154 y Ft(data)h
Fs(Cxt)g Fn(a)c Fw(=)h Fs(List)d Fq(j)g Fs(CatL)n(eft)14
b Fw(\()p Fs(Se)n(q)h Fn(a)p Fw(\))f(\()p Fs(Cxt)h Fn(a)p
Fw(\))9 b Fq(j)g Fs(CatR)o(ight)15 b Fw(\()p Fs(Se)n(q)g
Fn(a)p Fw(\))f(\()p Fs(Cxt)h Fn(a)p Fw(\))340 1238 y(where)1012
1323 y Fs(List)c Fw(=)h Fs(list)i Fw([)p Fq(\017)p Fw(])853
1385 y Fs(CatL)n(eft)g Fn(E)i(C)e Fw(=)e Fn(C)s Fw([[)p
Fq(\017)p Fw(])c Fs(`c)n(at`)g Fn(E)r Fw(])827 1448 y
Fs(CatR)o(ight)14 b Fn(E)i(C)e Fw(=)e Fn(C)s Fw([)p Fn(E)f
Fs(`c)n(at`)d Fw([)p Fq(\017)p Fw(]])340 1533 y(Notice)14
b(that)e(the)i(represen)o(tation)g(of,)e(sa)o(y)m(,)f(a)i
Fs(CatL)n(eft)f Fw(con)o(text)h Fs(c)n(ontains)g Fw(the)h(represen)o
(tation)340 1583 y(of)j(the)g(enclosing)g(con)o(text;)g(con)o(texts)g
(resem)o(ble)g(therefore)h(a)f(stac)o(k.)f(Notice)i(also)e(that)h(the)
340 1633 y(con)o(text)e(t)o(yp)q(e)f(m)o(ust)f(b)q(e)i(parameterised)f
(on)f Fn(a)h Fw(b)q(ecause)i(it)d(refers)j(to)d Fs(Se)n(q)j
Fn(a)p Fw(.)403 1683 y(In)10 b(fact,)f(just)h(as)h(w)o(e)f(used)h(the)f
(la)o(ws)g(to)g(w)o(ork)g(with)f(a)h(restricted)i(set)f(of)e(terms,)h
(w)o(e)g(shall)f(use)340 1733 y(the)14 b(la)o(ws)e(to)h(w)o(ork)f(with)
h(a)f(restricted)j(set)f(of)e(con)o(texts.)i(F)m(or)e(our)h(purp)q
(oses)i(in)d(this)h(example,)340 1782 y(w)o(e)i(will)d(only)h(need)i
(to)f(consider)g(con)o(texts)h(of)f(the)g(form)810 1868
y Fn(C)s Fw([)p Fq(\017)p Fw(])c(::=)h Fs(list)j Fw([)p
Fq(\017)p Fw(])8 b Fq(j)h Fs(list)14 b Fw(\([)p Fq(\017)p
Fw(])8 b Fs(`c)n(at`)h Fn(E)r Fw(\))340 1954 y(represen)o(ted)17
b(b)o(y)d(the)g(follo)o(wing)e(datat)o(yp)q(e:)777 2037
y Ft(data)j Fs(Cxt)g Fn(a)c Fw(=)h Fs(List)d Fq(j)f Fs(ListCat)15
b Fw(\()p Fs(Se)n(q)g Fn(a)p Fw(\))403 2120 y(No)o(w)h(w)o(e)i(can)f
(represen)o(t)i(sequence)h(v)n(alues)d(b)o(y)f(functions)i(from)d(con)o
(texts)j(to)f(lists:)g(the)340 2170 y(v)n(alue)12 b Fn(e)g
Fw(is)g(represen)o(ted)j(b)o(y)d(the)h(function)f Fn(\025C)s
Fw([)p Fq(\017)p Fw(])p Fn(:C)s Fw([)p Fn(e)p Fw(].)d(\(So)j(con)o
(texts)h(are)f(lik)o(e)g(con)o(tin)o(uations)340 2220
y(whose)j(in)o(ternal)e(structure)j(can)e(b)q(e)h(insp)q(ected\).)g(F)m
(or)f(example,)938 2306 y Fs(nil)d Fw(=)h Fn(\025C)s
Fw([)p Fq(\017)p Fw(])p Fn(:C)s Fw([)p Fs(nil)m Fw(])340
2391 y(where)18 b(again)e(w)o(e)h(mak)o(e)f(no)h(notational)e
(distinction)h(b)q(et)o(w)o(een)j(the)e Fs(nil)g Fw(on)g(the)g(left,)f
(whic)o(h)340 2441 y(is)g(a)f(represen)o(tation,)i(and)e(the)i
Fs(nil)e Fw(on)g(the)h(righ)o(t,)f(whic)o(h)h(is)f(a)g(seman)o(tic)g
(ob)r(ject.)h(When)g(w)o(e)340 2491 y(apply)e(this)f(represen)o(tation)
j(to)e(a)f(con)o(text,)h(w)o(e)g(deriv)o(e)h(for)e(example)p
eop
%%Page: 9 9
9 8 bop 432 187 a Fs(nil)14 b Fw(\()p Fs(ListCat)g(zs)p
Fw(\))e(=)g Fs(nil)h Fw(\()p Fs(list)h Fw(\([)p Fq(\017)p
Fw(])9 b Fs(`c)n(at`)f(zs)p Fw(\)\))54 b([defn.)13 b
Fs(ListCat)o Fw(])720 237 y(=)f Fs(list)i Fw(\()p Fs(nil)9
b(`c)n(at`)g(zs)o Fw(\))231 b([defn.)13 b Fs(nil)p Fw(])183
306 y(In)h(future)h(w)o(e)g(will)e(switc)o(h)h(bac)o(kw)o(ards)h(and)f
(forw)o(ards)h(b)q(et)o(w)o(een)h(the)f(\014rst)g(and)f(last)g(form)f
(in)183 356 y(one)f(step,)g(and)f(without)h(commen)o(t.)d(W)m(e)i(can)h
(deriv)o(e)g(de\014nitions)f(of)h(the)g(op)q(erators)g(using)g(the)183
405 y(la)o(ws)h(of)g(the)i(algebra)e(as)h(b)q(efore:)788
473 y Fs(nil)f(List)f Fw(=)g Fs(list)h(nil)930 523 y
Fw(=)f([])634 603 y Fs(nil)i Fw(\()p Fs(ListCat)g(zs)p
Fw(\))d(=)h Fs(list)i Fw(\()p Fs(nil)9 b(`c)n(at`)g(zs)p
Fw(\))921 653 y(=)j Fs(list)i(zs)921 703 y Fw(=)e Fs(zs)i(List)636
783 y(unit)h Fn(x)f Fs(List)d Fw(=)h Fs(list)i Fw(\()p
Fs(unit)h Fn(x)p Fw(\))842 833 y(=)d Fs(list)i Fw(\()p
Fs(unit)h Fn(x)9 b Fs(`c)n(at`)g(nil)o Fw(\))842 883
y(=)j Fn(x)f Fw(:)g Fs(list)j(nil)842 933 y Fw(=)e([)p
Fn(x)p Fw(])570 1013 y Fs(unit)j Fn(x)f Fw(\()p Fs(ListCat)g(zs)p
Fw(\))d(=)h Fs(list)i Fw(\()p Fs(unit)h Fn(x)9 b Fs(`c)n(at`)g(zs)p
Fw(\))921 1063 y(=)j Fn(x)g Fw(:)f Fs(list)j(zs)921 1112
y Fw(=)e Fn(x)g Fw(:)f Fs(zs)i(List)633 1193 y Fw(\()p
Fs(xs)d(`c)n(at`)e(ys)p Fw(\))14 b Fs(List)e Fw(=)g Fs(list)h
Fw(\()p Fs(xs)d(`c)n(at`)f(ys)p Fw(\))930 1242 y(=)j
Fs(xs)i Fw(\()p Fs(ListCat)g(ys)p Fw(\))388 1322 y(\()p
Fs(xs)c(`c)n(at`)f(ys)p Fw(\))14 b(\()p Fs(ListCat)g(zs)p
Fw(\))e(=)g Fs(list)i Fw(\(\()p Fs(xs)9 b(`c)n(at`)g(ys)p
Fw(\))g Fs(`c)n(at`)g(zs)p Fw(\))831 1372 y(=)j Fs(list)i
Fw(\()p Fs(xs)9 b(`c)n(at`)g Fw(\()p Fs(ys)g(`c)n(at`)g(zs)p
Fw(\)\))53 b([asso)q(c!])831 1422 y(=)12 b Fs(xs)i Fw(\()p
Fs(ListCat)g Fw(\()p Fs(ys)9 b(`c)n(at`)g(zs)p Fw(\)\))183
1496 y(Notice)14 b(that)h(the)f(deriv)o(ed)h(de\014nition)f(of)g
Fs(c)n(at)g Fw(recognises)h(an)f(enclosing)h Fs(c)n(at)f
Fw(and)g(applies)g(the)183 1546 y(asso)q(ciativ)o(e)e(la)o(w)f(|)g
(just)i(the)f(optimisation)e(w)o(e)i(w)o(an)o(ted)g(to)g(capture.)h
(Gathering)f(the)g(results)183 1596 y(together,)i(w)o(e)g(obtain)f(the)
i(implemen)o(tati)o(on)c(sho)o(wn)j(in)f(\014gure)i(2.)245
1646 y(W)m(e)10 b(can)g(sho)o(w)g(that)g(these)h(de\014nitions)f
(terminate,)f(and)h(moreo)o(v)o(er)f(deriv)o(e)h(their)h(complex-)183
1695 y(it)o(y)m(,)g(b)o(y)i(considering)g(a)f(suitable)h(cost)g
(measure)g(on)g(terms.)f(W)m(e)g(construct)j(the)e(cost)h(measure)183
1745 y(so)g(that)g(ev)o(ery)g(reduction)h(strictly)f(reduces)i(cost.)
245 1795 y(Start)j(b)o(y)f(observing)g(that)h(terms)f(not)g(con)o
(taining)f Fs(c)n(at)i Fw(or)f Fs(ListCat)g Fw(are)g(reduced)i(to)f(a)
183 1845 y(normal)13 b(form)g(in)h(one)h(step.)h(W)m(e'll)d(giv)o(e)h
(suc)o(h)i(terms)f(a)g(cost)g(of)g(zero.)g(No)o(w)f(notice)i(that)f
(the)183 1895 y(second)h(equations)f(de\014ning)g Fs(nil)g
Fw(and)g Fs(unit)h Fw(eliminate)d(a)i Fs(ListCat)o Fw(.)g(If)g
Fs(ListCat)f Fw(is)h(assigned)h(a)183 1945 y(cost)g(of)f(one,)g(then)h
(these)h(reductions)g(reduce)g(cost.)e(Lo)q(oking)g(at)g(the)h
(de\014nition)f(of)g Fs(c)n(at)p Fw(,)g(w)o(e)183 1994
y(see)f(that)f(the)h(\014rst)g(equation)e(con)o(v)o(erts)i(a)f
Fs(c)n(at)g Fw(to)g(a)g Fs(ListCat)o Fw(.)g(If)f(w)o(e)i(assign)e
Fs(c)n(at)h Fw(a)g(cost)h(of)e(t)o(w)o(o,)183 2044 y(then)h(this)g
(reduction)h(also)e(reduces)k(cost.)d(The)g(tric)o(ky)g(case)h(is)f
(the)h(second)g(equation)e(for)h Fs(c)n(at)p Fw(,)183
2094 y(since)h(it)g(neither)h(reduces)h(the)e(n)o(um)o(b)q(er)f(of)h(o)
q(ccurrences)j(of)c Fs(c)n(at)h Fw(nor)g(of)f Fs(ListCat)o
Fw(.)245 2144 y(W)m(e)j(can)g(obtain)f(a)h(cost)h(reduction)f(in)g
(this)g(case)h(also)f(b)o(y)f(assigning)h Fs(di\013er)n(ent)h(c)n(osts)
f Fw(to)183 2194 y(the)d(o)q(ccurrences)j(of)c Fs(c)n(at)h
Fw(on)g(the)g(left)g(and)g(righ)o(t)f(hand)h(side.)g(W)m(e)f(assign)h
Fs(c)n(at)g Fw(a)g(cost)g(of)f(t)o(w)o(o)h(in)183 2243
y(a)g(`c)o(heap')h(con)o(text,)g(and)g(a)f(cost)i(of)e(three)i(in)f
(other)g(con)o(texts.)h(Cheap)f(con)o(texts)h(are)f(de\014ned)183
2293 y(b)o(y)f(the)i(follo)o(wing)c(grammar:)669 2366
y Fs(Che)n(ap)p Fw([)p Fq(\017)p Fw(])g(::=)g([)p Fq(\017)p
Fw(])i Fs(List)857 2428 y Fq(j)33 b Fs(ListCat)14 b Fw([)p
Fq(\017)p Fw(])857 2491 y Fq(j)33 b Fs(Che)n(ap)p Fw([)p
Fn(E)11 b Fs(`c)n(at`)e Fw([)p Fq(\017)p Fw(]])p eop
%%Page: 10 10
10 9 bop 689 226 a Fj(data)16 b Fk(Cxt)d Fl(a)e Fv(=)g
Fk(List)d Fi(j)g Fk(ListCat)13 b Fv(\()p Fk(Se)n(q)f
Fl(a)p Fv(\))689 271 y Fj(t)o(yp)q(e)j Fk(Se)n(q)e Fl(a)e
Fv(=)f Fk(Cxt)k Fl(a)d Fi(!)g Fv([)p Fl(a)p Fv(])689
363 y Fk(nil)h(List)e Fv(=)h([])689 408 y Fk(nil)h Fv(\()p
Fk(ListCat)h(zs)o Fv(\))e(=)f Fk(zs)i(List)689 500 y(unit)h
Fl(x)f Fk(List)e Fv(=)h([)p Fl(x)p Fv(])689 545 y Fk(unit)i
Fl(x)f Fv(\()p Fk(ListCat)h(zs)o Fv(\))e(=)f Fl(x)h Fv(:)f
Fk(zs)i(List)689 637 y Fv(\()p Fk(xs)p Fv(`)p Fl(cat)p
Fv(`)p Fk(ys)n Fv(\))h Fk(List)d Fv(=)g Fk(xs)i Fv(\()p
Fk(ListCat)h(ys)o Fv(\))689 682 y(\()p Fk(xs)p Fv(`)p
Fl(cat)p Fv(`)p Fk(ys)n Fv(\))g(\()p Fk(ListCat)f(zs)p
Fv(\))e(=)h Fk(xs)h Fv(\()p Fk(ListCat)h Fv(\()p Fk(ys)o
Fv(`)p Fl(cat)p Fv(`)p Fk(zs)o Fv(\)\))689 774 y Fk(list)g(xs)d
Fv(=)g Fk(xs)j(List)340 900 y Fj(Fig.)7 b(2.)13 b Fv(The)g(con)o(text)h
(passing)h(implemen)o(tation)h(of)d(sequences.)340 1046
y Fw(No)o(w)i(it)g(is)g(easy)h(to)f(v)o(erify)f(that)i(the)f
Fs(c)n(at)g Fw(on)g(the)h(righ)o(t)f(in)g(the)g(last)g(equation)g(is)g
(in)g(a)g(c)o(heap)340 1096 y(con)o(text,)f(while)g(that)f(on)h(the)g
(left)g(is)f(not.)g(W)m(e)h(also)f(ha)o(v)o(e)g(to)h(c)o(hec)o(k)g
(that)g(in)g(ev)o(ery)g(equation,)340 1146 y(b)q(ound)20
b(v)n(ariables)e(app)q(ear)h(in)g(a)g(c)o(heap)g(con)o(text)h(on)f(the)
g(left)g(hand)g(side)g(i\013)g(they)h(app)q(ear)340 1196
y(in)g(a)f(c)o(heap)h(con)o(text)h(on)e(the)i(righ)o(t)e(hand)h(side)g
(|)f(otherwise)i(our)e(implicit)e(assumption)340 1246
y(that)e(a)f(b)q(ound)g(v)n(ariable)g(con)o(tributes)h(the)g(same)f
(cost)h(at)f(eac)o(h)h(o)q(ccurrence)i(w)o(ould)d(b)q(e)h(false.)340
1295 y(Ha)o(ving)f(done)g(so,)g(w)o(e)h(kno)o(w)f(that)g(the)h(n)o(um)o
(b)q(er)f(of)f(reductions)j(needed)g(to)e(ev)n(aluate)g(a)g(term)340
1345 y(is)g(b)q(ounded)h(b)o(y)e(its)h(cost.)g(And)g(this)g(is)g
(linear)f(in)h(the)g(size)h(of)e(the)i(term.)403 1396
y(W)m(e)f(ha)o(v)o(e)g(therefore)i(cured)g(the)g(quadratic)e(b)q(eha)o
(viour)g(that)h(motiv)n(ated)e(us)i(to)f(consider)340
1446 y(a)g(con)o(text-passing)g(implemen)o(tation.)340
1577 y Ft(4.3)48 b(Changing)14 b(the)h(Represen)o(tati)o(on)e(of)i(Con)
o(texts)340 1667 y Fw(If)21 b(w)o(e)g(examine)f(the)h(de\014nitions)g
(in)f(\014gure)i(2,)e(w)o(e)h(can)g(see)h(that)f(the)h
Fs(zs)f Fw(comp)q(onen)o(t)f(of)340 1716 y Fs(ListCat)14
b(zs)20 b Fw(is)g(only)e(used)j(b)o(y)e(applying)g(it)g(to)g
Fs(List)p Fw(.)g(That)h(is,)f(w)o(e)h(are)g(not)f(in)o(terested)j(in)
340 1766 y(the)15 b(v)n(alue)e(of)g Fs(zs)g Fw(itself,)g(only)g(in)g
(the)h(v)n(alue)f(of)g Fs(list)h(zs)p Fw(.)f(This)h(suggests)h(that)e
(w)o(e)h(try)g(c)o(hanging)340 1816 y(the)h(represen)o(tation)g(of)f
(con)o(texts)h(to)e(store)i(the)g(latter)f(rather)g(than)g(the)h
(former.)403 1867 y(The)f(new)g(con)o(text)h(datat)o(yp)q(e)f(will)e
(therefore)k(b)q(e)818 1955 y Ft(data)g Fs(Cxt)e Fn(a)e
Fw(=)g Fs(List)c Fq(j)h Fs(ListCat)14 b Fw([)p Fn(a)p
Fw(])340 2042 y(with)g(the)g(in)o(terpretation)1004 2135
y Fs(List)d Fw(=)h Fs(list)i Fw([)p Fq(\017)p Fw(])789
2198 y Fs(ListCat)g Fw(\()p Fs(list)g(zs)p Fw(\))e(=)g
Fs(list)i Fw(\([)p Fq(\017)p Fw(])8 b Fs(`c)n(at`)h(zs)p
Fw(\))340 2291 y(No)o(w)14 b(if)f(w)o(e)h(let)21 b(^)-28
b Fs(zs)12 b Fw(=)f Fs(list)j(zs)p Fw(,)g(w)o(e)g(can)g(deriv)o(e)792
2376 y Fs(nil)f Fw(\()p Fs(ListCat)21 b Fw(^)-28 b Fs(zs)p
Fw(\))12 b(=)g Fs(list)i Fw(\()p Fs(nil)9 b(`c)n(at`)g(zs)p
Fw(\))1079 2426 y(=)j Fs(list)i(zs)1079 2476 y Fw(=)19
b(^)-28 b Fs(zs)p eop
%%Page: 11 11
11 10 bop 570 187 a Fs(unit)15 b Fn(x)f Fw(\()p Fs(ListCat)20
b Fw(^)-27 b Fs(zs)p Fw(\))11 b(=)h Fs(list)i Fw(\()p
Fs(unit)h Fn(x)9 b Fs(`c)n(at`)g(zs)p Fw(\))921 237 y(=)j
Fn(x)g Fw(:)f Fs(list)j(zs)921 287 y Fw(=)e Fn(x)g Fw(:)17
b(^)-27 b Fs(zs)394 389 y Fw(\()p Fs(xs)9 b(`c)n(at`)g(ys)p
Fw(\))14 b(\()p Fs(ListCat)21 b Fw(^)-28 b Fs(zs)p Fw(\))12
b(=)g Fs(list)i Fw(\(\()p Fs(xs)c(`c)n(at`)e(ys)p Fw(\))i
Fs(`c)n(at`)e(zs)p Fw(\))836 439 y(=)k Fs(list)i Fw(\()p
Fs(xs)9 b(`c)n(at`)g Fw(\()p Fs(ys)h(`c)n(at`)e(zs)p
Fw(\)\))836 489 y(=)k Fs(xs)p Fw(\()p Fs(ListCat)i Fw(\()p
Fs(list)g Fw(\()p Fs(ys)c(`c)n(at`)f(zs)p Fw(\)\))836
538 y(=)j Fs(xs)p Fw(\()p Fs(ListCat)i Fw(\()p Fs(ys)q
Fw(\()p Fs(ListCat)g Fw(\()p Fs(list)g(zs)p Fw(\)\)\)\))836
588 y(=)e Fs(xs)p Fw(\()p Fs(ListCat)i Fw(\()p Fs(ys)q
Fw(\()p Fs(ListCat)20 b Fw(^)-27 b Fs(zs)p Fw(\)\)\))183
684 y(Notice)15 b(ho)o(w)f(eac)o(h)h(time)f(w)o(e)h(in)o(tro)q(duce)g
(a)g Fs(ListCat)o Fw(,)f(the)h(accompan)o(ying)e(application)g(of)h
Fs(list)183 734 y Fw(enables)g(a)g(further)h(simpli\014cation.)245
786 y(In)e(eac)o(h)h(case)g(w)o(e)g(ha)o(v)o(e)f(succeeded)j(in)d
(maneouv)o(ering)f(the)i(righ)o(t)f(hand)g(side)h(in)o(to)e(a)h(form)
183 835 y(in)f(whic)o(h)h Fs(zs)g Fw(do)q(es)g(not)g(app)q(ear)h(|)e
(only)19 b(^)-28 b Fs(zs)p Fw(.)12 b(W)m(e)h(can)g(therefore)h(tak)o(e)
f(the)h(deriv)o(ed)f(equations)183 885 y(as)g(de\014nitions,)g(with)g
(a)g(formal)e(parameter)22 b(^)-31 b Fn(z)r(s)q Fw(.)13
b(Pro)o(vided,)g(of)f(course,)i(that)g(con)o(texts)g(of)f(the)183
935 y(form)f Fs(ListCat)20 b Fw(^)-27 b Fs(zs)13 b Fw(alw)o(a)o(ys)g
(satisfy)g(the)i(in)o(v)n(arian)o(t)d Fq(9)p Fs(zs)p
Fn(:)7 b Fw(^)-28 b Fs(zs)11 b Fw(=)g Fs(list)j Fn(z)r(s)p
Fw(,)g(whic)o(h)g(is)f(easily)g(v)o(eri\014ed.)245 987
y(In)h(this)g(case)h(w)o(e)f(can)g(go)f(a)h(little)f(further)i(still.)d
(Noting)h(that)675 1074 y Fs(list)h(xs)e Fw(=)g Fs(list)i
Fw(\()p Fs(xs)c(`c)n(at`)e(nil)p Fw(\))792 1123 y(=)k
Fs(xs)p Fw(\()p Fs(ListCat)j Fw(\()p Fs(list)f(nil)o
Fw(\)\))792 1173 y(=)e Fs(xs)p Fw(\()p Fs(ListCat)j Fw([]\))183
1259 y(w)o(e)c(can)g(rede\014ne)h Fs(list)e Fw(and)h(do)f(without)h
Fs(List)f Fw(con)o(texts)i(altogether.)e(No)o(w)h(since)g(only)f(one)h
(form)183 1309 y(of)h(con)o(text)h(remains)e(w)o(e)i(can)g(drop)g(the)g
Fs(ListCat)e Fw(constructor)k(also,)c(and)h(represen)o(t)j(con)o(texts)
183 1359 y(just)f(b)o(y)f(lists.)h(The)g(resulting)g(de\014nitions)g
(app)q(ear)g(in)g(\014gure)g(3.)721 1538 y Fj(t)o(yp)q(e)h
Fk(Cxt)e Fl(a)e Fv(=)g([)p Fl(a)p Fv(])721 1584 y Fj(t)o(yp)q(e)k
Fk(Se)n(q)d Fl(a)f Fv(=)g Fk(Cxt)i Fl(a)e Fi(!)g Fv([)p
Fl(a)p Fv(])721 1630 y Fk(nil)18 b Fv(^)-26 b Fk(zs)10
b Fv(=)17 b(^)-25 b Fk(zs)721 1675 y(unit)12 b Fl(x)19
b Fv(^)-26 b Fk(zs)10 b Fv(=)h Fl(x)f Fv(:)17 b(^)-25
b Fk(zs)721 1721 y Fv(\()p Fk(xs)7 b(`c)n(at`)g(ys)p
Fv(\))19 b(^)-26 b Fk(zs)11 b Fv(=)f Fk(xs)i Fv(\()p
Fk(ys)18 b Fv(^)-25 b Fk(zs)p Fv(\))721 1767 y Fk(list)12
b(xs)e Fv(=)h Fk(xs)h Fv([])183 1894 y Fj(Fig.)6 b(3.)14
b Fv(Optimised)g(con)o(text)g(passing)h(represen)o(tation)g(of)e
(sequences)183 2090 y Fs(Exer)n(cise)7 b(1.)20 b Fw(Could)d(w)o(e)h(ha)
o(v)o(e)f(used)h(a)f(similar)e(tric)o(k)j(to)f(eliminate)e
Fs(List)i Fw(con)o(texts)i(and)e(the)183 2140 y Fs(ListCat)c
Fw(constructor)i(in)f(the)g(previous)g(section?)183 2283
y Fu(5)56 b(Implem)o(en)n(ting)16 b(Monads)183 2391 y
Fw(The)21 b(ideas)f(in)g(the)i(previous)f(section)g(are)g(applicable)f
(when)h(w)o(e)f(w)o(an)o(t)h(to)f(implemen)o(t)e(a)183
2441 y(datat)o(yp)q(e)h(sp)q(eci\014ed)h(b)o(y)e(a)h(signature)g(and)f
(some)g(equations)h(that)f(the)i(op)q(erations)f(in)f(the)183
2491 y(signature)h(should)h(satisfy)m(.)e(One)i(v)o(ery)g(in)o
(teresting)g(class)g(of)e(datat)o(yp)q(es)i(sp)q(eci\014ed)h(in)e(this)
p eop
%%Page: 12 12
12 11 bop 340 194 a Fw(w)o(a)o(y)14 b(are)g Fs(monads)p
Fw(.)h(A)o(t)f(its)g(simplest,)e(a)i(monad)e(is)i(a)g(parameterised)g
(t)o(yp)q(e)h Fn(M)k Fw(and)13 b(a)h(pair)g(of)340 244
y(op)q(erations)808 331 y Fs(unit)e Fw(::)f Fn(a)g Fq(!)g
Fs(M)k Fn(a)804 394 y Fs(bind)d Fw(::)f Fs(M)k Fn(a)c
Fq(!)g Fw(\()p Fn(a)h Fq(!)f Fs(M)k Fn(b)p Fw(\))d Fq(!)f
Fs(M)k Fn(b)340 481 y Fw(satisfying)e(the)i(la)o(ws)820
569 y Fs(unit)g Fn(x)9 b Fs(`bind`)g Fn(f)16 b Fw(=)c
Fn(f)19 b(x)847 632 y(m)9 b Fs(`bind`)g(unit)j Fw(=)g
Fn(m)570 694 y(m)e Fs(`bind`)f Fn(\025x)i Fq(!)g Fw(\()p
Fn(f)19 b(x)9 b Fs(`bind`)g Fn(g)q Fw(\))j(=)g(\()p Fn(m)e
Fs(`bind`)f Fn(\025x)i Fq(!)g Fn(f)t(x)p Fw(\))f Fs(`bind`)f
Fn(g)340 782 y Fw(See)14 b(the)g(c)o(hapter)f(b)o(y)g(W)m(adler)f(in)h
(this)g(v)o(olume)d(for)j(an)g(exp)q(osition)f(of)g(the)i(uses)g(of)e
(monads)g(in)340 831 y(functional)h(programming.)403
882 y(With)e(no)g(further)i(op)q(erations)f(a)f(monad)f(is)i(rather)g
(unin)o(teresting.)g(In)g(realit)o(y)m(,)e(w)o(e)i(alw)o(a)o(ys)340
932 y(extend)k(the)g(signature)f(with)f(some)g(additional)f(op)q
(erations.)i(In)g(particular,)f(there)i(m)o(ust)e(b)q(e)340
981 y(some)e(w)o(a)o(y)g(to)g(observ)o(e)h(a)g(monad)d(v)n(alue)i(|)g
(otherwise)h(w)o(e)g(could)f(implemen)o(t)e(the)j(monad)d(b)o(y)961
1063 y Ft(t)o(yp)q(e)16 b Fs(M)f Fn(a)c Fw(=)h(\(\))961
1113 y Fs(unit)j Fn(x)d Fw(=)f(\(\))961 1163 y Fn(m)f
Fs(`bind`)f Fn(f)16 b Fw(=)c(\(\))340 1245 y(whic)o(h)i(satis\014es)h
(the)g(monad)d(la)o(ws.)403 1296 y(W)m(e)h(will)g(consider)i(the)g
(simplest)e(in)o(teresting)h(monad:)e(that)i(with)g(one)g(additional)f
(op)q(er-)340 1345 y(ation)947 1433 y Fs(value)f Fw(::)e
Fs(M)15 b Fn(a)d Fq(!)f Fn(a)340 1521 y Fw(satisfying)i(the)i(la)o(w)
932 1609 y Fs(value)g Fw(\()p Fs(unit)g Fn(x)p Fw(\))c(=)h
Fn(x)340 1697 y Fw(W)m(e'll)g(lo)q(ok)h(at)h(implemen)o(tations)d
(based)j(on)g(simpli\014ed)e(terms)i(and)f(on)h(con)o(text)h(passing.)
340 1824 y Ft(5.1)48 b(The)16 b(T)l(erm)f(Represen)o(tati)o(on)e(of)i
(a)h(Simple)d(Monad)340 1909 y Fw(Supp)q(ose)i(w)o(e)f(try)g(to)g
(represen)o(t)i(monad)c(v)n(alues)i(directly)g(b)o(y)g(terms:)710
1993 y Ft(data)h Fs(M)g Fn(a)d Fw(=)f Fs(Unit)k Fn(a)9
b Fq(j)g Fs(M)15 b Fn(b)9 b Fs(`Bind`)g Fw(\()p Fn(b)j
Fq(!)f Fs(M)k Fn(a)p Fw(\))340 2078 y(Notice)d(that)g(the)g(t)o(yp)q(e)
g(v)n(ariable)e Fn(b)h Fw(do)q(es)h(not)g(o)q(ccur)g(on)f(the)h(left)g
(hand)f(side)h(of)f(this)g(de\014nition!)340 2128 y(It)h(is)g(an)g
(existen)o(tially)f(quan)o(ti\014ed)g(t)o(yp)q(e)i(v)n(ariable:)d(one)i
(ma)o(y)e(construct)j(an)f Fs(M)j Fn(a)d Fw(b)o(y)g(applying)340
2177 y Fs(Bind)j Fw(at)e Fs(any)i Fw(t)o(yp)q(e)f Fn(b)681
2162 y Fr(5)700 2177 y Fw(.)f(With)g(this)h(represen)o(tation)i
Fs(value)e Fw(can)g(b)q(e)h(de\014ned)g(b)o(y)726 2259
y Fs(value)d Fw(::)f Fs(M)k Fn(a)c Fq(!)g Fn(a)726 2309
y Fs(value)k Fw(\()p Fs(Unit)g Fn(x)p Fw(\))c(=)h Fn(x)726
2359 y Fs(value)j Fw(\()p Fn(m)10 b Fs(`Bind`)f Fn(f)t
Fw(\))k(=)f Fs(value)j Fw(\()p Fn(f)j Fw(\()p Fs(value)e
Fn(m)p Fw(\)\))p 340 2402 237 2 v 349 2429 a Fo(5)379
2445 y Fv(Suc)o(h)c(existen)o(tial)i(t)o(yp)q(e)d(de\014nitions)j(w)o
(ere)d(prop)q(osed)i(b)o(y)e(L\177)-19 b(aufer[2])11
b(and)h(are)f(not)g(part)h(of)f(standard)379 2491 y(Hask)o(ell,)j(but)f
(are)g(accepted)h(b)o(y)g Fg(hbc)p Fv(.)p eop
%%Page: 13 13
13 12 bop 183 194 a Fw(whic)o(h)15 b(uses)h(p)q(olymorphic)e
(recursion:)h(the)h(inner)g(recursiv)o(e)h(call)d(of)h
Fs(value)g Fw(is)g(at)g(a)g(di\013eren)o(t)183 244 y(t)o(yp)q(e)f(from)
e(the)j(enclosing)e(one)685 228 y Fr(6)704 244 y Fw(.)245
293 y(Ho)o(w)o(ev)o(er,)j(w)o(e)g(can)h(a)o(v)o(oid)e(these)i
(complications)d(b)o(y)i(using)g(a)g(represen)o(tation)i(based)f(on)183
343 y(simpli\014ed)g(terms)h(instead.)h(In)f(fact,)h(w)o(e)g(can)g
(simplify)d(ev)o(ery)j(term)f(to)h(the)g(form)e Fs(unit)e
Fn(x)p Fw(.)183 393 y(Dropping)e(the)h Fs(Bind)h Fw(constructor)g(from)
d(the)j(monad)d(t)o(yp)q(e,)i(w)o(e)g(obtain)731 474
y Fs(unit)h Fn(x)d Fw(=)f Fs(Unit)k Fn(x)731 524 y Fw(\()p
Fs(Unit)g Fn(x)p Fw(\))9 b Fs(`bind`)g Fn(f)17 b Fw(=)11
b Fn(f)19 b(x)731 573 y Fs(value)d Fw(\()p Fs(Unit)e
Fn(x)p Fw(\))e(=)f Fn(x)183 655 y Fw(where)16 b(the)g(only)e(prop)q
(ert)o(y)i(of)e Fs(unit)h Fw(and)g Fs(bind)h Fw(w)o(e)f(need)h(to)f
(deriv)o(e)g(these)i(de\014nitions)e(is)g(the)183 705
y(\014rst)f(monad)e(la)o(w.)g(And)i(no)o(w,)f(since)i
Fs(Unit)e Fw(is)h(the)g(only)f(constructor)i(in)f(the)g(monad)e(t)o(yp)
q(e)i(w)o(e)183 755 y(can)g(drop)g(it)f(to)q(o,)g(represen)o(t)k
Fs(M)e Fn(a)e Fw(just)i(b)o(y)e Fn(a)p Fw(,)h(and)f(obtain)g(the)i
(standard)f(iden)o(tit)o(y)g(monad.)183 880 y Ft(5.2)47
b(The)16 b(Con)o(text-passing)d(Represen)o(tat)o(ion)f(of)j(a)i(Simple)
c(Monad)183 963 y Fw(Supp)q(ose)k(w)o(e)f(instead)g(deriv)o(e)g(a)g
(con)o(text-passing)g(implemen)o(tation.)c(W)m(e)k(are)g(in)o(terested)
i(in)183 1013 y(con)o(texts)f(whic)o(h)e(mak)o(e)g(an)g(observ)n(ation)
h(b)o(y)f(applying)g Fs(value)p Fw(,)g(and)h(using)g(the)g(monad)e(la)o
(ws)183 1063 y(w)o(e)g(will)e(b)q(e)j(able)e(to)h(put)g(ev)o(ery)h(suc)
o(h)f(con)o(text)h(in)o(to)e(the)i(form)d Fs(value)j
Fw(\([)p Fq(\017)p Fw(])8 b Fs(`bind`)h Fn(k)q Fw(\),)14
b(b)q(ecause)685 1149 y Fs(value)h Fw([)p Fq(\017)p Fw(])10
b(=)i Fs(value)j Fw(\([)p Fq(\017)p Fw(])9 b Fs(`bind`)g(unit)p
Fw(\))332 1211 y Fs(value)15 b Fw(\(\([)p Fq(\017)p Fw(])8
b Fs(`bind`)h Fn(f)t Fw(\))i Fs(`bind`)e Fn(k)q Fw(\))i(=)h
Fs(value)j Fw(\([)p Fq(\017)p Fw(])9 b Fs(`bind`)g Fn(\025x)i
Fq(!)g Fw(\()p Fn(f)19 b(x)9 b Fs(`bind`)g Fn(k)q Fw(\)\))200
1297 y(Notice)19 b(here)g(that)e(if)g(the)i(hole)e(is)h(of)f(t)o(yp)q
(e)h Fs(M)e Fn(a)p Fw(,)h(the)h(\014nal)f(v)n(alue)g(computed)h(ma)o(y)
e(b)q(e)i(of)183 1347 y(some)h(other)h(t)o(yp)q(e)g(|)f(call)g(it)h
Fs(ans)p Fw(.)g(W)m(e)f(m)o(ust)g(therefore)i(represen)o(t)h(con)o
(texts)f(b)o(y)e(a)h(t)o(yp)q(e)183 1397 y(parameterised)e(on)g(b)q
(oth)h Fn(a)f Fw(and)h Fs(ans)p Fw(.)f(Consequen)o(tly)h(w)o(e)g(are)f
(also)g(obliged)g(to)g(represen)o(t)183 1446 y(monad)f(v)n(alues)h(b)o
(y)g(a)h(t)o(yp)q(e)g(parameterised)g(on)f(b)q(oth)h
Fn(a)g Fw(and)f Fs(ans)q Fw(.)g(F)m(or)g(example,)f(w)o(e)i(can)183
1496 y(de\014ne)515 1569 y Ft(data)c Fs(Cxt)g Fn(a)f
Fs(ans)e Fw(=)f Fs(V)m(alueBind)16 b Fw(\()p Fn(a)11
b Fq(!)g Fs(M)k(ans)g(ans)p Fw(\))515 1619 y Ft(t)o(yp)q(e)g
Fs(M)g Fn(a)f Fs(ans)e Fw(=)g Fs(Cxt)i Fn(a)g(ans)e Fq(!)f
Fs(ans)183 1700 y Fw(where)635 1786 y Fs(V)m(alueBind)k
Fn(k)e Fw(=)f Fs(value)j Fw(\([)p Fq(\017)p Fw(])8 b
Fs(`bind`)h Fn(k)q Fw(\))245 1872 y(Ho)o(w)o(ev)o(er,)15
b(it)g(isn't)g(hard)g(to)h(guess)g(that)f(uses)i(of)d
Fn(k)i Fw(will)e(all)g(tak)o(e)i(the)g(form)d Fs(value)i
Fw(\()p Fn(k)i(x)p Fw(\))183 1922 y(for)c(some)g Fn(x)p
Fw(.)g(W)m(e)h(therefore)h(optimise)d(the)j(represen)o(tation)g(of)f
(con)o(texts)h(to)578 2005 y Ft(data)h Fs(Cxt)e Fn(a)g
Fs(ans)e Fw(=)g Fs(V)m(alueBind)j Fw(\()p Fn(a)d Fq(!)f
Fs(ans)q Fw(\))183 2089 y(where)501 2175 y Fs(V)m(alueBind)k
Fw(\()p Fn(\025x:)p Fs(value)g Fw(\()p Fn(k)f(x)p Fw(\)\))e(=)g
Fs(value)j Fw(\([)p Fq(\017)p Fw(])8 b Fs(`bind`)h Fn(k)q
Fw(\))183 2261 y(\(If)k(our)h(guess)h(pro)o(v)o(es)f(to)g(b)q(e)h
(wrong)e(no)h(harm)e(will)h(b)q(e)h(done,)g(w)o(e)g(will)e(simply)g(b)q
(e)j(unable)f(to)183 2311 y(deriv)o(e)g(de\014nitions)g(for)f(the)i
(monad)d(op)q(erations\).)245 2365 y(No)o(w)h(letting)472
2354 y(^)471 2365 y Fn(k)f Fw(=)g Fn(\025x:)p Fs(value)j
Fw(\()p Fn(k)g(x)p Fw(\),)e(w)o(e)h(can)g(deriv)o(e)p
183 2402 237 2 v 191 2429 a Fo(6)221 2445 y Fv(Again)g(this)h(is)e(not)
h(standard)h(Hask)o(ell,)f(but)g(is)g(accepted)g(b)o(y)g
Fg(hbc)e Fv(pro)o(vided)j(the)e(t)o(yp)q(e)h(of)f Fk(value)f
Fv(is)221 2491 y(explicitly)k(giv)o(en.)p eop
%%Page: 14 14
14 13 bop 511 192 a Fs(unit)15 b Fn(x)e Fw(\()p Fs(V)m(alueBind)855
181 y Fw(^)854 192 y Fn(k)p Fw(\))f(=)g Fs(value)j Fw(\()p
Fs(unit)g Fn(x)9 b Fs(`bind`)g Fn(k)q Fw(\))904 242 y(=)j
Fs(value)j Fw(\()p Fn(k)g(x)p Fw(\))247 b([1st)13 b(monad)f(la)o(w)o(])
904 296 y(=)949 286 y(^)948 296 y Fn(k)j(x)495 413 y
Fw(\()p Fn(m)10 b Fs(`bind`)f Fn(f)t Fw(\))15 b(\()p
Fs(V)m(alueBind)942 402 y Fw(^)941 413 y Fn(k)q Fw(\))507
463 y(=)d Fs(value)j Fw(\(\()p Fn(m)10 b Fs(`bind`)f
Fn(f)t Fw(\))h Fs(`bind`)f Fn(k)q Fw(\))507 512 y(=)j
Fs(value)j Fw(\()p Fn(m)10 b Fs(`bind`)f Fn(\025x)i Fq(!)g
Fw(\()p Fn(f)19 b(x)9 b Fs(`bind`)g Fn(k)q Fw(\)\))206
b([3rd)14 b(monad)e(la)o(w)o(])507 562 y(=)g Fn(m)i Fw(\()p
Fs(V)m(alueBind)h Fw(\()p Fn(\025x)d Fq(!)f Fs(value)k
Fw(\()p Fn(f)k(x)9 b Fs(`bind`)g Fn(k)q Fw(\)\)\))53
b([prop.)13 b Fs(V)m(alueBind)q Fw(])507 617 y(=)f Fn(m)i
Fw(\()p Fs(V)m(alueBind)h Fw(\()p Fn(\025x)d Fq(!)f Fn(f)19
b(x)13 b Fw(\()p Fs(V)m(alueBind)1244 606 y Fw(^)1243
617 y Fn(k)q Fw(\)\)\))263 b([again)o(])471 725 y Fs(value)15
b Fn(m)d Fw(=)g Fs(value)j Fw(\()p Fn(m)10 b Fs(`bind`)f(unit)p
Fw(\))383 b([2nd)13 b(monad)f(la)o(w)o(])626 775 y(=)g
Fn(m)i Fw(\()p Fs(V)m(alueBind)i Fw(\()p Fn(\025x)11
b Fq(!)g Fs(value)k Fw(\()p Fs(unit)h Fn(x)p Fw(\)\)\))53
b([prop.)13 b Fs(V)m(alueBind)p Fw(])626 825 y(=)f Fn(m)i
Fw(\()p Fs(V)m(alueBind)i Fw(\()p Fn(\025x)11 b Fq(!)g
Fn(x)p Fw(\)\))375 b([prop.)13 b Fs(value)p Fw(])340
927 y(And)g(no)o(w)g(dropping)f(the)h(sup)q(er\015uous)h(constructor)h
Fs(V)m(alueBind)p Fw(,)d(w)o(e)h(obtain)f(the)h(de\014nitions)340
977 y(in)h(\014gure)g(4)g(|)f(the)i(standard)f(monad)e(of)h(con)o(tin)o
(uations!)798 1159 y Fj(t)o(yp)q(e)i Fk(M)f Fl(a)f Fk(ans)c
Fv(=)i(\()p Fk(Cxt)j Fl(a)f Fk(ans)o Fv(\))d Fi(!)h Fk(ans)798
1205 y Fj(t)o(yp)q(e)k Fk(Cxt)e Fl(a)g Fk(ans)d Fv(=)g
Fl(a)h Fi(!)h Fk(ans)798 1254 y(unit)g Fl(x)913 1244
y Fv(^)913 1254 y Fl(k)f Fv(=)986 1244 y(^)985 1254 y
Fl(k)j(x)798 1304 y Fv(\()p Fl(m)8 b Fk(`bind`)e Fl(f)t
Fv(\))1009 1294 y(^)1008 1304 y Fl(k)12 b Fv(=)e Fl(m)j
Fv(\()p Fl(\025x)e Fi(!)g Fl(f)16 b(x)1317 1294 y Fv(^)1316
1304 y Fl(k)q Fv(\))798 1349 y Fk(value)c Fl(m)e Fv(=)h
Fl(m)h Fv(\()p Fl(\025x)f Fi(!)g Fl(x)p Fv(\))340 1476
y Fj(Fig.)c(4.)13 b Fv(The)g(Optimised)i(Con)o(text-passing)g(Monad.)
340 1726 y Fu(6)56 b(Monads)20 b(for)f(Bac)n(ktrac)n(king)340
1842 y Fw(W)m(e'v)o(e)14 b(seen)i(ho)o(w)f(w)o(e)g(can)g(deriv)o(e)g(b)
q(oth)f(the)i(iden)o(tit)o(y)e(monad)f(and)h(the)i(monad)d(of)h(con)o
(tin)o(u-)340 1892 y(ations)g(from)f(the)i(`v)n(anilla')c(monad)i(sp)q
(eci\014cation.)h(But)h(in)f(realit)o(y)g(w)o(e)h(wish)f(to)g(add)g
(further)340 1941 y(op)q(erations)i(to)f(the)g(signature)h(|)f(that)g
(is)g(the)g Fs(r)n(aison)h(d')o(^)-20 b(etr)n(e)15 b
Fw(of)f(monads.)f(As)j(an)f(example,)340 1991 y(w)o(e'll)e(consider)i
(op)q(erations)f(for)g(bac)o(ktrac)o(king:)891 2095 y
Fs(fail)d Fw(::)g Fs(M)k Fn(a)846 2158 y Fs(or)n(else)c
Fw(::)g Fs(M)k Fn(a)d Fq(!)f Fs(M)k Fn(a)c Fq(!)g Fs(M)k
Fn(a)340 2262 y Fw(The)g(new)f(op)q(erations)g(form)e(a)i(monoid,)841
2366 y Fs(fail)9 b(`or)n(else`)f Fn(x)j Fw(=)h Fn(x)841
2428 y(x)d Fs(`or)n(else`)f(fail)j Fw(=)h Fn(x)677 2491
y Fw(\()p Fn(x)d Fs(`or)n(else`)f Fn(y)q Fw(\))i Fs(`or)n(else`)e
Fn(z)14 b Fw(=)e Fn(x)d Fs(`or)n(else`)f Fw(\()p Fn(y)j
Fs(`or)n(else`)d Fn(z)r Fw(\))p eop
%%Page: 15 15
15 14 bop 183 194 a Fw(and)13 b(w)o(e)h(m)o(ust)f(also)h(sp)q(ecify)g
(their)g(in)o(teraction)g(with)g(the)g(monad)e(op)q(erations)1446
179 y Fr(7)1465 194 y Fw(:)620 266 y Fs(fail)c(`bind`)h
Fn(f)17 b Fw(=)12 b Fs(fail)453 329 y Fw(\()p Fn(x)d
Fs(`or)n(else`)f Fn(y)q Fw(\))i Fs(`bind`)f Fn(f)17 b
Fw(=)12 b(\()p Fn(x)d Fs(`bind`)g Fn(f)t Fw(\))h Fs(`or)n(else`)e
Fw(\()p Fn(y)j Fs(`bind`)e Fn(f)t Fw(\))183 401 y(Finally)m(,)i(it)i
(is)h(no)g(longer)g(appropriate)f(to)h(giv)o(e)g Fs(value)g
Fw(the)g(t)o(yp)q(e)789 474 y Fs(value)e Fw(::)f Fs(M)k
Fn(a)c Fq(!)g Fn(a)183 547 y Fw(b)q(ecause)k(there)g(is)f(no)g
(sensible)h(b)q(eha)o(viour)e(for)h Fs(value)h(fail)o
Fw(.)f(Instead,)g(w)o(e)g(giv)o(e)f(it)h(the)g(t)o(yp)q(e)724
617 y Fs(value)e Fw(::)f Fs(M)k Fn(a)c Fq(!)g Fs(Mayb)n(e)16
b Fn(a)183 688 y Fw(where)690 758 y Ft(data)g Fs(Mayb)n(e)f
Fn(a)d Fw(=)f Fs(Y)m(es)k Fn(a)9 b Fq(j)g Fs(No)183 829
y Fw(satisfying)k(the)h(la)o(ws)912 901 y Fs(value)h(fail)c
Fw(=)h Fs(No)643 964 y(value)j Fw(\()p Fs(unit)g Fn(x)9
b Fs(`or)n(else`)f Fn(m)p Fw(\))13 b(=)f Fs(Y)m(es)i
Fn(x)183 1036 y Fw(So)19 b(w)o(e)h(can)f(observ)o(e)i(whether)g(a)e
(bac)o(ktrac)o(king)g(computation)f(succeeds)k(or)e(fails,)e(and)h(if)
183 1086 y(it)d(succeeds)k(w)o(e)d(observ)o(e)h(the)g(\014rst)g(answ)o
(er.)f(Let)h(us)f(apply)g(the)g(same)f(metho)q(ds)h(to)g(deriv)o(e)183
1136 y(implem)o(en)o(tations)11 b(of)j(this)g(monad.)183
1248 y Ft(6.1)47 b(The)16 b(T)l(erm)f(Represen)o(tatio)o(n)e(of)i(the)g
(Bac)o(ktrac)o(king)f(Monad)183 1319 y Fw(Rather)i(than)g(start)h(from)
d(scratc)o(h)j(to)f(dev)o(elop)h(a)e(term)h(represen)o(tation)h(for)f
(bac)o(ktrac)o(king,)183 1368 y(observ)o(e)h(that)f(if)g(w)o(e)g
(replace)i Fn(M)j Fw(b)o(y)16 b Fs(Se)n(q)p Fw(,)g Fs(fail)g
Fw(b)o(y)g Fs(nil)o Fw(,)g(and)g Fs(or)n(else)g Fw(b)o(y)g
Fs(c)n(at)p Fw(,)g(then)h(these)h(op-)183 1418 y(erations)g(together)g
(with)f Fs(unit)h Fw(satisfy)f(exactly)h(the)g(same)f(axioms)f(as)h(in)
g(section)i(4.)e(That)183 1468 y(suggests)k(that)e(w)o(e)h(try)g(to)g
(use)g(the)g(same)f(kind)g(of)g(simpli\014ed)f(terms)i(as)f(in)h
(section)g(4.1,)183 1518 y(namely)12 b Fs(fail)h Fw(and)h
Fs(unit)h Fn(x)9 b Fs(`or)n(else`)f Fn(m)p Fw(.)13 b(So)h(let)g(us)g
(de\014ne)599 1588 y Ft(data)h Fs(M)g Fn(a)d Fw(=)f Fs(F)m(ail)e
Fq(j)g Fn(a)g Fs(`UnitOrElse`)f(M)15 b Fn(a)183 1659
y Fw(reuse)j(the)f(previously)g(deriv)o(ed)g(de\014nitions)f(for)h
Fs(unit)p Fw(,)f Fs(fail)g Fw(and)h Fs(or)n(else)o Fw(,)f(and)h(see)g
(if)f(w)o(e)h(can)183 1709 y(deriv)o(e)d(implemen)o(tatio)o(ns)e(of)h
(the)h(remaining)e(op)q(erators.)245 1758 y(In)i(the)g(case)h(of)e
Fs(bind)q Fw(,)g(w)o(e)h(deriv)o(e)703 1826 y Fs(F)m(ail)9
b(`bind`)g Fn(f)16 b Fw(=)c Fs(fail)c(`bind`)h Fn(f)928
1876 y Fw(=)j Fs(fail)928 1926 y Fw(=)g Fs(F)m(ail)344
2006 y Fw(\()p Fn(x)d Fs(`UnitOrElse`)e Fn(m)p Fw(\))j
Fs(`bind`)f Fn(f)16 b Fw(=)c(\()p Fs(unit)k Fn(x)8 b
Fs(`or)n(else`)h Fn(m)p Fw(\))g Fs(`bind`)g Fn(f)841
2055 y Fw(=)j(\()p Fs(unit)k Fn(x)8 b Fs(`bind`)i Fn(f)t
Fw(\))g Fs(`or)n(else`)e Fw(\()p Fn(m)i Fs(`bind`)f Fn(f)t
Fw(\))841 2105 y(=)j Fn(f)19 b(x)9 b Fs(`or)n(else`)f
Fw(\()p Fn(m)i Fs(`bind`)f Fn(f)t Fw(\))183 2181 y(\(whic)o(h)17
b(is)f(a)h(terminating)e(de\014nition)i(b)q(ecause)h(the)g(recursiv)o
(e)g(call)f(of)f Fs(bind)h Fw(has)g(a)g(smaller)183 2231
y(\014rst)d(argumen)o(t\),)f(and)g(in)h(the)g(case)h(of)f
Fs(value)p Fw(,)f(w)o(e)h(\014nd)g(directly)h(that)636
2301 y Fs(value)g(F)m(ail)c Fw(=)g Fs(No)636 2351 y(value)k
Fw(\()p Fn(x)9 b Fs(`UnitOrElse`)e Fn(m)p Fw(\))12 b(=)g
Fs(Y)m(es)j Fn(x)183 2420 y Fw(So)e(as)h(w)o(e)g(exp)q(ected,)i(w)o(e)e
(can)g(implemen)o(t)d(the)k(bac)o(ktrac)o(king)e(monad)f(using)i
(lists.)p 183 2448 237 2 v 191 2475 a Fo(7)221 2491 y
Fv(It)d(is)h(the)f(second)i(equation)g(here)f(whic)o(h)g(distinguish)q
(es)i(bac)o(ktrac)o(king)g(from)d(exception)i(handling.)p
eop
%%Page: 16 16
16 15 bop 340 194 a Ft(6.2)48 b(Con)o(text-passing)13
b(Implemen)o(tat)o(ion)f(of)j(Bac)o(ktrac)o(king)340
270 y Fw(When)e(w)o(e)f(dev)o(elop)g(a)g(con)o(text-passing)g(implemen)
o(tation)d(of)i(bac)o(ktrac)o(king)h(w)o(e)g(ha)o(v)o(e)g(to)g(con-)340
319 y(sider)19 b(more)e(complex)f(forms)h(of)g(con)o(text)h(than)g(in)f
(section)i(5.2,)d(since)j(of)e(course)i(the)g(new)340
369 y(op)q(erations)f Fs(fail)g Fw(and)f Fs(or)n(else)g
Fw(ma)o(y)f(o)q(ccur)j(in)e(the)i(con)o(text)f(to)q(o.)f(But)i(just)f
(as)g(w)o(e)g(used)h(the)340 419 y(monad)13 b(la)o(ws)i(then)g(to)g
(express)h(all)e(con)o(texts)i(with)e(a)h(single)f(bind,)g(so)h(here)h
(w)o(e)f(can)g(use)h(the)340 469 y(monoidal)f(prop)q(erties)k(of)d
Fs(fail)h Fw(and)g Fs(or)n(else)g Fw(to)g(express)i(all)e(con)o(texts)h
(with)f(a)g(single)g Fs(or)n(else)p Fw(.)340 519 y(F)m(urthermore,)d(w)
o(e)g(need)h(not)e(consider)i(con)o(texts)g(with)f Fs(or)n(else)f
Fw(nested)i(inside)f Fs(bind)q Fw(,)f(b)q(ecause)597
597 y(\([)p Fq(\017)p Fw(])c Fs(`or)n(else`)f Fn(b)p
Fw(\))h Fs(`bind`)g Fn(k)j Fw(=)g(\([)p Fq(\017)p Fw(])d
Fs(`bind`)g Fn(k)q Fw(\))g Fs(`or)n(else`)f Fw(\()p Fn(b)h
Fs(`bind`)g Fn(k)q Fw(\))340 675 y(It)14 b(is)g(therefore)h(su\016cien)
o(t)g(to)f(consider)g(con)o(texts)h(of)f(the)g(form)835
753 y Fs(value)h Fw(\(\([)p Fq(\017)p Fw(])8 b Fs(`bind`)h
Fn(k)q Fw(\))h Fs(`or)n(else`)e Fn(b)p Fw(\))340 831
y(\(Remem)o(b)q(er)j(that)h(this)h(c)o(hoice)f(isn't)g(critical.)g(If)g
(w)o(e)g(mak)o(e)f(a)h(mistak)o(e)e(at)j(this)f(p)q(oin)o(t,)f(w)o(e)i
(will)340 881 y(disco)o(v)o(er)i(it)e(when)i(w)o(e)f(are)g(unable)g(to)
g(complete)f(the)h(deriv)n(ations)g(of)f(the)h(op)q(erators.\))403
931 y(Moreo)o(v)o(er,)h(w)o(e)h(ma)o(y)e(reasonably)h(guess)h(\(or)g
(disco)o(v)o(er)g(b)o(y)f(doing)g(the)h(deriv)n(ations\))f(that)340
981 y(uses)g(of)e Fn(k)i Fw(will)d(b)q(e)j(in)e(the)h(con)o(text)h
Fs(value)g Fw(\()p Fn(k)g(x)8 b Fs(`or)n(else`)g Fn(b)p
Fw(\))14 b(for)f(some)g Fn(x)g Fw(and)h Fn(b)p Fw(,)f(and)g(uses)i(of)e
Fn(b)340 1030 y Fw(will)g(b)q(e)h(in)g(the)g(con)o(text)h
Fs(value)g Fn(b)p Fw(.)e(W)m(e)h(will)e(therefore)j(represen)o(t)i(con)
o(texts)e(b)o(y)e(the)i(t)o(yp)q(e)473 1106 y Ft(data)g
Fs(Cxt)g Fn(a)f Fs(ans)e Fw(=)f Fs(VBO)k Fw(\()p Fn(a)d
Fq(!)f Fs(Mayb)n(e)k(ans)d Fq(!)f Fs(Mayb)n(e)16 b(ans)q
Fw(\))d(\()p Fs(Mayb)n(e)j(ans)q Fw(\))340 1182 y(where)624
1260 y(\()p Fq(8)p Fn(x;)7 b(b)724 1243 y Fh(0)735 1260
y Fn(:)748 1250 y Fw(^)747 1260 y Fn(k)15 b(x)e Fw(\()p
Fs(value)i Fn(b)962 1243 y Fh(0)974 1260 y Fw(\))d(=)f
Fs(value)16 b Fw(\()p Fn(k)e(x)9 b Fs(`or)n(else`)f Fn(b)1393
1243 y Fh(0)1405 1260 y Fw(\)\))636 1327 y Fq(\))j Fs(VBO)797
1316 y Fw(^)796 1327 y Fn(k)k Fw(\()p Fs(value)g Fn(b)p
Fw(\))c(=)h Fs(value)j Fw(\(\([)p Fq(\017)p Fw(])9 b
Fs(`bind`)g Fn(k)q Fw(\))g Fs(`or)n(else`)f Fn(b)p Fw(\))340
1405 y(The)19 b(an)o(teceden)o(t)h(sa)o(ys)e(that)g(uses)h(of)f
Fn(k)g Fw(of)g(the)h(form)d(w)o(e)i(exp)q(ect)i(can)e(b)q(e)h(represen)
o(ted)h(b)o(y)340 1455 y(applying)511 1444 y(^)510 1455
y Fn(k)q Fw(.)13 b(Since)i(w)o(e)f(plan)g(to)g(store)h(only)e(the)h
Fs(value)h Fw(of)e Fn(b)h Fw(and)g Fn(b)1421 1440 y Fh(0)1446
1455 y Fw(it)g(is)g(natural)f(to)h(require)340 1505 y(that)433
1494 y(^)432 1505 y Fn(k)i Fw(need)g(only)f(the)h(v)n(alue.)e(The)i
(conclusion)f(sa)o(ys)h(that)f(in)g(that)h(case,)g(the)f(con)o(texts)i
(w)o(e)340 1555 y(are)e(in)o(terested)g(in)f(can)g(b)q(e)g(represen)o
(ted)j(using)d Fs(VBO)p Fw(.)403 1605 y(No)o(w)h(assuming)f(that)773
1594 y(^)772 1605 y Fn(k)j Fw(has)e(the)i(prop)q(ert)o(y)f(in)f(the)h
(an)o(teceden)o(t)h(and)f(that)1636 1594 y(^)1637 1605
y Fn(b)e Fw(=)h Fs(value)g Fn(b)p Fw(,)340 1654 y(w)o(e)g(can)f(deriv)o
(e)444 1724 y Fs(unit)h Fn(x)f Fw(\()p Fs(VBO)693 1714
y Fw(^)692 1724 y Fn(k)727 1714 y Fw(^)729 1724 y Fn(b)o
Fw(\))e(=)g Fs(value)j Fw(\(\()p Fs(unit)g Fn(x)9 b Fs(`bind`)g
Fn(k)q Fw(\))h Fs(`or)n(else`)e Fn(b)p Fw(\))774 1774
y(=)k Fs(value)j Fw(\()p Fn(k)g(x)9 b Fs(`or)n(else`)f
Fn(b)p Fw(\))279 b([1st)14 b(monad)e(la)o(w)o(])774 1829
y(=)819 1818 y(^)818 1829 y Fn(k)j(x)e Fw(\()p Fs(value)j
Fn(b)p Fw(\))544 b([prop.)1715 1818 y(^)1714 1829 y Fn(k)q
Fw(])774 1884 y(=)819 1873 y(^)818 1884 y Fn(k)15 b(x)891
1873 y Fw(^)892 1884 y Fn(b)689 b Fw([prop.)1717 1873
y(^)1719 1884 y Fn(b)p Fw(])668 1975 y Fs(fail)13 b Fw(\()p
Fs(VBO)863 1964 y Fw(^)862 1975 y Fn(k)897 1964 y Fw(^)899
1975 y Fn(b)p Fw(\))e(=)h Fs(value)j Fw(\(\()p Fs(fail)9
b(`bind`)g Fn(k)q Fw(\))h Fs(`or)n(else`)e Fn(b)p Fw(\))944
2025 y(=)k Fs(value)j Fw(\()p Fs(fail)9 b(`or)n(else`)f
Fn(b)p Fw(\))944 2075 y(=)k Fs(value)j Fn(b)944 2130
y Fw(=)987 2119 y(^)988 2130 y Fn(b)340 2210 y Fw(The)k(deriv)n(ation)f
(of)g Fs(bind)g Fw(is)h(a)f(little)f(more)h(complicated)f(b)q(ecause)j
(of)e(the)h(more)e(complex)340 2260 y(prop)q(ert)o(y)e(that)601
2249 y(^)600 2260 y Fn(k)g Fw(satis\014es.)f(W)m(e)g(b)q(egin)g(in)f
(the)i(usual)e(w)o(a)o(y)m(,)473 2338 y(\()p Fn(m)d Fs(`bind`)f
Fn(f)t Fw(\))15 b(\()p Fs(VBO)825 2327 y Fw(^)824 2338
y Fn(k)859 2327 y Fw(^)861 2338 y Fn(b)p Fw(\))485 2388
y(=)d Fs(value)j Fw(\(\(\()p Fn(m)10 b Fs(`bind`)f Fn(f)t
Fw(\))h Fs(`bind`)f Fn(k)q Fw(\))h Fs(`or)n(else`)e Fn(b)p
Fw(\))485 2438 y(=)k Fs(value)j Fw(\(\()p Fn(m)10 b Fs(`bind`)f
Fw(\()p Fn(\025x)j Fq(!)f Fn(f)18 b(x)9 b Fs(`bind`)g
Fn(k)q Fw(\)\))h Fs(`or)n(else`)e Fn(b)p Fw(\))53 b([3rd)13
b(monad)g(la)o(w)o(])485 2492 y(=)f Fn(m)i Fw(\()p Fs(VBO)709
2481 y Fw(^)702 2492 y Fn(k)725 2480 y Fh(0)749 2481
y Fw(^)751 2492 y Fn(b)o Fw(\))p eop
%%Page: 17 17
17 16 bop 183 194 a Fw(pro)o(vided)360 183 y(^)353 194
y Fn(k)376 182 y Fh(0)402 194 y Fw(satis\014es)514 283
y(^)507 294 y Fn(k)530 282 y Fh(0)555 294 y Fn(x)14 b
Fw(\()p Fs(value)h Fn(b)734 277 y Fh(0)746 294 y Fw(\))c(=)h
Fs(value)j Fw(\(\()p Fn(f)k(x)9 b Fs(`bind`)g Fn(k)q
Fw(\))h Fs(`or)n(else`)e Fn(b)1343 277 y Fh(0)1354 294
y Fw(\))183 394 y(But)14 b(the)h(righ)o(t)e(hand)h(side)g(of)f(this)h
(equation)g(is)g(equal)f(to)728 494 y Fn(f)19 b(x)13
b Fw(\()p Fs(VBO)928 483 y Fw(^)927 494 y Fn(k)i Fw(\()p
Fs(value)g Fn(b)1105 477 y Fh(0)1117 494 y Fw(\)\))183
594 y(and)e(so)h(w)o(e)g(can)h(satisfy)e(the)i(condition)e(b)o(y)g
(taking)719 678 y(^)712 689 y Fn(k)735 677 y Fh(0)761
689 y Fn(x)803 678 y Fw(^)798 689 y Fn(b)816 677 y Fh(0)839
689 y Fw(=)f Fn(f)19 b(x)13 b Fw(\()p Fs(VBO)1083 678
y Fw(^)1082 689 y Fn(k)1123 678 y Fw(^)1119 689 y Fn(b)1137
677 y Fh(0)1149 689 y Fw(\))183 777 y(So)g(completing)f(the)j(deriv)n
(ation,)355 872 y(\()p Fn(m)10 b Fs(`bind`)f Fn(f)t Fw(\))15
b(\()p Fs(VBO)707 861 y Fw(^)705 872 y Fn(k)741 861 y
Fw(^)742 872 y Fn(b)p Fw(\))d(=)g Fn(m)i Fw(\()p Fs(VBO)h
Fw(\()p Fn(\025x)1087 861 y Fw(^)1083 872 y Fn(b)1101
860 y Fh(0)1124 872 y Fq(!)c Fn(f)18 b(x)c Fw(\()p Fs(VBO)1377
861 y Fw(^)1376 872 y Fn(k)1417 861 y Fw(^)1413 872 y
Fn(b)1431 860 y Fh(0)1442 872 y Fw(\)\))1487 861 y(^)1488
872 y Fn(b)p Fw(\))183 960 y(The)g(deriv)n(ation)f(of)g
Fs(or)n(else)g Fw(is)h(straigh)o(tforw)o(ard:)313 1055
y(\()p Fn(m)c Fs(`or)n(else`)e Fn(n)p Fw(\))14 b(\()p
Fs(VBO)691 1044 y Fw(^)690 1055 y Fn(k)725 1044 y Fw(^)727
1055 y Fn(b)p Fw(\))325 1105 y(=)e Fs(value)j Fw(\(\(\()p
Fn(m)10 b Fs(`or)n(else`)e Fn(n)p Fw(\))i Fs(`bind`)f
Fn(k)q Fw(\))g Fs(`or)n(else`)f Fn(b)p Fw(\))325 1155
y(=)k Fs(value)j Fw(\(\(\()p Fn(m)10 b Fs(`bind`)f Fn(k)q
Fw(\))h Fs(`or)n(else`)e Fw(\()p Fn(n)h Fs(`bind`)g Fn(k)q
Fw(\)\))g Fs(`or)n(else`)f Fn(b)p Fw(\))325 1205 y(=)k
Fs(value)j Fw(\(\()p Fn(m)10 b Fs(`bind`)f Fn(k)q Fw(\))g
Fs(`or)n(else`)f Fw(\(\()p Fn(n)i Fs(`bind`)f Fn(k)q
Fw(\))g Fs(`or)n(else`)f Fn(b)p Fw(\)\))53 b([asso)q(ciativit)o(y)o(])
325 1259 y(=)12 b Fn(m)i Fw(\()p Fs(VBO)543 1248 y Fw(^)542
1259 y Fn(k)h Fw(\()p Fs(value)g Fw(\(\()p Fn(n)10 b
Fs(`bind`)f Fn(k)q Fw(\))g Fs(`or)n(else`)f Fn(b)p Fw(\)\)\))209
b([prop.)13 b Fs(VBO)p Fw(])325 1314 y(=)f Fn(m)i Fw(\()p
Fs(VBO)543 1303 y Fw(^)542 1314 y Fn(k)h Fw(\()p Fn(n)f
Fw(\()p Fs(VBO)758 1303 y Fw(^)757 1314 y Fn(k)g Fw(\()p
Fs(value)i Fn(b)p Fw(\)\)\)\))341 b([prop.)13 b Fs(VBO)p
Fw(])325 1369 y(=)f Fn(m)i Fw(\()p Fs(VBO)543 1358 y
Fw(^)542 1369 y Fn(k)h Fw(\()p Fn(n)f Fw(\()p Fs(VBO)758
1358 y Fw(^)757 1369 y Fn(k)792 1358 y Fw(^)793 1369
y Fn(b)p Fw(\)\)\))183 1457 y(Finally)m(,)d(w)o(e)j(deriv)o(e)g
Fs(value)q Fw(:)529 1547 y Fs(value)i Fn(m)c Fw(=)g Fs(value)j
Fw(\()p Fn(m)10 b Fs(`or)n(else`)e(fail)o Fw(\))685 1597
y(=)k Fs(value)j Fw(\(\()p Fn(m)10 b Fs(`bind`)f(unit)15
b Fw(\))9 b Fs(`or)n(else`)f(fail)o Fw(\))685 1652 y(=)k
Fn(m)i Fw(\()p Fs(VBO)909 1641 y Fw(^)902 1652 y Fn(k)925
1640 y Fh(0)950 1652 y Fw(\()p Fs(value)h(fail)p Fw(\)\))685
1707 y(=)d Fn(m)i Fw(\()p Fs(VBO)909 1696 y Fw(^)902
1707 y Fn(k)925 1695 y Fh(0)950 1707 y Fs(No)p Fw(\))183
1795 y(pro)o(vided)577 1849 y(^)571 1860 y Fn(k)594 1848
y Fh(0)619 1860 y Fn(x)f Fw(\()p Fs(value)j Fn(b)798
1843 y Fh(0)809 1860 y Fw(\))c(=)g Fs(value)j Fw(\()p
Fs(unit)g Fn(x)9 b Fs(`or)n(else`)f Fn(b)1279 1843 y
Fh(0)1290 1860 y Fw(\))183 1948 y(But)16 b(the)h(righ)o(t)f(hand)g
(side)h(here)g(is)f(equal)g(to)g Fs(Y)m(es)e Fn(x)p Fw(,)i(so)g(w)o(e)h
(tak)o(e)f Fn(k)1299 1932 y Fh(0)1326 1948 y Fw(=)f Fn(\025x)1442
1937 y Fw(^)1437 1948 y Fn(b)1455 1936 y Fh(0)1482 1948
y Fq(!)g Fs(Y)m(es)g Fn(x)h Fw(to)183 1997 y(complete)d(the)h(deriv)n
(ation.)245 2050 y(W)m(e)d(can)g(simplify)e(the)j(de\014nitions)f
(sligh)o(tly)f(further)i(b)o(y)f(dropping)g(the)h Fs(VBO)f
Fw(constructor)183 2099 y(and)f(replacing)h(ev)o(ery)g(con)o(text)g
(argumen)o(t)f(b)o(y)g(t)o(w)o(o)g(argumen)o(ts,)1209
2088 y(^)1208 2099 y Fn(k)h Fw(and)1317 2088 y(^)1319
2099 y Fn(b)o Fw(.)g(Putting)f(the)h(results)183 2149
y(together,)g(w)o(e)f(obtain)g(the)h(de\014nitions)f(in)g(\014gure)h
(5,)e(a)h(con)o(tin)o(uation)g(passing)g(implemen)o(tatio)o(n)183
2199 y(of)j(bac)o(ktrac)o(king.)183 2303 y Fs(Exer)n(cise)7
b(2.)20 b Fw(Consider)15 b(the)f Fs(state)h(monad)p Fw(,)f(with)g
(additional)e(op)q(erations)753 2393 y Fs(fetch)f Fw(::)g
Fs(M)k(St)753 2443 y(stor)n(e)c Fw(::)f Fs(St)i Fq(!)f
Fs(M)k Fw(\(\))753 2492 y Fs(run)c Fw(::)g Fs(M)k Fn(a)d
Fq(!)f Fs(St)g Fq(!)g Fn(a)p eop
%%Page: 18 18
18 17 bop 454 226 a Fj(t)o(yp)q(e)15 b Fk(M)f Fl(a)f
Fk(ans)d Fv(=)g(\()p Fl(a)h Fi(!)g Fk(Mayb)n(e)i(ans)d
Fi(!)h Fk(Mayb)n(e)h(ans)o Fv(\))f Fi(!)g Fk(Mayb)n(e)h(ans)e
Fi(!)h Fk(Mayb)n(e)i(ans)454 275 y(unit)f Fl(x)570 265
y Fv(^)569 275 y Fl(k)601 265 y Fv(^)603 275 y Fl(b)f
Fv(=)671 265 y(^)670 275 y Fl(k)j(x)738 265 y Fv(^)739
275 y Fl(b)454 325 y Fv(\()p Fl(m)8 b Fk(`bind`)f Fl(f)t
Fv(\))665 315 y(^)664 325 y Fl(k)697 315 y Fv(^)698 325
y Fl(b)k Fv(=)g Fl(m)i Fv(\()p Fl(\025x)889 315 y Fv(^)884
325 y Fl(b)900 314 y Ff(0)923 325 y Fi(!)e Fl(f)16 b(x)1043
315 y Fv(^)1042 325 y Fl(k)1080 315 y Fv(^)1076 325 y
Fl(b)1092 314 y Ff(0)1103 325 y Fv(\))1130 315 y(^)1131
325 y Fl(b)454 374 y Fk(fail)521 364 y Fv(^)520 374 y
Fl(k)552 364 y Fv(^)554 374 y Fl(b)11 b Fv(=)620 364
y(^)621 374 y Fl(b)454 424 y Fv(\()p Fl(m)d Fk(`or)n(else`)f
Fl(n)p Fv(\))690 414 y(^)689 424 y Fl(k)721 414 y Fv(^)723
424 y Fl(b)k Fv(=)f Fl(m)838 414 y Fv(^)837 424 y Fl(k)k
Fv(\()p Fl(n)923 414 y Fv(^)922 424 y Fl(k)954 414 y
Fv(^)956 424 y Fl(b)p Fv(\))454 473 y Fk(value)e Fl(m)f
Fv(=)f Fl(m)j Fv(\()p Fl(\025x)761 463 y Fv(^)757 473
y Fl(b)773 462 y Ff(0)795 473 y Fi(!)e Fk(Y)m(es)i Fl(x)p
Fv(\))f Fk(No)340 600 y Fj(Fig.)7 b(5.)13 b Fv(A)g(Con)o(text-passing)i
(Implemen)o(tation)g(of)e(Bac)o(ktrac)o(king.)340 740
y Fw(satisfying)646 822 y Fs(fetch)c(`bind`)h Fn(\025s)i
Fq(!)f Fs(stor)n(e)j Fn(s)e Fw(=)g Fs(unit)j Fw(\(\))633
884 y Fs(stor)n(e)g Fn(s)9 b Fs(`bind`)h Fn(\025)p Fw(\(\))i
Fq(!)f Fs(fetch)g Fw(=)h Fs(stor)n(e)i Fn(s)c Fs(`bind`)f
Fn(\025)p Fw(\(\))j Fq(!)f Fs(unit)k Fn(s)587 947 y Fs(stor)n(e)f
Fn(s)c Fs(`bind`)f Fn(\025)p Fw(\(\))j Fq(!)f Fs(stor)n(e)j
Fn(s)1069 929 y Fh(0)1093 947 y Fw(=)e Fs(stor)n(e)i
Fn(s)1257 929 y Fh(0)827 1009 y Fs(run)h Fw(\()p Fs(unit)g
Fn(x)p Fw(\))f Fn(s)e Fw(=)g Fn(x)707 1071 y Fs(run)j
Fw(\()p Fs(fetch)9 b(`bind`)g Fn(f)t Fw(\))15 b Fn(s)d
Fw(=)g Fs(run)j Fw(\()p Fn(f)k(s)p Fw(\))14 b Fn(s)660
1133 y Fs(run)h Fw(\()p Fs(stor)n(e)g Fn(s)10 b Fs(`bind`)f
Fn(f)t Fw(\))14 b Fn(s)1069 1116 y Fh(0)1093 1133 y Fw(=)e
Fs(run)j Fw(\()p Fn(f)k Fw(\(\)\))14 b Fn(s)340 1215
y Fw(Deriv)o(e)g(term)g(and)f(con)o(text)i(passing)f(implem)o(en)o
(tations)d(of)j(these)h(op)q(erations.)340 1347 y Fu(7)56
b(Sp)r(ecifying)17 b(Prett)n(y-prin)n(ting)340 1443 y
Fw(No)o(w)12 b(w)o(e)g(shall)f(return)j(to)d(our)h(case)h(study:)f
(prett)o(y-prin)o(ting.)g(Before)h(w)o(e)f(can)g(start)h(to)f(deriv)o
(e)340 1493 y(implemen)o(tations)d(of)i(the)h(prett)o(y-prin)o(ting)g
(com)o(binators)e(w)o(e)i(m)o(ust)f(dev)o(elop)g(a)h(sp)q
(eci\014cation.)340 1543 y(But)f(in)e(this)g(case,)h(it)g(isn't)f(in)o
(tuitiv)o(ely)f(ob)o(vious)h(what)g(la)o(ws)g(the)h(prett)o(y-prin)o
(ting)g(com)o(binators)340 1592 y(should)16 b(satisfy!)e(W)m(e)h(need)h
(some)f(w)o(a)o(y)f(to)i(guide)f(our)g(in)o(tuition,)f(to)h(lead)g(us)h
(to)f(write)g(do)o(wn)340 1642 y(the)g Fs(right)e Fw(la)o(ws)g(for)h
(the)g(com)o(binators.)403 1692 y(In)f(mathematics,)e(w)o(e)j(often)g
(guide)g(our)f(in)o(tuition)g(with)g(the)h(help)g(of)f(an)h(example.)e
(If)h(w)o(e)340 1742 y(are)j(form)o(ulating)c(h)o(yp)q(othesis)k(ab)q
(out)f(certain)h(top)q(ological)d(spaces,)j(w)o(e)f(migh)o(t)e(think)i
(ab)q(out)340 1792 y(the)c(reals.)f(It)g(is)f(ev)o(en)i(more)e(imp)q
(ortan)o(t)f(when)i(form)o(ulating)d(a)j(new)g(concept,)h(suc)o(h)f(as)
g(a)g(group,)340 1841 y(to)17 b(ha)o(v)o(e)f(a)g(concrete)j(mo)q(del)c
(in)h(mind.)e(W)m(e)i(are)h(trying)f(to)g(form)o(ulate)f(a)h(theory)h
(of)f(prett)o(y-)340 1891 y(prin)o(ting,)e(but)h(as)g(y)o(et)h(w)o(e)f
(ha)o(v)o(e)g(no)f(mo)q(del)g(to)h(guide)f(us.)h(So)g(w)o(e)g(shall)g
(start)g(o\013)g(b)o(y)g(lo)q(oking)340 1941 y(for)k(an)f(abstract)i
(mo)q(del)d(of)h(do)q(cumen)o(ts,)g(on)h(whic)o(h)f(w)o(e)h(can)g
(agree)g(what)g(the)g(b)q(eha)o(viour)340 1991 y(of)c(the)i(com)o
(binators)d(should)h(b)q(e.)h(Our)g(mo)q(del)e(will)g(not)h(b)q(e)i(|)e
(and)g(is)g(not)h(in)o(tended)g(to)g(b)q(e)340 2041 y(|)d(a)g
(reasonable)h(implemen)o(tation,)c(but)j(it)g(can)h(b)q(e)g(though)o(t)
f(of)g(as)h(a)f(kind)g(of)g(`denotational)340 2090 y(seman)o(tics')c
(for)h(the)g(com)o(binators.)e(Using)h(the)h(mo)q(del)f(w)o(e)h(can)g
(establish)f(algebraic)h(prop)q(erties)340 2140 y(whic)o(h)h(the)g(com)
o(binators)f(should)g(satisfy)h(|)f(in)h Fs(any)g Fw(implemen)o(tatio)o
(n.)d(And)j(then)g(once)h(these)340 2190 y(prop)q(erties)20
b(are)f(established,)f(w)o(e)h(can)g(use)g(them)e(as)i(in)f(the)g
(previous)h(sections)h(to)e(deriv)o(e)340 2240 y(implemen)o(tations.)
340 2361 y Ft(7.1)48 b(Abstract)15 b(La)o(y)o(outs)340
2441 y Fw(W)m(e'll)d(b)q(egin)h(b)o(y)g(lo)q(oking)f(for)h(an)g
(abstract)h(mo)q(del)e(of)h(a)g(prett)o(y-prin)o(ter's)h(output)g(|)e
(that)i(is,)340 2491 y(prettily)e(inden)o(ted)h(text.)f(W)m(e)f(could)h
(sa)o(y)f(that)h(the)h(output)f(is)f(just)i(a)e(string,)g(but)i(a)e
(string)h(has)p eop
%%Page: 19 19
19 18 bop 183 194 a Fw(so)13 b(little)g(structure)i(that)f(w)o(e)f(can)
h(deriv)o(e)f(no)g(in)o(tuition)f(from)g(it.)g(Let)i(us)g(sa)o(y)f
(instead,)g(that)h(a)183 244 y Fs(layout)g Fw(is)f(a)h(sequence)i(of)d
(inden)o(ted)i(lines,)e(whic)o(h)h(w)o(e)g(can)g(mo)q(del)f(as)663
321 y Ft(t)o(yp)q(e)i Fs(L)n(ayout)e Fw(=)e([\()p Fs(Int)p
Fn(;)c Fs(String)o Fw(\)])1186 306 y Fr(+)183 399 y Fw(Notice)15
b(that)f(w)o(e)h(shall)e(allo)o(w)g(inden)o(tations)h(to)h(b)q(e)g
(negativ)o(e:)e(later)i(on)f(this)h(will)e(con)o(tribute)183
449 y(to)h(a)h(nicer)h(algebra,)d(just)j(as)f(in)o(tegers)g(ha)o(v)o(e)
g(a)g(nicer)g(algebra)g(than)f(natural)h(n)o(um)o(b)q(ers.)f(But)183
498 y(notice)j(also)g(that)g(w)o(e)h(restrict)g(la)o(y)o(outs)f(to)g(b)
q(e)h Fs(non-empty)g Fw(\(w)o(e)f(use)h([)p Fq(\000)p
Fw(])1378 483 y Fr(+)1423 498 y Fw(for)e(the)i(t)o(yp)q(e)g(of)183
548 y(non-empt)o(y)12 b(lists\).)i(W)m(e'll)e(return)j(to)f(this)g(p)q
(oin)o(t)f(b)q(elo)o(w.)245 598 y(W)m(e)g(can)i(no)o(w)e(sp)q(ecify)h
Fs(text)p Fw(,)g Fs(nest)g Fw(and)f(\($$\))h(v)o(ery)g(easily:)664
675 y Fs(text)h Fn(s)d Fw(=)g([\(0)p Fn(;)7 b(s)p Fw(\)])664
725 y Fs(nest)15 b Fn(k)g(l)e Fw(=)f([\()p Fn(i)d Fw(+)g
Fn(k)q(;)e(s)p Fw(\))p Fq(j)p Fw(\()p Fn(i;)g(s)p Fw(\))12
b Fq( )f Fn(l)q Fw(])664 775 y Fn(l)676 781 y Fr(1)705
775 y Fw($$)d Fn(l)767 781 y Fr(2)798 775 y Fw(=)k Fn(l)854
781 y Fr(1)882 775 y Fw(+)-12 b(+)p Fn(l)946 781 y Fr(2)183
853 y Fw(The)17 b(righ)o(t)g(de\014nition)f(of)g(horizon)o(tal)g(comp)q
(osition)g(\()-7 b Fn(<)g(>)g Fw(\))17 b(is)g(not)g(so)g(ob)o(vious.)f
(The)h(desired)183 903 y(b)q(eha)o(viour)10 b(is)g(clear)h(enough)f
(when)h Fs(text)k Fn(s)c Fw(is)f(placed)g(b)q(eside)i
Fs(text)j Fn(t)p Fw(,)9 b(but)i(what)f(if)g(b)q(oth)g(la)o(y)o(outs)183
952 y(are)k(inden)o(ted?)g(What)g(if)f(the)h(argumen)o(ts)f(o)q(ccup)o
(y)i(more)e(than)g(one)i(line)e(eac)o(h?)245 1002 y(Our)h(c)o(hoice)h
(is)e(guided)h(b)o(y)g(the)g(follo)o(wing)e(principles:)209
1080 y Ft({)20 b Fw(The)d(t)o(w)o(o)f(dimensional)f(structure)k(of)d
(eac)o(h)h(argumen)o(t)e(should)i(b)q(e)g(preserv)o(ed;)h(that)f(is,)
253 1130 y(the)f(app)q(earance)g(of)e Fn(x)e(<)-7 b(>)14
b(y)j Fw(on)d(the)i(page)e(should)h(consist)g(of)f(some)g(com)o
(bination)f(of)h(a)253 1180 y(translation)f(of)h Fn(x)f
Fw(and)h(a)g(translation)f(of)g Fn(y)q Fw(.)209 1229
y Ft({)20 b Fw(Our)15 b(in)o(ten)o(tion)f(is)h(that)g(a)f(la)o(y)o(out)
f(is)i(just)g(a)f(prett)o(y)h(w)o(a)o(y)f(of)g(displa)o(ying)f(a)i
(string.)f(What)253 1279 y(string?)g(W)m(e)f(de\014ne)682
1354 y Fs(string)e Fw(::)g Fs(L)n(ayout)h Fq(!)f Fs(String)682
1404 y(string)k Fn(l)d Fw(=)g Fs(foldr1)j Fw(\()-7 b
Fq(\010)g Fw(\))14 b(\()p Fs(map)i(snd)e Fn(l)q Fw(\))710
1454 y Ft(where)29 b Fn(s)10 b Fq(\010)f Fn(t)j Fw(=)g
Fn(s)d Fw(+)-12 b(+)p Fp(\\)15 b(")9 b Fw(+)-12 b(+)p
Fn(t)253 1532 y Fw(\(W)m(e)13 b(in)o(terpret)i(a)e(line)g(break)h(as)f
(white)h(space)g(|)f(equiv)n(alen)o(t)f(to)i(a)f(single)g(space\).)h
(Then)253 1581 y(w)o(e)19 b(exp)q(ect)g(that)g Fs(string)14
b Fw(\()p Fn(x)19 b(<)-7 b(>)19 b(y)q Fw(\))h(=)f Fs(string)14
b Fn(x)e Fw(+)-9 b(+)p Fs(string)15 b Fn(y)q Fw(.)k(This)f(prop)q(ert)o
(y)h(enables)253 1631 y(the)c(programmer)e(to)h(predict)i(the)f(string)
g(that)g Fn(x)d(<)-7 b(>)14 b(y)i Fw(represen)o(ts,)h(without)d
(thinking)253 1681 y(ab)q(out)g(ho)o(w)f Fn(x)h Fw(and)g
Fn(y)h Fw(are)g(laid)d(out.)209 1731 y Ft({)20 b Fw(Inden)o(tation)c
(cannot)g(app)q(ear)g(in)g(the)g(middle)e(of)h(a)h(line)f(|)h(since)g
(our)g(abstract)h(mo)q(del)253 1781 y(\(fortunately\))d(cannot)g
(represen)o(t)i(this.)183 1858 y(There)f(is)f(really)g(only)g(one)g(c)o
(hoice)h(for)f(\()-7 b Fn(<)g(>)g Fw(\))15 b(that)g(meets)f(these)i
(three)g(criteria:)e(to)g(translate)183 1908 y(the)f(second)h(op)q
(erand)g(so)f(that)g(its)g(\014rst)h(c)o(haracter)g(abuts)f(against)g
(the)g(last)g(c)o(haracter)h(of)f(the)183 1958 y(\014rst)h(op)q(erand.)
g(F)m(ormally)m(,)264 2036 y(\()p Fn(x)9 b Fw(+)-12 b(+[\()p
Fn(i;)7 b(s)p Fw(\)]\))12 b Fn(<)-7 b(>)12 b Fw(\([\()p
Fn(j;)7 b(t)p Fw(\)])h(+)-12 b(+)p Fn(y)q Fw(\))14 b(=)e
Fn(x)d Fw(+)-12 b(+[\()p Fn(i;)7 b(s)j Fw(+)-12 b(+)p
Fn(t)p Fw(\)])10 b(+)-12 b(+)p Fs(nest)16 b Fw(\()p Fn(i)10
b Fw(+)f Fs(length)15 b Fn(s)10 b Fq(\000)f Fn(j)r Fw(\))15
b Fn(y)183 2113 y Fw(T)m(o)e(see)i(that)f(the)g(de\014nition)g(is)g
(reasonable,)f(consider)i(the)g(follo)o(wing)c(t)o(w)o(o)i(examples:)p
685 2182 98 2 v 684 2232 2 50 v 691 2217 a Fp(one:)p
782 2232 V 685 2233 98 2 v 31 w Fn(<)-7 b(>)p 864 2157
100 2 v 863 2207 2 50 v 870 2192 a Fp(t)o(w)o(o)p 962
2207 V 863 2257 V 870 2242 a(three)p 961 2257 V 864 2258
100 2 v 974 2217 a Fw(=)p 1018 2157 197 2 v 1017 2257
2 100 v 1024 2192 a Fp(one:)20 b(t)o(w)o(o)1116 2242
y(three)p 1214 2257 V 1018 2258 197 2 v 617 2277 242
2 v 616 2326 2 50 v 623 2312 a(while)15 b(x)p Fn(>)p
Fp(0)f(do)p 858 2326 V 616 2376 V 651 2361 a(x)g(:=)f(x-2)p
858 2376 V 617 2378 242 2 v 870 2337 a Fn(<)-7 b(>)p
940 2302 24 2 v 939 2351 2 50 v 946 2336 a Fp(;)p 963
2351 V 940 2353 24 2 v 974 2337 a Fw(=)p 1018 2277 242
2 v 1017 2326 2 50 v 1024 2312 a Fp(while)15 b(x)p Fn(>)p
Fp(0)f(do)p 1259 2326 V 1017 2376 V 1052 2361 a(x)g(:=)f(x-2;)p
1259 2376 V 1018 2378 242 2 v 183 2441 a Fw(So)e(at)h(least)f(in)h
(cases)h(where)f(one)g(of)f(the)h(op)q(erands)h(is)f(a)f(single)g
(line,)g(the)h(result)h(is)e(reasonable)183 2491 y(and)i(useful.)p
eop
%%Page: 20 20
20 19 bop 403 194 a Fw(No)o(w)13 b(lo)q(ok)f(again)g(at)h(the)h(formal)
c(de\014nition)j(of)g(\()-7 b Fn(<)g(>)g Fw(\).)14 b(It)f(is)g(only)f
(de\014ned)j(for)d(non-empt)o(y)340 244 y(argumen)o(ts!)f(This)i(is)f
(the)g(reason)h(for)f(the)h(restriction)g(to)f(non-empt)o(y)f(la)o(y)o
(outs)h(that)g(w)o(e)g(made)340 293 y(ab)q(o)o(v)o(e:)k(there)i(is)e
(simply)e(no)i(sensible)h(de\014nition)f(of)g(\()-7 b
Fn(<)g(>)g Fw(\))17 b(for)f(empt)o(y)g(argumen)o(ts.)f(The)i(re-)340
343 y(striction)i(is)f(unfortunate:)g(the)h(empt)o(y)e(la)o(y)o(out)g
(w)o(ould)g(b)q(e)i(a)f(unit)g(for)29 b($$)12 b(,)18
b(so)g(impro)o(ving)340 393 y(the)e(com)o(binator)e(algebra,)g(and)h
(moreo)o(v)o(er)f(w)o(ould)h(b)q(e)g(useful)h(in)e(practice.)i(But)g
(if)e(w)o(e)i(allo)o(w)340 443 y(empt)o(y)e(la)o(y)o(outs)g(and)h
(simply)e(mak)o(e)h(some)g(arbitrary)g(c)o(hoice)i(for)e(the)i(v)n
(alue)e(of)h Fn(<)-7 b(>)15 b Fw(in)g(these)340 493 y(cases,)i(man)o(y)
d(algebraic)i(la)o(ws)g(in)o(v)o(olving)d Fn(<)-7 b(>)17
b Fw(cease)g(to)f(hold.)f(A)h(w)o(a)o(y)g(out)g(of)f(the)i(dilemm)o(a)
340 542 y(w)o(ould)c(b)q(e)i(to)e(allo)o(w)g(empt)o(y)f(la)o(y)o(outs,)
h(and)g(de\014ne)i Fn(<)-7 b(>)15 b Fw(to)e(b)q(e)i(a)e(partial)g(op)q
(erator.)h(But)g(since)340 592 y(this)g(w)o(ould)f(complicate)g(the)h
(dev)o(elopmen)o(t)f(w)o(e)i(ha)o(v)o(e)e(not)h(done)g(so.)340
718 y Ft(7.2)48 b(The)16 b(Algebra)e(of)h(La)o(y)o(outs)340
802 y Fw(No)o(w)20 b(that)f(w)o(e)h(ha)o(v)o(e)f(formal)f
(de\014nitions)h(of)g(the)h(la)o(y)o(out)f(op)q(erators)h(w)o(e)g(can)g
(study)g(their)340 852 y(algebra.)12 b(The)h(la)o(ws)g(in)f(\014gure)h
(6)g(are)g(easily)f(pro)o(v)o(ed,)h(although)f(the)h(pro)q(ofs)g(are)g
(not)g(included)340 902 y(here.)810 1072 y Fv(\()p Fl(x)e(<)-6
b(>)10 b(y)q Fv(\))h Fl(<)-6 b(>)10 b(z)j Fv(=)e Fl(x)g(<)-6
b(>)10 b Fv(\()p Fl(y)i(<)-6 b(>)10 b(z)r Fv(\))849 1130
y(\()p Fl(x)e Fv($$)h Fl(y)q Fv(\))g($$)g Fl(z)k Fv(=)e
Fl(x)e Fv($$)g(\()p Fl(y)g Fv($$)g Fl(z)r Fv(\))842 1188
y Fl(x)h(<)-6 b(>)10 b Fk(text)j Fe(\\")f Fv(=)f Fl(x)809
1247 y Fk(nest)h Fl(k)i Fv(\()p Fl(x)8 b Fv($$)h Fl(y)q
Fv(\))j(=)f Fk(nest)i Fl(k)h(x)8 b Fv($$)h Fk(nest)j
Fl(k)i(y)789 1305 y Fk(nest)f Fl(k)h Fv(\()p Fl(x)c(<)-6
b(>)10 b(y)q Fv(\))i(=)f Fk(nest)i Fl(k)h(x)c(<)-6 b(>)10
b(y)819 1363 y(x)h(<)-6 b(>)10 b Fk(nest)i Fl(k)i(y)f
Fv(=)e Fl(x)g(<)-6 b(>)10 b(y)758 1421 y Fk(nest)i Fl(k)i
Fv(\()p Fk(nest)e Fl(k)990 1403 y Ff(0)1014 1421 y Fl(x)p
Fv(\))g(=)f Fk(nest)i Fv(\()p Fl(k)c Fv(+)g Fl(k)1290
1403 y Ff(0)1301 1421 y Fv(\))k Fl(x)916 1479 y Fk(nest)f
Fv(0)h Fl(x)f Fv(=)f Fl(x)830 1537 y Fv(\()p Fl(x)d Fv($$)h
Fl(y)q Fv(\))i Fl(<)-6 b(>)10 b(z)j Fv(=)e Fl(x)e Fv($$)g(\()p
Fl(y)i(<)-6 b(>)10 b(z)r Fv(\))542 1595 y Fk(text)i Fl(s)f(<)-6
b(>)10 b Fv(\(\()p Fk(text)i Fe(\\")f Fl(<)-6 b(>)10
b(y)q Fv(\))f($$)g Fl(z)r Fv(\))i(=)g(\()p Fk(text)i
Fl(s)d(<)-6 b(>)10 b(y)q Fv(\))f($$)g Fk(nest)j Fv(\()p
Fk(length)g Fl(s)p Fv(\))h Fl(z)796 1653 y Fk(text)f
Fl(s)f(<)-6 b(>)10 b Fk(text)i Fl(t)g Fv(=)f Fk(text)i
Fv(\()p Fl(s)8 b Fv(+)-11 b(+)p Fl(t)p Fv(\))340 1816
y Fj(Fig.)7 b(6.)13 b Fv(Algebraic)i(la)o(ws)f(for)e(la)o(y)o(out)j(op)
q(erations.)403 1968 y Fw(First,)9 b(b)q(oth)g Fn(<)-7
b(>)10 b Fw(and)f($$)g(are)h(asso)q(ciativ)o(e,)e(and)i
Fn(<)-7 b(>)9 b Fw(has)h Fs(text)15 b Fp(\\")8 b Fw(as)i(a)f(righ)o(t)g
(unit.)f(Ho)o(w)o(ev)o(er,)340 2018 y Fn(<)-7 b(>)18
b Fw(has)e(no)h(left)f(unit)h(b)q(ecause)h(the)f(inden)o(tation)f(of)g
(the)i(second)g(op)q(erand)f(is)f(alw)o(a)o(ys)g(lost.)340
2068 y(F)m(or)e(example,)872 2155 y Fs(text)h Fp(\\")c
Fn(<)-7 b(>)p 1075 2119 123 2 v 1074 2169 2 50 v 1137
2154 a Fp(fo)q(o)p 1198 2169 V 1075 2171 123 2 v 1209
2155 a Fw(=)p 1253 2119 67 2 v 1252 2169 2 50 v 1259
2154 a Fp(fo)q(o)p 1320 2169 V 1253 2171 67 2 v 340 2241
a Fw(Since)15 b(w)o(e)f(excluded)h(empt)o(y)e(la)o(y)o(outs,)21
b($$)i(has)14 b(no)g(units)g(at)f(all.)403 2292 y(The)j(inden)o(tation)
g(com)o(binator)e Fs(nest)i Fw(distributes)h(o)o(v)o(er)27
b($$)11 b(,)k(and)h(distributes)h(o)o(v)o(er)g Fn(<)-7
b(>)340 2341 y Fw(on)17 b(the)g(left.)f(W)m(e)g(do)g(not)g(need)i(to)e
(inden)o(t)h(the)g(righ)o(t)f(op)q(erand)h(of)f Fn(<)-7
b(>)17 b Fw(here,)g(b)q(ecause)h(it)e(is)340 2391 y(translated)i(to)f
(abut)g(against)g(the)h(left)f(op)q(erand)g(and)g(so)h(its)f(inden)o
(tation)f(is)h(lost.)g(F)m(or)g(the)340 2441 y(same)f(reason)h
Fs(nest)f Fw(can)h(b)q(e)f(cancelled)h(to)f(the)h(righ)o(t)f(of)g
Fn(<)-7 b(>)p Fw(.)16 b(Of)g(course)i(consecutiv)o(e)g
Fs(nest)p Fw(s)340 2491 y(can)c(b)q(e)h(com)o(bined,)d(and)i
Fs(nest)p Fw(ing)f(b)o(y)h(zero)h(is)e(the)i(iden)o(tit)o(y)e(op)q
(eration.)p eop
%%Page: 21 21
21 20 bop 245 194 a Fw(Moreo)o(v)o(er)20 b($$)g(and)13
b Fn(<)-7 b(>)13 b Fw(are)g(related)h(to)f(one)g(another)g(b)o(y)g(a)f
(kind)h(of)f(asso)q(ciativ)o(e)h(la)o(w:)e(w)o(e)183
244 y(ma)o(y)h(sa)o(y)h(they)i(`asso)q(ciate)f(with')f(one)h(another.)g
(F)m(or)f(example,)584 379 y(\()p 600 344 32 2 v 599
394 2 50 v 6 w Fp(a)p 631 394 V 600 396 32 2 v 15 w Fw($$)p
692 344 34 2 v 691 394 2 50 v 15 w Fp(b)p 724 394 V 692
396 34 2 v 6 w Fw(\))f Fn(<)-7 b(>)p 822 319 V 821 369
2 50 v 828 354 a Fp(c)p 854 369 V 821 419 V 828 404 a(d)p
854 419 V 822 420 34 2 v 867 379 a Fw(=)p 910 294 57
2 v 909 344 2 50 v 916 329 a Fp(a)p 966 344 V 909 394
V 916 379 a(b)q(c)p 966 394 V 909 444 V 939 429 a(d)p
965 444 V 910 445 57 2 v 978 379 a Fw(=)p 1022 344 32
2 v 1021 394 2 50 v 18 w Fp(a)p 1053 394 V 1022 396 32
2 v 15 w Fw($$)8 b(\()p 1129 344 34 2 v 1128 394 2 50
v 6 w Fp(b)p 1161 394 V 1129 396 34 2 v 18 w Fn(<)-7
b(>)p 1243 319 V 1242 369 2 50 v 1249 354 a Fp(c)p 1276
369 V 1242 419 V 1249 404 a(d)p 1275 419 V 1243 420 34
2 v 1276 379 a Fw(\))183 515 y(On)14 b(the)g(other)h(hand,)671
566 y(\()p Fn(x)d(<)-7 b(>)12 b(y)q Fw(\))e($$)f Fn(z)k
Fq(6)p Fw(=)f Fn(x)f(<)-7 b(>)13 b Fw(\()p Fn(y)e Fw($$)e
Fn(z)r Fw(\))183 641 y(Here)15 b(the)f(inden)o(tation)g(of)f
Fn(z)j Fw(is)d(di\013eren)o(t)i(in)f(the)g(t)o(w)o(o)g(cases:)g(for)g
(example,)535 752 y(\()p 551 716 32 2 v 550 766 2 50
v 557 751 a Fp(a)p 582 766 V 551 768 32 2 v 594 752 a
Fn(<)-7 b(>)p 663 716 34 2 v 662 766 2 50 v 669 751 a
Fp(b)p 695 766 V 663 768 34 2 v 696 752 a Fw(\))10 b($$)p
772 716 31 2 v 771 766 2 50 v 778 751 a Fp(c)p 801 766
V 772 768 31 2 v 814 752 a Fw(=)p 858 691 54 2 v 857
741 2 50 v 864 726 a Fp(ab)p 910 741 V 857 791 V 864
776 a(c)p 910 791 V 858 793 54 2 v 922 752 a Fq(6)p Fw(=)p
966 691 V 965 741 2 50 v 972 726 a Fp(ab)p 1018 741 V
965 791 V 995 776 a(c)p 1018 791 V 966 793 54 2 v 1031
752 a Fw(=)p 1075 716 32 2 v 1074 766 2 50 v 1081 751
a Fp(a)p 1106 766 V 1075 768 32 2 v 1118 752 a Fn(<)-7
b(>)12 b Fw(\()p 1203 716 34 2 v 1202 766 2 50 v 1209
751 a Fp(b)p 1235 766 V 1203 768 34 2 v 1245 752 a Fw($$)p
1296 716 31 2 v 1295 766 2 50 v 1302 751 a Fp(c)p 1325
766 V 1296 768 31 2 v 1326 752 a Fw(\))183 863 y(It)f(is)g(the)h
(failure)e(of)h(this)g(la)o(w)g(to)g(hold)f(that)i(mak)o(es)e(the)h
(prett)o(y-prin)o(ting)h(algebra)e(in)o(teresting!)183
912 y(W)m(e)18 b(ha)o(v)o(e)h(to)g(ha)o(v)o(e)f(some)g(w)o(a)o(y)h(to)f
(transform)g(expressions)j(of)d(the)i(form)d Fn(x)i(<)-7
b(>)21 b Fw(\()p Fn(y)15 b Fw($$)d Fn(z)r Fw(\),)183
962 y(and)k(w)o(e)h(can)f(in)g(the)h(sp)q(ecial)g(case)g(when)g(w)o(e)g
(kno)o(w)f(the)h(p)q(osition)f(where)i Fn(x)e Fw(ends,)h(and)f(the)183
1012 y(inden)o(tation)d(of)h(the)h(\014rst)g(line)f(of)f
Fn(y)q Fw(.)i(F)m(or)f(example,)e(when)j Fn(x)f Fw(is)g(just)g(a)g
Fs(text)p Fw(,)g(and)g Fn(y)i Fw(is)e(of)g(the)183 1062
y(form)e Fs(text)j Fp(\\")c Fn(<)-7 b(>)12 b(y)505 1047
y Fh(0)517 1062 y Fw(.)i(The)g(follo)o(wing)d(la)o(w)i(is)h(su\016cien)
o(t:)339 1148 y Fs(text)h Fn(s)d(<)-7 b(>)12 b Fw(\(\()p
Fs(text)j Fp(\\")c Fn(<)-7 b(>)12 b(y)q Fw(\))f($$)d
Fn(z)r Fw(\))k(=)g(\()p Fs(text)j Fn(s)d(<)-7 b(>)12
b(y)q Fw(\))e($$)f Fs(nest)15 b Fw(\()p Fs(length)g Fn(s)p
Fw(\))g Fn(z)183 1235 y Fw(One)g(migh)o(t)e(sa)o(y)h(that)h(the)h
(di\016cult)e(part)h(of)f(prett)o(y-prin)o(ting)g(is)h(transforming)e
(expressions)183 1285 y(so)h(that)g(this)g(la)o(w)e(is)i(applicable.)
245 1335 y(Finally)e(there)j(is)f(a)g(simple)e(la)o(w)h(relating)g
Fn(<)-7 b(>)15 b Fw(and)f Fs(text)o Fw(.)245 1385 y(In)i(a)f(sense)i
(these)g(la)o(ws)f(completely)e(sp)q(ecify)i(the)h(baha)o(viour)d(of)h
(the)h(la)o(y)o(out)f(op)q(erators:)183 1435 y(an)o(y)d(t)o(w)o(o)g
(closed)i(terms)e(whic)o(h)h(denote)h(the)f(same)f(la)o(y)o(out)g(can)h
(b)q(e)g(pro)o(v)o(ed)g(equal)f(using)h(these)183 1485
y(la)o(ws.)183 1569 y Fs(Exer)n(cise)7 b(3.)20 b Fw(Pro)o(v)o(e)c(this)
f(remark,)g(b)o(y)g(c)o(ho)q(osing)g(a)g(canonical)g(form)f(for)h(la)o
(y)o(out)f(expressions)183 1618 y(suc)o(h)h(that)h(ev)o(ery)f(la)o(y)o
(out)f(is)h(denoted)h(b)o(y)f(a)g(unique)g(canonical)f(form,)f(and)i(b)
o(y)g(deriving)f(im-)183 1668 y(plemen)o(tations)e(of)i(the)g(op)q
(erators)h(that)f(map)e(canonical)h(forms)g(to)g(canonical)h(forms.)183
1769 y Fs(R)n(emark)i(on)h(the)g(b)n(ene\014ts)g(of)g(a)g(formal)f
(appr)n(o)n(ach:)23 b Fw(This)16 b(formal)d(sp)q(eci\014cation)k(of)e
(the)i(la)o(y-)183 1819 y(out)c(op)q(erators)h(is)g(an)f
(after-the-fact)h(reconstruction.)h(The)f(\014rst)g(implemen)o(tatio)o
(n)d(w)o(as)i(con-)183 1869 y(structed)i(using)e(seat-of-the-pan)o(ts)h
(in)o(tuition,)e(and)h(the)h(com)o(binators')e(b)q(eha)o(viour)h(w)o
(as)g(v)o(ery)183 1918 y(subtly)g(di\013eren)o(t.)h(The)g
Fs(nest)f Fw(com)o(binator)f(inserted)i(spaces)h(`in)d(a)h(v)o(ertical)
h(con)o(text':)f(that)g(is,)183 1968 y(when)h(used)h(as)f(an)f(op)q
(erand)i(of)22 b($$)h(or)14 b(at)f(the)i(top)f(lev)o(el.)245
2018 y(As)g(a)g(consequence)i(the)f(la)o(w)722 2105 y
Fs(nest)g Fn(k)g(x)c(<)-7 b(>)12 b(y)i Fw(=)e Fn(x)f(<)-7
b(>)12 b(y)183 2192 y Fw(held)18 b(in)g(the)h(implemen)o(tatio)o(n)d(|)
h(the)i(con)o(text)g(here)h(is)e(`horizon)o(tal'.)e(But)j(since)g(the)g
(b)q(e-)183 2241 y(ha)o(viour)d(of)h(a)g(la)o(y)o(out)g(dep)q(ended)i
(on)e(its)h(con)o(text,)g(w)o(e)f(could)h(not)f(giv)o(e)g(a)g(simple)g
(abstract)183 2291 y(mo)q(del)12 b(suc)o(h)i(as)f(that)h(in)f(the)h
(previous)g(section.)g(Moreo)o(v)o(er,)f(of)g(the)h(elev)o(en)g(la)o
(ws)f(in)g(\014gure)h(6,)183 2341 y(four)f(did)g(not)g(hold)g(\(whic)o
(h)h(four?\))f(Both)g(the)h(user)h(and)e(the)h(dev)o(elop)q(er)h(of)e
(the)h(library)e(w)o(ere)183 2391 y(depriv)o(ed)i(of)f(a)h(useful)g
(algebra.)245 2441 y(F)m(or)k(the)i(user)f(\(that)g(is)g(the)g(author)g
(of)f(a)h(prett)o(y-prin)o(ter\))h(eac)o(h)f(la)o(w)f(means)g(one)h
(less)183 2491 y(w)o(orry:)c(there)i(is)e(no)h(need)g(to)g(think)f(ab)q
(out)g(whether)i(to)f(write)g(the)g(left)g(or)f(the)h(righ)o(t)g(hand)p
eop
%%Page: 22 22
22 21 bop 340 194 a Fw(side.)11 b(F)m(or)f(the)h(dev)o(elop)q(er,)g
(eac)o(h)g(la)o(w)f(simpli\014es)f(optimisation:)e(the)k(original)e
(library)g(w)o(as)i(v)o(ery)340 244 y(hard)h(to)e(optimise)g(without)g
(c)o(hanging)h(its)g(b)q(eha)o(viour.)f(The)i(program)d(w)o(e)i(are)h
(follo)o(wing)c(no)o(w,)340 293 y(of)16 b(deriving)f(implemen)o
(tations)e(from)h(the)i(algebra,)f(w)o(ould)h(ha)o(v)o(e)f(b)q(een)i
(extremely)f(di\016cult)340 343 y(to)e(follo)o(w.)403
393 y(And)f(all)e(these)j(problems)e(stemmed)f(from)g(a)h(v)o(ery)h
(subtle)h(error)f(that)g(w)o(as)g(only)e(rev)o(ealed)340
443 y(b)o(y)j(writing)f(a)h(formal)d(sp)q(eci\014cation.)c(.)g(.)340
570 y Ft(7.3)48 b(Abstract)15 b(Do)q(cumen)o(ts)340 656
y Fw(The)d(la)o(y)o(out)f(op)q(erations)h(enable)g(us)g(to)f(construct)
j(individual)9 b(la)o(y)o(outs,)i(but)h(a)f(prett)o(y-prin)o(ter)340
706 y(m)o(ust)g(of)g(course)i(c)o(ho)q(ose)f(b)q(et)o(w)o(een)h(man)o
(y)d(alternativ)o(e)h(la)o(y)o(outs.)f(W)m(e)h(mak)o(e)f(a)i(design)f
(decision:)340 756 y(to)k(separate)i(the)e(construction)i(of)d
(alternativ)o(es)h(from)f(the)h(c)o(hoice)h(of)e(the)i(prettiest)h(la)o
(y)o(out.)340 806 y(W)m(e)d(represen)o(t)i(a)e(collection)f(of)g
(alternativ)o(es)h(b)o(y)g(a)g(set:)886 894 y Ft(t)o(yp)q(e)h
Fs(Do)n(c)d Fw(=)g Fq(P)s Fw(\()p Fs(L)n(ayout)q Fw(\))340
982 y(W)m(e)17 b(will)f(require)i(that)f(ev)o(ery)h(la)o(y)o(out)d(in)i
(a)g Fs(Do)n(c)g Fw(represen)o(t)j(the)d(same)g(string,)f(so)h(that)h
(the)340 1032 y(programmer)12 b(kno)o(ws)i(whic)o(h)f(string)h(is)g(b)q
(eing)g(prett)o(y-prin)o(ted.)403 1082 y(The)g(c)o(hoice)g(of)g(a)f
(particular)h(la)o(y)o(out)f(will)f(b)q(e)i(made)f(b)o(y)h(a)f
(function)911 1171 y Fs(b)n(est)f Fw(::)e Fs(Do)n(c)i
Fq(!)g Fs(L)n(ayout)340 1259 y Fw(Th)o(us)18 b(the)g(author)g(of)f(a)g
(prett)o(y-prin)o(ter)i(need)f(only)f(construct)i(a)e(set)h(of)f
(alternativ)o(es;)h(the)340 1309 y(hard)c(w)o(ork)f(of)g(selecting)h
(the)g(b)q(est)g(alternativ)o(e)f(is)h(done)f(just)h(b)o(y)f(reusing)h
(the)g(function)f Fs(b)n(est)p Fw(.)403 1359 y(Since)h
Fs(Do)n(c)p Fw(s)h(are)f(just)g(sets)h(of)e(la)o(y)o(outs,)f(there)j
(is)f(a)f(natural)h(w)o(a)o(y)f(to)g(promote)g(the)h(la)o(y)o(out)340
1409 y(op)q(erations)g(to)f(w)o(ork)h(on)f Fs(Do)n(c)p
Fw(s)h(to)q(o.)f(W)m(e)g(just)h(apply)f(the)h(op)q(eration)f(to)g(the)h
(elemen)o(ts)g(of)f(the)340 1459 y(op)q(erand)i(sets)g(and)f(form)e(a)h
(set)i(of)e(the)i(results)g(|)e(for)h(example,)834 1547
y Fn(d)856 1553 y Fr(1)886 1547 y Fn(<)-7 b(>)12 b(d)977
1553 y Fr(2)1007 1547 y Fw(=)f Fq(f)p Fn(l)1083 1553
y Fr(1)1114 1547 y Fn(<)-7 b(>)12 b(l)1195 1553 y Fr(2)1214
1547 y Fq(j)p Fn(l)1238 1553 y Fm(i)1263 1547 y Fq(2)f
Fn(d)1324 1553 y Fm(i)1338 1547 y Fq(g)340 1636 y Fw(The)k(promoted)e
(op)q(erations)h(distribute)g(o)o(v)o(er)g Fq([)g Fw(and)f(preserv)o(e)
j Fq(;)e Fw(|)f(for)h(example,)776 1724 y(\()p Fn(x)9
b Fq([)g Fn(y)q Fw(\))j Fn(<)-7 b(>)12 b(z)i Fw(=)e(\()p
Fn(x)f(<)-7 b(>)13 b(z)r Fw(\))c Fq([)g Fw(\()p Fn(y)k(<)-7
b(>)13 b(z)r Fw(\))879 1786 y Fq(;)e Fn(<)-7 b(>)12 b(z)i
Fw(=)e Fq(;)340 1875 y Fw(Moreo)o(v)o(er,)18 b(since)h(the)g(la)o(ws)e
(of)g(the)i(la)o(y)o(out)d(algebra)i(are)g(all)f Fs(line)n(ar)g
Fw(in)g(the)i(sense)g(that)f(no)340 1925 y(v)n(ariable)11
b(app)q(ears)i(more)e(than)h(once)h(on)e(either)i(the)g(left)e(or)h
(righ)o(t)g(hand)g(side,)g(then)g(they)h(hold)340 1974
y(for)h(do)q(cumen)o(ts)g(also.)e(So)i(all)f(the)h(la)o(ws)g(in)f
(\014gure)h(6)g(remain)f(true)h(for)g Fs(Do)n(c)p Fw(s.)403
2025 y(Of)f(course,)h(if)e(w)o(e)h(con\014ne)h(ourselv)o(es)g(to)f(the)
g(la)o(y)o(out)f(op)q(erations)i(w)o(e)f(can)g(only)g(construct)340
2075 y Fs(Do)n(c)q Fw(s)d(with)g(a)g(single)g(elemen)o(t.)f(W)m(e)h(m)o
(ust)f(add)h(an)f(op)q(eration)h(with)g(m)o(ultiple)e(p)q(ossible)i(la)
o(y)o(outs.)340 2124 y(Since)16 b(w)o(e)e(require)i(that)f(all)e(la)o
(y)o(outs)h(in)g(a)h(do)q(cumen)o(t)f(represen)o(t)j(the)e(same)f
(string,)g(union)g(is)340 2174 y(not)f(an)e(appropriate)i(op)q(erator)f
(to)h(pro)o(vide)f(|)f(rather)i(w)o(e)g(should)f(de\014ne)h(an)f(op)q
(eration)g(that)340 2224 y(forms)e(the)h(union)f(of)g(t)o(w)o(o)g
Fs(Do)n(c)q Fw(s)g(that)h(are)g(guaran)o(teed)g(to)g(represen)o(t)i
(the)e(same)f(string.)g(Noting)340 2274 y(that)710 2327
y Fs(string)k Fw(\()p Fn(x)9 b Fw($$)g Fn(y)q Fw(\))j(=)g
Fs(string)i Fn(x)9 b Fw(+)-12 b(+)p Fp(\\)15 b(")9 b
Fw(+)-12 b(+)p Fs(string)15 b Fn(y)340 2402 y Fw(it)f(is)g(tempting)e
(to)i(de\014ne)824 2491 y Fn(x)d(<)-9 b Fw(+)g Fn(>)12
b(y)h Fw(=)f Fn(x)f(<)-7 b(>)12 b Fs(text)j Fp(\\)f(")d
Fn(<)-7 b(>)12 b(y)p eop
%%Page: 23 23
23 22 bop 183 194 a Fw(and)13 b(de\014ne)i(an)f(op)q(erator)g(that)g
(forms)f(the)h(union)g(of)f Fn(x)c Fw($$)g Fn(y)15 b
Fw(and)f Fn(x)d(<)-9 b Fw(+)g Fn(>)12 b(y)q Fw(.)245
245 y(Ho)o(w)o(ev)o(er,)18 b(this)g(isn't)g(quite)g(enough.)g
(Sometimes)e(w)o(e)i(w)o(an)o(t)f(to)h(mak)o(e)f(sev)o(eral)i(c)o
(hoices)183 295 y(consisten)o(tly:)14 b(for)f(example,)f(w)o(e)i(ma)o
(y)e(w)o(an)o(t)i(to)g(allo)o(w)p 477 354 67 2 v 476
404 2 50 v 483 389 a Fp(if)g(e)p 543 404 V 477 405 67
2 v 17 w Fn(<)-9 b Fw(+)g Fn(>)p 645 354 139 2 v 644
404 2 50 v 18 w Fp(then)15 b(s1)p 783 404 V 645 405 139
2 v 17 w Fn(<)-9 b Fw(+)g Fn(>)p 885 354 125 2 v 884
404 2 50 v 18 w Fp(else)15 b(s2)p 1010 404 V 885 405
125 2 v 17 w Fw(=)p 1066 354 335 2 v 1065 404 2 50 v
18 w Fp(if)e(e)h(then)h(s1)f(else)g(s2)p 1399 404 V 1066
405 335 2 v 560 474 67 2 v 559 523 2 50 v 566 508 a(if)g(e)p
626 523 V 560 525 67 2 v 636 509 a Fw($$)p 687 474 139
2 v 686 523 2 50 v 693 508 a Fp(then)h(s1)p 825 523 V
687 525 139 2 v 834 509 a Fw($$)p 885 474 125 2 v 884
523 2 50 v 891 508 a Fp(else)g(s2)p 1010 523 V 885 525
125 2 v 1022 509 a Fw(=)p 1066 424 139 2 v 1065 474 2
50 v 1072 459 a Fp(if)e(e)p 1203 474 V 1065 523 V 1072
508 a(then)i(s1)p 1204 523 V 1065 573 V 1072 558 a(else)f(s2)p
1203 573 V 1066 575 139 2 v 183 652 a Fw(as)g(alternativ)o(es,)f
(without)h(also)f(allo)o(wing)p 516 736 67 2 v 515 786
2 50 v 522 771 a Fp(if)g(e)p 581 786 V 516 787 67 2 v
18 w Fn(<)-9 b Fw(+)g Fn(>)12 b Fw(\()p 700 736 139 2
v 699 786 2 50 v 6 w Fp(then)j(s1)p 838 786 V 700 787
139 2 v 15 w Fw($$)p 899 736 125 2 v 898 786 2 50 v 15
w Fp(else)f(s2)p 1023 786 V 899 787 125 2 v 6 w Fw(\))d(=)p
1095 711 212 2 v 1094 811 2 100 v 1101 746 a Fp(if)j(e)f(then)i(s1)1169
796 y(else)f(s2)p 1306 811 V 1095 812 212 2 v 549 855
67 2 v 548 905 2 50 v 555 890 a(if)f(e)p 614 905 V 549
907 67 2 v 624 891 a Fw($$)p 675 855 139 2 v 674 905
2 50 v 681 890 a Fp(then)i(s1)p 813 905 V 675 907 139
2 v 825 891 a Fn(<)-9 b Fw(+)g Fn(>)p 915 855 125 2 v
914 905 2 50 v 921 890 a Fp(else)14 b(s2)p 1039 905 V
915 907 125 2 v 1051 891 a Fw(=)p 1095 830 266 2 v 1094
880 2 50 v 1101 865 a Fp(if)g(e)p 1360 880 V 1094 930
V 1101 915 a(then)h(s1)f(else)g(s2)p 1360 930 V 1095
932 266 2 v 183 1009 a Fw(W)m(e)f(therefore)i(de\014ne)g(an)f
Fn(n)p Fw(-ary)g(op)q(eration,)f(whic)o(h)h(mak)o(es)e
Fn(n)e Fq(\000)f Fw(1)14 b(c)o(hoices)g(consisten)o(tly:)579
1096 y Fs(sep)e Fw(::)e([)p Fs(Do)n(c)p Fw(])775 1081
y Fr(+)814 1096 y Fq(!)h Fs(Do)n(c)579 1146 y(sep)k(xs)d
Fw(=)g Fs(foldr1)i Fw(\()-7 b Fn(<)e Fw(+)g Fn(>)i Fw(\))15
b Fs(xs)9 b Fq([)g Fs(foldr1)14 b Fw(\($$\))g Fs(xs)183
1231 y Fw(W)m(e'll)d(revise)k(this)e(de\014nition)g(sligh)o(tly)f(b)q
(elo)o(w,)h(but)h(\014rst)g(let)g(us)f(observ)o(e)i(a)e(pleasing)g(in)o
(terac-)183 1281 y(tion)g(b)q(et)o(w)o(een)i Fs(sep)f
Fw(and)g Fs(nest)p Fw(.)g(Consider)g(for)g(example,)622
1376 y Fs(sep)h Fw([)p 706 1340 242 2 v 705 1390 2 50
v 712 1375 a Fp(while)f(x)p Fq(\025)p Fp(0)g(do)p 946
1390 V 706 1392 242 2 v 947 1376 a Fn(;)7 b Fs(nest)14
b Fw(2)p 1088 1340 156 2 v 1087 1390 2 50 v 1094 1375
a Fp(x)g(:=)g(x-2)p 1244 1390 V 1088 1392 156 2 v 1244
1376 a Fw(])183 1470 y(The)g(alternativ)o(e)g(la)o(y)o(outs)f(here)i
(are)p 350 1529 242 2 v 349 1579 2 50 v 356 1564 a Fp(while)g(x)p
Fq(\025)p Fp(0)f(do)p 591 1579 V 350 1581 242 2 v 18
w Fn(<)-9 b Fw(+)g Fn(>)11 b Fs(nest)16 b Fw(2)p 816
1529 156 2 v 815 1579 2 50 v 19 w Fp(x)e(:=)g(x-2)p 972
1579 V 816 1581 156 2 v 17 w Fw(=)p 1028 1529 242 2 v
1027 1579 2 50 v 18 w Fp(while)g(x)p Fq(\025)p Fp(0)g(do)p
1268 1579 V 1028 1581 242 2 v 18 w Fn(<)-9 b Fw(+)g Fn(>)p
1371 1529 156 2 v 1370 1579 2 50 v 18 w Fp(x)14 b(:=)f(x-2)p
1526 1579 V 1371 1581 156 2 v 984 1634 a Fw(=)p 1028
1599 400 2 v 1027 1649 2 50 v 18 w Fp(while)h(x)p Fq(\025)p
Fp(0)g(do)g(x)g(:=)g(x-2)p 1427 1649 V 1028 1650 400
2 v 183 1729 a Fw(and)p 500 1804 242 2 v 499 1854 2 50
v 506 1839 a Fp(while)g(x)p Fq(\025)p Fp(0)g(do)p 740
1854 V 500 1855 242 2 v 16 w Fw($$)8 b Fs(nest)16 b Fw(2)p
924 1804 156 2 v 923 1854 2 50 v 19 w Fp(x)e(:=)g(x-2)p
1080 1854 V 924 1855 156 2 v 17 w Fw(=)p 1136 1779 242
2 v 1135 1829 2 50 v 1142 1814 a Fp(while)g(x)p Fq(\025)p
Fp(0)g(do)p 1376 1829 V 1135 1879 V 1183 1864 a(x)g(:=)g(x-2)p
1377 1879 V 1136 1880 242 2 v 183 1958 a Fw(In)f(the)i(horizon)o(tal)d
(form)g(no)i(un)o(w)o(an)o(ted)f(extra)i(inden)o(tation)e(app)q(ears,)h
(b)q(ecause)h Fs(nest)f Fw(can)g(b)q(e)183 2008 y(cancelled)g(on)g(the)
g(righ)o(t)g(of)f(\()-7 b Fn(<)g(>)g Fw(\).)245 2059
y(No)o(w)14 b(let)h(us)g(consider)h(an)f(example)e(whic)o(h)i(motiv)n
(ates)e(a)h(sligh)o(t)g(re\014nemen)o(t)h(to)g(the)g(def-)183
2109 y(inition)f(of)i Fs(sep)p Fw(.)g(Supp)q(ose)h(w)o(e)f(wish)g(to)h
(prett)o(y-prin)o(t)f(pairs)g(of)g(statemen)o(ts)g(separated)i(b)o(y)e
(a)183 2159 y(semicolon,)c(c)o(ho)q(osing)h(b)q(et)o(w)o(een)i(horizon)
o(tal)e(and)h(v)o(ertical)g(la)o(y)o(outs.)e(W)m(e)i(migh)o(t)e
(de\014ne)636 2253 y Fs(semic)j Fn(x)e(y)h Fw(=)d Fs(sep)16
b Fw([)p Fn(x)10 b(<)-7 b(>)13 b Fs(text)h Fp(\\;")o
Fn(;)7 b(y)q Fw(])183 2348 y(No)o(w)13 b(for)h(example,)554
2466 y Fs(semic)p 671 2431 96 2 v 670 2481 2 50 v 21
w Fp(x:=0)p 766 2481 V 671 2482 96 2 v 780 2431 V 779
2481 2 50 v 25 w(y:=0)p 875 2481 V 780 2482 96 2 v 17
w Fw(=)931 2408 y Fd(\032)p 962 2431 205 2 v 961 2481
2 50 v 968 2466 a Fp(x:=0;)f(y:=0)p 1166 2481 V 962 2482
205 2 v 5 w Fn(;)p 1185 2406 107 2 v 1184 2456 2 50 v
1191 2441 a Fp(x:=0;)p 1292 2456 V 1184 2506 V 1191 2491
a(y:=0)p 1291 2506 V 1185 2507 107 2 v 1292 2408 a Fd(\033)p
eop
%%Page: 24 24
24 23 bop 340 194 a Fw(in)14 b(whic)o(h)g(b)q(oth)g(horizon)o(tal)f
(and)g(v)o(ertical)h(la)o(y)o(outs)f(lo)q(ok)g(\014ne.)h(But)g
(consider)686 300 y Fs(semic)p 803 239 242 2 v 802 289
2 50 v 809 274 a Fp(while)h(x)p Fq(\025)p Fp(2)f(do)p
1044 289 V 802 339 V 851 324 a(x:=x-2)p 1044 339 V 803
341 242 2 v 1059 239 V 1058 289 2 50 v 1065 274 a(while)h(y)p
Fq(\025)p Fp(2)f(do)p 1300 289 V 1058 339 V 1106 324
a(y:=y-2)p 1300 339 V 1059 341 242 2 v 698 469 a Fw(=)742
359 y Fd(8)742 396 y(>)742 409 y(>)742 421 y(<)742 496
y(>)742 508 y(>)742 521 y(:)p 779 384 431 2 v 778 434
2 50 v 785 419 a Fp(while)h(x)p Fq(\025)p Fp(2)f(do)p
1208 434 V 778 533 2 100 v 826 469 a(x:=x-2;)e(while)j(y)p
Fq(\025)p Fp(2)f(do)1009 518 y(y:=y-2)p 1208 533 V 779
535 431 2 v 1209 469 a Fn(;)p 1228 359 242 2 v 1227 409
2 50 v 1234 394 a Fp(while)g(x)p Fq(\025)p Fp(2)g(do)p
1468 409 V 1227 459 V 1275 444 a(x:=x-2;)p 1468 459 V
1227 508 V 1234 494 a(while)g(y)p Fq(\025)p Fp(2)g(do)p
1468 508 V 1227 558 V 1275 543 a(y:=y-2)p 1468 558 V
1228 560 242 2 v 1469 359 a Fd(9)1469 396 y(>)1469 409
y(>)1469 421 y(=)1469 496 y(>)1469 508 y(>)1469 521 y(;)340
625 y Fw(In)g(cases)h(suc)o(h)g(as)f(this,)f(the)i(horizon)o(tal)e(la)o
(y)o(out)f(is)i(ugly)f(or)h(ev)o(en)g(misleading.)d(W)m(e)j(therefore)
340 675 y(rede\014ne)695 743 y Fs(sep)h(xs)c Fw(=)h Fs(\014t)j
Fw(\()p Fs(foldr1)g Fw(\()-7 b Fn(<)e Fw(+)g Fn(>)i Fw(\))14
b Fs(xs)q Fw(\))9 b Fq([)g Fs(foldr1)14 b Fw(\($$\))g
Fs(xs)722 793 y Ft(where)29 b Fs(\014t)15 b Fn(d)c Fw(=)h
Fq(f)p Fn(l)h Fq(2)e Fn(d)p Fq(j)p Fs(length)j Fn(l)f
Fw(=)f(1)p Fq(g)340 871 y Fw(whic)o(h)i(restricts)i(the)e(horizon)o
(tal)f(form)g(of)g(a)g Fs(sep)i Fw(to)e(\014t)h(on)g(one)g(line.)403
921 y(The)k(algebraic)f(prop)q(erties)i(of)d Fs(\014t)i
Fw(are)g(v)o(ery)g(simply)d(stated)k(|)d(see)j(\014gure)f(7.)f(The)h
Fs(sep)340 970 y Fw(op)q(erator)d(has)f(few)o(er)g(useful)g(prop)q
(erties,)h(and)f(w)o(e)g(will)e(dev)o(elop)i(them)f(as)h(w)o(e)h(need)f
(them.)899 1146 y Fk(\014t)f Fv(\()p Fk(text)g Fl(s)p
Fv(\))e(=)h Fk(text)g Fl(s)855 1204 y Fk(\014t)h Fv(\()p
Fk(nest)f Fl(k)i(x)p Fv(\))d(=)h Fk(nest)g Fl(k)i Fv(\()p
Fk(\014t)f Fl(x)p Fv(\))875 1263 y Fk(\014t)g Fv(\()p
Fl(x)e(<)-6 b(>)10 b(y)q Fv(\))h(=)h Fk(\014t)h Fl(x)d(<)-6
b(>)10 b Fk(\014t)j Fl(y)894 1321 y Fk(\014t)g Fv(\()p
Fl(x)c Fv($$)g Fl(y)q Fv(\))i(=)h Fi(;)907 1379 y Fk(\014t)h
Fv(\()p Fl(x)8 b Fi([)h Fl(y)q Fv(\))i(=)h Fk(\014t)h
Fl(x)8 b Fi([)g Fk(\014t)13 b Fl(y)1003 1437 y Fk(\014t)g
Fi(;)e Fv(=)h Fi(;)340 1599 y Fj(Fig.)7 b(7.)13 b Fv(The)g
Fk(\014t)f Fv(la)o(ws.)340 1778 y Fs(Exer)n(cise)7 b(4.)21
b Fw(De\014ne)14 b(a)g(t)o(yp)q(e)g(of)f(abstract)h(syn)o(tax)g(trees)h
(for)f(a)f(simple)f(imp)q(erativ)o(e)h(language,)340
1828 y(with)c(assignmen)o(t)g(statemen)o(ts,)g Ft(if)p
Fw({)p Ft(then)p Fw({)p Ft(e)o(ls)o(e)p Fw(,)d Ft(while)p
Fw({)p Ft(do)p Fw(,)g(and)k Ft(b)q(egin)p Fw({)p Ft(end)p
Fw(.)5 b(Use)11 b(the)f(com-)340 1878 y(binators)k(to)g(write)g(a)g
(prett)o(y-prin)o(ter)h(for)e(this)h(t)o(yp)q(e.)340
1999 y Ft(7.4)48 b(Cho)q(osing)15 b(a)h(Prett)o(y)e(La)o(y)o(out)340
2078 y Fw(No)o(w)20 b(that)h(w)o(e)f(ha)o(v)o(e)h(designed)g(com)o
(binators)d(for)i(constructing)i(do)q(cumen)o(ts)e(with)g(man)o(y)340
2128 y(p)q(ossible)10 b(la)o(y)o(outs,)e(it)h(is)h(time)e(to)h(discuss)
i(c)o(ho)q(osing)e(among)e(those)j(alternativ)o(es.)g(Man)o(y)f(prett)o
(y-)340 2178 y(prin)o(ters)15 b(aim)c(simply)h(to)h(a)o(v)o(oid)f
(exceeding)j(a)e(giv)o(en)g(page)g(width.)g(Ho)o(w)o(ev)o(er,)g(w)o(e)h
(found)f(that)340 2228 y(using)h(this)g(criterion)g(alone)g(tends)h(to)
e(pro)q(duce)i(la)o(y)o(outs)e(suc)o(h)i(as)p 453 2274
1264 2 v 452 2324 2 50 v 459 2309 a Fp(fo)o(r)e(i)h(=)g(1)g(to)f(100)g
(do)h(fo)o(r)g(j)g(=)g(1)f(to)h(100)f(do)h(fo)o(r)f(k)h(=)h(1)e(to)h
(100)f(do)h(a[i,j,k])f(:=)h(0)p 1716 2324 V 453 2326
1264 2 v 340 2391 a Fw(whic)o(h)k(\014ts)h(on)f(a)f(page,)h(but)g
(cannot)g(b)q(e)h(describ)q(ed)h(as)e(prett)o(y)m(.)f(W)m(e)h
(therefore)i(imp)q(ose)c(an)340 2441 y(additional)e(constrain)o(t)i
(limiting)c(the)k(n)o(um)o(b)q(er)f(of)g(c)o(haracters)j(on)d(eac)o(h)h
(line)f(\(excluding)h(in-)340 2491 y(den)o(tation\))f(to)f(a)g(smaller)
f(n)o(um)o(b)q(er.)g(The)i(idea)f(is)g(to)g(a)o(v)o(oid)f(placing)h(to)
q(o)g(m)o(uc)o(h)f(information)p eop
%%Page: 25 25
25 24 bop 183 194 a Fw(on)17 b(a)g(line)f(|)h(ev)o(en)h(a)f(line)g
(that)g(b)q(egins)g(at)g(the)h(left)f(margin.)e(Under)j(this)f
(constrain)o(t)h(the)183 244 y(example)12 b(ab)q(o)o(v)o(e)i(migh)o(t)e
(instead)i(b)q(e)g(laid)f(out)h(as)p 601 287 653 2 v
600 337 2 50 v 607 322 a Fp(fo)o(r)f(i)h(=)g(1)f(to)h(100)f(do)p
1252 337 V 600 386 V 648 371 a(fo)o(r)h(j)f(=)i(1)e(to)h(100)f(do)p
1252 386 V 600 436 V 690 421 a(fo)o(r)g(k)h(=)g(1)g(to)f(100)h(do)g
(a[i,j,k])f(:=)g(0)p 1252 436 V 601 438 653 2 v 183 500
a Fw(In)i(general)h(a)g(prett)o(y)g(la)o(y)o(out)f(will)f(consist)j(of)
e(a)g(ribb)q(on)h(of)f(text)i(snaking)e(across)i(the)f(page.)183
550 y(T)m(o)f(see)i(that)e(this)h(is)g(reasonable,)f(ask)h(y)o
(ourself:)f(`is)g(the)h(prettiest)i(la)o(y)o(out)c(on)i(an)f
(in\014nitely)183 600 y(wide)f(page)f(really)h(to)f(place)h(ev)o
(erything)h(on)e(one)h(line?')245 650 y(W)m(e)f(will)g(sa)o(y)h(that)f
(a)h(line)f(that)h(meets)g(b)q(oth)g(constrain)o(ts)h(is)f
Fs(nic)n(e)p Fw(,)f(and)h(de\014ne)512 729 y Fs(nic)n(e)585
711 y Fm(w)585 739 y(r)625 729 y Fw(\()p Fn(i;)7 b(s)p
Fw(\))12 b Fq(\()-7 b(\))11 b Fn(i)f Fw(+)f Fs(length)15
b Fn(s)d Fq(\024)g Fn(w)e Fq(^)f Fs(length)15 b Fn(s)d
Fq(\024)g Fn(r)183 808 y Fw(where)j Fn(w)f Fw(is)g(the)h(page)e(width)h
(and)g Fn(r)g Fw(is)g(the)h(width)e(of)h(the)g(ribb)q(on.)245
858 y(W)m(e)j(migh)o(t)e(b)q(e)j(tempted)f(to)g(sp)q(ecify)h(that)f
(the)h(prett)o(y-prin)o(ter)h(c)o(ho)q(ose)f(a)f(la)o(y)o(out)f(all)g
(of)183 907 y(whose)f(lines)g(are)g(nice,)g(but)g(w)o(e)h(m)o(ust)d(b)q
(e)j(careful:)f(some)f(do)q(cumen)o(ts)g(ha)o(v)o(e)h(no)g(suc)o(h)h
(la)o(y)o(out)183 957 y(at)11 b(all.)f(F)m(or)i(example,)e
Fs(text)k Fp(\\13)f(cha)o(racters")h Fw(cannot)e(b)q(e)g(made)f(to)g
(\014t)h(within)f(a)h(pagewidth)f(of)183 1007 y(12.)h(Ev)o(en)h(in)f
(suc)o(h)i(cases)g(w)o(e)g(w)o(an)o(t)e(the)i(prett)o(y-prin)o(ter)g
(to)f(pro)q(duce)h(something,)d(and)i(rather)183 1057
y(than)i(adopt)g(an)g(ad)h(ho)q(c)g(solution)e(w)o(e)i(accept)h(that)e
(the)h(niceness)h(criteria)f(will)e(not)h(alw)o(a)o(ys)183
1107 y(b)q(e)f(met.)245 1156 y(Moreo)o(v)o(er,)19 b(ev)o(en)h(if)e(a)g
(nice)i(la)o(y)o(out)e(exists)h(w)o(e)g(ma)o(y)e(not)i(w)o(an)o(t)g
(the)g(prett)o(y-prin)o(ter)i(to)183 1206 y(c)o(ho)q(ose)14
b(it!)f(Consider)i(for)e(example)g(the)h(do)q(cumen)o(t)580
1373 y Fs(sep)659 1339 y Fd(\002)p 676 1338 32 2 v 675
1387 2 50 v 682 1372 a Fp(a)p 707 1387 V 676 1389 32
2 v 708 1373 a Fn(;)p 727 1338 34 2 v 726 1387 2 50 v
733 1372 a Fp(b)p 759 1387 V 727 1389 34 2 v 759 1339
a Fd(\003)788 1373 y Fn(<)-7 b(>)p 857 1249 242 2 v 856
1299 2 50 v 863 1284 a Fp(1)p 1098 1299 V 856 1376 2
77 v 863 1328 a(.)863 1344 y(.)863 1361 y(.)p 1098 1376
V 856 1426 2 50 v 863 1411 a(999)p 1098 1426 V 856 1475
V 863 1460 a(13)13 b(cha)o(racters)p 1096 1475 V 857
1477 242 2 v 591 1644 a Fw(=)635 1496 y Fd(8)635 1534
y(>)635 1546 y(>)635 1558 y(>)635 1571 y(>)635 1583 y(>)635
1596 y(<)635 1671 y(>)635 1683 y(>)635 1695 y(>)635 1708
y(>)635 1720 y(>)635 1733 y(:)p 672 1520 302 2 v 671
1746 2 226 v 678 1555 a Fp(a)h(b)o(1)732 1598 y(.)732
1615 y(.)732 1632 y(.)732 1681 y(999)732 1731 y(13)g(cha)o(racters)p
973 1746 V 672 1748 302 2 v 974 1644 a Fn(;)p 993 1495
268 2 v 992 1545 2 50 v 999 1530 a Fp(a)p 1260 1545 V
992 1771 2 226 v 999 1580 a(b)o(1)1019 1623 y(.)1019
1640 y(.)1019 1657 y(.)1019 1706 y(999)1019 1756 y(13)f(cha)o(racters)p
1260 1771 V 993 1773 268 2 v 1260 1496 a Fd(9)1260 1534
y(>)1260 1546 y(>)1260 1558 y(>)1260 1571 y(>)1260 1583
y(>)1260 1596 y(=)1260 1671 y(>)1260 1683 y(>)1260 1695
y(>)1260 1708 y(>)1260 1720 y(>)1260 1733 y(;)183 1835
y Fw(This)e(do)q(cumen)o(t)g(has)h(a)g(nice)g(la)o(y)o(out)e(on)i(a)f
(page)h(of)f(width)g(14)g(c)o(haracters)j(|)d(the)h(second)h(one.)183
1885 y(But)k(it)g(w)o(ould)f(b)q(e)h(unreasonably)g(ine\016cien)o(t)g
(for)f(a)h(prett)o(y-prin)o(ter)h(to)e(decide)i(whether)g(or)183
1935 y(not)c(to)g(split)g(the)h(\014rst)g(line)f(of)g(a)g(do)q(cumen)o
(t)g(on)g(the)h(basis)g(of)e(the)i(con)o(ten)o(ts)h(of)e(the)h(last.)e
(An)183 1984 y(e\016cien)o(t)e(prett)o(y-prin)o(ter)i(should)d(need)j
(only)d(a)h(limited)e(lo)q(ok-ahead,)g(and)i(so)g(w)o(e)h(m)o(ust)e
(exp)q(ect)183 2034 y(the)h(\014rst)g(la)o(y)o(out)f(to)g(b)q(e)i(c)o
(hosen)f(despite)h(the)f(trouble)g(ahead)1138 2019 y
Fr(8)1157 2034 y Fw(.)f(The)h(question)g(of)f(whic)o(h)h(la)o(y)o(out)
183 2084 y(a)j(prett)o(y-prin)o(ter)i(c)o(ho)q(oses)h(is)d(th)o(us)i
(tric)o(kier)f(than)g(it)g(at)f(\014rst)i(app)q(ears.)f(Of)g(course,)h
(it)f(could)183 2134 y(nev)o(er)i(ha)o(v)o(e)f(b)q(een)h(su\016cien)o
(t)g(to)f(sa)o(y)g(simply)e(that)j(a)f(nice)g(la)o(y)o(out)f(is)i(c)o
(hosen,)f(since)h(ev)o(en)g(if)183 2184 y(all)f(la)o(y)o(outs)g(are)h
(nice,)h(some)e(will)g(b)q(e)h(preferable)h(to)f(others.)h(W)m(e)f(m)o
(ust)f(instead)h(de\014ne)i(an)183 2234 y Fs(or)n(dering)13
b Fw(on)h(la)o(y)o(outs)f(and)g(c)o(ho)q(ose)i(the)g(b)q(est.)245
2283 y(W)m(e)e(b)q(egin)g(b)o(y)g(de\014ning)g(an)g(ordering)g
Fc(\003)892 2268 y Fm(w)892 2294 y(r)933 2283 y Fw(on)g(individual)e
(lines.)h(Our)i(guiding)e(principles)183 2333 y(are)p
183 2357 237 2 v 191 2384 a Fo(8)221 2399 y Fv(A)i(di\013eren)o(t)h
(design)h(decision)g(is)f(p)q(ossible:)h(w)o(e)d(migh)o(t)i(c)o(ho)q
(ose)g(to)f(`pla)o(y)h(safe')f(and)g(split)i(the)e(\014rst)221
2445 y(line)19 b(unless)h(a)e(limited)i(lo)q(ok-ahead)f(sho)o(ws)g
(that)f(it)g(is)g(de\014nitely)j(unnecessary)m(.)e(W)m(e)f(ha)o(v)o(e)g
(not)221 2491 y(explored)d(this)f(alternativ)o(e.)p eop
%%Page: 26 26
26 25 bop 366 194 a Ft({)21 b Fw(a)14 b(nice)g(line)f(is)h(alw)o(a)o
(ys)f(b)q(etter)i(than)f(an)g(o)o(v)o(er\015o)o(wing)f(line,)366
244 y Ft({)21 b Fw(if)13 b(one)g(cannot)h(a)o(v)o(oid)e(o)o(v)o
(er\015o)o(wing,)g(it)h(is)h(b)q(etter)h(to)e(o)o(v)o(er\015o)o(w)g(b)o
(y)g(a)h(little)e(than)i(b)o(y)f(a)g(lot,)366 295 y Ft({)21
b Fw(unnecessary)16 b(line)d(breaks)i(should)f(b)q(e)g(a)o(v)o(oided.)
340 381 y(W)m(e)g(therefore)h(de\014ne)665 511 y Fn(x)c
Fc(\003)732 493 y Fm(w)732 521 y(r)771 511 y Fn(y)j Fq(\()-7
b(\))937 460 y Fw(\()p Fs(nic)n(e)1026 443 y Fm(w)1026
471 y(r)1066 460 y Fn(x)9 b Fq(^)g(:)p Fs(nic)n(e)1236
443 y Fm(w)1236 471 y(r)1263 460 y Fn(y)q Fw(\))898 510
y Fq(_)i Fw(\()p Fq(:)p Fs(nic)n(e)1053 493 y Fm(w)1053
520 y(r)1094 510 y Fn(x)e Fq(^)g(:)p Fs(nic)n(e)1264
493 y Fm(w)1264 520 y(r)1304 510 y Fn(y)i Fq(^)e Fn(]x)j(<)g(]y)q
Fw(\))898 560 y Fq(_)f Fw(\()p Fs(nic)n(e)1026 543 y
Fm(w)1026 570 y(r)1066 560 y Fn(x)e Fq(^)g Fs(nic)n(e)1208
543 y Fm(w)1208 570 y(r)1249 560 y Fn(y)i Fq(^)e Fn(]x)i(>)h(]y)q
Fw(\))340 651 y(where)j(the)g(length)f(of)f(a)h(line)f(is)h(giv)o(en)f
(b)o(y)h Fn(])p Fw(\()p Fn(i;)7 b(s)p Fw(\))12 b(=)g
Fn(i)d Fw(+)h Fs(length)15 b Fn(s)p Fw(.)403 701 y(If)e(w)o(e)h(kno)o
(w)g(that)g Fn(]x)d(>)h(]y)k Fw(then)e(w)o(e)g(can)g(test)h
Fc(\003)1195 686 y Fm(w)1195 712 y(r)1236 701 y Fw(particularly)e
(simply:)933 792 y Fs(nic)n(e)1005 775 y Fm(w)1005 802
y(r)1046 792 y Fn(x)e Fw(=)-7 b Fq(\))12 b Fn(x)f Fc(\003)1227
775 y Fm(w)1227 802 y(r)1266 792 y Fn(y)905 854 y Fq(:)p
Fs(nic)n(e)1005 837 y Fm(w)1005 864 y(r)1046 854 y Fn(x)g
Fw(=)-7 b Fq(\))12 b Fn(y)h Fc(\003)1225 837 y Fm(w)1225
864 y(r)1264 854 y Fn(x)340 945 y Fw(In)k(the)h(\014rst)g(case)f
Fn(y)i Fw(m)o(ust)d(also)g(b)q(e)i(nice,)f(but)g(not)g(as)g(nice)g(b)q
(ecause)i(it)d(is)h(shorter.)h(In)f(the)340 994 y(second)f(case)f
(either)g Fn(y)h Fw(is)e(nice)h(\(and)f(therefore)i(nicer)f(than)f
Fn(x)p Fw(\),)f(or)i(it)f(is)g(not)g(nice,)g(but)g(nicer)340
1044 y(than)g Fn(x)g Fw(b)q(ecause)h(it)f(is)g(shorter.)g(W)m(e)g(will)
e(use)j(this)f(prop)q(ert)o(y)h(in)e(the)i(implem)o(en)o(tations.)403
1095 y(Unfortunately)9 b(an)h(ordering)g(on)g(lines)f(do)q(es)i(not)f
(extend)h(in)e(a)h(unique)g(w)o(a)o(y)f(to)g(an)h(ordering)340
1145 y(on)k(la)o(y)o(outs,)f(and)h(so)g(w)o(e)g(m)o(ust)f(mak)o(e)g(an)
h(arbitrary)g(decision.)g(W)m(e)f(c)o(ho)q(ose)i(to)f(order)h(la)o(y)o
(outs)340 1194 y(b)o(y)k(the)h(lexicographic)f(extension)g(of)g(the)h
(ordering)f(on)g(lines,)f(whic)o(h)h(w)o(e)h(will)d(also)i(write)340
1244 y(as)e Fc(\003)426 1229 y Fm(w)426 1255 y(r)453
1244 y Fw(.)e(The)i(reason)f(for)g(this)g(c)o(hoice)h(is)f(simple:)e
(lexicographic)h(ordering)h(can)g(b)q(e)h(decided)340
1294 y(left-to-righ)o(t,)11 b(and)g(w)o(e)h(hop)q(e)h(to)e(prett)o
(y-prin)o(t)i(do)q(cumen)o(ts)e(from)f(left)i(to)g(righ)o(t)f(without)g
(m)o(uc)o(h)340 1344 y(lo)q(ok-ahead.)i(W)m(e)g(de\014ne)794
1434 y Fq(r)829 1417 y Fm(w)829 1445 y(r)867 1434 y Fw(::)e
Fs(L)n(ayout)h Fq(!)f Fs(L)n(ayout)h Fq(!)f Fs(L)n(ayout)340
1525 y Fw(to)j(select)h(the)g(lexicographically)d(nicer)i(of)g(its)g
(argumen)o(ts,)e(and)794 1615 y Fs(b)n(est)f Fw(::)g
Fs(Int)g Fq(!)h Fs(Int)f Fq(!)g Fs(Do)n(c)h Fq(!)f Fs(L)n(ayout)340
1706 y Fw(suc)o(h)20 b(that)g Fs(b)n(est)14 b Fn(w)20
b(r)g Fw(selects)h(the)f(lexicographically)d(nicest)j(la)o(y)o(out)e
(in)h(the)h(set.)g(It's)f(also)340 1755 y(con)o(v)o(enien)o(t)h(to)f
(in)o(tro)q(duce)i(a)e(unit)g Fq(1)g Fw(for)g Fq(r)1096
1740 y Fm(w)1096 1766 y(r)1122 1755 y Fw(,)g(represen)o(ting)i(a)e(la)o
(y)o(out)f(uglier)h(than)h(an)o(y)340 1805 y(other.)403
1856 y(The)13 b(careful)g(reader)h(will)d(ha)o(v)o(e)h(noticed)i(that)e
Fc(\003)1183 1841 y Fm(w)1183 1866 y(r)1223 1856 y Fw(is)h(only)f(a)g
Fs(p)n(artial)g Fw(order)h(|)g(if)e Fn(x)i Fw(and)f Fn(y)340
1906 y Fw(are)h(b)q(oth)g(lines)g(of)f(equal)g(length,)g(then)i
(neither)f Fn(x)f Fc(\003)1191 1891 y Fm(w)1191 1916
y(r)1229 1906 y Fn(y)j Fw(nor)d Fn(y)i Fc(\003)1402 1891
y Fm(w)1402 1916 y(r)1440 1906 y Fn(x)f Fw(holds,)f(ev)o(en)h(though)f
Fn(x)340 1956 y Fw(and)g Fn(y)h Fw(need)g(not)f(b)q(e)g(equal.)f
(Consequen)o(tly)h(b)q(oth)g Fq(r)1178 1940 y Fm(w)1178
1966 y(r)1216 1956 y Fw(and)g Fs(b)n(est)f Fw(are)h(partial)f(op)q
(erations.)h(But)340 2005 y(this)f(will)e(not)i(trouble)f(us,)h(b)q
(ecause)h(all)d(the)i(do)q(cumen)o(t)f(op)q(erations)h(construct)h
(sets)g(whic)o(h)f(are)340 2055 y(totally)g(ordered)j(b)o(y)e
Fc(\003)708 2040 y Fm(w)708 2065 y(r)735 2055 y Fw(.)g(This)g(will)f(b)
q(ecome)i(eviden)o(t)f(when)h(w)o(e)g(deriv)o(e)g(implem)o(en)o
(tations)d(of)340 2105 y(the)j(library)m(.)d(Consider)i(this:)f(our)h
(task)g(is)f(to)h(de\014ne)g(when)h(one)f(la)o(y)o(out)e(is)i(nicer)g
(than)g(another)340 2155 y(la)o(y)o(out)k Fs(of)i(the)g(same)g(do)n
(cument)p Fw(;)f(w)o(e)h(ha)o(v)o(e)e(no)h(need)h(to)f(\(and)g(indeed,)
g(w)o(e)h(cannot\))f(de\014ne)340 2205 y(when)e(a)e(la)o(y)o(out)g(is)h
(nicer)g(than)g(a)g(la)o(y)o(out)f(of)g(an)g(unrelated)i(do)q(cumen)o
(t.)403 2255 y(Let)f(us)f(no)o(w)h(in)o(v)o(estigate)f(the)h(prop)q
(erties)h(of)e Fc(\003)1167 2240 y Fm(w)1167 2266 y(r)1194
2255 y Fw(,)g Fq(r)1254 2240 y Fm(w)1254 2266 y(r)1294
2255 y Fw(and)g Fs(b)n(est)p Fw(.)g(Since)h(the)g(ordering)f(on)340
2305 y(la)o(y)o(outs)g(is)h(lexicographic,)781 2443 y
Fn(x)d Fc(\003)848 2426 y Fm(w)848 2453 y(r)887 2443
y Fn(y)i Fw(=)-7 b Fq(\))998 2360 y Fd(0)998 2434 y(@)1080
2393 y Fn(z)11 b Fw($$)e Fn(x)i Fc(\003)1228 2378 y Fm(w)1228
2403 y(r)1267 2393 y Fn(z)g Fw($$)e Fn(y)1041 2443 y
Fq(^)51 b Fn(x)12 b Fc(\003)1188 2428 y Fm(w)1188 2453
y(r)1226 2443 y Fn(y)f Fw($$)e Fn(z)1041 2492 y Fq(^)51
b Fn(x)9 b Fw($$)g Fn(z)14 b Fc(\003)1269 2477 y Fm(w)1269
2503 y(r)1307 2492 y Fn(y)1376 2360 y Fd(1)1376 2434
y(A)p eop
%%Page: 27 27
27 26 bop 183 194 a Fw(Moreo)o(v)o(er,)619 258 y Fn(x)11
b Fc(\003)686 241 y Fm(w)686 269 y(r)725 258 y Fn(y)i
Fw(=)-7 b Fq(\))12 b Fs(nest)j Fn(k)g(x)c Fc(\003)1029
241 y Fm(w)q Fr(+)p Fm(k)1029 269 y(r)1111 258 y Fs(nest)k
Fn(k)g(y)183 342 y Fw(and)e(therefore)579 406 y Fs(nest)i
Fn(k)f Fw(\()p Fn(x)p Fq(r)778 389 y Fm(w)778 416 y(r)805
406 y Fn(y)q Fw(\))e(=)g Fs(nest)j Fn(k)g(x)p Fq(r)1082
389 y Fm(w)q Fr(+)p Fm(k)1082 416 y(r)1152 406 y Fs(nest)g
Fn(k)g(y)183 489 y Fw(Finally)m(,)c(w)o(e)j(can)g(reform)o(ulate)f(the)
h(observ)n(ation)g(ab)q(out)g(a)f(simple)g(test)i(for)e
Fc(\003)1442 474 y Fm(w)1442 500 y(r)1483 489 y Fw(as)h(follo)o(ws:)324
614 y Fs(length)h Fn(s)d(>)g Fs(length)j Fn(t)d Fw(=)-7
b Fq(\))748 556 y Fd(\022)779 614 y Fq(^)813 589 y Fs(length)14
b Fn(s)e Fq(\024)g Fn(w)e Fs(`min`)f Fn(r)j Fq(\))f Fs(text)k
Fn(s)d Fc(\003)1382 574 y Fm(w)1382 599 y(r)1421 589
y Fs(text)i Fn(t)813 639 y Fs(length)g Fn(s)e(>)g(w)e
Fs(`min`)f Fn(r)j Fq(\))f Fs(text)k Fn(t)c Fc(\003)1377
624 y Fm(w)1377 649 y(r)1416 639 y Fs(text)k Fn(s)1522
556 y Fd(\023)245 739 y Fw(F)m(rom)h(these)j(prop)q(erties,)g(and)f
(from)e(the)i(fact)g(that)g Fs(b)n(est)g Fw(c)o(ho)q(oses)h(the)f
(nicest)h(elemen)o(t)183 789 y(from)12 b(a)h(set,)i(w)o(e)f(can)g
(deriv)o(e)g(the)h(la)o(ws)e(in)h(\014gure)g(8)g(for)f
Fs(b)n(est)p Fw(.)597 972 y Fk(b)n(est)f Fl(w)h(r)i Fv(\()p
Fl(x)8 b Fv($$)h Fl(y)q Fv(\))j(=)f Fk(b)n(est)i Fl(w)g(r)h(x)8
b Fv($$)h Fk(b)n(est)k Fl(w)g(r)h(y)557 1030 y Fk(b)n(est)f
Fl(w)g(r)h Fv(\()p Fk(nest)e Fl(k)i(x)p Fv(\))e(=)f Fk(nest)h
Fl(k)i Fv(\()p Fk(b)n(est)1131 1012 y Fb(w)q Ff(\000)p
Fb(k)1131 1036 y(r)1209 1030 y Fl(x)p Fv(\))602 1088
y Fk(b)n(est)e Fl(w)h(r)i Fv(\()p Fk(text)d Fl(s)p Fv(\))g(=)f
Fk(text)i Fl(s)609 1146 y Fk(b)n(est)g Fl(w)g(r)h Fv(\()p
Fl(x)9 b Fi([)f Fl(y)q Fv(\))k(=)f Fk(b)n(est)i Fl(w)g(r)h(x)p
Fi(r)1127 1128 y Fb(w)1127 1153 y(r)1152 1146 y Fk(b)n(est)e
Fl(w)i(r)g(y)705 1204 y Fk(b)n(est)e Fl(w)i(r)g Fi(;)e
Fv(=)f Fi(1)183 1367 y Fj(Fig.)6 b(8.)14 b Fv(The)f Fk(b)n(est)e
Fv(la)o(ws.)183 1612 y Fu(8)56 b(Implem)o(en)n(ting)16
b(Prett)n(y-prin)n(ting:)h(A)i(T)-5 b(erm)17 b(Represen)n(tation)183
1724 y Fw(No)o(w)9 b(that)h(w)o(e)h(ha)o(v)o(e)e(dev)o(elop)q(ed)i(a)f
(collection)f(of)h(algebraic)f(prop)q(erties)j(of)d(the)i(prett)o
(y-prin)o(ting)183 1774 y(op)q(erators,)i(w)o(e)g(can)g(apply)f(the)h
(metho)q(ds)f(presen)o(ted)j(in)d(the)h(earlier)g(sections)h(of)e(the)h
(c)o(hapter)183 1824 y(to)g(construct)j(implemen)o(tatio)o(ns.)245
1876 y(\(The)d(reader)g(ma)o(y)d(b)q(e)i(w)o(ondering)g(wh)o(y)g(w)o(e)
g(can't)g(just)g(use)h(the)g(abstract)g(represen)o(tation)183
1926 y(of)g(do)q(cumen)o(ts)h(as)g(an)f(implemen)o(tation,)d(sa)o(y)k
(represen)o(ting)h(a)f Fs(Do)n(c)g Fw(as)g(a)g(list)f(of)h(the)g(p)q
(ossible)183 1975 y Fs(L)n(ayout)p Fw(s.)h(Consider)f(for)h(a)f(momen)o
(t)e(a)i(medium)d(sized)16 b(syn)o(tax)e(tree)i(for)e(an)g(imp)q
(erativ)o(e)f(lan-)183 2025 y(guage,)k(whic)o(h)g(con)o(tains)h(100)e
(o)q(ccurrences)21 b(of)c Ft(if)p Fw({)p Ft(then)p Fw({)p
Ft(el)o(se)p Fw(,)d(eac)o(h)k(prett)o(y-prin)o(ted)h(using)183
2075 y Fs(sep)p Fw(.)f(Ignoring)g(the)h(fact)f(that)h(nesting)g(ma)o(y)
d(force)k(some)d Fs(sep)q Fw(s)h(to)h(mak)o(e)e(related)i(c)o(hoices,)
183 2125 y(suc)o(h)c(a)f Fs(Do)n(c)g Fw(has)h(2)491 2110
y Fr(100)557 2125 y Fw(alternativ)o(e)f(la)o(y)o(outs,)f(and)h(so)g(w)o
(ould)g(b)q(e)h(represen)o(ted)i(b)o(y)d(a)g(list)g(with)183
2175 y(this)k(man)o(y)e(elemen)o(ts.)h(There)i(is)f(no)g(reason)h(to)f
(exp)q(ect)h(the)g(b)q(est)g(la)o(y)o(out)e(to)h(b)q(e)g(near)h(the)183
2224 y(b)q(eginning,)13 b(and)g(so)h(it)g(should)g(b)q(e)g(clear)h
(that)f(searc)o(hing)g(for)g(it)f(in)h(suc)o(h)h(a)e(list)h(is)g(a)f
(hop)q(eless)183 2274 y(exercise.\))245 2327 y(W)m(e)h(will)e(b)q(egin)
j(b)o(y)f(deriving)f(an)h(implemen)o(tation)d(based)k(on)f(a)g(term)f
(represen)o(tation)j(of)183 2376 y Fs(Do)n(c)p Fw(s.)d(W)m(e)f(c)o(ho)q
(ose)i(simpli\014ed)d(terms)h(to)h(whic)o(h)f(the)i Fs(b)n(est)e
Fw(la)o(ws)h(are)g(easily)f(applicable,)g(whic)o(h)183
2426 y(suggests)553 2491 y Fn(E)h Fw(::=)e Fs(text)k
Fn(S)d Fq(j)d Fs(nest)15 b Fn(N)j(E)12 b Fq(j)d Fn(E)i
Fw($$)d Fn(E)k Fq(j)d Fn(E)i Fq([)e Fn(E)i Fq(j)e(;)p
eop
%%Page: 28 28
28 27 bop 340 194 a Fw(Ho)o(w)o(ev)o(er,)14 b(w)o(e)g(also)e(w)o(an)o
(t)i(to)f(b)q(e)h(sure)h(that)e(w)o(e)h(can)g(apply)e(our)i
(simpli\014ed)d(test)k(for)e Fc(\003)1733 179 y Fm(w)1733
204 y(r)1760 194 y Fw(,)g(and)340 244 y(so)k(w)o(e)f(will)f(restrict)j
(the)f(form)e(of)h(unions)g(further.)h(W)m(e)f(can)g(de\014ne)i(a)e
(class)g(of)g(do)q(cumen)o(ts)340 293 y(with)e(a)g(`manifest')d
(\014rst)k(line)e(b)o(y)865 378 y Fn(M)j Fw(::=)11 b
Fs(text)k Fn(S)d Fq(j)c Fs(text)15 b Fn(S)d Fw($$)d Fn(E)340
462 y Fw(The)16 b(simpli\014ed)d(test)j(is)f(easily)f(applicable)h(to)f
(do)q(cumen)o(ts)h(of)g(this)g(form)e(pro)o(vided)i(one)g(has)340
512 y(a)f(longer)g(\014rst)g(line)g(than)g(the)g(other.)g(W)m(e)g(will)
e(therefore)j(only)e(p)q(ermit)g(unions)h(of)f(the)i(form)947
596 y Fn(U)i Fw(::=)11 b Fn(M)j Fq(j)8 b Fn(U)14 b Fq([)9
b Fn(U)340 680 y Fw(and)15 b(moreo)o(v)o(er)e(w)o(e)i(shall)e(imp)q
(ose)h(an)g(in)o(v)n(arian)o(t)f(that)h(the)h(\014rst)g(line)f(of)g(ev)
o(ery)h(la)o(y)o(out)f(in)g(the)340 730 y(left)d(op)q(erand)g(of)f
Fq([)g Fw(m)o(ust)f(b)q(e)i(strictly)g(longer)f(than)h(the)g(\014rst)g
(line)f(of)g(ev)o(ery)h(la)o(y)o(out)e(in)i(the)g(righ)o(t)340
780 y(op)q(erand.)i(Since)g(b)q(oth)g(op)q(erands)g(represen)o(t)i(the)
e(same)e(string)i(it)f(follo)o(ws)f(that)i(all)e(la)o(y)o(outs)h(in)340
830 y(the)j(righ)o(t)e(op)q(erand)i(consist)f(of)g(at)f(least)h(t)o(w)o
(o)g(lines.)403 879 y(No)o(w)f(w)o(e)h(can)g(de\014ne)h(simpli\014ed)d
(terms)i(b)o(y)923 964 y Fn(E)f Fw(::=)e Fn(U)j Fq(j)9
b Fs(nest)15 b Fn(N)k(E)340 1048 y Fw(W)m(e)14 b(allo)o(w)e
Fq(;)i Fw(only)f(at)h(the)g(top)g(lev)o(el)f(of)h(the)g(result)h(of)e
Fs(\014t)p Fw(,)988 1132 y Fn(E)r Fw(0)f(::=)f Fn(E)g
Fq(j)e(;)340 1216 y Fw(With)14 b(these)h(restrictions)g
Fs(b)n(est)f Fw(of)f(a)h(union)f(is)h(easily)f(determined.)403
1266 y(W)m(e)g(can)h(represen)o(t)i Fs(Do)n(c)q Fw(s)e(b)o(y)g(the)g(t)
o(yp)q(e)617 1345 y Ft(data)i Fs(Do)n(c)c Fw(=)59 b Fs(T)m(ext)14
b(String)217 b Fq(\000)-5 b(\000)10 b Fs(text)15 b Fn(s)864
1395 y Fq(j)21 b Fs(String)9 b(`T)m(extA)o(b)n(ove`)f(Do)n(c)13
b Fq(\000)-5 b(\000)10 b Fs(text)15 b Fn(s)9 b Fw($$)g
Fn(x)864 1445 y Fq(j)21 b Fs(Do)n(c)10 b(`Union`)f(Do)n(c)126
b Fq(\000)-5 b(\000)10 b Fn(x)f Fq([)g Fn(y)864 1495
y Fq(j)21 b Fs(Empty)303 b Fq(\000)-5 b(\000)10 b(;)864
1545 y(j)21 b Fs(Nest)14 b(Int)g(Do)n(c)189 b Fq(\000)-5
b(\000)10 b Fs(nest)15 b Fn(k)g(x)340 1625 y Fw(although)k(w)o(e)g(m)o
(ust)f(b)q(e)i(careful)g(only)e(to)h(construct)i(do)q(cumen)o(ts)e(of)g
(the)h(form)d(describ)q(ed)340 1675 y(ab)q(o)o(v)o(e.)403
1725 y(W)m(e)f(can)g(use)i(the)f(same)e(t)o(yp)q(e)i(to)f(represen)o(t)
j Fs(L)n(ayout)q Fw(s:)d(a)g Fs(Do)n(c)h Fw(not)f(in)o(v)o(olving)e
Fs(Union)j Fw(or)340 1774 y Fs(Empty)d Fw(represen)o(ts)j(a)d
Fs(L)n(ayout)p Fw(.)403 1824 y(The)e(de\014nition)f(of)g
Fs(b)n(est)h Fw(is)f(no)o(w)g(easy)h(to)g(deriv)o(e)g(b)o(y)f(applying)
g(the)h Fs(b)n(est)f Fw(la)o(ws)h(|)f(see)i(\014gure)340
1874 y(9.)h(W)m(e'll)e(discuss)j(only)e(the)h Fs(Union)h
Fw(case.)f(W)m(e)f(kno)o(w)h(from)e(the)i Fs(b)n(est)g
Fw(la)o(ws)f(that)658 1958 y Fs(b)n(est)i Fn(w)g(r)f
Fw(\()p Fn(x)c Fs(`Union`)f Fn(y)q Fw(\))j(=)g Fs(b)n(est)j
Fn(w)f(r)h(x)p Fq(r)1326 1941 y Fm(w)1326 1968 y(r)1352
1958 y Fs(b)n(est)g Fn(w)g(r)f(y)340 2042 y Fw(But)20
b(since)h Fs(b)n(est)e Fw(m)o(ust)f(c)o(ho)q(ose)j(one)e(of)g(the)h(la)
o(y)o(outs)f(in)g(its)g(argumen)o(t,)f(the)i(datat)o(yp)q(e)g(in-)340
2092 y(v)n(arian)o(t)c(implies)f(that)j(if)e Fs(b)n(est)e
Fn(w)k(r)g(x)f Fw(is)g(either)h Fs(text)c Fn(s)k Fw(or)f
Fs(text)e Fn(s)c Fw($$)g Fn(x)1495 2077 y Fh(0)1507 2092
y Fw(,)16 b(and)h Fs(b)n(est)e Fn(w)j(r)f(y)i Fw(is)340
2142 y Fs(text)c Fn(t)10 b Fw($$)e Fn(y)517 2127 y Fh(0)530
2142 y Fw(,)13 b(then)i Fs(length)g Fn(s)e(>)f Fs(length)j
Fn(t)p Fw(.)e(So)h(the)h(simpli\014ed)d(niceness)k(comparison)c(is)i
(appli-)340 2192 y(cable.)i(If)f Fs(nic)n(e)576 2175
y Fm(w)576 2202 y(r)602 2192 y Fw(\()p Fs(text)g Fn(s)p
Fw(\))i(then)f Fs(text)f Fn(s)g Fc(\003)994 2177 y Fm(w)994
2202 y(r)1036 2192 y Fs(text)g Fn(t)p Fw(,)g(and)h(b)o(y)g(the)g
(lexicographic)f(prop)q(erties)j(it)340 2242 y(follo)o(ws)e(that)i
Fs(text)c Fn(s)k Fc(\003)723 2227 y Fm(w)723 2252 y(r)768
2242 y Fs(text)d Fn(t)c Fw($$)g Fn(y)949 2227 y Fh(0)979
2242 y Fw(and)17 b Fs(text)e Fn(s)d Fw($$)f Fn(x)1252
2227 y Fh(0)1281 2242 y Fc(\003)1313 2227 y Fm(w)1313
2252 y(r)1358 2242 y Fs(text)k Fn(t)c Fw($$)g Fn(y)1539
2227 y Fh(0)1552 2242 y Fw(.)17 b(So)g(in)g(this)g(case)340
2292 y Fq(r)375 2276 y Fm(w)375 2302 y(r)419 2292 y Fw(c)o(ho)q(oses)h
(its)f(left)f(op)q(erand.)h(If)g Fq(:)p Fs(nic)n(e)1026
2275 y Fm(w)1026 2302 y(r)1052 2292 y Fw(\()p Fs(text)e
Fn(s)p Fw(\))j(then)f(the)h(opp)q(osite)f(holds.)f(So)h(w)o(e)g(can)340
2341 y(implemen)o(t)e Fq(r)583 2326 y Fm(w)583 2352 y(r)626
2341 y Fw(in)i(this)g(case)h(b)o(y)f(the)h(function)e
Fs(nic)n(est)p Fw(,)h(whic)o(h)g(simply)e(insp)q(ects)k(the)e(\014rst)
340 2391 y(line)d(of)f(its)h(\014rst)h(op)q(erand.)403
2441 y(Hask)o(ell's)g(lazy)h(ev)n(aluation)f(is)h(exploited)g(here,)h
(in)f(t)o(w)o(o)g(w)o(a)o(ys.)f(Firstly)m(,)h Fs(shorter)e(xs)i
Fn(n)g Fw(is)340 2491 y(de\014ned)h(to)e(test)h(whether)h
Fs(length)e(xs)f Fq(\024)g Fn(n)h Fs(without)g Fw(ev)n(aluating)f(all)g
(of)g Fs(xs)i Fw(if)e(it)h(is)g(not.)g(Since)p eop
%%Page: 29 29
29 28 bop 382 226 a Fk(b)n(est)12 b Fl(w)i(r)g Fv(\()p
Fk(T)m(ext)f Fl(s)p Fv(\))e(=)f Fk(T)m(ext)k Fl(s)382
271 y Fk(b)n(est)e Fl(w)i(r)g Fv(\()p Fl(s)8 b Fk(`T)m(extA)o(b)n(ove`)
e Fl(x)p Fv(\))k(=)h Fl(s)d Fk(`T)m(extA)o(b)n(ove`)e(b)n(est)13
b Fl(w)g(r)h(x)382 317 y Fk(b)n(est)e Fl(w)i(r)g Fv(\()p
Fk(Nest)e Fl(k)i(x)p Fv(\))c(=)h Fk(Nest)h Fl(k)i Fv(\()p
Fk(b)n(est)f Fv(\()p Fl(w)c Fi(\000)f Fl(k)q Fv(\))13
b Fl(r)h(x)p Fv(\))382 363 y Fk(b)n(est)e Fl(w)i(r)g
Fv(\()p Fl(x)8 b Fk(`Union`)e Fl(y)q Fv(\))11 b(=)g Fk(nic)n(est)24
b Fl(w)14 b(r)g Fv(\()p Fk(b)n(est)e Fl(w)h(r)i(x)p Fv(\))d(\()p
Fk(b)n(est)h Fl(w)g(r)h(y)q Fv(\))382 454 y Fk(nic)n(est)25
b Fl(w)13 b(r)h(x)f(y)f Fv(=)e Fj(if)k Fk(shorter)e Fv(\()p
Fk(\014rstline)g Fl(x)p Fv(\))g(\()p Fl(w)d Fk(`min`)f
Fl(r)q Fv(\))13 b Fj(then)h Fl(x)f Fj(else)i Fl(y)382
500 y Fk(shorter)d(xs)h Fl(n)d Fv(=)h Fk(nul)r(l)h Fv(\()p
Fk(dr)n(op)h Fl(n)g Fk(xs)o Fv(\))382 545 y Fk(\014rstline)f
Fv(\()p Fk(T)m(ext)h Fl(s)p Fv(\))d(=)h Fl(s)382 591
y Fk(\014rstline)h Fv(\()p Fl(s)c Fk(`T)m(extA)o(b)n(ove`)e
Fl(x)p Fv(\))k(=)h Fl(s)183 718 y Fj(Fig.)6 b(9.)14 b
Fv(The)f(de\014nition)i(of)e Fk(b)n(est)o Fv(.)183 860
y Fw(some)c(la)o(y)o(outs)h(ma)o(y)f(ha)o(v)o(e)h(v)o(ery)h(long)e
(\014rst)i(lines)g(|)f(for)g(example,)f(the)i(la)o(y)o(out)e(pro)q
(duced)j(when)183 909 y(all)e Fs(sep)p Fw(s)i(adopt)f(a)g(horizon)o
(tal)g(form)e(|)i(this)h(is)f(an)g(imp)q(ortan)o(t)f(optimisation.)e
(Secondly)m(,)j(since)183 959 y Fs(nic)n(est)29 b Fw(mak)o(es)15
b(its)g(decision)g(on)g(the)h(basis)f(of)f(the)i(\014rst)g(line)f(of)f
(eac)o(h)i(argumen)o(t)e Fs(only)p Fw(,)h(then)183 1009
y(when)g(w)o(e)g(select)h(the)f(b)q(est)h(la)o(y)o(out)d(from)g(a)h
Fs(Union)h Fw(the)h(la)o(y)o(out)d(of)h(the)h(unsuccessful)i(branc)o(h)
183 1059 y(is)d(ev)n(aluated)f(only)h(as)g(far)g(as)g(the)g(\014rst)h
(line.)e(Although)h(the)h Fs(Do)n(c)f Fw(w)o(e)h(apply)e
Fs(b)n(est)h Fw(to)g(ma)o(y)e(b)q(e)183 1109 y(a)h(large)h(tree,)g(w)o
(e)h(follo)o(w)d(\(and)h(therefore)j(ev)n(aluate\))d(only)h(a)f(single)
h(path)g(through)f(it.)245 1159 y(De\014nitions)g(of)f
Fs(text)p Fw(,)h Fs(nest)p Fw(,)g(\()-7 b Fn(<)g(>)g
Fw(\))14 b(and)f(\($$\))g(are)h(obtained)f(b)o(y)g(simple)f(algebraic)h
(manipu-)183 1208 y(lation.)f(T)m(o)h(tak)o(e)h(just)g(t)o(w)o(o)f
(examples,)455 1287 y(\()p Fs(Nest)i Fn(k)g(x)p Fw(\))9
b($$)f Fn(y)14 b Fw(=)e(\()p Fs(nest)j Fn(k)g(x)p Fw(\))9
b($$)f Fn(y)737 1337 y Fw(=)k(\()p Fs(nest)j Fn(k)g(x)p
Fw(\))9 b($$)f(\()p Fs(nest)16 b Fn(k)e Fw(\()p Fs(nest)i
Fw(\()p Fq(\000)p Fn(k)q Fw(\))e Fn(y)q Fw(\)\))737 1387
y(=)e Fs(nest)j Fn(k)g Fw(\()p Fn(x)9 b Fw($$)f Fs(nest)15
b Fw(\()p Fq(\000)p Fn(k)q Fw(\))g Fn(y)q Fw(\))737 1437
y(=)d Fs(Nest)i Fn(k)h Fw(\()p Fn(x)9 b Fw($$)g Fs(Nest)14
b Fw(\()p Fq(\000)p Fn(k)q Fw(\))h Fn(y)q Fw(\))188 1535
y Fs(T)m(ext)g Fn(s)d(<)-7 b(>)12 b Fw(\()p Fn(t)e Fs(`T)m(extA)o(b)n
(ove`)e Fn(x)p Fw(\))k(=)f Fs(text)k Fn(s)d(<)-7 b(>)12
b Fw(\()p Fs(text)j Fn(t)10 b Fw($$)e Fn(x)p Fw(\))694
1584 y(=)j Fs(text)k Fn(s)d(<)-7 b(>)12 b Fw(\(\()p Fs(text)j
Fp(\\")c Fn(<)-7 b(>)13 b Fs(text)h Fn(t)p Fw(\))c($$)f
Fn(x)p Fw(\))694 1634 y(=)i(\()p Fs(text)k Fn(s)d(<)-7
b(>)13 b Fs(text)h Fn(t)p Fw(\))c($$)e Fs(nest)15 b Fw(\()p
Fs(length)h Fn(s)p Fw(\))e Fn(x)53 b Fw([)p Fn(<)-7 b(>)p
Fw(/)9 b($$)23 b(la)o(w)o(])694 1684 y(=)11 b Fs(text)k
Fw(\()p Fn(s)10 b Fw(+)-12 b(+)p Fn(t)p Fw(\))10 b($$)f
Fs(nest)15 b Fw(\()p Fs(length)g Fn(s)p Fw(\))g Fn(x)694
1734 y Fw(=)c(\()p Fn(s)f Fw(+)-12 b(+)p Fn(t)p Fw(\))11
b Fs(`T)m(extA)o(b)n(ove`)d(Nest)15 b Fw(\()p Fs(length)g
Fn(s)p Fw(\))f Fn(x)183 1822 y Fw(The)j(remaining)e(equations)i(are)g
(deriv)o(ed)h(similarly;)13 b(the)18 b(complete)e(de\014nitions)h(app)q
(ear)h(in)183 1871 y(\014gure)12 b(10.)f(It)i(is)e(easy)i(to)f(v)o
(erify)g(that)g(the)g(de\014nitions)g(terminate.)f(W)m(e)h(lea)o(v)o(e)
g(it)g(to)g(the)g(reader)183 1921 y(to)h(c)o(hec)o(k)h(that)f(if)f(the)
i(datat)o(yp)q(e)g(in)o(v)n(arian)o(t)d(holds)i(for)g(the)h(argumen)o
(ts,)e(it)g(also)h(holds)g(for)g(the)183 1971 y(result)h(of)g(eac)o(h)g
(these)h(op)q(erators.)245 2021 y(It)j(is)f(in)o(teresting)h(to)g(lo)q
(ok)e(at)i(the)g(w)o(a)o(y)f Fs(Union)p Fw(s)h(are)g(treated)h(in)e
(these)i(de\014nitions.)e(In)183 2071 y(almost)11 b(ev)o(ery)j(case)h
Fs(Union)p Fw(s)f(in)f(argumen)o(ts)g(are)g(`\015oated)h(up)o(w)o
(ards')f(to)g(giv)o(e)g(a)g Fs(Union)h Fw(in)f(the)183
2120 y(result.)j(The)h(exception)g(is)f(a)g Fs(Union)h
Fw(in)e(the)i(righ)o(t)f(argumen)o(t)f(of)h(\($$\):)f(w)o(e)i(do)f(not)
g(use)h(the)183 2170 y(prop)q(ert)o(y)648 2219 y Fn(x)9
b Fw($$)g(\()p Fn(y)i Fq([)e Fn(z)r Fw(\))i(=)h(\()p
Fn(x)d Fw($$)g Fn(y)q Fw(\))h Fq([)f Fw(\()p Fn(x)g Fw($$)g
Fn(z)r Fw(\))183 2292 y(One)k(go)q(o)q(d)f(reason)h(is)f(that)h(to)f
(do)h(so)f(w)o(ould)g(violate)f(the)i(datat)o(yp)q(e)g(in)o(v)n(arian)o
(t:)d(the)k(op)q(erands)183 2341 y(of)g(the)i(union)e(on)h(the)h(righ)o
(t)e(hand)h(side)g(ha)o(v)o(e)g(the)h Fs(same)f Fw(\014rst)h(lines.)e
(Another)i(go)q(o)q(d)f(reason)183 2391 y(is)d(e\016ciency:)h(the)h
Fs(Do)n(c)f Fw(form)e(w)o(e)i(ha)o(v)o(e)f(c)o(hosen)i(groups)f
(together)g(all)f(la)o(y)o(outs)g(with)g(the)h(same)183
2441 y(\014rst)k(line)f(in)h(a)f(v)n(alue)g(of)g(the)i(form)d
Fn(s)c Fs(`T)m(extA)o(b)n(ove`)g Fn(x)p Fw(.)16 b(The)h
Fs(b)n(est)f Fw(function)h(can)g(then)g(reject)183 2491
y(all)d(these)k(la)o(y)o(outs)d(in)h(one)g(go,)f(if)g
Fn(s)h Fw(is)g(not)g(nice.)g(Here)h Fn(x)f Fw(ma)o(y)e(represen)o(t)19
b(man)o(y)14 b(billions)g(of)p eop
%%Page: 30 30
30 29 bop 536 226 a Fk(text)13 b Fl(s)d Fv(=)h Fk(T)m(ext)i
Fl(s)536 317 y Fk(nest)f Fl(k)i(x)d Fv(=)f Fk(Nest)i
Fl(k)i(x)536 408 y Fk(T)m(ext)f Fl(s)c Fv($$)g Fl(y)j
Fv(=)e Fl(s)f Fk(`T)m(extA)o(b)n(ove`)c Fl(y)536 454
y Fv(\()p Fl(s)j Fk(`T)m(extA)o(b)n(ove`)e Fl(x)p Fv(\))i($$)h
Fl(y)j Fv(=)f Fl(s)d Fk(`T)m(extA)o(b)n(ove`)e Fv(\()p
Fl(x)i Fv($$)h Fl(y)q Fv(\))536 500 y(\()p Fk(Nest)j
Fl(k)i(x)p Fv(\))8 b($$)h Fl(y)j Fv(=)f Fk(Nest)h Fl(k)i
Fv(\()p Fl(x)8 b Fv($$)h Fk(Nest)j Fv(\()p Fi(\000)p
Fl(k)q Fv(\))h Fl(y)q Fv(\))536 545 y(\()p Fl(x)8 b Fk(`Union`)e
Fl(y)q Fv(\))j($$)g Fl(z)j Fv(=)f(\()p Fl(x)d Fv($$)h
Fl(z)r Fv(\))f Fk(`Union`)e Fv(\()p Fl(y)j Fv($$)g Fl(z)r
Fv(\))536 637 y Fk(T)m(ext)k Fl(s)e(<)-6 b(>)10 b Fk(T)m(ext)j
Fl(t)e Fv(=)f Fk(T)m(ext)k Fv(\()p Fl(s)8 b Fv(+)-11
b(+)p Fl(t)p Fv(\))536 682 y Fk(T)m(ext)13 b Fl(s)e(<)-6
b(>)10 b Fv(\()p Fl(t)e Fk(`T)m(extA)o(b)n(ove`)e Fl(x)p
Fv(\))k(=)h(\()p Fl(s)d Fv(+)-11 b(+)p Fl(t)p Fv(\))9
b Fk(`T)m(extA)o(b)n(ove`)c(Nest)13 b Fv(\()p Fk(length)e
Fl(s)p Fv(\))i Fl(x)536 728 y Fk(T)m(ext)g Fl(s)e(<)-6
b(>)10 b Fv(\()p Fk(Nest)i Fl(k)i(x)p Fv(\))c(=)h Fk(T)m(ext)i
Fl(s)e(<)-6 b(>)10 b(x)536 774 y Fk(T)m(ext)j Fl(s)e(<)-6
b(>)10 b Fv(\()p Fl(x)e Fk(`Union`)e Fl(y)q Fv(\))11
b(=)g(\()p Fk(T)m(ext)i Fl(s)d(<)-6 b(>)10 b(x)p Fv(\))f
Fk(`Union`)d Fv(\()p Fk(T)m(ext)13 b Fl(s)d(<)-6 b(>)10
b(y)q Fv(\))536 819 y(\()p Fl(s)e Fk(`T)m(extA)o(b)n(ove`)e
Fl(x)p Fv(\))k Fl(<)-6 b(>)10 b(y)i Fv(=)f Fl(s)d Fk(`T)m(extA)o(b)n
(ove`)e Fv(\()p Fl(x)k(<)-6 b(>)10 b(y)q Fv(\))536 865
y Fk(Nest)i Fl(k)i(x)d(<)-6 b(>)10 b(y)i Fv(=)e Fk(Nest)i
Fl(k)q Fv(\()p Fl(x)f(<)-6 b(>)10 b(y)q Fv(\))536 911
y(\()p Fl(x)e Fk(`Union`)e Fl(y)q Fv(\))11 b Fl(<)-6
b(>)10 b(z)i Fv(=)f(\()p Fl(x)f(<)-6 b(>)10 b(z)r Fv(\))e
Fk(`Union`)e Fv(\()p Fl(y)12 b(<)-6 b(>)10 b(z)r Fv(\))340
1039 y Fj(Fig.)d(10.)13 b Fv(The)g(de\014nitions)j(of)d
Fk(text)o Fv(,)f Fk(nest)o Fv(,)g(\()-6 b Fl(<)g(>)g
Fv(\))12 b(and)h(\($$\).)340 1188 y Fw(alternativ)o(e)j(la)o(y)o(outs,)
f(and)g(if)g(all)g Fs(Union)p Fw(s)i(w)o(ere)f(\015oated)g(to)g(the)h
(top)e(lev)o(el)h(then)g Fs(b)n(est)g Fw(w)o(ould)340
1238 y(ha)o(v)o(e)e(to)g(reject)i(eac)o(h)e(one)g(individually)m(.)d
(The)j(cost)h(w)o(ould)e(b)q(e)i(prohibitiv)o(e,)d(and)i(the)h(library)
340 1288 y(simply)d(w)o(ould)h(not)h(w)o(ork.)403 1339
y(W)m(e)f(still)g(need)i(to)f(implem)o(en)o(t)e Fs(sep)i
Fw(|)f(recall)h(its)g(sp)q(eci\014cation)695 1434 y Fs(sep)h(xs)c
Fw(=)h Fs(\014t)j Fw(\()p Fs(foldr1)g Fw(\()-7 b Fn(<)e
Fw(+)g Fn(>)i Fw(\))14 b Fs(xs)q Fw(\))9 b Fq([)g Fs(foldr1)14
b Fw(\($$\))g Fs(xs)340 1529 y Fw(W)m(e)e(can)h(almost)d(use)k(this)e
(directly)h(as)f(the)h(implemen)o(tation,)c(but)j(w)o(e)h(m)o(ust)e
(ensure)j(that)f(the)340 1579 y Fs(Union)h Fw(is)f(w)o(ell-formed.)e
(Firstly)m(,)h(if)g(the)i(result)g(of)e Fs(\014t)h Fw(is)g
Fq(;)g Fw(w)o(e)g(m)o(ust)g(a)o(v)o(oid)e(creating)j(a)f
Fs(Union)340 1629 y Fw(with)k(an)f(empt)o(y)g(op)q(erand.)h(Secondly)m
(,)f(w)o(e)g(m)o(ust)g(ensure)i(that)f(the)g(\014rst)h(line)e(of)g(the)
h(result)340 1678 y(of)g(the)g Fs(\014t)g Fw(is)g(strictly)h(longer)e
(than)h(the)h(\014rst)g(lines)f(in)f(the)i(second)g(op)q(erand.)f(Pro)o
(vided)g Fs(xs)340 1728 y Fw(consists)g(of)d(at)h(least)g(t)o(w)o(o)g
(do)q(cumen)o(ts)g(this)g(is)g(guaran)o(teed,)g(since)h(the)g(longest)f
(\014rst)h(line)f(in)340 1778 y(\()p Fn(x)380 1784 y
Fr(1)406 1778 y Fw($$)7 b Fn(x)479 1784 y Fr(2)503 1778
y Fn(:)g(:)g(:)12 b Fw($$)7 b Fn(x)638 1784 y Fm(n)659
1778 y Fw(\))13 b(is)g(the)g(longest)f(\014rst)i(line)e(in)g
Fn(x)1171 1784 y Fr(1)1189 1778 y Fw(,)h(and)f(the)h(horizon)o(tal)f
(form)f(con)o(tains)h(at)340 1828 y(least)h(one)g(extra)g(space.)g(But)
g(if)e Fs(xs)i Fw(consists)h(of)e(exactly)g(one)h(do)q(cumen)o(t)f
(then)h(the)g(horizon)o(tal)340 1878 y(and)j(v)o(ertical)f(forms)f(are)
h(the)h(same,)e(and)h(a)g Fs(Union)h Fw(w)o(ould)f(b)q(e)g(badly)g
(formed.)f(So)h(w)o(e)g(m)o(ust)340 1928 y(treat)e(this)f(as)f(a)h(sp)q
(ecial)g(case.)g(Thirdly)m(,)e(w)o(e)i(m)o(ust)f(a)o(v)o(oid)f
(constructing)j(a)e Fs(Union)h Fw(with)f Fs(nest)q Fw(ed)340
1977 y(op)q(erands:)j(this)f(can)g(only)f(happ)q(en)i(if)e(the)h
(\014rst)h Fs(Do)n(c)f Fw(in)g(the)g(list)g(is)g(of)f(the)h(form)f
Fs(Nest)i Fn(k)g(x)p Fw(.)e(In)340 2027 y(that)i(case)h(w)o(e)f(factor)
g(out)g(the)g Fs(Nest)p Fw(:)493 2106 y Fs(sep)h Fw(\()p
Fs(nest)g Fn(k)g(x)d Fw(:)f Fs(xs)p Fw(\))h(=)17 b Fs(\014t)e
Fw(\()p Fs(nest)g Fn(k)g(x)c(<)-9 b Fw(+)g Fn(>)12 b
Fs(foldr1)j Fw(\()-7 b Fn(<)e Fw(+)g Fn(>)i Fw(\))p Fs(xs)q
Fw(\))p Fq([)878 2156 y Fw(\()p Fs(nest)15 b Fn(k)g(x)9
b Fw($$)g Fs(foldr1)14 b Fw(\($$\))p Fs(xs)p Fw(\))829
2206 y(=)j Fs(nest)e Fn(k)g Fw(\()p Fs(\014t)g Fw(\()p
Fn(x)d(<)-9 b Fw(+)g Fn(>)12 b Fs(foldr1)i Fw(\()-7 b
Fn(<)e Fw(+)g Fn(>)i Fw(\))p Fs(xs)q Fw(\)\))p Fq([)878
2255 y Fs(nest)15 b Fn(k)g Fw(\()p Fn(x)9 b Fw($$)g Fs(foldr1)14
b Fw(\($$\)\()p Fs(map)h Fw(\()p Fs(nest)h Fw(\()p Fq(\000)p
Fn(k)q Fw(\)\))e Fs(xs)p Fw(\)\))829 2305 y(=)d Fs(nest)16
b Fn(k)q Fw(\()p Fs(sep)f Fw(\()p Fn(x)c Fw(:)g Fs(map)k
Fw(\()p Fs(nest)h Fw(\()p Fq(\000)p Fn(k)q Fw(\)\))e
Fs(xs)340 2391 y Fw(The)f(de\014nitions)g(of)f Fs(sep)h
Fw(and)f Fs(\014t)h Fw(app)q(ear)g(in)f(\014gure)h(11.)e(Notice)i(that)
g(the)g(datat)o(yp)q(e)g(in)o(v)n(arian)o(t)340 2441
y(lets)h(us)g(de\014ne)h Fs(\014t)e Fw(of)g(a)g Fs(Union)h
Fw(v)o(ery)g(e\016cien)o(tly)m(,)e(since)j(w)o(e)e(kno)o(w)g(the)h(la)o
(y)o(outs)f(in)g(the)h(second)340 2491 y(op)q(erand)h(consist)f(of)g
(at)f(least)h(t)o(w)o(o)g(lines.)p eop
%%Page: 31 31
31 30 bop 448 226 a Fk(sep)12 b Fv([)p Fl(x)p Fv(])e(=)h
Fl(x)448 271 y Fk(sep)h Fv(\()p Fk(Nest)g Fl(k)i(x)d
Fv(:)f Fk(xs)p Fv(\))g(=)h Fk(Nest)h Fl(k)i Fv(\()p Fk(sep)e
Fv(\()p Fl(x)f Fv(:)f Fk(map)j Fv(\()p Fk(nest)g Fv(\()p
Fi(\000)p Fl(k)q Fv(\)\))f Fk(xs)p Fv(\)\))448 317 y
Fk(sep)g(xs)e Fv(=)h Fk(\014t)i Fv(\()p Fk(foldr1)f Fv(\()-6
b Fl(<)d Fv(+)g Fl(>)j Fv(\))12 b Fk(xs)p Fv(\))c Fk(`u`)g(foldr1)k
Fv(\($$\))h Fk(xs)499 363 y Fj(where)21 b Fk(Empty)8
b(`u`)f Fl(y)12 b Fv(=)f Fl(y)635 408 y(x)d Fk(`u`)g
Fl(y)k Fv(=)e Fl(x)e Fk(`Union`)e Fl(y)448 500 y Fk(\014t)13
b Fv(\()p Fk(T)m(ext)g Fl(s)p Fv(\))d(=)h Fk(T)m(ext)i
Fl(s)448 545 y Fk(\014t)g Fv(\()p Fl(s)8 b Fk(`T)m(extA)o(b)n(ove`)e
Fl(x)p Fv(\))k(=)h Fk(Empty)448 591 y(\014t)i Fv(\()p
Fk(Nest)f Fl(k)i(x)p Fv(\))c(=)16 b Fj(case)g Fk(\014t)d
Fl(x)g Fj(of)771 637 y Fk(Empty)e Fi(!)h Fk(Empty)771
682 y Fl(y)101 b Fi(!)12 b Fk(Nest)g Fl(k)i(y)448 728
y Fk(\014t)f Fv(\()p Fl(x)8 b Fk(`Union`)e Fl(y)q Fv(\))11
b(=)f Fk(\014t)j Fl(x)183 855 y Fj(Fig.)6 b(11.)14 b
Fv(The)f(de\014nition)i(of)e Fk(sep)o Fv(.)245 1001 y
Fw(T)m(o)g(complete)g(the)h(implemen)o(tation)c(of)j(the)i(library)e(w)
o(e)h(just)f(need)i(to)f(de\014ne)g(a)g(function)183
1050 y(mapping)d Fs(L)n(ayout)q Fw(s)j(to)g(appropriate)g(strings.)g
(Let)g(us)g(de\014ne)680 1143 y Fs(layout)e Fw(::)e Fs(Int)i
Fq(!)f Fs(Do)n(c)h Fq(!)f Fs(String)183 1236 y Fw(suc)o(h)17
b(that)h Fs(layout)d Fn(k)j(x)e Fw(constructs)j(a)e(string)g(displa)o
(ying)f Fs(nest)f Fn(k)j(x)p Fw(.)e(A)h(suitable)g(de\014nition)183
1286 y(app)q(ears)d(in)g(\014gure)g(12.)499 1464 y Fk(layout)e
Fl(k)i Fv(\()p Fk(T)m(ext)f Fl(s)p Fv(\))d(=)h Fk(indent)h
Fl(k)h(s)499 1510 y Fk(layout)f Fl(k)i Fv(\()p Fl(s)8
b Fk(`T)m(extA)o(b)n(ove`)e Fl(x)p Fv(\))k(=)h Fk(indent)g
Fl(k)j(s)9 b Fv(+)-11 b(+)p Fk(layout)11 b Fl(k)j(x)499
1555 y Fk(layout)e Fl(k)i Fv(\()p Fk(Nest)e Fl(k)772
1540 y Ff(0)796 1555 y Fl(x)p Fv(\))e(=)h Fk(layout)h
Fv(\()p Fl(k)d Fv(+)g Fl(k)1103 1540 y Ff(0)1114 1555
y Fv(\))k Fl(x)499 1647 y Fk(indent)f Fl(k)i(s)8 b Fi(j)g
Fl(k)k Fi(\025)f Fv(8)f(=)h(`)p Fi(n)p Fl(t)p Fv(')f(:)g
Fk(indent)i Fv(\()p Fl(k)d Fi(\000)g Fv(8\))k Fl(s)499
1692 y Fk(indent)f Fl(k)i(s)8 b Fi(j)g Fl(k)k Fi(\025)f
Fv(1)f(=)h(`)h(')f(:)f Fk(indent)i Fv(\()p Fl(k)d Fi(\000)g
Fv(1\))k Fl(s)499 1738 y Fk(indent)f Fv(0)h Fl(s)d Fv(=)h
Fl(s)d Fv(+)-11 b(+\\)p Fi(n)p Fl(n)p Fv(")183 1865 y
Fj(Fig.)6 b(12.)14 b Fv(Mapping)h(la)o(y)o(outs)f(to)f(strings.)245
2012 y Fw(One)i(or)e(t)o(w)o(o)h(minor)e(optimisations)f(can)j(b)q(e)h
(made.)d(F)m(or)i(example,)637 2105 y Fs(b)n(est)h Fn(w)g(r)g
Fw(\(\()p Fn(x)9 b Fs(`Union`)g Fn(y)q Fw(\))h Fs(`Union`)f
Fn(z)r Fw(\))183 2198 y(tests)16 b Fn(x)e Fw(for)g(niceness)i(t)o(wice)
f(if)e(it)h(is)g(nice)h(|)f(once)h(to)g(reject)g Fn(y)q
Fw(,)g(and)f(once)h(to)g(reject)g Fn(z)r Fw(.)g(This)183
2247 y(is)i(easily)g(a)o(v)o(oided,)f(sa)o(y)i(b)o(y)f(rede\014ning)h
Fs(b)n(est)g Fw(to)f(return)i(a)e(pair)g(of)g(the)h(b)q(est)h(la)o(y)o
(out)d(and)i(a)183 2297 y(b)q(o)q(olean)d(indicating)g(whether)i(the)g
(\014rst)g(line)e(is)h(nice.)g(Suc)o(h)h(measures)f(can)g(bring)g(a)f
(useful)183 2347 y(impro)o(v)o(em)o(en)o(t)d(in)h(p)q(erformance,)h
(but)g(in)f(fact)h(a)g(m)o(uc)o(h)e(more)h(serious)i(problem)d
(remains.)245 2398 y(Consider)i(for)g(example)560 2491
y Fs(sep)h Fw([)p Fs(sep)g Fw([)p Fs(sep)f Fw([)p 811
2455 93 2 v 810 2505 2 50 v 817 2490 a Fp(hello)p 902
2505 V 811 2507 93 2 v 903 2491 a Fn(;)p 922 2455 32
2 v 921 2505 2 50 v 928 2490 a Fp(a)p 953 2505 V 922
2507 32 2 v 953 2491 a Fw(])p Fn(;)p 984 2455 34 2 v
983 2505 2 50 v 990 2490 a Fp(b)p 1016 2505 V 984 2507
34 2 v 1016 2491 a Fw(])p Fn(;)p 1047 2455 31 2 v 1046
2505 2 50 v 1053 2490 a Fp(c)p 1076 2505 V 1047 2507
31 2 v 1076 2491 a Fw(])p eop
%%Page: 32 32
32 31 bop 729 264 a Fw(=)773 154 y Fd(8)773 191 y(>)773
204 y(>)773 216 y(<)773 291 y(>)773 303 y(>)773 316 y(:)p
810 229 194 2 v 809 278 2 50 v 816 263 a Fp(hello)14
b(a)g(b)g(c)p 1002 278 V 810 280 194 2 v 1004 264 a Fn(;)p
1023 204 162 2 v 1022 253 2 50 v 1029 239 a Fp(hello)f(a)h(b)p
1182 253 V 1022 303 V 1029 288 a(c)p 1182 303 V 1023
305 162 2 v 1183 264 a Fn(;)p 1202 179 126 2 v 1201 229
2 50 v 1208 214 a Fp(hello)g(a)p 1327 229 V 1201 278
V 1208 263 a(b)p 1327 278 V 1201 328 V 1208 313 a(c)p
1327 328 V 1202 330 126 2 v 1328 264 a Fn(;)p 1347 154
93 2 v 1346 204 2 50 v 1353 189 a Fp(hello)p 1438 204
V 1346 253 V 1353 239 a(a)p 1437 253 V 1346 303 V 1353
288 a(b)p 1437 303 V 1346 353 V 1353 338 a(c)p 1437 353
V 1347 355 93 2 v 1438 154 a Fd(9)1438 191 y(>)1438 204
y(>)1438 216 y(=)1438 291 y(>)1438 303 y(>)1438 316 y(;)340
428 y Fw(If)k(this)h(do)q(cumen)o(t)e(is)i(displa)o(y)o(ed)e(on)h(a)g
(page)h(of)e(width)h(5)g(then)h(the)g(last)f(la)o(y)o(out)f(m)o(ust)h
(b)q(e)340 478 y(c)o(hosen,)13 b(but)f(since)h(eac)o(h)g(la)o(y)o(out)e
(has)h(a)g(di\013eren)o(t)h(\014rst)g(line,)e(our)i(implem)o(en)o
(tation)c(m)o(ust)i(\014rst)340 528 y(construct)20 b(and)e(reject)h
(eac)o(h)g(of)e(the)i(\014rst)f(three.)h(Y)m(et)f(as)g(so)q(on)g(as)g
(the)h(length)f(of)p 1714 493 V 1713 542 2 50 v 1720
527 a Fp(hello)p 1805 542 V 1714 544 93 2 v 1824 528
a Fw(is)340 578 y(kno)o(wn)d(it)f(is)h(clear)g(that)g(the)g(innermost)f
Fs(sep)p Fw(,)g(and)h(therefore)h(all)e(the)h(others,)g(m)o(ust)f(b)q
(e)h(laid)340 628 y(out)k(v)o(ertically)m(.)d(W)m(e)i(could)g
(therefore)i(go)e(immedia)o(tely)e(to)i(the)h(fourth)f(la)o(y)o(out.)f
(F)m(or)g(large)340 677 y(do)q(cumen)o(ts)g(in)f(whic)o(h)h
Fs(sep)g Fw(ma)o(y)d(b)q(e)k(nested)g(v)o(ery)f(deep,)g(this)g
(optimisation)d(is)i(imp)q(ortan)o(t.)340 727 y(Without)h(it)h(the)g
(complexit)o(y)e(of)h(prett)o(yprin)o(ters)j(is)e(at)f(least)h
Fn(O)q Fw(\()p Fn(n)1442 712 y Fr(2)1461 727 y Fw(\))g(in)f(the)h
(depth)h(of)e Fs(sep)340 777 y Fw(nesting,)12 b(and)g(in)f(practice)i
(they)f(pause)h(for)e(an)h(em)o(barrassingly)e(long)h(time)g(at)g(the)i
(b)q(eginning)340 827 y(of)c(prett)o(y-prin)o(ting,)g(gradually)f(sp)q
(eeding)i(up)g(as)f(more)g(and)g(more)g Fs(sep)g Fw(decisions)h(are)g
(resolv)o(ed.)403 877 y(But)16 b(to)f(incorp)q(orate)h(this)g
(optimisation)d(w)o(e)j(will)e(need)j(to)e(c)o(hange)h(our)g(represen)o
(tation)340 927 y(of)e(do)q(cumen)o(ts.)340 1066 y Fu(9)56
b(Optimised)17 b(Prett)n(y-prin)n(ting:)g(A)i(T)-5 b(erm)17
b(Represen)n(tation)340 1170 y Fw(Lo)q(oking)g(bac)o(k)g(at)g(the)h
(problematic)e(example,)f(w)o(e)j(can)f(see)i(that)e(the)h(three)h
(\014rst)f(la)o(y)o(outs)340 1220 y(ha)o(v)o(e)c(a)f(common)e(pre\014x)
j(|)f Fp(\\hello)h(a")g Fw(|)f(and)g(moreo)o(v)o(er)g(w)o(e)h(can)f
(tell)h(just)f(from)f(the)i(pre\014x)340 1270 y(that)19
b(none)f(of)g(the)h(la)o(y)o(outs)e(has)h(a)g(nice)h(\014rst)g(line.)e
(Our)i(goal)e(will)g(b)q(e)i(to)f(factor)g(out)g(this)340
1319 y(common)11 b(pre\014x,)k(express)g(the)g(union)e(of)g(the)i
(three)g(la)o(y)o(outs)e(as)p 897 1374 126 2 v 896 1424
2 50 v 903 1409 a Fp(hello)i(a)p 1023 1424 V 897 1426
126 2 v 1035 1410 a Fn(<)-7 b(>)12 b Fw(\()p Fn(x)d Fq([)g
Fn(y)i Fq([)e Fn(z)r Fw(\))340 1500 y(for)14 b(suitable)g
Fn(x)p Fw(,)f Fn(y)i Fw(and)f Fn(z)r Fw(,)f(and)h(then)h(reject)g(all)e
(of)g(them)g(together)i(in)e(fa)o(v)o(our)g(of)g(the)i(fourth.)403
1551 y(But)i(to)g(b)q(e)h(able)f(to)f(observ)o(e)j(this)e(situation,)e
(w)o(e)j(m)o(ust)e(in)o(tro)q(duce)h Fs(text)e Fn(S)20
b(<)-7 b(>)17 b(E)i Fw(as)e(a)340 1601 y(simpli\014ed)h(form.)f(A)o(t)i
(the)g(same)g(time)e(w)o(e)j(can)f(replace)h(the)g(simpli\014ed)d
(forms)h Fs(text)c Fn(S)22 b Fw(b)o(y)340 1650 y Fs(text)15
b Fp(\\")g Fw(and)g Fs(text)g Fn(S)e Fw($$)c Fn(E)17
b Fw(b)o(y)e Fs(text)g Fp(\\")10 b Fw($$)f Fn(E)r Fw(,)15
b(b)q(ecause)i(the)f(old)e(forms)g(can)h(b)q(e)h(expressed)i(in)340
1700 y(terms)c(of)f(the)i(new)f(ones)h(as)f(follo)o(ws)697
1791 y Fs(text)g Fn(s)f Fw(=)e Fs(text)k Fn(s)d(<)-7
b(>)12 b Fs(text)j Fp(\\")613 1853 y Fs(text)g Fn(s)9
b Fw($$)g Fn(x)j Fw(=)f Fs(text)k Fn(s)d(<)-7 b(>)12
b Fw(\()p Fs(text)j Fp(\\")9 b Fw($$)g Fs(nest)15 b Fw(\()p
Fq(\000)p Fs(length)g Fn(s)p Fw(\))g Fn(x)p Fw(\))403
1944 y(W)m(e)d(will)f(need)j(to)e(allo)o(w)f Fq(;)h Fw(in)g(more)g
(places)h(than)g(b)q(efore,)g(b)q(ecause)h(w)o(e)f(in)o(tend)g(to)f
(use)i(the)340 1994 y(prop)q(ert)o(y)796 2049 y Fs(\014t)h
Fw(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))f(=)h
Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(\014t)j Fn(x)340 2126
y Fw(where)i(the)f(righ)o(t)e(hand)h(side)h(is)f(a)g(canonical)f(form)g
(with)h(a)f(comp)q(onen)o(t)h(\()p Fs(\014t)g Fn(x)p
Fw(\))g(that)g(migh)o(t)340 2175 y(v)o(ery)f(w)o(ell)f(b)q(e)h(empt)o
(y)m(.)e(W)m(e)h(don't)g(w)o(an)o(t)g(to)h Fs(test)f
Fw(for)g(an)h(empt)o(y)e(set)j(here,)f(of)f(course,)h(b)q(ecause)340
2225 y(that)g(w)o(ould)f(mak)o(e)g Fs(\014t)h Fw(h)o(yp)q(er-strict)h
(with)f(disastrous)g(consequences.)403 2276 y(Our)g(new)g(simpli\014ed)
e(forms)h(are)h(therefore)i(giv)o(en)d(b)o(y)h(the)g(grammar)736
2366 y Fn(E)g Fw(::=)d Fn(U)j Fq(j)9 b Fs(nest)15 b Fn(N)k(E)737
2428 y(U)d Fw(::=)11 b Fn(M)j Fq(j)9 b Fn(U)14 b Fq([)9
b Fn(U)14 b Fq(j)9 b(;)725 2491 y Fn(M)16 b Fw(::=)11
b Fs(text)k Fp(\\")9 b Fq(j)f Fs(text)15 b Fp(\\")9 b
Fw($$)g Fn(E)i Fq(j)e Fs(text)14 b Fn(S)h(<)-7 b(>)12
b(E)p eop
%%Page: 33 33
33 32 bop 183 194 a Fw(W)m(e)12 b(imp)q(ose)f(the)i(same)e(condition)h
(on)g(unions)g(as)h(b)q(efore:)f(ev)o(ery)i(la)o(y)o(out)d(in)h(the)h
(\014rst)g(op)q(erand)183 244 y(m)o(ust)g(ha)o(v)o(e)g(a)h(longer)f
(\014rst)i(line)f(than)f(ev)o(ery)i(la)o(y)o(out)e(in)g(the)i(second.)
245 293 y(These)g(simpli\014ed)d(forms)h(can)h(b)q(e)g(represen)o(ted)j
(b)o(y)d(the)g(datat)o(yp)q(e)469 374 y Ft(data)h Fs(Do)n(c)d
Fw(=)g Fs(Nil)377 b Fq(\000)-5 b(\000)10 b Fs(text)15
b Fp(\\")667 424 y Fq(j)22 b Fs(NilA)o(b)n(ove)15 b(Do)n(c)187
b Fq(\000)-5 b(\000)10 b Fs(text)15 b Fp(\\")9 b Fw($$)g
Fn(x)667 474 y Fq(j)22 b Fs(String)9 b(`T)m(extBeside`)g(Do)n(c)j
Fq(\000)-5 b(\000)10 b Fs(text)15 b Fn(s)d(<)-7 b(>)12
b(x)667 523 y Fq(j)22 b Fs(Nest)15 b(Int)f(Do)n(c)200
b Fq(\000)-5 b(\000)10 b Fs(nest)15 b Fn(k)g(x)667 573
y Fq(j)22 b Fs(Do)n(c)10 b(`Union`)f(Do)n(c)138 b Fq(\000)-5
b(\000)10 b Fn(x)f Fq([)g Fn(y)667 623 y Fq(j)22 b Fs(Empty)315
b Fq(\000)-5 b(\000)10 b(;)183 704 y Fw(And)j(no)o(w)f(the)h(k)o(ey)g
(problem)e(is)i(to)f(rederiv)o(e)i Fs(sep)f Fw(so)g(as)g(to)f
Fs(delay)h Fw(in)o(tro)q(ducing)g(a)f Fs(Union)h Fw(un)o(til)183
754 y(after)h(the)g(common)d(pre\014x)k(of)e(the)i(t)o(w)o(o)e(branc)o
(hes)i(of)e(the)i Fs(sep)f Fw(is)g(pro)q(duced.)245 804
y(W)m(e)f(need)h(an)f(algebraic)g(la)o(w)f(p)q(ermitting)g(us)h(to)g
(dra)o(w)g(a)g(pre\014x)h(out)f(of)g(a)g Fs(sep)p Fw(.)g(Let)h(us)f
(try)183 854 y(to)g(pro)o(v)o(e)h(one.)g(Assuming)f Fs(xs)h
Fw(is)g(non-empt)o(y)m(,)d(then)285 932 y Fs(sep)16 b
Fw(\(\()p Fs(text)f Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))f(:)g
Fs(xs)p Fw(\))297 982 y(=)18 b Fs(\014t)d Fw(\()p Fs(text)g
Fn(s)d(<)-7 b(>)12 b(x)f(<)-9 b Fw(+)g Fn(>)12 b Fw(\()p
Fs(foldr1)j Fw(\()-7 b Fn(<)e Fw(+)g Fn(>)i Fw(\))14
b Fs(xs)p Fw(\)\))p Fq([)347 1032 y Fw(\(\()p Fs(text)h
Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))d($$)g Fs(foldr1)14 b
Fw(\($$\))g Fs(xs)p Fw(\))297 1082 y(=)k(\()p Fs(text)d
Fn(s)d(<)-7 b(>)12 b Fs(\014t)j Fw(\()p Fs(text)g Fp(\\")c
Fn(<)-7 b(>)12 b(x)f(<)-9 b Fw(+)g Fn(>)12 b Fs(foldr1)j
Fw(\()-7 b Fn(<)e Fw(+)g Fn(>)i Fw(\))14 b Fs(xs)p Fw(\)\))p
Fq([)347 1132 y Fw(\()p Fs(text)h Fn(s)d(<)-7 b(>)12
b Fw(\(\()p Fs(text)j Fp(\\")c Fn(<)-7 b(>)12 b(x)p Fw(\))d($$)g
Fs(foldr1)14 b Fw(\($$\))g(\()p Fs(map)h Fw(\()p Fs(nest)h
Fw(\()p Fq(\000)p Fs(length)f Fn(s)p Fw(\)\))g Fs(xs)p
Fw(\))297 1181 y(=)d Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(sep)j
Fw(\(\()p Fs(text)g Fp(\\")c Fn(<)-7 b(>)12 b(x)p Fw(\))g(:)f
Fs(map)k Fw(\()p Fs(nest)g Fw(\()p Fq(\000)p Fs(length)h
Fn(s)p Fw(\)\))e Fs(xs)p Fw(\))183 1261 y(This)f(last)g(step)i(holds)e
(b)q(ecause)j Fs(nest)d Fw(can)h(b)q(e)g(either)h(cancelled)f(or)g(in)o
(tro)q(duced)g(freely)g(in)f(the)183 1310 y(horizon)o(tal)g(alternativ)
o(e.)h(W)m(e)f(ha)o(v)o(e)i(already)e(seen)j(that)e(w)o(e)h(can)f(mo)o
(v)o(e)f(a)h Fs(Nest)g Fw(out)g(of)g(a)g Fs(sep)p Fw(,)183
1360 y(and)g(indeed)i(w)o(e)f(can)g(ev)o(en)g(mo)o(v)o(e)e(a)i
Fs(Union)g Fw(out)g(of)f Fs(sep)p Fw('s)h(\014rst)g(argumen)o(t)f
Fs(without)g Fw(splitting)183 1410 y(the)h Fs(sep)f Fw(in)o(to)g(t)o(w)
o(o)g(branc)o(hes)h(whic)o(h)f(m)o(ust)g(b)q(e)h(explored)g(separately)
m(.)f(In)g(fact)g(the)h(only)f(time)183 1460 y(that)h(w)o(e)g(ha)o(v)o
(e)g(to)g(do)g(this)g(is)h(when)f(the)h(\014rst)g(argumen)o(t)e(is)h
Fs(Nil)f Fw(|)h(and)g(b)o(y)g(that)g(p)q(oin)o(t)g(the)183
1510 y(horizon)o(tal)9 b(and)i(v)o(ertical)f(alternativ)o(es)h
(di\013er)g(at)g(the)g(v)o(ery)g(next)g(c)o(haracter,)h(so)f(there)h
(is)e(really)183 1560 y(no)k(alternativ)o(e.)g(The)i(deriv)o(ed)f
(de\014nition)g(of)f Fs(sep)h Fw(is)g(giv)o(en)f(in)g(\014gure)i(13.)e
(W)m(e)g(ha)o(v)o(e)h(used)h(an)183 1609 y(auxiliary)c(function)h(sp)q
(eci\014ed)j(b)o(y)595 1693 y Fs(sep)652 1676 y Fh(0)677
1693 y Fn(x)e(k)h Fs(ys)c Fw(=)h Fs(sep)j Fw(\()p Fn(x)d
Fw(:)f Fs(map)k Fw(\()p Fs(nest)g Fn(k)q Fw(\))p Fn(y)q(s)p
Fw(\))183 1776 y(to)e(a)o(v)o(oid)g(rep)q(eated)j(applications)c(of)i
Fs(nest)g Fw(to)f(the)i(remaining)d(argumen)o(ts.)245
1826 y(Implemen)o(tations)f(of)j(the)h(other)f(four)g(op)q(erators)h
(can)g(b)q(e)f(deriv)o(ed)h(in)f(the)h(usual)f(w)o(a)o(y)f(|)183
1876 y(this)k(time)f(w)o(e)i(skip)f(the)h(details.)e(The)i(resulting)f
(de\014nitions)h(are)f(presen)o(ted)j(in)d(\014gure)g(14.)183
1926 y(Once)c(again)d(w)o(e)i(lea)o(v)o(e)g(it)f(to)h(the)g(reader)h
(to)f(c)o(hec)o(k)h(that)f(the)g(datat)o(yp)q(e)g(in)o(v)n(arian)o(t)e
(is)i(satis\014ed.)245 2025 y(In)i(fact,)f(these)j(are)e(not)g(quite)g
(the)h(implemen)o(ted)d(de\014nitions.)h(Heap)i(pro\014ling)e(rev)o
(ealed)183 2075 y(that)k(the)h(deriv)o(ed)g(de\014nition)f(of)g(\($$\))
h(leaks)f(space:)h(unev)n(aluated)g(calls)f(of)g(\($$\))g(and)g
Fs(nest)183 2125 y Fw(collect)h(on)g(the)h(heap.)g(These)g(are)g(in)o
(tro)q(duced)g(in)f(the)h(3rd)f(and)h(4th)f(equations)g(for)g(\($$\),)
183 2175 y(and)f(unfortunately)g(passed)h(to)f(a)g(recursiv)o(e)i(call)
d(of)h(\($$\))g(whic)o(h)g(usually)f(in)o(tro)q(duces)i(still)183
2224 y(more)9 b(unev)n(aluated)i(applications.)e(A)i(solution)f(is)g
(to)h(a)o(v)o(oid)e(constructing)i(these)i(unev)n(aluated)183
2274 y(applications)f(at)i(all)f(b)o(y)h(using)f(an)h(auxiliary)e
(function)651 2358 y Fs(ab)n(oveNest)j Fn(x)f(k)h(y)e
Fw(=)f Fn(x)d Fw($$)f Fs(nest)15 b Fn(k)g(y)183 2441
y Fw(instead.)e(This)h(is)g(of)f(course)i(just)f(the)g(sp)q
(eci\014cation)h(of)e Fs(ab)n(oveNest)p Fw(;)h(the)g(deriv)o(ed)g
(implemen-)183 2491 y(tation)k(app)q(ears)i(in)f(\014gure)h(15.)e(It)h
(is)g(imp)q(ortan)o(t)e(that)j Fs(ab)n(oveNest)p Fw(s)f(second)i
(parameter)e(is)p eop
%%Page: 34 34
34 33 bop 455 226 a Fk(sep)12 b Fv([)p Fl(x)p Fv(])e(=)h
Fl(x)455 271 y Fk(sep)h Fv(\()p Fl(x)f Fv(:)f Fk(ys)o
Fv(\))h(=)f Fk(sep)743 255 y Ff(0)767 271 y Fl(x)j Fv(0)g
Fk(ys)455 363 y(sep)508 347 y Ff(0)532 363 y Fk(Nil)e
Fl(k)j Fk(ys)c Fv(=)h Fk(\014t)i Fv(\()p Fk(fold)r(l)f
Fv(\()-6 b Fl(<)d Fv(+)g Fl(>)j Fv(\))12 b Fk(Nil)g(ys)p
Fv(\))c Fk(`Union`)e(vertic)n(al)12 b(Nil)g Fl(k)i Fk(ys)455
408 y(sep)508 392 y Ff(0)532 408 y Fv(\()p Fk(NilA)o(b)n(ove)c
Fl(x)p Fv(\))j Fl(k)h Fk(ys)c Fv(=)g Fk(vertic)n(al)i
Fv(\()p Fk(NilA)o(b)n(ove)f Fl(x)p Fv(\))h Fl(k)i Fk(ys)455
454 y(sep)508 438 y Ff(0)532 454 y Fv(\()p Fl(s)8 b Fk(`T)m(extBeside`)
e Fl(x)p Fv(\))12 b Fl(k)i Fk(ys)c Fv(=)h Fl(s)d Fk(`T)m(extBeside`)e
(sep)1249 438 y Ff(0)1273 454 y Fv(\()p Fk(Nil)k Fl(<)-6
b(>)10 b(x)p Fv(\))i(\()p Fl(k)e Fi(\000)e Fk(length)k
Fl(s)p Fv(\))h Fk(ys)455 500 y(sep)508 484 y Ff(0)532
500 y Fv(\()p Fk(Nest)f Fl(n)h(x)p Fv(\))f Fl(k)i Fk(ys)c
Fv(=)h Fk(Nest)25 b Fl(n)13 b Fv(\()p Fk(sep)1045 484
y Ff(0)1069 500 y Fl(x)f Fv(\()p Fl(k)e Fi(\000)e Fl(n)p
Fv(\))13 b Fk(ys)o Fv(\))455 545 y Fk(sep)508 529 y Ff(0)532
545 y Fv(\()p Fl(x)8 b Fk(`Union`)e Fl(y)q Fv(\))13 b
Fl(k)h Fk(ys)c Fv(=)g Fk(sep)932 529 y Ff(0)956 545 y
Fl(x)j(k)h Fk(ys)7 b(`Union`)g(vertic)n(al)k Fl(y)j(k)g(y)q(s)455
591 y Fk(sep)508 575 y Ff(0)532 591 y Fk(Empty)e Fl(k)i
Fk(ys)c Fv(=)g Fk(Empty)455 682 y(vertic)n(al)h Fl(x)i(k)h
Fk(ys)c Fv(=)g Fl(x)f Fv($$)g Fk(nest)j Fl(k)i Fv(\()p
Fk(foldr1)e Fv(\($$\))h Fk(ys)o Fv(\))340 809 y Fj(Fig.)7
b(13.)13 b Fk(sep)f Fv(optimised)j(to)e(dela)o(y)i Fk(Union)n
Fv(.)490 937 y Fk(text)d Fl(s)f Fv(=)f Fl(s)f Fk(`T)m(extBeside`)d(Nil)
490 1028 y(nest)12 b Fl(k)i(x)c Fv(=)h Fk(Nest)h Fl(k)i(x)490
1120 y Fk(Nil)c Fl(<)-6 b(>)10 b Fv(\()p Fk(Nest)i Fl(k)i(x)p
Fv(\))c(=)h Fk(Nil)e Fl(<)-6 b(>)10 b(x)490 1165 y Fk(Nil)g
Fl(<)-6 b(>)10 b(x)g Fv(=)h Fl(x)490 1211 y Fk(NilA)o(b)n(ove)g
Fl(x)f(<)-6 b(>)10 b(y)i Fv(=)f Fk(NilA)o(b)n(ove)f Fv(\()p
Fl(x)h(<)-6 b(>)10 b(y)q Fv(\))490 1257 y(\()p Fl(s)e
Fk(`T)m(extBeside`)e Fl(x)p Fv(\))11 b Fl(<)-6 b(>)10
b(y)h Fv(=)g Fl(s)d Fk(`T)m(extBeside`)e Fv(\()p Fl(x)11
b(<)-6 b(>)10 b(y)q Fv(\))490 1302 y Fk(Nest)i Fl(k)i(x)c(<)-6
b(>)10 b(y)i Fv(=)f Fk(Nest)h Fl(k)i Fv(\()p Fl(x)c(<)-6
b(>)10 b(y)q Fv(\))490 1348 y(\()p Fl(x)e Fk(`Union`)e
Fl(y)q Fv(\))11 b Fl(<)-6 b(>)10 b(z)i Fv(=)f(\()p Fl(x)f(<)-6
b(>)10 b(z)r Fv(\))e Fk(`Union`)e Fv(\()p Fl(y)12 b(<)-6
b(>)10 b(z)r Fv(\))490 1394 y Fk(Empty)g Fl(<)-6 b(>)10
b(z)i Fv(=)f Fk(Empty)490 1485 y(Nil)c Fv($$)i Fl(x)i
Fv(=)f Fk(NilA)o(b)n(ove)h Fl(x)490 1531 y Fk(NilA)o(b)n(ove)g
Fl(x)d Fv($$)h Fl(y)j Fv(=)e Fk(NilA)o(b)n(ove)h Fv(\()p
Fl(x)d Fv($$)h Fl(y)q Fv(\))490 1576 y(\()p Fl(s)f Fk(`T)m(extBeside`)e
Fl(x)p Fv(\))i($$)h Fl(y)j Fv(=)f Fl(s)d Fk(`T)m(extBeside`)e
Fv(\(\()p Fk(Nil)k Fl(<)-6 b(>)10 b(x)p Fv(\))e($$)h
Fk(nest)j Fv(\()p Fi(\000)p Fk(length)g Fl(s)p Fv(\))p
Fl(y)q Fv(\))490 1622 y Fk(Nest)g Fl(k)i(x)8 b Fv($$)h
Fl(y)j Fv(=)f Fk(Nest)h Fl(k)i Fv(\()p Fl(x)8 b Fv($$)h
Fk(nest)j Fv(\()p Fi(\000)p Fl(k)q Fv(\))h Fl(y)q Fv(\))490
1668 y(\()p Fl(x)8 b Fk(`Union`)e Fl(y)q Fv(\))j($$)g
Fl(z)j Fv(=)e(\()p Fl(x)f Fv($$)g Fl(z)r Fv(\))f Fk(`Union`)e
Fv(\()p Fl(y)j Fv($$)g Fl(z)r Fv(\))490 1713 y Fk(Empty)f
Fv($$)h Fl(y)j Fv(=)e Fk(Empty)340 1842 y Fj(Fig.)d(14.)13
b Fv(Implemen)o(tations)j(of)d Fk(text)o Fv(,)f Fk(nest)o
Fv(,)g(\()-6 b Fl(<)g(>)g Fv(\))11 b(and)j(\($$\).)340
1982 y Fw(ev)n(aluated)f(strictly)f(|)g(otherwise)i(the)f(heap)f(w)o
(ould)g(\014ll)f(up)i(with)f(unev)n(aluated)g(subtractions)340
2032 y(instead.)h(W)m(e)f(can)h(arrange)f(this)h(using)f
Fa(hbc)p Fw('s)g(standard)h(function)25 b Fs(se)n(q)14
b Fn(a)f(b)p Fw(,)f(whic)o(h)g(ev)n(aluates)340 2082
y Fn(a)i Fw(and)g(returns)h(the)g(v)n(alue)e(of)g Fn(b)p
Fw(.)403 2132 y(And)h(no)o(w)f(w)o(e)h(m)o(ust)f(deriv)o(e)i(an)e
(implemen)o(tation)e(of)i Fs(b)n(est)p Fw(.)403 2181
y(The)h(tric)o(kiest)g(case)g(is)g Fs(b)n(est)h Fn(w)f(r)g
Fw(\()p Fs(text)h Fn(s)d(<)-7 b(>)13 b(x)p Fw(\).)g(W)m(e)g(kno)o(w)g
(that)h(this)f(m)o(ust)g(b)q(e)h(equal)f(to)340 2231
y Fs(text)i Fn(s)d(<)-7 b(>)12 b(y)i Fw(for)d(some)g
Fn(y)j Fw(|)d(but)h(what)f(is)h Fn(y)q Fw(?)g(It)g(clearly)f(dep)q
(ends)j(on)d(b)q(oth)h Fn(x)f Fw(and)h Fn(s)p Fw(,)f(b)q(ecause)340
2281 y(the)18 b(length)e(of)g Fn(s)h Fw(a\013ects)h(the)f(width)f(of)g
(`ribb)q(on')g(a)o(v)n(ailable)e(to)i(the)i(\014rst)f(line)f(of)g
Fn(x)p Fw(.)g(Let)h(us)340 2331 y(in)o(tro)q(duce)e(a)f(new)g(function)
g Fs(b)n(est)o Fw(')g(,)f(whose)i(de\014ning)e(prop)q(ert)o(y)i(is)666
2411 y Fs(b)n(est)f Fn(w)h(r)g Fw(\()p Fs(text)g Fn(s)d(<)-7
b(>)12 b(x)p Fw(\))f(=)h Fs(text)j Fn(s)d(<)-7 b(>)12
b Fs(b)n(est)1366 2392 y Fh(0)1391 2411 y Fn(w)j(r)g(s)f(x)340
2491 y Fw(W)m(e)k(can)g(deriv)o(e)g(a)f(de\014nition)g(for)h
Fs(b)n(est')f Fw(using)g(the)h(algebra;)f(w)o(e)h(presen)o(t)h(the)g
(details)e(this)p eop
%%Page: 35 35
35 34 bop 233 226 a Fl(x)8 b Fv($$)h Fl(y)j Fv(=)f Fk(ab)n(oveNest)f
Fl(x)j Fv(0)g Fl(y)233 317 y Fk(ab)n(oveNest)d(Nil)i
Fl(k)i(y)e Fv(=)f Fk(NilA)o(b)n(ove)f Fv(\()p Fk(nest)j
Fl(k)h(y)q Fv(\))233 363 y Fk(ab)n(oveNest)c Fv(\()p
Fk(NilA)o(b)n(ove)h Fl(x)p Fv(\))i Fl(k)h(y)e Fv(=)e
Fk(NilA)o(b)n(ove)h Fv(\()p Fk(ab)n(oveNest)f Fl(x)j(k)h(y)q
Fv(\))233 408 y Fk(ab)n(oveNest)c Fv(\()p Fl(s)f Fk(`T)m(extBeside`)d
Fl(x)p Fv(\))12 b Fl(k)i(y)e Fv(=)k Fk(se)n(q)d Fl(k)911
392 y Ff(0)935 408 y Fv(\()p Fl(s)c Fk(`T)m(extBeside`)c(ab)n(oveNest)
11 b Fv(\()p Fk(Nil)f Fl(<)-6 b(>)10 b(x)p Fv(\))i Fl(k)1579
392 y Ff(0)1603 408 y Fl(y)q Fv(\))827 454 y Fj(where)j
Fl(k)978 438 y Ff(0)1000 454 y Fv(=)c Fl(k)e Fi(\000)g
Fk(length)j Fl(s)233 500 y Fk(ab)n(oveNest)e Fv(\()p
Fk(Nest)j Fl(k)536 484 y Ff(0)560 500 y Fl(x)p Fv(\))f
Fl(k)i(y)e Fv(=)k Fk(se)n(q)d Fl(k)804 484 y Ff(00)837
500 y Fv(\()p Fk(Nest)f Fl(k)961 484 y Ff(0)986 500 y
Fv(\()p Fk(ab)n(oveNes)o(t)f Fl(x)i(k)1235 484 y Ff(00)1268
500 y Fl(y)q Fv(\)\))720 545 y Fj(where)i Fl(k)871 529
y Ff(00)902 545 y Fv(=)c Fl(k)f Fi(\000)e Fl(k)1032 529
y Ff(0)233 591 y Fk(ab)n(oveNest)i Fv(\()p Fl(x)f Fk(`Union`)d
Fl(y)q Fv(\))13 b Fl(k)h(z)e Fv(=)e Fk(ab)n(oveNest)h
Fl(x)h(k)i(z)c Fk(`Union`)c(ab)n(oveNest)11 b Fl(y)j(k)g(z)233
637 y Fk(ab)n(oveNest)c(Empty)j Fl(k)g(z)g Fv(=)d Fk(Empty)183
766 y Fj(Fig.)c(15.)14 b Fv(De\014ning)23 b($$)f(without)14
b(a)f(space)h(leak.)183 911 y Fw(time.)443 987 y Fs(text)h
Fn(s)d(<)-7 b(>)12 b Fs(b)n(est)691 968 y Fh(0)717 987
y Fn(w)i(r)h(s)f Fs(Nil)d Fw(=)h Fs(b)n(est)j Fn(w)f(r)h
Fw(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b Fs(text)j Fp(\\")p
Fw(\))894 1037 y(=)d Fs(b)n(est)j Fn(w)f(r)h Fw(\()p
Fs(text)g Fn(s)p Fw(\))894 1086 y(=)d Fs(text)j Fn(s)894
1136 y Fw(=)d Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(Nil)183
1226 y Fw(so)i(w)o(e)g(can)g(tak)o(e)g Fs(b)n(est)528
1208 y Fh(0)553 1226 y Fn(w)h(r)f(s)h Fs(Nil)10 b Fw(=)i
Fs(Nil)p Fw(.)480 1302 y Fs(text)i Fn(s)e(<)-7 b(>)12
b Fs(b)n(est)727 1284 y Fh(0)753 1302 y Fn(w)i(r)h(s)f
Fw(\()p Fs(NilA)o(b)n(ove)h Fn(s)p Fw(\))491 1352 y(=)d
Fs(b)n(est)j Fn(w)f(r)h Fw(\()p Fs(text)g Fn(s)d(<)-7
b(>)12 b Fw(\()p Fs(text)j Fp(\\")9 b Fw($$)g Fn(x)p
Fw(\)\))491 1402 y(=)j Fs(b)n(est)j Fn(w)f(r)h Fw(\()p
Fs(text)g Fn(s)10 b Fw($$)e Fs(nest)16 b Fw(\()p Fs(length)f
Fn(s)p Fw(\))f Fn(x)p Fw(\))491 1452 y(=)e Fs(text)j
Fn(s)10 b Fw($$)e Fs(nest)15 b Fw(\()p Fs(length)g Fn(s)p
Fw(\)\()p Fs(b)n(est)h Fw(\()p Fn(w)10 b Fq(\000)g Fs(length)15
b Fn(s)p Fw(\))f Fn(r)h(x)p Fw(\))491 1501 y(=)d Fs(text)j
Fn(s)d(<)-7 b(>)12 b Fw(\()p Fs(text)j Fp(\\")9 b Fw($$)f
Fs(b)n(est)15 b Fw(\()p Fn(w)10 b Fq(\000)g Fs(length)15
b Fn(s)p Fw(\))f Fn(r)h(x)p Fw(\))183 1585 y(so)f(w)o(e)g(can)g(tak)o
(e)385 1676 y Fs(b)n(est)452 1658 y Fh(0)478 1676 y Fn(w)g(r)h(s)f
Fw(\()p Fs(NilA)o(b)n(ove)h Fn(x)p Fw(\))c(=)h Fs(NilA)o(b)n(ove)i
Fw(\()p Fs(b)n(est)h Fw(\()p Fn(w)10 b Fq(\000)g Fs(length)15
b Fn(s)p Fw(\))f Fn(r)h(x)p Fw(\))183 1767 y(F)m(or)e(the)i
Fs(T)m(extBeside)e Fw(case,)563 1852 y Fs(text)i Fn(s)d(<)-7
b(>)12 b Fs(b)n(est)811 1833 y Fh(0)837 1852 y Fn(w)i(r)h(s)f
Fw(\()p Fn(t)c Fs(`T)m(extBeside`)e Fn(x)p Fw(\))575
1901 y(=)k Fs(b)n(est)j Fn(w)f(r)h Fw(\()p Fs(text)g
Fn(s)d(<)-7 b(>)12 b Fs(text)j Fn(s)d(<)-7 b(>)12 b(x)p
Fw(\))575 1951 y(=)g Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(text)j
Fn(t)c(<)-7 b(>)12 b Fs(b)n(est)1043 1933 y Fh(0)1069
1951 y Fn(w)i(r)h Fw(\()p Fn(s)10 b Fw(+)-12 b(+)p Fn(t)p
Fw(\))15 b Fn(x)183 2035 y Fw(so)f(w)o(e)g(can)g(tak)o(e)356
2126 y Fs(b)n(est)423 2108 y Fh(0)449 2126 y Fn(w)g(r)h(s)f
Fw(\()p Fn(t)c Fs(`T)m(extBeside`)e Fn(x)p Fw(\))k(=)g
Fn(t)d Fs(`T)m(extBeside`)f(b)n(est)1250 2108 y Fh(0)1276
2126 y Fn(w)14 b(r)h Fw(\()p Fn(s)10 b Fw(+)-12 b(+)p
Fn(t)p Fw(\))15 b Fn(x)183 2217 y Fw(The)f Fs(Nest)g
Fw(case)g(is)g(v)o(ery)g(simple:)363 2301 y Fs(text)h
Fn(s)d(<)-7 b(>)12 b Fs(b)n(est)611 2283 y Fh(0)636 2301
y Fn(w)j(r)g(s)f Fw(\()p Fs(Nest)h Fn(k)g(x)p Fw(\))c(=)h
Fs(b)n(est)j Fn(w)f(r)h Fw(\()p Fs(text)g Fn(s)d(<)-7
b(>)12 b Fs(nest)j Fn(k)g(x)p Fw(\))948 2351 y(=)d Fs(b)n(est)j
Fn(w)f(r)h Fw(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b(x)p
Fw(\))948 2401 y(=)g Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(b)n(est)1240
2382 y Fh(0)1265 2401 y Fn(w)j(r)g(s)f(x)183 2491 y Fw(so)g
Fs(b)n(est)300 2472 y Fh(0)326 2491 y Fn(w)h(r)f(s)h
Fw(\()p Fs(Nest)f Fn(k)h(x)p Fw(\))c(=)h Fs(b)n(est)748
2472 y Fh(0)774 2491 y Fn(w)i(r)h(s)f(x)p Fw(.)f(Finally)m(,)p
eop
%%Page: 36 36
36 35 bop 598 187 a Fs(text)15 b Fn(s)d(<)-7 b(>)12 b
Fs(b)n(est)846 168 y Fh(0)871 187 y Fn(w)j(r)f(s)h Fw(\()p
Fn(x)9 b Fs(`Union`)g Fn(y)q Fw(\))609 237 y(=)j Fs(b)n(est)j
Fn(w)g(r)f Fw(\()p Fs(text)h Fn(s)d(<)-7 b(>)12 b Fw(\()p
Fn(x)e Fq([)e Fn(y)q Fw(\)\))609 287 y(=)k Fs(b)n(est)j
Fn(w)g(r)f Fw(\()p Fs(text)h Fn(s)d(<)-7 b(>)12 b(x)p
Fw(\))p Fq(r)1085 272 y Fm(w)1085 297 y(r)1112 287 y
Fs(b)n(est)i Fn(w)h(r)g Fw(\()p Fs(text)g Fn(s)d(<)-7
b(>)12 b(y)q Fw(\))609 336 y(=)g(\()p Fs(text)j Fn(s)d(<)-7
b(>)12 b Fs(b)n(est)917 318 y Fh(0)943 336 y Fn(w)i(r)h(s)f(x)p
Fw(\))p Fq(r)1129 321 y Fm(w)1129 347 y(r)1156 336 y
Fw(\()p Fs(text)h Fn(s)d(<)-7 b(>)12 b Fs(b)n(est)1420
318 y Fh(0)1445 336 y Fn(w)j(r)g(s)f(y)q Fw(\))609 386
y(=)e Fs(text)j Fn(s)d(<)-7 b(>)12 b Fw(\()p Fs(b)n(est)917
368 y Fh(0)943 386 y Fn(w)i(r)h(s)f(x)9 b Fq(r)1122 371
y Fm(w)1122 397 y(r)1149 368 y Fh(0)1160 386 y Fw(\()p
Fn(s)p Fw(\))h Fs(b)n(est)1288 368 y Fh(0)1314 386 y
Fn(w)k(r)h(s)f(y)q Fw(\))340 468 y(where)h(w)o(e)g(ha)o(v)o(e)e(in)o
(tro)q(duced)i(a)f(new)g(op)q(erator)g(whose)h(de\014ning)f(prop)q(ert)
o(y)g(is)g(that)601 554 y Fs(text)h Fn(s)d(<)-7 b(>)12
b Fw(\()p Fn(x)d Fq(r)866 537 y Fm(w)866 564 y(r)892
535 y Fh(0)904 554 y Fw(\()p Fn(s)p Fw(\))h Fn(y)q Fw(\))i(=)g(\()p
Fs(text)j Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))p Fq(r)1330
537 y Fm(w)1330 564 y(r)1357 554 y Fw(\()p Fs(text)j
Fn(s)d(<)-7 b(>)12 b(y)q Fw(\))340 640 y(But)20 b(recall)g(that)f(b)q
(ecause)j(of)c(the)i(in)o(v)n(arian)o(t)e(that)i Fs(Union)p
Fw(s)g(satisfy)m(,)e Fq(r)1530 625 y Fm(w)1530 651 y(r)1576
640 y Fw(c)o(ho)q(oses)j(its)e(left)340 690 y(argumen)o(t)11
b(if)f(and)h(only)g(if)f(its)h(\014rst)h(line)f(is)g(nice.)h(But)g(if)e
Fn(s)i Fw(is)f(already)g(longer)g(than)g(\()p Fn(w)5
b Fs(`min`)t Fn(r)q Fw(\),)340 740 y(then)17 b(no)f Fs(text)f
Fn(s)h(<)-7 b(>)17 b(x)e Fw(can)i(ha)o(v)o(e)f(a)g(nice)h(\014rst)g
(line.)e(So)h(in)g(this)h(case)28 b Fq(r)1539 725 y Fm(w)1539
750 y(r)1565 722 y Fh(0)1577 740 y Fw(\()p Fn(s)p Fw(\))g(can)16
b(c)o(ho)q(ose)340 790 y(its)g(righ)o(t)f(argumen)o(t)f(without)h(lo)q
(oking)f(at)i(either)g(one!)f(This)h(is)f(the)h(optimisation)d(w)o(e)i
(ha)o(v)o(e)340 840 y(b)q(een)f(trying)e(to)h(capture:)g(just)f(b)o(y)h
(lo)q(oking)e(at)h(the)h(common)d(pre\014x)j(w)o(e)g(can)g(select)g
(the)h(righ)o(t)340 890 y(branc)o(h,)h(and)f(thereb)o(y)h(the)g(v)o
(ertical)f(form)f(for)h(the)h Fs(sep)f Fw(from)f(whic)o(h)h(the)h
Fs(Union)g Fw(came.)e(The)340 939 y(complete)h(de\014nition)f(of)g
Fs(b)n(est)h Fw(app)q(ears)h(in)e(\014gure)i(16.)511
1116 y Fk(b)n(est)e Fl(w)g(r)h Fk(Nil)c Fv(=)g Fk(Nil)511
1161 y(b)n(est)j Fl(w)g(r)h Fv(\()p Fk(NilA)o(b)n(ove)d
Fl(x)p Fv(\))f(=)h Fk(NilA)o(b)n(ove)g Fv(\()p Fk(b)n(est)h
Fl(w)h(r)i(x)p Fv(\))511 1207 y Fk(b)n(est)e Fl(w)g(r)h
Fv(\()p Fl(s)9 b Fk(`T)m(extBeside`)c Fl(x)p Fv(\))11
b(=)f Fl(s)f Fk(`T)m(extBeside`)d(b)n(est)1305 1191 y
Ff(0)1328 1207 y Fl(w)14 b(r)g(s)f(x)511 1253 y Fk(b)n(est)g
Fl(w)g(r)h Fv(\()p Fk(Nest)e Fl(k)i(x)p Fv(\))d(=)f Fk(Nest)i
Fl(k)i Fv(\()p Fk(b)n(est)f Fv(\()p Fl(w)c Fi(\000)f
Fl(k)q Fv(\))13 b Fl(r)h(x)p Fv(\))511 1298 y Fk(b)n(est)f
Fl(w)g(r)h Fv(\()p Fl(x)8 b Fk(`Union`)e Fl(y)q Fv(\))11
b(=)g Fk(nic)n(est)h Fl(w)h(r)h Fv(\()p Fk(b)n(est)f
Fl(w)g(r)h(x)p Fv(\))f(\()p Fk(b)n(est)f Fl(w)h(r)h(y)q
Fv(\))511 1344 y Fk(b)n(est)f Fl(w)g(r)h Fk(Empty)c Fv(=)h
Fi(1)511 1435 y Fk(b)n(est)573 1420 y Ff(0)597 1435 y
Fl(w)i(r)h(s)f Fk(Nil)d Fv(=)g Fk(Nil)511 1481 y(b)n(est)573
1465 y Ff(0)597 1481 y Fl(w)j(r)h(s)f Fv(\()p Fk(NilA)o(b)n(ove)e
Fl(x)p Fv(\))f(=)h Fk(NilA)o(b)n(ove)g Fv(\()p Fk(b)n(est)h
Fv(\()p Fl(w)d Fi(\000)f Fk(length)k Fl(s)p Fv(\))h Fl(r)h(x)p
Fv(\))511 1527 y Fk(b)n(est)573 1511 y Ff(0)597 1527
y Fl(w)f(r)h(s)f Fv(\()p Fl(t)8 b Fk(`T)m(extBeside`)e
Fl(x)p Fv(\))11 b(=)f Fl(t)f Fk(`T)m(extBeside`)d(b)n(est)1337
1511 y Ff(0)1361 1527 y Fl(w)14 b(r)g Fv(\()p Fl(s)8
b Fv(+)-11 b(+)p Fl(t)p Fv(\))p Fl(x)511 1572 y Fk(b)n(est)573
1556 y Ff(0)597 1572 y Fl(w)13 b(r)h(s)f Fv(\()p Fk(Nest)f
Fl(k)i(x)p Fv(\))d(=)f Fk(b)n(est)987 1556 y Ff(0)1011
1572 y Fl(w)j(r)h(s)f(x)511 1618 y Fk(b)n(est)573 1602
y Ff(0)597 1618 y Fl(w)g(r)h(s)f Fv(\()p Fl(x)8 b Fk(`Union`)e
Fl(y)q Fv(\))11 b(=)g Fk(nic)n(est)1062 1602 y Ff(0)1086
1618 y Fl(w)i(r)h(s)f Fv(\()p Fk(b)n(est)1266 1602 y
Ff(0)1290 1618 y Fl(w)g(r)h(s)f(x)p Fv(\))f(\()p Fk(b)n(est)1519
1602 y Ff(0)1543 1618 y Fl(w)h(r)i(s)d(y)q Fv(\))511
1664 y Fk(b)n(est)573 1648 y Ff(0)597 1664 y Fl(w)h(r)h(s)f
Fk(Empty)d Fv(=)h Fi(1)511 1709 y Fk(nic)n(est)h Fl(w)h(r)h(x)f(y)f
Fv(=)e Fk(nic)n(est)894 1693 y Ff(0)918 1709 y Fl(w)j(r)h
Fe(\\")f Fl(x)g(y)511 1801 y Fk(nic)n(est)606 1785 y
Ff(0)630 1801 y Fl(w)h(r)g(s)e(x)h(y)f Fv(=)e Fj(if)k
Fk(\014ts)f Fv(\()p Fl(w)c Fk(`min`)e Fl(r)q Fv(\))14
b(\()p Fk(length)d Fl(s)p Fv(\))i Fl(x)f Fj(then)j Fl(x)d
Fj(else)j Fl(y)511 1892 y Fk(\014ts)e Fl(n)g(k)h(x)c
Fv(=)16 b Fj(if)e Fl(n)d(<)f(k)k Fj(then)h(false)f(else)755
1938 y(case)i Fl(x)c Fj(of)799 1983 y Fk(Nil)217 b Fi(!)12
b Fj(true)799 2029 y Fk(NilA)o(b)n(ove)f Fl(y)87 b Fi(!)12
b Fj(true)799 2075 y Fl(t)d Fk(`T)m(extBeside`)c Fl(y)13
b Fi(!)f Fk(\014ts)h Fl(n)g Fv(\()p Fl(k)d Fv(+)e Fk(length)k
Fl(t)p Fv(\))g Fl(y)799 2120 y Fi(1)230 b(!)12 b Fj(false)340
2247 y(Fig.)7 b(16.)13 b Fv(The)g(optimised)j(de\014nition)f(of)e
Fk(b)n(est)o Fv(.)403 2391 y Fw(Once)18 b(again)e(minor)g(impro)o(v)o
(emen)o(ts)f(can)i(b)q(e)h(made)e(to)h(the)h(implemen)o(tation.)c
(Quite)j(a)340 2441 y(substan)o(tial)9 b(sp)q(eed-up)i(is)f(obtained)f
(b)o(y)g(storing)h(strings)g(with)f(their)h(length)f(|)g(that)h(is,)f
(strings)340 2491 y(are)19 b(represen)o(ted)j(within)17
b(the)i(library)f(b)o(y)g(a)h(pair)f(of)f(their)i(length)g(and)f(their)
h(c)o(haracters.)p eop
%%Page: 37 37
37 36 bop 183 194 a Fw(String)19 b(concatenation)g(is)h(used)g(hea)o
(vily)e(in)h(the)h(library)f(and)g(is)g(p)q(erformed)g(in)g(constan)o
(t)183 244 y(time:)11 b(it)i(consists)h(of)f(addition)f(of)h(the)h
(lengths)g(and)f(comp)q(osition)e(of)i(the)h(c)o(haracters,)h(whic)o(h)
183 293 y(are)f(represen)o(ted)j(b)o(y)c(a)h(function)f(as)h(in)g
(section)g(4.2.)245 345 y(This)d(implemen)o(tation)e(of)i(the)h
(library)f(is)g(a)h(ma)r(jor)e(impro)o(v)o(em)o(en)o(t)g(on)h(the)h
(previous)g(ones.)183 395 y(There)h(are)g(no)g(`em)o(barrassing)e
(pauses'.)h(While)g(the)h(cost)g(of)f(prett)o(y-prin)o(ting)h(seems)f
(to)h(gro)o(w)183 445 y(sligh)o(tly)j(faster)h(than)h(linearly)m(,)d
(the)j(library)e(is)h(able)g(to)g(pro)q(duce)i(large)e(outputs)g(\()p
Fn(>)p Fw(200K\))183 495 y(in)d(little)g(space)i(and)f(reasonable)h
(time.)d(On)i(a)g(SP)m(AR)o(C)f(ELC)h(a)g(b)q(enc)o(hmark)f(program)g
(with)183 544 y(deeply)j(nested)h Fs(sep)q Fw(s)f(ev)n(aluated)f(b)q
(et)o(w)o(een)i(500)f(and)f(1000)g Fs(sep)p Fw(s)h(p)q(er)h(second.)g
(P)o(erformance)183 594 y(is)13 b(quite)i(acceptable,)f(and)g(far)g
(sup)q(erior)g(to)g(b)q(oth)g(the)h(earlier)f(term-based)g(implemen)o
(tatio)o(n)183 644 y(\(sometimes)i Fn(O)q Fw(\()p Fn(n)478
629 y Fr(2)496 644 y Fw(\)\))j(and)e(the)i(seat-of-the-pan)o(ts)f
(implemen)o(tation)d(\(whic)o(h)j(w)o(as)f(actually)183
694 y(sometimes)12 b(exp)q(onen)o(tial\).)183 839 y Fu(10)56
b(A)19 b(Con)n(text-passing)f(Prett)n(y-prin)n(ter)183
949 y Fw(The)j(k)o(ey)f(observ)n(ation)g(in)g(the)h(dev)o(elopmen)o(t)f
(of)g(the)h(e\016cien)o(t)g(com)o(binators)e(in)h(the)h(last)183
999 y(section)14 b(w)o(as)g(that)183 1097 y Fs(sep)h
Fw(\(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))f(:)g
Fs(xs)q Fw(\))g(=)h Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(sep)j
Fw(\(\()p Fs(text)g Fp(\\")c Fn(<)-7 b(>)13 b(x)p Fw(\))e(:)g
Fs(map)k Fw(\()p Fs(nest)g Fw(\()p Fq(\000)p Fs(length)h
Fn(s)p Fw(\)\))c Fs(xs)p Fw(\))183 1195 y(and)j(so)g(w)o(e)h(can)f
(`factor)g(out')g(all)f(the)i(text)g(in)f(the)h(\014rst)g(elemen)o(t)f
(of)g(a)g Fs(sep)g Fw(b)q(efore)h(splitting)183 1244
y(the)f(computation)d(in)o(to)i(a)g Fs(Union)h Fw(of)f(t)o(w)o(o)g
(alternativ)o(es.)g(W)m(e)g(exploited)g(the)h(observ)n(ation)g(b)o(y)
183 1294 y(making)e Fs(text)i Fn(s)h(<)-7 b(>)16 b(x)f
Fw(in)o(to)h(a)f(simpli\014ed)g(form,)e(and)j(testing)h(for)f(it)f(in)h
Fs(sep)p Fw(.)g(But)g(w)o(e)h(could)183 1344 y(equally)d(w)o(ell)g(ha)o
(v)o(e)h(deriv)o(ed)h(a)f(con)o(text-passing)g(implemen)o(tation,)c(in)
k(whic)o(h)g Fs(text)g Fw(tests)i(for)183 1394 y(the)h(presence)i(of)d
(an)g(enclosing)h Fs(sep)p Fw(.)f(Indeed,)i(it)e(seems)h(natural)f(to)g
(think)h(of)f(a)g Fs(Do)n(c)h Fw(as)g(a)183 1444 y(function)d(that)h(c)
o(ho)q(oses)g(a)g(la)o(y)o(out)e(dep)q(ending)i(on)g(the)g(con)o(text,)
g(and)f(this)h(is)g(ho)o(w)f(the)h(v)o(ery)183 1493 y(\014rst)e
(implemen)o(tation)d(of)i(the)h(com)o(binators)f(w)o(as)h(constructed.)
245 1545 y(What)i(kind)g(of)g(con)o(texts)i(should)f(w)o(e)g(consider?)
g(Certainly)f(observ)n(ations)h(of)f(the)h(form)183 1595
y Fs(b)n(est)d Fn(w)i(r)g Fw([)p Fq(\017)p Fw(])e(|)g(that)h(is,)g(w)o
(e)g(should)g(b)q(e)h(able)e(to)h(la)o(y)f(out)h(a)g(do)q(cumen)o(t)f
(with)h(a)g(giv)o(en)f(page)183 1645 y(and)e(ribb)q(on)h(width.)f(W)m
(e)g(will)g(also)g(need)i(to)e(la)o(y)g(out)h(do)q(cumen)o(ts)f(with)h
(a)f(giv)o(en)h(inden)o(tation,)183 1695 y(that)g(is)f(consider)i(con)o
(texts)g(of)e(the)i(form)d Fs(b)n(est)k Fn(w)e(r)h Fw(\()p
Fs(nest)h Fn(k)f Fw([)p Fq(\017)p Fw(]\).)d(If)i(w)o(e)g(tak)o(e)g
Fn(k)f Fw(=)g(0)h(then)g(this)183 1745 y(form)f(subsumes)i(the)g
(\014rst.)245 1797 y(No)o(w)e(imagine)e(that)j(a)f(union)g(app)q(ears)i
(in)e(suc)o(h)h(a)f(con)o(text.)h(W)m(e)f(can)h(simplify)d(as)i(follo)o
(ws:)320 1894 y Fs(b)n(est)i Fn(w)h(r)g Fw(\()p Fs(nest)g
Fn(k)g Fw(\()p Fn(x)9 b Fq([)g Fn(y)q Fw(\)\))j(=)g Fs(b)n(est)j
Fn(w)f(r)h Fw(\()p Fs(nest)g Fn(k)g(x)p Fw(\))p Fq(r)1192
1877 y Fm(w)1192 1905 y(r)1218 1894 y Fs(b)n(est)g Fn(w)g(r)g
Fw(\()p Fs(nest)g Fn(k)f(y)q Fw(\))183 1992 y(W)m(e)i(exp)q(ect)i(to)f
(con)o(tin)o(ue)g(w)o(orking)e(on)i Fn(x)p Fw(,)f(so)g(w)o(e)h(m)o(ust)
f(b)q(e)h(able)g(to)f(represen)o(t)j(con)o(texts)f(of)183
2042 y(the)c(form)f Fs(b)n(est)h Fn(w)h(r)g Fw(\()p Fs(nest)g
Fn(k)g Fw([)p Fq(\017)p Fw(]\))p Fq(r)750 2027 y Fm(w)750
2052 y(r)775 2042 y Fn(b)f Fw(also.)f(W)m(e)h(can)g(think)g(of)f
Fn(b)h Fw(as)g(the)h(la)o(y)o(out)e(to)g(c)o(ho)q(ose)i(if)183
2092 y(w)o(e)g(are)h(forced)g(to)f(bac)o(ktrac)o(k.)h(Once)g(again,)e
(the)i(conditions)f(on)g(unions)g(will)f(enable)i(us)g(to)183
2142 y(decide)e(whic)o(h)g(of)g Fn(x)f Fw(and)h Fn(b)f
Fw(to)h(c)o(ho)q(ose)h(purely)f(on)g(the)g(basis)g(of)f(the)i(v)n(alue)
e(of)g Fn(x)p Fw(.)245 2194 y(Of)i(course,)h(in)f(order)h(to)g(apply)e
(the)i(k)o(ey)g(optimisation)c(w)o(e)k(m)o(ust)e(b)q(e)i(able)f(to)g
(recognise)183 2243 y(when)h(a)g(do)q(cumen)o(t)g(is)g(the)h(\014rst)g
(elemen)o(t)f(of)g(an)g(enclosing)g Fs(sep)p Fw(.)g(W)m(e)g(shall)g
(therefore)h(need)183 2293 y(con)o(texts)12 b(of)f(the)h(form)e
Fn(C)s Fw([)p Fs(sep)k Fw([[)p Fq(\017)p Fw(])p Fn(;)7
b(y)766 2299 y Fr(1)790 2293 y Fn(:)g(:)g(:)e(y)865 2299
y Fm(n)888 2293 y Fw(]].)10 b(Moreo)o(v)o(er,)i(the)g(optimisation)d
(applies)i(to)g(do)q(c-)183 2343 y(umen)o(ts)g(of)g(the)h(form)e
Fs(text)15 b Fn(s)d(<)-7 b(>)12 b(x)p Fw(.)f(But)h(when)g(suc)o(h)g(a)f
(do)q(cumen)o(t)h(app)q(ears)g(at)f(the)i(top)e(lev)o(el,)183
2393 y(w)o(e)j(shall)f(need)i(to)e(ev)n(aluate)661 2491
y Fs(b)n(est)i Fn(w)g(r)g Fw(\()p Fs(nest)g Fn(k)g Fw(\()p
Fs(text)f Fn(s)e(<)-7 b(>)13 b(x)p Fw(\)\))p eop
%%Page: 38 38
38 37 bop 340 194 a Fw(T)m(o)11 b(do)f(so)h(w)o(e)h(m)o(ust)e(b)q(e)h
(able)g(to)g(ev)n(aluate)f Fn(x)p Fw(,)h(and)f(w)o(e)i(therefore)g
(need)g(to)f(b)q(e)g(able)g(to)g(represen)o(t)340 244
y(its)k(con)o(text)f(in)g(this)g(expression.)h(W)m(e)f(shall)f(add)h
(con)o(texts)h(of)f(the)h(form)d Fn(C)s Fw([)p Fs(text)i
Fn(s)e(<)-7 b(>)13 b Fw([)p Fq(\017)p Fw(]])f(to)340
293 y(co)o(v)o(er)j(this)f(case.)403 343 y(When)f(w)o(e)g(la)o(y)f(out)
h Fn(x)e(<)-7 b(>)12 b(y)j Fw(and)e Fn(x)7 b Fw($$)g
Fn(y)q Fw(,)13 b(w)o(e)g(shall)f(start)i(b)o(y)f(la)o(ying)e(out)i
Fn(x)p Fw(.)f(W)m(e)h(therefore)340 393 y(ha)o(v)o(e)i(to)g(represen)o
(t)j(the)e(con)o(texts)g Fn(C)s Fw([[)p Fq(\017)p Fw(])c
Fn(<)-7 b(>)14 b(y)q Fw(])i(and)f Fn(C)s Fw([[)p Fq(\017)p
Fw(])8 b($$)h Fn(y)q Fw(].)15 b(And)h(when)g(w)o(e)f(expand)g(a)340
443 y Fs(sep)e Fw(in)o(to)f(a)g(union)f(of)h(t)o(w)o(o)g(alternativ)o
(es,)g(the)h(horizon)o(tal)e(alternativ)o(e)h(app)q(ears)h(inside)g
Fs(\014t)p Fw(.)f(W)m(e)340 493 y(m)o(ust)h(therefore)j(represen)o(t)g
(con)o(texts)f(of)e(the)i(form)d Fn(C)s Fw([)p Fs(\014t)i
Fw([)p Fq(\017)p Fw(]])e(also.)403 542 y(So)h(w)o(e)h(c)o(ho)q(ose)h
(con)o(texts)g(of)e(the)i(forms)771 614 y Fn(C)s Fw([)p
Fq(\017)p Fw(])10 b(::=)h Fs(b)n(est)k Fn(N)j(N)h Fw(\()p
Fs(nest)c Fn(N)k Fw([)p Fq(\017)p Fw(]\))881 677 y Fq(j)33
b Fs(b)n(est)15 b Fn(N)j(N)h Fw(\()p Fs(nest)c Fn(N)k
Fw([)p Fq(\017)p Fw(]\))p Fq(r)1363 659 y Fm(w)1363 687
y(r)1389 677 y Fn(E)881 739 y Fq(j)33 b Fn(C)s Fw([)p
Fs(text)14 b Fn(s)e(<)-7 b(>)12 b Fw([)p Fq(\017)p Fw(]])881
801 y Fq(j)33 b Fn(C)s Fw([)p Fs(sep)14 b Fw([[)p Fq(\017)p
Fw(])p Fn(;)7 b(E)g(:)g(:)g(:)e(E)r Fw(]])881 863 y Fq(j)33
b Fn(C)s Fw([)p Fs(\014t)14 b Fw([)p Fq(\017)p Fw(]])881
926 y Fq(j)33 b Fn(C)s Fw([[)p Fq(\017)p Fw(])10 b Fn(<)-7
b(>)12 b(E)r Fw(])881 988 y Fq(j)33 b Fn(C)s Fw([[)p
Fq(\017)p Fw(])7 b($$)i Fn(E)r Fw(])340 1060 y(where)21
b Fn(N)j Fw(represen)o(ts)f(in)o(teger)c(expressions,)i(and)e
Fn(E)j Fw(represen)o(ts)g(do)q(cumen)o(t)d(expressions.)340
1110 y(Con)o(texts)c(can)f(b)q(e)g(represen)o(ted)j(b)o(y)d(the)g
(follo)o(wing)e(Hask)o(ell)h(datat)o(yp)q(e:)729 1182
y Ft(data)i Fs(Cxt)26 b Fw(=)12 b Fs(BestNest)j(Int)f(Int)g(Int)936
1244 y Fq(j)21 b Fs(BestNestOr)14 b(Int)g(Int)g(Int)g(Do)n(c)936
1306 y Fq(j)21 b Fs(T)m(extBeside)15 b(String)f(Cxt)936
1368 y Fq(j)21 b Fs(Sep)16 b Fw([)p Fs(Do)n(c)p Fw(])d
Fs(Cxt)936 1431 y Fq(j)21 b Fs(Fit)15 b(Cxt)936 1493
y Fq(j)21 b Fs(Beside)16 b(Do)n(c)e(Cxt)936 1555 y Fq(j)21
b Fs(A)o(b)n(ove)15 b(Do)n(c)g(Cxt)403 1627 y Fw(Must)e(w)o(e)f
(consider)i(suc)o(h)f(complex)e(con)o(texts,)i(or)f(can)h(w)o(e)f
(apply)g(the)h(la)o(ws)f(of)g(the)h(prett)o(y-)340 1677
y(prin)o(ting)g(algebra)g(to)g(simplify)d(them?)i(Unfortunately)m(,)g
(w)o(e)i(ha)o(v)o(e)f(b)q(een)h(unable)f(to)g(eliminate)340
1727 y(an)o(y)h(of)f(the)h(forms)e(of)h(con)o(text)h(giv)o(en)f(ab)q(o)
o(v)o(e.)g(Certainly)m(,)f(some)h(con)o(text)h(simpli\014cations)e(are)
340 1776 y(p)q(ossible.)k(In)g(particular,)f(w)o(e)h(can)g(alw)o(a)o
(ys)f(mo)o(v)o(e)f Fs(T)m(extBeside)i Fw(up)g(to)g(the)g(top)g(lev)o
(el)g(|)f(this)340 1826 y(is)j(after)g(all)e(the)j(observ)n(ation)e
(that)h(the)g(k)o(ey)g(optimisation)d(is)i(based)i(on.)e(But)h(w)o(e)g
(cannot)340 1876 y(usefully)h(com)o(bine)e Fs(T)m(extBeside)i
Fw(with)f(the)h(enclosing)g Fs(BestNest)f Fw(or)h Fs(BestNestOr)o
Fw(,)f(b)q(ecause)340 1926 y(there)c(w)o(ould)e(then)h(b)q(e)g(no)f(w)o
(a)o(y)g(to)g(express)i(a)e Fs(BestNest)g(without)g Fw(a)g
Fs(T)m(extBeside)p Fw(:)g(no)g(instance)340 1976 y(of)809
2019 y Fs(b)n(est)j Fn(w)g(r)f Fw(\()p Fs(nest)h Fn(k)g
Fw(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b Fw([)p Fq(\017)p
Fw(]\)\))340 2079 y(is)i(equal)g(to)916 2122 y Fs(b)n(est)g
Fn(w)h(r)g Fw(\()p Fs(nest)g Fn(k)g Fw([)p Fq(\017)p
Fw(]\))340 2182 y(b)q(ecause)h Fs(text)f Fp(\\")c Fn(<)-7
b(>)12 b(x)f Fq(6)p Fw(=)h Fn(x)i Fw(in)f(general.)403
2232 y(W)m(e)g(can)h(also)g(use)g(the)h(facts)838 2304
y Fs(\014t)g Fw(\()p Fn(x)9 b Fw($$)g Fn(y)q Fw(\))j(=)g
Fq(;)710 2366 y Fs(sep)j Fw(\(\()p Fn(x)10 b Fw($$)e
Fn(y)q Fw(\))13 b(:)e Fn(z)r(s)p Fw(\))h(=)g Fn(x)d Fw($$)g
Fn(y)i Fw($$)e Fs(foldr1)14 b Fw(\($$\))p Fn(z)r(s)809
2428 y Fw(\()p Fn(x)9 b Fw($$)g Fn(y)q Fw(\))h($$)e Fn(z)14
b Fw(=)e Fn(x)d Fw($$)g(\()p Fn(y)i Fw($$)e Fn(z)r Fw(\))788
2491 y(\()p Fn(x)g Fw($$)g Fn(y)q Fw(\))j Fn(<)-7 b(>)12
b(z)i Fw(=)e Fn(x)d Fw($$)g(\()p Fn(y)k(<)-7 b(>)13 b(z)r
Fw(\))p eop
%%Page: 39 39
39 38 bop 183 194 a Fw(to)16 b(simplify)d(con)o(texts)18
b(in)e(whic)o(h)g Fs(A)o(b)n(ove)h Fw(o)q(ccurs)h(inside)e
Fs(Fit)p Fw(,)f Fs(Sep)q Fw(,)h Fs(A)o(b)n(ove)h Fw(or)f
Fs(Beside)p Fw(.)g(If)g(w)o(e)183 244 y(could)d(alw)o(a)o(ys)g(mo)o(v)o
(e)f Fs(A)o(b)n(ove)i Fw(to)g(the)h(top)e(lev)o(el,)h(w)o(e)g(could)f
(apply)313 332 y Fs(b)n(est)i Fn(w)g(r)g Fw(\()p Fs(nest)g
Fn(k)f Fw(\()p Fn(x)c Fw($$)e Fn(y)q Fw(\)\))13 b(=)f
Fs(b)n(est)i Fn(w)h(r)g Fw(\()p Fs(nest)g Fn(k)g(x)p
Fw(\))9 b($$)g Fs(b)n(est)14 b Fn(w)h(r)g Fw(\()p Fs(nest)g
Fn(k)g(y)q Fw(\))183 421 y(But)f(alas,)f(w)o(e)h(cannot)g(simplify)d
Fs(text)k Fn(s)d(<)-7 b(>)12 b Fw(\()p Fn(x)d Fw($$)g
Fn(y)q Fw(\))15 b(without)e(kno)o(wing)g(more)g(ab)q(out)h
Fn(x)p Fw(.)245 472 y(In)g(fact)h(there)g(is)g(no)f(form)e(of)i(con)o
(text)h(whic)o(h)f(can)h Fs(always)f Fw(b)q(e)h(simpli\014ed)e(a)o(w)o
(a)o(y)m(,)f(and)i(w)o(e)183 521 y(m)o(ust)f(just)h(w)o(ork)f(with)h
(this)g(rather)g(complex)f(set.)245 572 y(No)o(w)h(that)g(the)i(con)o
(texts)f(ha)o(v)o(e)f(b)q(een)i(c)o(hosen,)f(the)g(actual)f(deriv)n
(ation)f(of)h(an)g(implemen-)183 622 y(tation)d(follo)o(ws)f(exactly)h
(the)i(same)d(metho)q(d)h(as)h(in)f(earlier)h(sections.)g(W)m(e)g(will)
e(not)h(go)g(through)183 672 y(the)16 b(details.)e(W)m(e)i(simply)d
(remark)i(that,)g(just)g(as)h(in)f(the)h(previous)g(section,)f(the)h
(implemen-)183 721 y(tation)c(has)h(a)f(space)i(leak.)e(`P)o(ending')g
(applications)f(of)i Fs(nest)f Fw(\014ll)g(up)h(the)h(heap.)e(And)h(to)
g(a)o(v)o(oid)183 771 y(this,)i(just)i(as)f(in)g(the)g(previous)h
(section,)f(w)o(e)h(com)o(bine)e(an)g(application)g(of)h
Fs(nest)g Fw(with)g(other)183 821 y(op)q(erators.)e(In)g(this)g(case)h
(w)o(e)f(de\014ne)h(t)o(w)o(o)e(forms)g(of)g(con)o(text)h(with)g(a)g
(`built-in')d Fs(nest)p Fw(:)495 910 y Fs(A)o(b)n(oveNest)k
Fn(k)g(y)h(C)e Fw(=)e Fn(C)s Fw([[)p Fq(\017)p Fw(])7
b($$)i Fs(nest)15 b Fn(k)f(y)q Fw(])523 972 y Fs(SepNest)h
Fn(k)g Fs(ys)f Fn(C)g Fw(=)e Fn(C)s Fw([)p Fs(sep)i Fw(\([)p
Fq(\017)p Fw(])d(:)g Fs(map)k Fw(\()p Fs(nest)g Fn(k)q
Fw(\))f Fs(ys)p Fw(\)])183 1061 y(In)g(the)g(deriv)o(ed)g(implemen)o
(tation,)c(when)15 b(w)o(e)f(exploit)183 1150 y Fs(sep)h
Fw(\(\()p Fs(text)g Fn(s)d(<)-7 b(>)12 b(x)p Fw(\))f(:)g
Fs(xs)q Fw(\))g(=)h Fs(text)j Fn(s)d(<)-7 b(>)12 b Fs(sep)j
Fw(\(\()p Fs(text)g Fp(\\")c Fn(<)-7 b(>)13 b(x)p Fw(\))e(:)g
Fs(map)k Fw(\()p Fs(nest)g Fw(\()p Fq(\000)p Fs(length)h
Fn(s)p Fw(\)\))c Fs(xs)p Fw(\))183 1239 y(and)17 b(the)h(corresp)q
(onding)g(prop)q(ert)o(y)g(for)f(\($$\),)g(w)o(e)g(just)h(ha)o(v)o(e)f
(to)g(c)o(hange)g(a)g(n)o(um)o(b)q(er)g(in)g Fn(x)p Fw('s)183
1289 y(con)o(text,)d(instead)g(of)f(building)g(applications)g(of)g
Fs(nest)p Fw(.)183 1391 y Fs(Evaluation)j(of)g(the)g(Context-p)n
(assing)h(Combinators)22 b Fw(This)15 b(v)o(ersion)g(of)g(the)h(prett)o
(y-prin)o(ting)183 1441 y(library)11 b(is)i(de\014nitely)f(more)f
(complex)h(than)g(the)h(term-based)f(v)o(ersions,)h(as)f(a)g
(consequence)j(of)183 1491 y(the)g(rather)h(complex)e(forms)g(of)g(con)
o(text)i(w)o(e)f(w)o(ere)h(forced)f(to)g(w)o(ork)g(with.)f(It)h(is)g
(also)g(harder)183 1541 y(to)f(mo)q(dify:)f(in)h(particular,)g(a)h(c)o
(hange)g(to)g(the)h(w)o(a)o(y)e(the)i(b)q(est)g(la)o(y)o(out)e(is)g(c)o
(hosen)i(w)o(ould)f(ha)o(v)o(e)183 1590 y(far)e(reac)o(hing)h
(e\013ects.)h(In)e(the)h(term-based)g(libraries,)f Fs(b)n(est)g
Fw(is)h(a)f(separate)i(function)e(and)g(ma)o(y)183 1640
y(b)q(e)f(replaced)h(with)f(another)g(without)g(altering)f(the)i(rest)g
(of)e(the)i(library)m(.)d(But)j(in)e(the)i(con)o(text-)183
1690 y(passing)i(library)m(,)f(ev)o(ery)j(com)o(binator)c(kno)o(ws)j
(ho)o(w)f(to)h(b)q(eha)o(v)o(e)g(in)f(a)g Fs(BestNest)h
Fw(con)o(text:)g(the)183 1740 y(criterion)e(for)f(selecting)i(the)g(b)q
(est)g(la)o(y)o(out)d(is)i(distributed)g(throughout)g(the)h(co)q(de.)
245 1790 y(This)k(could)g(b)q(e)g(a)g(fair)f(price)i(to)f(pa)o(y)f(for)
h(b)q(etter)i(p)q(erformance.)d(But)h(at)g(least)h(in)e(m)o(y)183
1840 y(implem)o(en)o(tation,)11 b(the)j(con)o(text)h(passing)f(library)
f(is)h(\(a)g(little\))g(slo)o(w)o(er)g(than)g(the)g(term)g(based)183
1890 y(one,)g(and)g(uses)h(\(a)f(little\))f(more)h(space.)g(Its)h(only)
e(adv)n(an)o(tage)h(seems)g(to)g(b)q(e)h(that)f(it)g(do)q(es)g(not)183
1940 y(require)f(lazy)f(ev)n(aluation,)f(as)h(the)h(term)f(based)h
(library)f(do)q(es)h(\(to)f(mak)o(e)f(tra)o(v)o(ersing)i(one)f(path)183
1990 y(through)i(an)g(enormous)f(tree)i(e\016cien)o(t\).)g(If)e(one)i
(w)o(ere)g(to)f(reimplemen)o(t)e(the)j(prett)o(y-prin)o(ting)183
2039 y(library)c(in)g(a)g(strict)i(functional)e(language)g(suc)o(h)h
(as)g(ML,)f(the)i(con)o(text)f(passing)g(v)o(ersion)g(migh)o(t)183
2089 y(pro)o(v)o(e)i(more)f(e\016cien)o(t)h(than)g(sim)o(ulating)d
(laziness)j(with)g(references)i(and)e(n)o(ullary)f(functions.)183
2192 y Fs(R)n(elationship)g(to)f(the)h(Original)f(Implementation)19
b Fw(The)12 b(\014rst)g(implemen)o(tatio)o(n)d(of)i(the)h(prett)o(y-)
183 2242 y(prin)o(ting)d(com)o(binators)f(w)o(as)i(indeed)h(based)f(on)
g(con)o(text-passing,)g(with)g(con)o(texts)h(represen)o(ted)183
2292 y(b)o(y)f(a)g(\014v)o(e-tuple)h(con)o(taining)e(the)i(page)f
(width,)g(ribb)q(on)g(width,)g(length)g(of)g(text)h(to)f(the)h(left)f
(\()p Fs(c.f.)183 2341 y Fn(C)s Fw([)p Fs(text)k Fn(s)h(<)-7
b(>)15 b Fw([)p Fq(\017)p Fw(]]\),)f(a)i(b)q(o)q(olean)f(forcing)h(a)f
(one-line)h(la)o(y)o(out)e(\()p Fs(c.f.)i Fn(C)s Fw([)p
Fs(\014t)e Fw([)p Fq(\017)p Fw(]],)g(and)h(a)h(b)q(o)q(olean)183
2391 y(indicating)10 b(whether)j(the)f(surrounding)g(con)o(text)h(w)o
(as)e(horizon)o(tal)g(or)h(v)o(ertical.)f(Suc)o(h)h(a)f(design)183
2441 y(seems)f(natural,)f(if)g(one)i(in)o(tuitiv)o(ely)d(exp)q(ects)k
(a)e(prett)o(y-prin)o(ter)i(just)e(to)g(main)o(tain)d(a)j(little)g
(state)183 2491 y(\(the)k(con)o(text\))g(to)f(guide)g(la)o(y)o(out)e(c)
o(hoices.)j(But)g(as)f(w)o(e)g(ha)o(v)o(e)g(seen,)h(this)f(con)o(text)h
(information)p eop
%%Page: 40 40
40 39 bop 340 194 a Fw(is)12 b(not)f(su\016cien)o(t)i(to)e(implemen)o
(t)e(the)j(correct)i(b)q(eha)o(viour)d(of)g(the)h(com)o(binators)f(|)g
(whic)o(h)g(w)o(as)340 244 y(an)j(obstacle)g(to)g(the)h
Fs(disc)n(overy)e Fw(of)h(the)g(simple)f(sp)q(eci\014cation)h(they)h
(no)o(w)e(satisfy)m(.)403 294 y(Moreo)o(v)o(er)d(the)g(p)q(erformance)g
(of)f(the)i(com)o(binators)d(w)o(as)i(p)q(o)q(or,)f(at)h(\014rst)h(exp)
q(onen)o(tial)e(in)h(the)340 344 y(depth)16 b(of)f Fs(sep)p
Fw(-nesting,)g(later)g(impro)o(v)o(ed)e(to)i(square.)h(F)m(urther)f
(optimisations)e(w)o(ere)j(hard)f(to)340 394 y(\014nd,)10
b(b)q(ecause)h(of)f(the)g(lac)o(k)f(of)h(a)f(go)q(o)q(d)h(algebra,)f
(and)g(no)h(doubt)g(also)f(b)q(ecause)i(of)f(the)g(necessary)340
444 y(complexit)o(y)k(of)h(the)h(solution)e(|)h(the)h(e\016cien)o(t)g
(con)o(text-passing)g(library)f(describ)q(ed)i(in)e(this)340
494 y(section)g(is)f(nothing)f(one)h(w)o(ould)f(stum)o(ble)g(on)h(b)o
(y)f(acciden)o(t.)403 544 y(The)g(\014rst)h(implem)o(en)o(tation)c(w)o
(as)j(dev)o(elop)q(ed)g(rapidly)m(,)e(and)i(its)g(usefulness)h(w)o(as)f
(certainly)340 594 y(an)h(inspiration)f(to)h(dev)o(elop)g(the)h
(solutions)e(presen)o(ted)j(in)e(this)g(c)o(hapter.)g(But)h(in)e
(retrosp)q(ect,)340 644 y(the)i(seemingly)e(natural)h(c)o(hoice)h(of)f
(a)g(con)o(text-passing)h(implemen)o(tatio)o(n)d(w)o(as)i(unfortunate.)
340 694 y(Abandoning)j(that)g(c)o(hoice,)g(and)g(w)o(orking)f(with)g(a)
h(more)f(abstract)i(sp)q(eci\014cation)g(and)f(sys-)340
744 y(tematic)11 b(program)f(dev)o(elopmen)o(t,)h(led)g(b)q(oth)h(to)g
(b)q(etter)h(b)q(eha)o(viour)f(and)f(m)o(uc)o(h)g(more)g(e\016cien)o(t)
340 794 y(implemen)o(tations.)340 933 y Fu(11)56 b(A)19
b(Comparison)f(with)h(Opp)r(en's)f(Prett)n(y-prin)n(ter)340
1038 y Fw(The)13 b(classic)f(w)o(ork)g(in)f(`language)g(indep)q(enden)o
(t)i(prett)o(y-prin)o(ting')e(is)h(Opp)q(en's)h(prett)o(y-prin)o(ter)
340 1088 y([3].)d(He)j(de\014ned)f(a)g(small)d(language)i(for)g
(expressing)i(do)q(cumen)o(ts,)e(and)g(an)h(in)o(terpreter)h(for)f(the)
340 1138 y(language)k(whic)o(h)g(generates)j(a)d(prett)o(y)h(la)o(y)o
(out.)e(The)i(output)g(of)f(a)g(user's)i(prett)o(y-prin)o(ter)f(is)340
1188 y(th)o(us)f(in)o(tended)f(to)g(b)q(e)g(pip)q(ed)g(through)g(the)g
(in)o(terpreter.)h(The)g(in)o(terpreter)g(is)f(written)g(in)f(an)340
1237 y(imp)q(erativ)o(e)f(language,)f(and)i(its)g(space)h(requiremen)o
(ts)f(are)g(small.)403 1288 y(The)k(similarit)o(y)c(b)q(et)o(w)o(een)19
b(Opp)q(en's)g(language)e(and)g(m)o(y)f(prett)o(y-prin)o(ting)i(com)o
(binators)340 1338 y(is)d(striking.)f(Opp)q(en)i(pro)o(vides)f(equiv)n
(alen)o(ts)g(of)f Fs(text)p Fw(,)g Fs(sep)q Fw(,)g(and)h
Fs(nest)p Fw(,)f(and)h(his)g(language)f(can)340 1388
y(also)19 b(express)i(\()-7 b Fn(<)g(>)g Fw(\),)19 b(although)f(w)o
(ell-formed)f(do)q(cumen)o(ts)i(should)g(not)g(con)o(tain)g(it.)f(Opp)q
(en)340 1438 y(also)c(pro)o(vides)g(a)g(v)n(arian)o(t)f(of)g
Fs(sep)i Fw(whic)o(h)f(places)g(as)h(man)o(y)d(elemen)o(ts)i(as)g(will)
f(\014t)h(on)g(one)g(line,)340 1487 y(then)h(places)g(more)f(on)g(the)h
(next)g(line,)e(and)h(so)g(on.)g(An)h(equiv)n(alen)o(t)e(com)o(binator)
g(could)h(v)o(ery)340 1537 y(usefully)g(b)q(e)g(added)h(to)e(m)o(y)f
(prett)o(y-prin)o(ting)i(library)m(.)403 1588 y(On)c(the)h(other)g
(hand,)e(Opp)q(en's)i(in)o(terpreter)h(is)e(quite)g(large)g(and)g(hard)
g(to)g(understand.)h(His)340 1638 y(pap)q(er)18 b(describ)q(es)h(its)f
(b)q(eha)o(viour)f(for)f(`w)o(ell-formed')f(inputs,)h(but)i(the)g(in)o
(terpreter)h(accepts)340 1688 y(a)g(wider)h(class)g(of)f(inputs,)g(and)
g(its)g(b)q(eha)o(viour)g(on)h(the)g(others)g(is)f(hard)h(to)f
(predict.)h(The)340 1738 y(in)o(terpreter)c(de\014nes)f(the)g(meaning)d
(of)h(ev)o(ery)i(program,)d(but)i(in)f(a)h(monolithic)d(w)o(a)o(y)i(|)h
(there)340 1787 y(is)c(no)g(w)o(a)o(y)g(to)g(describ)q(e)i(the)f
(meaning)d(of)i(one)g(construct)i(in)e(isolation.)e(Moreo)o(v)o(er)j
(it)f(isn't)g(clear)340 1837 y(whic)o(h)i(of)f(the)h(p)q(ossible)g(la)o
(y)o(outs)f(the)h(in)o(terpreter)i(actually)c(c)o(ho)q(oses.)j(One)f(w)
o(a)o(y)f(to)g(regard)i(the)340 1887 y(prett)o(y-prin)o(ting)d(com)o
(binators)e(is)i(as)g(a)g(candidate)g(for)f(a)h(denotational)f(seman)o
(tics)g(of)g(Opp)q(en's)340 1937 y(language.)403 1988
y(Opp)q(en's)14 b(in)o(terpreter)i(is)e(probably)f(more)f(e\016cien)o
(t)j(than)e(our)h(com)o(binators,)e(but)i(on)g(the)340
2037 y(other)k(hand)f(our)h(libraries)e(are)i(probably)f(easier)h(to)f
(mo)q(dify)m(.)d(F)m(or)i(example,)g(to)h(mak)o(e)f(the)340
2087 y(prett)o(y-prin)o(ter)f(lo)q(ok)d(ahead)h(a)g(few)g(lines)g(and)f
(a)o(v)o(oid)g(immi)o(nen)o(t)f(line)i(o)o(v)o(er\015o)o(ws)g(b)o(y)f
(breaking)340 2137 y(lines)j(earlier,)g(rather)h(than)f(making)d
(decisions)j(only)g(on)f(the)i(basis)f(of)f(the)i(curren)o(t)g(line,)e
(w)o(e)340 2187 y(w)o(ould)g(just)g(need)h(to)f(rede\014ne)i(the)f
Fs(b)n(est)f Fw(function.)f(A)o(t)i(least)f(with)g(the)g(\014rst)h(t)o
(w)o(o)f(implemen-)340 2237 y(tations)f(w)o(e)g(describ)q(ed,)h(the)f
(other)h(com)o(binators)d(could)i(b)q(e)g(reused)h(as)f(they)g(are.)g
(It)g(is)g(not)f(at)340 2287 y(all)g(clear)i(what)f(c)o(hanges)g(w)o
(ould)g(need)h(to)f(b)q(e)g(made)f(to)h(Opp)q(en's)h(in)o(terpreter)h
(to)e(ac)o(hiev)o(e)h(the)340 2336 y(same)f(e\013ect.)340
2433 y Fs(Exer)n(cise)7 b(5.)21 b Fw(Sp)q(ecify)f(and)f(implemen)o(t)d
(Opp)q(en's)21 b Fs(sep)p Fw(-v)n(arian)o(t,)d(whic)o(h)h(allo)o(ws)f
(sev)o(eral)i(ele-)340 2483 y(men)o(ts)14 b(p)q(er)g(line)g(in)f(a)h(v)
o(ertical)g(la)o(y)o(out.)e Fs(Warning)i Fw(this)g(is)g(a)g(substan)o
(tial)f(exercise!)p eop
%%Page: 41 41
41 40 bop 183 194 a Fu(12)56 b(Conclusions)183 293 y
Fw(In)14 b(this)h(c)o(hapter)h(w)o(e)f(ha)o(v)o(e)f(considered)j(the)e
(design)g(of)f(com)o(binator)f(libraries.)h(W)m(e)g(sa)o(w)h(ho)o(w)183
343 y(studying)10 b(the)h(algebraic)f(prop)q(erties)i(of)e(the)h(com)o
(binators)e(desired)i(can)g(b)q(oth)g(help)f(to)h(suggest)183
393 y(natural)f(c)o(hoices)i(of)e(represen)o(tation,)h(and)g(guide)g
(the)g(implemen)o(tatio)o(n)d(of)i(the)i(op)q(erators.)f(W)m(e)183
443 y(sa)o(w)k(sev)o(eral)i(examples)e(|)g(lists,)g(monads,)f(and)i(a)g
(prett)o(y-prin)o(ting)f(library)m(.)g(F)m(or)g(this)h(kind)183
493 y(of)g(program)f(dev)o(elopmen)o(t)g(w)o(e)i(need)g(a)g(language)e
(with)i(higher-order)g(functions)f(and)h(lazy)183 542
y(ev)n(aluation,)10 b(for)j(whic)o(h)f(equational)g(reasoning)h(is)f(v)
n(alid;)f(in)h(other)h(w)o(ords,)g(Hask)o(ell)f(is)h(ideally)183
592 y(suited.)245 642 y(In)18 b(the)h(case)h(of)e(prett)o(y-prin)o
(ting,)f(studying)i(the)g(algebra)f(led)g(to)g(the)h(correction)h(of)e
(a)183 692 y(subtle)e(error)h(in)f(the)g(com)o(binators')e(b)q(eha)o
(viour,)i(and)g(to)f(the)i(dev)o(elopmen)o(t)e(of)h(m)o(uc)o(h)e(more)
183 742 y(e\016cien)o(t)e(implemen)o(tations.)d(The)k(prett)o(y-prin)o
(ting)f(algebra)g(is)g(just)h(to)q(o)f(in)o(tricate)g(to)g(rely)h(on)
183 791 y(in)o(tuition)8 b(alone:)g(w)o(orking)h(informally)d(I)j
(could)h(not)f(see)i(ho)o(w)e(to)g(implemen)o(t)e(the)j(optimisation)
183 841 y(considered)j(in)f(section)h(9,)f(nor)g(could)g(I)h(in)o(v)o
(en)o(t)f(the)h(represen)o(tation)h(used)f(there.)g(The)g(formal)183
891 y(approac)o(h)g(has)i(b)q(een)g(in)o(v)n(aluable.)245
941 y(The)i(prett)o(y-prin)o(ting)g(library)g(itself)f(has)h(pro)o(v)o
(ed)h(useable,)f(despite)h(its)f(simplicit)o(y)m(.)d(In-)183
991 y(deed,)h(v)o(ersions)g(of)f(it)g(ha)o(v)o(e)g(seen)i(quite)f
(extensiv)o(e)h(use,)e(in)h(program)e(transformation)f(to)q(ols,)183
1041 y(pro)q(of)17 b(assistan)o(ts,)h(and)f(compilers.)f(All)h(the)h
(prett)o(y-prin)o(ters)h(in)e(b)q(oth)h(the)g(Chalmers)f(and)183
1090 y(the)d(Glasgo)o(w)f(Hask)o(ell)g(compilers)g(are)h(written)g
(using)g(v)n(arian)o(ts)f(of)h(this)f(design.)183 1225
y Fu(References)183 1320 y Fv(1.)20 b(Lennart)38 b(Augustsson,)f
Fk(Haskel)r(l)c(B.)j(user's)e(manual)p Fv(,)g(a)o(v)n(ailable)40
b(o)o(v)o(er)d(WWW)h(from)233 1366 y Fg(http://www)o(.cs)o(.c)o(hal)o
(mer)o(s.)o(se:)o(80)o(/pu)o(b/h)o(as)o(kel)o(l/)o(cha)o(lm)o(ers)o(/)p
Fv(.)183 1412 y(2.)20 b(Konstan)o(tin)11 b(L\177)-19
b(aufer,)8 b Fk(Combining)g(T)m(yp)n(e)i(Classes)e(and)h(Existential)e
(T)m(yp)n(es)p Fv(,)g(Pro)q(c.)i(Latin)g(American)233
1457 y(Informatics)14 b(Conference)g(\(P)m(ANEL\),)e(ITESM-CEM,)g
(Mexico,)i(Septem)o(b)q(er)g(1994.)183 1503 y(3.)20 b(Derek)11
b(C.)e(Opp)q(en,)i Fk(Pr)n(etty-printing)p Fv(,)6 b(in)11
b(A)o(CM)f(T)m(ransactions)i(on)e(Programming)i(Languages)g(and)233
1549 y(Systems,)i(V)m(ol.)f(2,)f(No.)h(4,)f(Octob)q(er)i(1980.)p
eop
%%Page: 42 42
42 41 bop 340 194 a Fu(A)57 b(The)18 b(Optimised)e(Prett)n(y-prin)n
(ting)i(Library)340 293 y Fa(module)j(NewPP\(Doc,\(<>\),\($)o($\),te)o
(xt,se)o(p,nes)o(t,pr)o(etty\))d(where)340 343 y(import)j(Seq)340
443 y(infixl)g(<>)340 493 y(infixl)g($$)340 592 y(data)g(Doc)h(=)f(Nil)
370 b(--)21 b(text)g("")537 642 y(|)g(NilAbove)f(Doc)174
b(--)21 b(text)g("")h($$)f(x)537 692 y(|)g(Str)g(`TextBeside`)f(Doc--)g
(text)h(s)h(<>)f(x)537 742 y(|)g(Nest)g(Int)g(Doc)174
b(--)21 b(nest)g(k)h(x)537 791 y(|)f(Doc)g(`Union`)g(Doc)108
b(--)21 b(x)h(U)g(y)537 841 y(|)f(Empty)326 b(--)21 b({})537
891 y(deriving)f(\(Text\))340 991 y(type)h(Str)h(=)f
(\(Int,String->Strin)o(g\))428 1041 y(--)g(optimised)f(rep)h(of)g
(strings:)g(fast)g(length,)f(fast)h(concat.)340 1090
y(len)h(\(i,_\))e(=)i(i)340 1140 y(\(i,s\))f(`cat`)g(\(j,t\))g(=)g
(\(i+j,s.t\))340 1190 y(str)h(s)f(=)h(\(length)e(s,\(s++\)\))340
1240 y(string)h(\(i,s\))g(=)g(s)h([])340 1339 y(text)f(s)h(=)g(str)f(s)
g(`TextBeside`)f(Nil)340 1439 y(nest)h(k)h(x)g(=)f(Nest)g(k)h(x)340
1539 y(x)g($$)f(y)h(=)g(aboveNest)d(x)j(0)g(y)340 1638
y(aboveNest)e(Nil)h(k)h(y)g(=)f(NilAbove)f(\(nest)h(k)h(y\))340
1688 y(aboveNest)e(\(NilAbove)g(x\))i(k)f(y)h(=)f(NilAbove)g
(\(aboveNest)e(x)j(k)f(y\))340 1738 y(aboveNest)f(\(s)i(`TextBeside`)d
(x\))i(k)h(y)g(=)384 1788 y(seq)f(k')384 1838 y(\(s)g(`TextBeside`)f
(\(aboveNest)f(\(Nil<>x\))i(k')g(y\)\))384 1887 y(where)g(k')g(=)h
(k-len)e(s)340 1937 y(aboveNest)g(\(Nest)h(k')g(x\))h(k)f(y)h(=)384
1987 y(seq)f(k'')g(\(Nest)g(k')g(\(aboveNest)f(x)i(k'')f(y\)\))384
2037 y(where)g(k'')g(=)g(k-k')340 2087 y(aboveNest)f(\(x)i(`Union`)e
(y\))h(k)h(z)g(=)384 2136 y(aboveNest)e(x)h(k)h(z)g(`Union`)e
(aboveNest)g(y)i(k)f(z)340 2186 y(aboveNest)f(Empty)h(k)h(x)f(=)h
(Empty)p eop
%%Page: 43 43
43 42 bop 183 194 a Fa(Nil)21 b(<>)g(\(Nest)g(k)h(x\))f(=)h(Nil)f(<>)g
(x)183 244 y(Nil)g(<>)g(x)h(=)f(x)183 293 y(NilAbove)f(x)h(<>)h(y)f(=)h
(NilAbove)e(\(x)h(<>)h(y\))183 343 y(\(s)f(`TextBeside`)e(x\))j(<>)f(y)
h(=)f(s)h(`TextBeside`)d(\(x)j(<>)f(y\))183 393 y(Nest)g(k)g(x)h(<>)f
(y)h(=)f(Nest)g(k)h(\(x)f(<>)h(y\))183 443 y(Empty)e(<>)i(y)f(=)h
(Empty)183 493 y(\(x)f(`Union`)f(y\))i(<>)f(z)h(=)f(\(x)h(<>)f(z\))g
(`Union`)g(\(y)g(<>)h(z\))183 592 y(sep)f([x])g(=)h(x)183
642 y(sep)f(\(x:ys\))f(=)i(sep')f(x)h(0)f(ys)183 742
y(sep')g(Nil)g(k)g(ys)h(=)f(fit)h(\(foldl)e(\(<+>\))h(Nil)g(ys\))531
791 y(`Union`)g(vertical)f(Nil)h(k)h(ys)183 841 y(sep')f(\(NilAbove)f
(x\))h(k)h(ys)f(=)g(vertical)g(\(NilAbove)f(x\))h(k)h(ys)183
891 y(sep')f(\(s)g(`TextBeside`)e(x\))j(k)f(ys)h(=)226
941 y(s)g(`TextBeside`)d(sep')i(\(Nil)g(<>)g(x\))h(\(k-len)e(s\))i(ys)
183 991 y(sep')f(\(Nest)f(n)i(x\))f(k)h(ys)f(=)h(Nest)f(n)g(\(sep')g(x)
h(\(k-n\))f(ys\))183 1041 y(sep')g(\(x)g(`Union`)f(y\))i(k)f(ys)h(=)f
(sep')g(x)h(k)f(ys)h(`Union`)e(vertical)g(y)i(k)f(ys)183
1090 y(sep')g(Empty)f(k)i(ys)f(=)h(Empty)183 1190 y(vertical)e(x)h(k)h
(ys)f(=)h(x)g($$)f(nest)g(k)g(\(foldr1)g(\($$\))g(ys\))183
1240 y(x)g(<+>)g(y)h(=)g(x)f(<>)h(text)f(")g(")h(<>)f(y)183
1339 y(fit)g(Nil)g(=)h(Nil)183 1389 y(fit)f(\(NilAbove)f(x\))h(=)h
(Empty)183 1439 y(fit)f(\(s)g(`TextBeside`)f(x\))h(=)g(s)h
(`TextBeside`)d(\(fit)i(x\))183 1489 y(fit)g(\(Nest)g(n)g(x\))h(=)f
(Nest)g(n)h(\(fit)f(x\))183 1539 y(fit)g(\(x)g(`Union`)g(y\))g(=)h(fit)
f(x)183 1588 y(fit)g(Empty)g(=)g(Empty)183 1688 y(best)g(w)g(r)h(Nil)f
(=)h(Nil)183 1738 y(best)f(w)g(r)h(\(NilAbove)e(x\))h(=)h(NilAbove)e
(\(best)h(w)g(r)h(x\))183 1788 y(best)f(w)g(r)h(\(s)f(`TextBeside`)e
(x\))j(=)f(s)h(`TextBeside`)d(best')i(w)h(r)f(s)h(x)183
1838 y(best)f(w)g(r)h(\(Nest)f(k)g(x\))h(=)f(Nest)g(k)h(\(best)e
(\(w-k\))h(r)h(x\))183 1887 y(best)f(w)g(r)h(\(x)f(`Union`)g(y\))g(=)g
(nicest)g(w)h(r)f(\(best)g(w)h(r)f(x\))h(\(best)e(w)i(r)f(y\))183
1937 y(best)g(w)g(r)h(Empty)f(=)g(Empty)183 2037 y(best')f(w)i(r)g(s)f
(Nil)g(=)h(Nil)183 2087 y(best')e(w)i(r)g(s)f(\(NilAbove)f(x\))h(=)h
(NilAbove)e(\(best)h(\(w-len)g(s\))g(r)g(x\))183 2136
y(best')f(w)i(r)g(s)f(\(t)h(`TextBeside`)d(x\))i(=)226
2186 y(t)h(`TextBeside`)d(best')i(w)g(r)h(\(s)f(`cat`)g(t\))h(x)183
2236 y(best')e(w)i(r)g(s)f(\(Nest)g(k)h(x\))f(=)g(best')g(w)h(r)f(s)h
(x)183 2286 y(best')e(w)i(r)g(s)f(\(x)h(`Union`)e(y\))h(=)226
2336 y(nicest')g(w)g(r)h(s)f(\(best')g(w)g(r)h(s)g(x\))f(\(best')g(w)g
(r)h(s)f(y\))183 2385 y(best')f(w)i(r)g(s)f(Empty)g(=)h(Empty)p
eop
%%Page: 44 44
44 43 bop 340 194 a Fa(nicest)21 b(w)h(r)f(x)h(y)f(=)h(nicest')e(w)i(r)
f(\(str)g(""\))h(x)f(y)340 244 y(nicest')g(w)g(r)h(s)f(x)h(y)g(=)f(if)h
(fits)f(\(w)g(`min`)g(r\))g(\(len)g(s\))g(x)h(then)f(x)h(else)f(y)340
343 y(fits)g(n)h(k)g(x)f(=)h(if)f(n<k)g(then)g(False)g(else)667
393 y(case)g(x)h(of)711 443 y(Nil)f(->)g(True)711 493
y(NilAbove)f(y)i(->)f(True)711 542 y(t)g(`TextBeside`)f(y)h(->)h(fits)f
(n)g(\(k+len)g(t\))g(y)711 592 y(Empty)g(->)g(False)340
692 y(layout)g(k)h(\(Nest)e(k')i(x\))f(=)h(layout)e(\(k+k'\))h(x)340
742 y(layout)g(k)h(x)f(=)h([')f(')h(|)f(i<-[1..k]])f(++)h(layout')g(k)g
(x)340 841 y(layout')g(k)g(Nil)g(=)h("\\n")340 891 y(layout')f(k)g
(\(NilAbove)f(x\))i(=)f("\\n")g(++)h(layout)e(k)i(x)340
941 y(layout')f(k)g(\(s)h(`TextBeside`)d(x\))i(=)h(string)f(s)g(++)g
(layout')g(\(k+len)f(s\))i(x)340 1041 y(pretty)f(w)h(r)f(d)h(=)f
(layout)g(0)g(\(best)g(w)h(r)f(d\))340 2483 y Fv(This)14
b(article)g(w)o(as)f(pro)q(cessed)i(using)f(the)f(L)968
2474 y Fo(A)985 2483 y Fv(T)1007 2491 y(E)1028 2483 y(X)f(macro)h(pac)o
(k)n(age)h(with)g(LLNCS)e(st)o(yle)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
